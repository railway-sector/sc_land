const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationProfileChart-C09Hd19Z.js","assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/ResponsiveTheme-W2ZTqcEa.js","assets/Theme-BNDyEbhG.js","assets/elevationProfileGenerationUtils-B6RIgc1c.js","assets/elevationProfileGeometryUtils-u3tjjsiT.js","assets/geodesicUtils-BJZXB7Hp.js","assets/chartUtilsAm5-BjTQp-zo.js","assets/Tooltip-D_XnmscP.js","assets/DefaultTheme-BDw4Uk0K.js","assets/substitute-D-eLZ17Q.js","assets/LineSeries-BYwLTTln.js","assets/ColorSet-COuxoDU3.js","assets/Tick-Dczb9D2J.js","assets/Button-C43v8qZn.js","assets/area-BRK1xFzQ.js"])))=>i.map(i=>d[i]);
import{U as u,ds as d,eB as v,Y as V,y as g,f as p,bH as f,B as m,b1 as A,e as n,g as O}from"./index-BrQW8HOS.js";import{p as b}from"./geodesicMeasurementUtils-CQw8IWGR.js";import{P as y,H as U,A as F,v as T}from"./async-utils-Ct29LAJ6.js";import{e as l,o as _}from"./maybe-BQxFr9e1.js";import{n as H}from"./handle-YQAj7gpI.js";function R(t){return t.forceInteractive()}function D(t){return v(t,"meters").value>b}function x(t){return t.viewData.intersectingSegments.size===0}async function M(t){const{ElevationProfileChart:e}=await u(()=>import("./ElevationProfileChart-C09Hd19Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]));return d(t.signal),new e({analysisView:t.analysisView,container:t.container,messages:t.messages,onCursorPositionChange:t.onCursorPositionChange,onRangeChange:t.onRangeChange,uniformScaling:t.uniformScaling??!1,view:t.view})}var I=Object.defineProperty,k=Object.getOwnPropertyDescriptor,i=(t,e,a,r)=>{for(var o=r>1?void 0:r?k(e,a):e,c=t.length-1,h;c>=0;c--)(h=t[c])&&(o=(r?h(e,a,o):h(o))||o);return r&&o&&I(e,a,o),o};let s=class extends V{constructor(){super({}),this.shouldForceInteractive=!0,this._ownsAnalysis=!1,this._operationState="inactive",this._loggedUnsupportedErrorMessage=!1,this._changeFromReconnect=!1,this._startUserOperation=null}initialize(){this._set("analysis",this.constructAnalysis()),this._ownsAnalysis=!0;const t=()=>{!this._changeFromReconnect&&!this._viewHasAnalysis&&(this._ownsAnalysis=!1);const e=!this._changeFromReconnect;this._changeFromReconnect=!1,e&&this._scheduleViewReconnect()};this.addHandles([g(()=>this.view?.ready&&!this.supported,()=>{this._loggedUnsupportedErrorMessage||console.error(this.unsupportedErrorMessage)},{sync:!0,initial:!0}),p(()=>[this.analysis,this._viewHasAnalysis],t,{sync:!0}),f(()=>this.view,"analysis-view-destroy",e=>{e.analysis===this.analysis&&t()}),p(()=>({view:this.view,ready:!!this.view?.ready,supported:this.supported}),({view:e},a)=>{const r=a?.view;e!==r&&(this._startUserOperation=l(this._startUserOperation),this._disconnectFromView(r)),this._scheduleViewReconnect()},{sync:!0,initial:!0})])}destroy(){this._reconnectViewTask=l(this._reconnectViewTask),this._startUserOperation=l(this._startUserOperation),this._analysisView!=null&&(this._analysisView.visible=void 0),this._disconnectFromView(this.view),this._set("view",null),this._ownsAnalysis&&this.analysis?.destroy()}get supported(){return this.view==null||this.supportedViewType==="both"||this.view.type===this.supportedViewType}set visible(t){this._set("visible",t),this._analysisView!=null&&(this._analysisView.visible=t)}get active(){return this._startUserOperation?.state===2}get disabled(){return!this.view?.ready||!this.supported}set analysis(t){t!==this._get("analysis")&&(this._startUserOperation=l(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(t),this._scheduleViewReconnect())}get analysisView(){return this._analysisView}get ready(){return this._analysisView!=null&&!this.connectingToView}get connectingToView(){return this._reconnectViewTask!=null}get _viewHasAnalysis(){const{view:t}=this;return t?.analyses.includes(this.analysis)===!0}get operationState(){return this._operationState}clear(){this.clearAnalysis(),this._startUserOperation=l(this._startUserOperation)}async start(t){if(!this.visible){console.warn("Cannot start analysis when not visible");return}t?.clear!==!1&&this.clear();const e={task:null,abort:null,state:0},a=y(async r=>{if(e.state=1,await m(()=>this.ready,r),e.state=2,this._analysisView==null||this.view==null)return;this._operationState="active";const o=t?.operation?.({signal:r})??this.place({signal:r});await A(o)});return a.promise.finally(()=>{(this._startUserOperation===e||this._startUserOperation==null)&&(this._operationState="inactive")}),e.task=a,e.abort=()=>a.abort(),this._startUserOperation=e,await a.promise}stop(){this._startUserOperation=l(this._startUserOperation)}onConnectToAnalysisView(t){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=l(this._reconnectViewTask);const t=y(async e=>{try{await this._reconnectView(e)}catch(a){if(U(e),!F(a)){console.warn("Failed to use analysis in view model",a);return}throw a}finally{t===this._reconnectViewTask&&(this._reconnectViewTask=void 0)}});this._reconnectViewTask=t}async _reconnectView(t){const{view:e}=this,a=e?.ready&&this.supported,r=this.analysis;if(this._startUserOperation=w(this._startUserOperation),this._disconnectFromView(e),!a||e==null||r==null)return;this._ownsAnalysis&&(this._changeFromReconnect=!0,e.analyses.add(r));const o=await e.whenAnalysisView(r);if(this._analysisView=o,T(t)){this._startUserOperation=w(this._startUserOperation);return}o.visible=this.visible,this._forceInteractiveHandle=this.shouldForceInteractive?R(o):H(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(o)}_disconnectFromView(t){t!=null&&this._ownsAnalysis&&t.analyses.includes(this.analysis)&&(this._changeFromReconnect=!0,this.analysis.clear(),t.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=_(this._forceInteractiveHandle),this._analysisView=void 0}_setExternalAnalysis(t){this._analysisView!=null&&!this._ownsAnalysis&&(this._analysisView.visible=void 0,this._forceInteractiveHandle=_(this._forceInteractiveHandle)),this._analysisView=void 0,this._ownsAnalysis=!1,this._set("analysis",t),this._changeFromReconnect=!1}};i([n()],s.prototype,"supported",1);i([n()],s.prototype,"view",2);i([n({type:Boolean,value:!0})],s.prototype,"visible",1);i([n()],s.prototype,"active",1);i([n()],s.prototype,"disabled",1);i([n()],s.prototype,"analysis",1);i([n()],s.prototype,"_analysisView",2);i([n()],s.prototype,"shouldForceInteractive",2);i([n()],s.prototype,"analysisView",1);i([n()],s.prototype,"ready",1);i([n()],s.prototype,"connectingToView",1);i([n()],s.prototype,"_ownsAnalysis",2);i([n()],s.prototype,"_viewHasAnalysis",1);i([n()],s.prototype,"_reconnectViewTask",2);i([n()],s.prototype,"_forceInteractiveHandle",2);i([n()],s.prototype,"_operationState",2);i([n()],s.prototype,"operationState",1);s=i([O("esri.components.support.AnalysisViewModel")],s);function w(t){return t!=null&&t.state>=2?(t.abort(),null):t}export{s as e,D as r,M as s,x as t};
