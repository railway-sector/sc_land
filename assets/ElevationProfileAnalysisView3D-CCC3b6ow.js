import{as as x,gH as L,fE as G,f as m,ff as H,xq as U,aD as q,gF as A,xr as F,rZ as B,fD as M,l_ as N,gG as Z,xs as j,p2 as $,bD as W,_ as i,e as s,g as f,Z as P,a$ as Y,$ as D,xt as J,l6 as K,b9 as Q,aZ as X,ay as ee,aB as te,df as ie,lG as se}from"./index-CgzAF5Ey.js";import{e as re}from"./AnalysisView3D-CCEFTtOd.js";import{p as oe,t as w,r as ne,o as ae,l as le,a as pe,k as ue,n as ce,u as he,b as de,L as ye}from"./ElevationProfileTool-tF46_S13.js";import{b as me}from"./settings-TkGYLJPj.js";import{R}from"./OutlineVisualElement-BGztVhlD.js";import{l as ve}from"./throttle-CJw3Glso.js";import{i as _e}from"./elevationProfileGenerationUtils-CkNvrUxw.js";import"./AnalysisView-P9qsDIPr.js";import"./createUtils-IRSfXt-_.js";import"./Circle-BiDO0Dld.js";import"./geodesicUtils-Cfv0uT1u.js";import"./distanceOperator-kpocAfUa.js";import"./Point2D-8Py_srEd.js";import"./Distance2DCalculator-CXhBP-8I-RGTjIsY8.js";import"./ProjectionTransformation-D72vYhR2.js";import"./Envelope2D-DQ3Tn1o-.js";import"./Transformation2D-Ckyhe4wc.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-CvNJfrRe.js";import"./jsonConverter-EjytI4Do.js";import"./simplifyOperator-CkrCdZRR.js";import"./operatorSimplify-CpftPpUB.js";import"./surfaceCoordinateSystems-Czhjgkml.js";import"./mat2d-DWPHXQcf.js";import"./mat2df64-DJ_RMjZ3.js";import"./getDefaultUnitForView-DdQQf52Q.js";import"./elevationProfileGeometryUtils-DivoHbyN.js";import"./GraphicsLayer-CNIUk38A.js";import"./ExclusiveOperationManager-CEJDD66z.js";import"./SketchViewModel-DhxBVxKu.js";import"./isSupportedObject-DSxuxd5I.js";import"./layerUtils-C4kbKZbG.js";import"./SketchLabelOptions-CtWdh0ak.js";import"./SketchOptions-DsWZlvNP.js";import"./SnappingManager-C_Xw3YlC.js";import"./euclideanLengthMeasurementUtils-CGkbgpIY.js";import"./utils-DN_jc3_L.js";import"./geometry2dUtils-DamFhDZI.js";import"./geodeticLengthOperator-CCmu1UCP.js";import"./geodeticCurveType-CirnHLSB.js";import"./geodesicMeasurementUtils-CD0H_C-6.js";import"./automaticAreaMeasurementUtils-BatsSLDN.js";import"./geodesicAreaMeasurementUtils-CadONabs.js";import"./earcut-D9gy186-.js";import"./automaticLengthMeasurementUtils-B1DzL2GL.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-Be4j1swo.js";import"./VisualElement-C3IrjIMj.js";import"./LaserlinePath.glsl-BvuzGQiU.js";import"./line-C6GoSWqB.js";import"./line-B8sYvboW.js";import"./triangulationUtils-Bm38jwp7.js";import"./deduplicate-Cq87yrC4.js";const fe=2e5;let l=class extends oe{constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=w(()=>{const e=this._view;return e?{view:e,stationary:e.stationary,geometry:this.controller?.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},$),this._getStableSpatialReference=w(()=>this._view?.spatialReference,W),this._getStableLayerIds=w(()=>ne(this._view),$),this._getStablePointCloudLayers=w(()=>{const e=this._view;return e?e.allLayerViews.toArray().filter(t=>t.layer?.type==="point-cloud").map(t=>t.layer):[]},$),this._vecA=x(),this._vecB=x(),this._ray=L()}get minDemResolution(){const e=this._view;if(!e)return null;const t=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return t==null?null:t*G(e.spatialReference)}initialize(){const e=()=>this.onInvalidate(this);return this.addHandles([m(()=>this._queryElevationDependencies,e,H),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:r}){const n=this._queryElevationDependencies;if(n==null)throw new Error(`${this.declaredClass}: no dependencies`);const a=this._intersector;if(a==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:u,view:h,spatialReference:c}=n,V=h.renderCoordsHelper,T=h.sceneIntersectionHelper,O=this._vecA,g=this._vecA,v=this._vecB,k=this._ray;if(!c)return{geometry:e,noDataValue:t};const b=await U.fromGeometry(e).project(c,r);if(!b)return{geometry:e,noDataValue:t};const z=b.coordinates,C=z.length;for(let E=0;E<C;++E){const _=z[E];q(v,_.x,_.y,_.z??0),V.toRenderCoords(v,c,v),V.setAltitude(O,fe,v);const S=A(O,v,k);T.computeIntersection(S,a,!0,u);const I=ge(n,a.results.all);I?(I.getIntersectionPoint(g),V.fromRenderCoords(g,g,c),_.z=g[2]):_.z=t}return{geometry:b.export(),noDataValue:t}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const e=this._view;if(!e||e.destroyed)return{};const{include:t,exclude:r}=this.profile;return F(e,{include:t,exclude:[...this._pointCloudLayers,...B(r)?r:r?[r]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const e=this.controller.view;return e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?M(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(!e)return null;const t=new N(e.state.viewingMode),r=t.options;return r.hud=!1,r.invisibleTerrain=!1,r.backfacesTerrain=!1,r.selectionMode=!1,r.store=2,t}};function ge({intersectOptions:e,maxIntersectionDistance:t,view:r},n){const a=e.graphics,u=!(!a?.include&&!a?.exclude);for(const h of n)if(h.withinDistance(t)){if(u){const c=Z(h,r);if(c!=null&&!j(a,c))continue}return h}return null}i([s({readOnly:!0})],l.prototype,"minDemResolution",null),i([s()],l.prototype,"_queryElevationDependencies",null),i([s()],l.prototype,"_intersectOptions",null),i([s()],l.prototype,"_pointCloudLayers",null),i([s()],l.prototype,"_view",null),i([s()],l.prototype,"_maxIntersectionDistance",null),i([s()],l.prototype,"_intersector",null),l=i([f("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],l);let d=class extends P{constructor(t){super(t),this._visualElementHandle=null}initialize(){this._settings=new me({getTheme:()=>this.view.effectiveTheme}),this.addHandles(ae({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:t=>this._show(t)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=Y(this._visualElementHandle)}_show(t){this._remove();const{view:r}=this,n=new R({view:r,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),a=[m(()=>this.analysisViewData.analysis.elevationInfo,u=>{n.elevationInfo=u,n.isDraped=J(!0,u)==="on-the-ground"},D),m(()=>this.analysisViewData.analysis.geometry,u=>{n.geometry=u}),r.maskOccludee(t),K(n)];this._settings.visualElements.lineObjects.outline.apply(n),n.attached=!0,this._visualElementHandle=Q(a)}};i([s({constructOnly:!0})],d.prototype,"view",void 0),i([s({constructOnly:!0})],d.prototype,"analysisViewData",void 0),i([s()],d.prototype,"updating",null),d=i([f("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],d);let p=class extends P{constructor(e){super(e),this._updateGeometryThrottled=ve(t=>{if(!t)return;const{samples:r,spatialReference:n}=t,a=r!=null&&r.length>0;this._visualElement.geometry=a?le(r,n):null},_e().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new R({view:this.view,elevationInfo:X,innerWidth:0,innerColor:ee(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([m(()=>({color:this._result?.computation.profile.color,visible:this._effectiveVisible}),({color:e,visible:t})=>{e&&(this._visualElement.color=te(ie.toUnitRGBA(e))),this._visualElement.visible=t},D),m(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},D),m(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),D),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:e,_result:t}=this;return e.visible&&t!=null&&t.available&&t.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:this._result?.samples,spatialReference:this.view.spatialReference}}};i([s()],p.prototype,"view",void 0),i([s()],p.prototype,"analysisViewData",void 0),i([s()],p.prototype,"getResult",void 0),i([s()],p.prototype,"updating",null),i([s()],p.prototype,"_result",null),i([s()],p.prototype,"_effectiveVisible",null),i([s()],p.prototype,"_geometryUpdateParameters",null),p=i([f("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],p);let y=class extends P{constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new pe({view:e,analysisViewData:t}),this._geometryVisualization=new d({view:e,analysisViewData:t}),this._lineVisualizations=se(()=>this.analysisViewData.analysis.profiles,r=>new p({view:e,analysisViewData:t,getResult:()=>t.results.find(n=>n.computation.profile===r)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};i([s()],y.prototype,"view",void 0),i([s()],y.prototype,"analysisViewData",void 0),i([s()],y.prototype,"updating",null),y=i([f("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],y);let o=class extends re{constructor(e){super(e),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new ue({analysis:e,analysisViewData:this,view:t,computationFactory:{create:r=>{switch(r.profile.type){case"ground":return new de(r);case"input":return new he(r);case"query":return new ce(r);case"scene":return new l(r)}}}}),this._visualization=new y({view:t,analysisViewData:this}),this._sketchTool=new ye({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:"meters",elevation:"meters"}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return this._controller?.updating===!0||this._visualization?.updating===!0||this._sketchTool?.updating===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};i([s({readOnly:!0})],o.prototype,"type",void 0),i([s({constructOnly:!0,nonNullable:!0})],o.prototype,"analysis",void 0),i([s({readOnly:!0})],o.prototype,"effectiveDisplayUnits",null),i([s({readOnly:!0})],o.prototype,"error",null),i([s()],o.prototype,"hoveredPosition",void 0),i([s()],o.prototype,"hoveredPoints",null),i([s({readOnly:!0})],o.prototype,"progress",null),i([s({readOnly:!0})],o.prototype,"results",null),i([s({readOnly:!0})],o.prototype,"statistics",null),i([s({readOnly:!0})],o.prototype,"updating",null),i([s()],o.prototype,"sketchGraphic",null),i([s()],o.prototype,"toolState",null),i([s()],o.prototype,"_controller",void 0),i([s()],o.prototype,"_visualization",void 0),i([s()],o.prototype,"_sketchTool",void 0),o=i([f("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],o);const Dt=o;export{Dt as default};
