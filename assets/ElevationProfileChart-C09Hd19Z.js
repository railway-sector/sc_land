import{a5 as B,Y as W,ex as U,ey as N,ds as Z,rh as q,f as j,ap as P,eA as X,bX as J,ri as K,b8 as Q,by as tt,_ as u,e as h,g as et}from"./index-BrQW8HOS.js";import{R as Y,D as it}from"./ResponsiveTheme-W2ZTqcEa.js";import{i as v,F as st,s as ot}from"./elevationProfileGenerationUtils-B6RIgc1c.js";import{h as nt,N as at}from"./chartUtilsAm5-BjTQp-zo.js";import{s as rt}from"./substitute-D-eLZ17Q.js";import{X as lt,b as dt,V as z,A as pt,a as ct,L as ut}from"./LineSeries-BYwLTTln.js";import{l as S,c as g,a as ht,C as ft}from"./Theme-BNDyEbhG.js";import{T as O}from"./Tooltip-D_XnmscP.js";import"./elevationProfileGeometryUtils-u3tjjsiT.js";import"./geodesicUtils-BJZXB7Hp.js";import"./DefaultTheme-BDw4Uk0K.js";import"./ColorSet-COuxoDU3.js";import"./Tick-Dczb9D2J.js";import"./Button-C43v8qZn.js";import"./area-BRK1xFzQ.js";const k=.001,mt=.1,gt=.02,T=15,y=12,M="#f8f8f8",E="#a9a9a9",A="#323232",C={fontFamily:"Avenir Next",paddingBottom:y/2,paddingLeft:0,paddingRight:0,paddingTop:0,axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:E,axisTooltipFontSize:12,axisTooltipBackgroundColor:A,axisTooltipLabelColor:M,axisTooltipPaddingTop:Math.round(y/4),axisTooltipPaddingBottom:Math.round(y/4),axisTooltipPaddingHorizontal:Math.round(T/4),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(y/2),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(T/4),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:M,seriesTooltipLabelColor:A,seriesFillLighten:.9,seriesTooltipSpacing:y/2,seriesTooltipPaddingVertical:Math.round(T/4),seriesTooltipPaddingHorizontal:Math.round(T/4)},xt={...C,axisGridStroke:A,axisLabelsColor:E,axisTooltipBackgroundColor:A,axisTooltipLabelColor:M,seriesTooltipBackgroundColor:A,seriesTooltipLabelColor:M,seriesFillLighten:-.75},F={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function _t({data:e,pixelWidth:t,pixelHeight:i}){if(!e)return F;const s=e.statistics,o=0,n=s?.maxDistance;let a=s?.minElevation,r=s?.maxElevation;if(n==null||a==null||r==null)return F;const l=Math.max(n-o,k);let d=Math.max(r-a,k);const f=e.effectiveUnits;if(e.dynamicElevationRange){const c=B(l,f.distance,f.elevation);d=Math.max(d,c/v().maxChartRatio)}return a-=gt*d,r=a+d+mt*d,[a,r]=vt(a,r,10),d=r-a,e.uniformScaling?yt({data:e,bounds:{minX:o,maxX:n,minY:a,maxY:r},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:o,maxX:o+l,minY:a,maxY:a+d}}function yt({data:e,bounds:t,pixelWidth:i,pixelHeight:s,centered:o}){if(!e)return t;let{minX:n,maxX:a,minY:r,maxY:l}=t;if(n==null||a==null||r==null||l==null)return F;const d=a-n,f=l-r,c=e.effectiveUnits,m=B(f,c.elevation,c.distance)/s/(d/i);return m>=1?[n,a]=H([n,a],m):[r,l]=H([r,l],1/m),{minX:n,maxX:a,minY:r,maxY:l}}function vt(e,t,i=10){const s=w(t-e,!1);if(s===0)return[e,t];const o=w(s/(i-1),!0);return[Math.floor(e/o)*o,Math.ceil(t/o)*o]}function w(e,t){const i=Math.floor(Math.log10(e)),s=e/10**i;let o;return o=t?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*10**i}function H([e,t],i,s){const o=(t-e)*i;{const n=(e+t)/2-o/2;return[n,n+o]}}let p=class extends W{get chartVisible(){const e=this._chartData;if(e==null)return!1;let t=0;for(const{samples:i}of e.lines)t+=i?.length??0;return e.refined||t<=v().largeChartSamples}get spinnerVisible(){return this._chartData!=null&&(this.analysisView?.progress??0)<1}get _updateParameters(){const{messages:e,_unitsMessages:t}=this;if(e&&t)return{data:this._chartData,messages:e,unitsMessages:t}}get _chartData(){const{analysisView:e,uniformScaling:t}=this;if(!this._hasGeometry||!e)return;const{analysis:i,effectiveDisplayUnits:s,progress:o,statistics:n}=e;return{lines:this._lineData,statistics:n,effectiveUnits:s,refined:o===1,uniformScaling:t,dynamicElevationRange:i.profiles.some(a=>a.type==="scene")}}get _hasGeometry(){return this.analysisView?.analysis.geometry!=null}get _lineData(){const{analysisView:e}=this;if(!e)return[];const{analysis:t,results:i}=e,{profiles:s}=t;if(i.length!==s.length)return[];const o=[];for(let n=0;n<s.length;n++){const a=s.at(n),r=i.at(n);if(!r.available||!r.rawResult?.hasZ||!a.chartOptions.lineVisible)continue;const l=a.type!=="input";o.push({id:a.id,type:a.type,title:a.title,color:a.color,samples:r.samples,fillEnabled:l,strokeOffsetY:l?-1:0,strokeWidth:1.5})}return o}constructor(e){super(e),this.view=null,this.analysisView=null,this.messages=null,this.uniformScaling=!1,this._theme=C,this._data=null,this._seriesInfos=new Map,this._pointerIsOver=!1,this._rtl=!1,this._chartInfo=null,this._unitsMessages=null}initialize(){this.addHandles(U(e=>this._initializeChart(e)))}destroy(){this._chartInfo=null,this._seriesInfos.clear(),this._data=null}zoomOut(){this._chartInfo?.xAxis.zoom(0,1),this._chartInfo?.yAxis.zoom(0,1)}async _initializeChart(e){const[t,i]=await Promise.all([nt(this.container),N("esri/core/t9n/Units")]);Z(e);const s=Lt(this.container),o=q(this.container),n=o?xt:C;t.setThemes(o?[Y.new(t),it.new(t)]:[Y.new(t)]),this._rtl=s,this._theme=n,this._unitsMessages=i;const a=t.container.children.push(lt.new(t,{panX:!0,panY:!0,paddingTop:n.paddingTop,paddingBottom:n.paddingBottom,paddingLeft:s?n.paddingRight:n.paddingLeft,paddingRight:s?n.paddingLeft:n.paddingRight,maxTooltipDistance:-1}));a.zoomOutButton.set("forceHidden",!0);const r=a.xAxes.push(this._createXAxis(t)),l=a.yAxes.push(this._createYAxis(t));this._chartInfo={chart:a,xAxis:r,yAxis:l};const d=dt.new(a.root,{behavior:"none",xAxis:r,yAxis:l,snapToSeriesBy:"y"});d.lineY.set("visible",!1),a.set("cursor",d),this._initializeTest(a),this.addHandles([this._setupZoomHandling(),this._setupCursorHandling(),G(t),j(()=>this._updateParameters,this._update.bind(this))]),this._update(this._updateParameters)}_initializeTest(e){}_update(e){if(!e||this.destroyed)return;const t=this._data,i=e.data;if(i===t&&e.messages===this.messages&&e.unitsMessages===this._unitsMessages)return;const s=t!==i,o=t?.effectiveUnits!==i?.effectiveUnits,n=t?.uniformScaling!==i?.uniformScaling;this._data=i,this._chartInfo?.chart.get("cursor")?.set("forceHidden",!i?.refined),(s||o)&&(this._updateAxes(),this._updateSeries()),n&&this.zoomOut(),this._updateTooltips()}_createXAxis(e){const t=this._theme,i=z.new(e,{renderer:pt.new(e,{})});i.setAll({extraMax:0,extraMin:0,maxDeviation:0,numberFormatter:this._makeFormatter(e,"distance"),strictMinMax:!0,strictMinMaxSelection:!0}),i.axisHeader.set("forceHidden",!0);const s=i.get("renderer");s.setAll({inside:!1,minGridDistance:t.xAxisMinGridDistance}),s.labels.template.setAll({centerX:S,centerY:S,fill:g(t.axisLabelsColor),fontFamily:t.fontFamily,fontSize:t.axisLabelsFontSize,fontWeight:t.axisLabelsFontWeight,maxPosition:t.xAxisMaxLabelPosition,minPosition:t.xAxisMinLabelPosition,paddingLeft:0,paddingRight:0,paddingTop:t.xAxisLabelsSpacing});const o=i.set("tooltip",O.new(e,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));return o.get("background")?.setAll({fill:g(t.axisTooltipBackgroundColor),stroke:void 0}),o.label.setAll({fill:g(t.axisTooltipLabelColor),fontFamily:t.fontFamily,fontSize:t.axisTooltipFontSize,paddingBottom:t.axisTooltipPaddingBottom,paddingLeft:t.axisTooltipPaddingHorizontal,paddingRight:t.axisTooltipPaddingHorizontal,paddingTop:t.axisTooltipPaddingTop,direction:this._rtl?"rtl":"ltr"}),s.grid.template.setAll({strokeOpacity:1,stroke:g(t.axisGridStroke)}),i}_createYAxis(e){const t=this._theme,i=this._rtl,s=z.new(e,{renderer:ct.new(e,{})});s.setAll({baseValue:v().noDataValue,extraMax:0,extraMin:0,maxDeviation:0,numberFormatter:this._makeFormatter(e,"elevation"),strictMinMax:!0,strictMinMaxSelection:!0,tooltip:void 0}),s.axisHeader.set("visible",!1);const o=s.get("renderer");return o.setAll({minGridDistance:t.yAxisMinGridDistance,opposite:i,inside:!0}),o.labels.template.setAll({centerX:S,centerY:ht,fill:g(t.axisLabelsColor),fontFamily:t.fontFamily,fontSize:t.axisLabelsFontSize,fontWeight:t.axisLabelsFontWeight,maxPosition:t.yAxisMaxLabelPosition,minPosition:t.yAxisMinLabelPosition,paddingBottom:0,paddingLeft:i?0:t.yAxisLabelSpacing,paddingRight:i?t.yAxisLabelSpacing:0,paddingTop:0,textAlign:"start"}),o.grid.template.setAll({strokeOpacity:1,stroke:g(t.axisGridStroke)}),s}_setupZoomHandling(){const e=this._chartInfo;if(!e)return P();const{xAxis:t,yAxis:i}=e,s=()=>{this.onRangeChange?.(b(t),b(i))},o=n=>[n.on("start",s),n.on("end",s)];return R([...o(t),...o(i)])}_setupCursorHandling(){const e=this._chartInfo;if(!e)return P();const{chart:t,xAxis:i,yAxis:s}=e,o=t.get("cursor"),n=t.plotContainer.events,a=l=>{this._pointerIsOver=l,this._updateTooltips()},r=()=>{a(!1),this.onCursorPositionChange?.(null,null)};return R([o?.events.on("cursormoved",()=>{if(!this._pointerIsOver)return;this._updateTooltips();let l=o?.getPrivate("positionX")??0,d=o?.getPrivate("positionY")??0;const f=this._data;if(f?.statistics!=null){const{maxDistance:c,minElevation:m,maxElevation:L}=f.statistics;let x,_;c!=null&&(b(i)===1?(x=0,_=c):(x=D(i),_=V(i)),l=$(l,x,_,0,c)),m!=null&&L!=null&&(b(s)===1?(x=m,_=L):(x=D(s),_=V(s)),d=$(d,x,_,m,L))}this.onCursorPositionChange?.(l,d)}),n.on("pointerover",()=>a(!0)),n.on("pointerout",r),n.on("blur",r)])}_updateAxes(){const e=this._chartInfo;if(!e)return;const{chart:t,xAxis:i,yAxis:s}=e,o=this._data,{minX:n,maxX:a,minY:r,maxY:l}=_t({data:o,pixelWidth:i.width(),pixelHeight:s.height()}),d=!!o?.uniformScaling,f=!!o?.refined;t.setAll({panX:!0,panY:d,pinchZoomX:f,pinchZoomY:f&&d,wheelX:"panX",wheelY:f?d?"zoomXY":"zoomX":"none"}),i.setAll({max:a,min:n,panX:!0,panY:!1,zoomX:!0,zoomY:d}),s.setAll({max:l,min:r,panX:!1,panY:d,zoomX:d,zoomY:d})}_updateSeries(){const e=this._seriesInfos,t=this._chartInfo;if(!t)return;const{chart:i,xAxis:s,yAxis:o}=t,n=this._data;if(!n||n.lines.length===0)return this._seriesInfos.clear(),void i.series.clear();const a=new Map,r=new Set(i.series.values),l=n.lines.length;for(let d=0;d<l;d++){const f=n.lines[d];let c=e.get(f.id);c?(c.fill&&r.delete(c.fill),r.delete(c.line)):(c=At(t,this._theme,this._rtl,f),c.fill&&i.series.push(c.fill),i.series.push(c.line)),a.set(c.id,c);const m=l-d-1;c.fill?.set("layer",m),c.line.set("layer",l+m),this._updateLineSeries(c,f)}this._seriesInfos=a;for(const d of r)i.series.removeValue(d);s.set("layer",l+1),o.set("layer",l+2)}_updateLineSeries(e,t){const i=g(t.color.toCss()),s=t.samples??[],o=s.length>0,{line:n,fill:a}=e;n.set("visible",o),n.set("stroke",i),a?.set("visible",o),a?.set("fill",ft.lighten(i,this._theme.seriesFillLighten)),n.data.setAll(s),a?.data.setAll(s)}_updateTooltips(){const e=this._getSeriesTooltipText();e?(this._seriesInfos.forEach(t=>{const i=t.line.get("tooltip");i.set("forceHidden",!1),i.label.set("text",e)}),this._chartInfo?.xAxis.getTooltip()?.setAll({tooltipText:this._getAxisTooltipText()})):this._seriesInfos.forEach(t=>{t.line.get("tooltip")?.set("forceHidden",!0)})}_getSeriesTooltipText(){const e=this._data?.lines.map(t=>({line:t,y:this._getPointNearestToCursor(t)?.elevation})).sort(bt);return e&&e.length!==0&&e[0].y!=null?e.map(({y:t,line:i})=>this._getTooltipTextForLine(i,t)).join(`
`):null}_getPointNearestToCursor(e){const t=e.samples??[];if(t.length===0)return null;const i=this._chartInfo;if(!i)return null;const{chart:s,xAxis:o}=i,n=s.get("cursor"),a=n?.getPrivate("positionX")??0,r=o.toAxisPosition(a),l=o.positionToValue(r);return st(t,l,d=>d.distance)}_getTooltipTextForLine(e,t){const i=this._data,s=this.messages,o=this._unitsMessages;if(!i||!s||!o)return"";const n=`[${e.color.toHex()}]â—[/]`,a="  ",r=v().formatPrecision,l=rt(s.chartTooltip,{name:Mt(e,s),elevation:t!=null?X(o,t,i.effectiveUnits.elevation,r):ot});return this._rtl?l+a+n:n+a+l}_getAxisTooltipText(){const e=this._data,t=this._unitsMessages;if(!e||!t)return"";const i=e.lines[0],s=i?this._getPointNearestToCursor(i):null,o=v().formatPrecision;return s!=null?X(t,s.distance,e.effectiveUnits.distance,o):"-"}_makeFormatter(e,t){const i=at.new(e,{});return i.format=(s,o,n)=>{const a=this._data,r=this._unitsMessages;return!a||!r||typeof s=="string"?"":`${J(s,{maximumFractionDigits:n})} ${K(r,a.effectiveUnits[t],"abbr")}`},i}};function At(e,t,i,s){const{id:o}=s,n=I(e,`line-${o}`),a=Tt(e,t,i);n.setAll({dy:s.strokeOffsetY,tooltip:a}),n.strokes.template.setAll({strokeWidth:s.strokeWidth});let r=null;return s.fillEnabled&&(r=I(e,`fill-${o}`),r.fills.template.setAll({fillOpacity:1,visible:!0})),{id:o,line:n,fill:r}}function I({chart:e,xAxis:t,yAxis:i},s){return ut.new(e.root,{connect:!1,excludeFromTotal:!0,fill:void 0,id:s,stroke:void 0,valueXField:"distance",valueYField:"elevation",xAxis:t,yAxis:i})}function Tt({chart:e},t,i){const s=O.new(e.root,{autoTextColor:!1,forceHidden:!0,getFillFromSprite:!1,getLabelFillFromSprite:!1,pointerOrientation:"vertical",visible:!1}),o=t.seriesTooltipPaddingHorizontal,n=t.seriesTooltipPaddingVertical;return s.label.setAll({fill:g(t.seriesTooltipLabelColor),fontFamily:t.fontFamily,fontSize:t.seriesTooltipFontSize,paddingBottom:n,paddingLeft:o,paddingRight:o,paddingTop:n,textAlign:i?"end":"start",direction:"ltr"}),s.get("background")?.setAll({stroke:void 0,fill:g(t.seriesTooltipBackgroundColor)}),s.adapters.add("dy",a=>{const r=t.seriesTooltipSpacing,l=s.get("pointTo")?.y??0;return(a??0)+(s.y()>l?r:-r)}),s}function b(e){const t=Math.abs((e.get("end")??0)-(e.get("start")??0)),i=t!==0?1/t:1;return Math.abs(1-i)<tt()?1:i}function $(e,t,i,s,o){return(t+e*(i-t)-s)/(o-s)}function bt({y:e},{y:t}){return e==null?1:t==null?-1:t-e}function D(e){return e.positionToValue(e.get("start")??0)}function V(e){return e.positionToValue(e.get("end")??1)}function Mt(e,t){const i=e.title;if(i!=null)return i;switch(e.type){case"ground":return t.profiles.ground;case"input":return t.profiles.input;case"query":return t.profiles.query;case"scene":return t.profiles.scene;default:return""}}function Lt(e){const t=e?.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function R(e){return Q(e.map(G))}function G(e){return P(()=>e?.dispose())}u([h()],p.prototype,"view",void 0),u([h()],p.prototype,"analysisView",void 0),u([h()],p.prototype,"container",void 0),u([h()],p.prototype,"messages",void 0),u([h()],p.prototype,"onRangeChange",void 0),u([h()],p.prototype,"onCursorPositionChange",void 0),u([h()],p.prototype,"uniformScaling",void 0),u([h()],p.prototype,"chartVisible",null),u([h()],p.prototype,"spinnerVisible",null),u([h()],p.prototype,"test",void 0),u([h()],p.prototype,"_theme",void 0),u([h()],p.prototype,"_data",void 0),u([h()],p.prototype,"_seriesInfos",void 0),u([h()],p.prototype,"_pointerIsOver",void 0),u([h()],p.prototype,"_rtl",void 0),u([h()],p.prototype,"_chartInfo",void 0),u([h()],p.prototype,"_unitsMessages",void 0),u([h()],p.prototype,"_updateParameters",null),u([h()],p.prototype,"_chartData",null),u([h()],p.prototype,"_hasGeometry",null),u([h()],p.prototype,"_lineData",null),p=u([et("esri.views.analysis.ElevationProfile.ElevationProfileChart")],p);export{p as ElevationProfileChart};
