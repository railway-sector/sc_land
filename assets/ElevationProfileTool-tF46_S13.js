import{fn as M,fE as x,a6 as H,hj as Y,ov as F,am as ee,_ as s,e as n,g as f,Z as D,f as m,ff as T,b9 as te,$ as b,df as j,d7 as ie,O as N,lG as se,jl as G,bI as ae,aq as E,DH as oe,de as ne,DI as Z,ex as Q,dq as B,ds as re,a_ as le,p2 as w,Cl as ue,Cm as pe,bD as O,ak as q,aZ as ce,DJ as he,aR as de,xq as ye,jb as me,b2 as I,lg as ve,oA as A,ap as ge,fF as _e,DK as fe,at as we,aw as be}from"./index-CgzAF5Ey.js";import{j as Se}from"./createUtils-IRSfXt-_.js";import{H as J,F as Pe,i as V,S as ke,o as Ce,j as $e,a as Ee}from"./elevationProfileGenerationUtils-CkNvrUxw.js";import{l as De}from"./throttle-CJw3Glso.js";import{e as Re}from"./getDefaultUnitForView-DdQQf52Q.js";import{o as Ge,n as xe,s as Ve,U as Ie,x as Le,A as Oe}from"./elevationProfileGeometryUtils-DivoHbyN.js";import{n as Me}from"./GraphicsLayer-CNIUk38A.js";import{s as Te}from"./ExclusiveOperationManager-CEJDD66z.js";import{d as qe}from"./SketchViewModel-DhxBVxKu.js";function g(t,e){let i,a=!1;function o(...l){const r=t.apply(this,l);return a&&i!==void 0&&e?.(i,r)?i:(a=!0,i=r,r)}return o}function ze(t){return t?.map?.allLayers?.toArray().filter(e=>(e.type!=="graphics"||!e.internal)&&e.visible).map(e=>e.uid)??[]}function Ue(t,e){if(t==null||e==null)return null;const{samples:i,spatialReference:a}=t,{distance:o,elevation:l}=e,r=M(a),u=x(a),p=i.length,h=new Array(p);for(let y=0;y<p;++y){const S=i[y],z=S.sampledZ,U=S.coordinate;h[y]={x:U[0],y:U[1],z,distance:K(S.distance,r,o),elevation:$(z,u,l)}}return h}function Fe(t,e){if(t==null||e==null||t.statistics==null||t.spatialReference==null)return null;const{distance:i,elevation:a}=e,{statistics:o,spatialReference:l}=t,r=M(l),u=x(l);return{maxDistance:K(o.maxDistance,r,i),minElevation:$(o.minElevation,u,a),maxElevation:$(o.maxElevation,u,a),avgElevation:$(o.avgElevation,u,a),elevationGain:$(o.elevationGain,u,a),elevationLoss:$(o.elevationLoss,u,a),maxPositiveSlope:o.maxPositiveSlope,maxNegativeSlope:o.maxNegativeSlope,avgPositiveSlope:o.avgPositiveSlope,avgNegativeSlope:o.avgNegativeSlope}}function K(t,e,i){return t==null?null:H(t*e,"meters",i)}function $(t,e,i){return t==null?null:H(t*e,"meters",i)}let v=class extends Y{constructor(e){super(e),this._getSamplesMemoized=F((i,a)=>Ue(i,a)),this._getStatisticsMemoized=F((i,a)=>Fe(i,a)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return J(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:i,samples:a}=this;if(a==null||i==null)return null;const o=a.length;if(o===0)return null;const l=a[o-1].distance,r=Pe(a,e*l,y=>y.distance);if(r==null)return null;const{x:u,y:p,z:h}=r;return h==null?null:new ee({x:u,y:p,z:h,spatialReference:i.spatialReference})}};s([n()],v.prototype,"available",null),s([n({readOnly:!0})],v.prototype,"profile",null),s([n({readOnly:!0})],v.prototype,"progress",null),s([n()],v.prototype,"samples",null),s([n()],v.prototype,"statistics",null),s([n({constructOnly:!0})],v.prototype,"computation",void 0),s([n()],v.prototype,"rawResult",void 0),s([n()],v.prototype,"hoveredPoint",null),v=s([f("esri.views.analysis.ElevationProfile.ElevationProfileResult")],v);let d=class extends D{constructor(t){super(t),this.result=new v({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([m(()=>{const{geometry:t,elevationInfo:e}=this.controller.analysis;return[t,e]},()=>this.onInvalidate(this),T)])}setResult(t){this.result.rawResult=t}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return V().defaultDemResolution}};s([n({constructOnly:!0})],d.prototype,"controller",void 0),s([n({constructOnly:!0})],d.prototype,"profile",void 0),s([n({constructOnly:!0})],d.prototype,"onInvalidate",void 0),s([n()],d.prototype,"result",void 0),s([n({readOnly:!0})],d.prototype,"progress",null),s([n()],d.prototype,"hoveredPoint",null),s([n()],d.prototype,"available",null),s([n()],d.prototype,"numSamplesForPreview",void 0),s([n()],d.prototype,"numSamplesPerChunk",void 0),s([n({readOnly:!0})],d.prototype,"minDemResolution",null),d=s([f("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],d);function at(t){return te([m(()=>{const{analysis:e,sketchGraphic:i,toolState:a,visible:o}=t.analysisViewData,{geometryVisualizationVisible:l}=e.viewOptions;return{geometryVisualizationVisible:l,geometry:e.geometry,sketchGraphic:i,toolState:a,visible:o}},({geometryVisualizationVisible:e,sketchGraphic:i,toolState:a,visible:o})=>{if(t.remove(),o)return e&&i!=null&&a!=="reshaping"&&a!=="sketching"?t.show(i):void 0},b)])}function ot(t,e){t??=[];const i=t.length-1,a=[];let o=[];for(let l=0;l<=i;l++){const{x:r,y:u,z:p}=t[l];p!=null&&o.push([r,u,p]),l!==i&&p!=null||!o.length||(a.push(o),o=[])}return Se(a,e,!0)}let P=class extends D{constructor(e){super(e),this.position=null,this.color=new j("#ffffff"),this.element=Ae()}initialize(){this.addHandles([m(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},b),m(()=>this.color.toCss(),e=>{this.element.style.background=e},b)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:i}=this;i.type==="3d"?(i.commitProperty("size"),i.commitProperty("camera")):i.commitProperty("center");const a=i?.spatialReference,o=a?ie(e,a).geometry:null;return o&&i?.ready?i.toScreen(o):null}};function Ae(){const t=document.createElement("div"),{size:e,borderStyle:i,borderColor:a,borderWidth:o,boxShadow:l}=V().hoveredPointsStyle,{style:r}=t;return r.display="block",r.position="absolute",r.top="0",r.left="0",r.contain="strict",r.boxSizing="border-box",r.width=`${e}px`,r.height=`${e}px`,r.marginTop=`-${e/2}px`,r.marginLeft=`-${e/2}px`,r.border=`${i} ${o}px ${a}`,r.borderRadius=`${e}px`,r.boxShadow=l,t}s([n()],P.prototype,"position",void 0),s([n({type:j})],P.prototype,"color",void 0),s([n()],P.prototype,"view",void 0),s([n()],P.prototype,"_screenLocation",null),P=s([f("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],P);let k=class extends D{constructor(e){super(e),this._hoveredPoints=new N}initialize(){const{analysisViewData:e}=this,{analysis:i}=e;this.addHandles([m(()=>{const{hoveredPoints:a,visible:o,updating:l}=e;return o?l?null:a.map((r,u)=>{const p=i.profiles.at(u);return p?.viewOptions.hoveredPointVisible===!0&&r!=null?{hoveredPoint:r,color:p.color}:null}).filter(r=>!!r):[]},a=>this._update(a),b),m(()=>i.geometry,()=>this._update([]),b)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;const{view:i,_hoveredPoints:a}=this,o=e.length;for(;a.length>o;)a.pop()?.destroy();for(;a.length<o;){const l=new P({view:i});a.push(l)}for(let l=0;l<o;++l){const r=e[l],u=a.at(o-1-l);u.position=r.hoveredPoint,u.color=r.color}}};s([n()],k.prototype,"view",void 0),s([n()],k.prototype,"analysisViewData",void 0),s([n()],k.prototype,"_hoveredPoints",void 0),s([n()],k.prototype,"updating",null),k=s([f("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],k);let c=class extends D{constructor(t){super(t),this.error=null,this._getStableEffectiveUnits=g(()=>{const e=Ee(this._activeComputations.map(o=>o.result.rawResult)),i=this.analysis.displayUnits,a=Re(this.view);return{distance:pe(e.maxDistance,"meters",i.distance??a),elevation:ue(e.maxElevation,"meters",i.elevation??a)}},w),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=g(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),w),this._getStableGenerationParameters=g(()=>{const{view:e,analysis:i}=this;return e?.ready&&this._queue?{view:e,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type==="3d"?e.slice.plane:null}:null},w),this._getStableElevationInfo=g(()=>this.analysis.elevationInfo??He,O),this._getStableOptions=g(()=>{const{densificationMaxSamples:e,defaultDemResolution:i,maxTotalSamples:a}=V();let o=this._minDemResolution??i;return o=parseFloat(o.toFixed(2)),{samplingDistance:o,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:a}},w),this._updateThrottled=De(e=>this._update(e),V().updateThrottleMillis)}initialize(){this._computationsCollection=se(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),m(()=>this._updateParameters,e=>this._updateThrottled(e),b),this._updateThrottled]);const t=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=ke(t?.scheduler),t?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=G(this._queue),this._currentTileCache=G(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let t=0,e=0;for(const i of this._activeComputations)t++,e+=i.progress;return J(t>0?e/t:0)}get updating(){const{progress:t}=this,e=!!this._queue?.updating,i=this._updateThrottled.hasPendingUpdates(),a=this._updateTask!=null&&!this._updateTask.finished;return e||i||a||t>0&&t<1}get results(){return this._computations.map(t=>t.result)}get statistics(){return Ce(this._activeComputations.map(t=>t.result.statistics))}get hoveredPoints(){return this._computations.map(t=>t.hoveredPoint)}onElevationChange(t){const{view:e}=this;return e?.type==="3d"?ae(()=>e.elevationProvider,"elevation-change",t,{onListenerAdd:t,onListenerRemove:t}):E()}get _tileCache(){this._currentTileCache=G(this._currentTileCache);const t=this.view;if(t?.type==="3d"){const e=t.basemapTerrain?.elevationQueryCache;if(e!=null)return e}return this._currentTileCache==null&&(this._currentTileCache=new oe(new ne(20971520))),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(t=>t.profile.enabled&&t.available)}get _minDemResolution(){const t=this._minDemResolutions;return t.length>0?Z(t):null}get _minDemResolutions(){const t=[];for(const{minDemResolution:e}of this._activeComputations)e!=null&&t.push(e);return t}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:t,activeComputations:e,generationParameters:i}){this._abortUpdate(),t&&(i!=null?this._updateTask=Q(async a=>{this.error=null;const o=e.filter(l=>!this._isComputationValid(l,i));try{if(!i.geometryIsValid)throw new Ge;const l=$e({...i,providers:o},{signal:a});let r=!1;for await(const u of l){B(a),r||(this._clearInvalidResults(i),r=!0);for(let p=0;p<o.length;p++)o[p].setResult(u[p])}for(const u of o)this._parametersPerComputation.set(u,i)}catch(l){re(l),this._abortUpdate(),this.error=l instanceof Ve?l:new xe,o.forEach(r=>{r.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=le(this._updateTask)}_isComputationValid(t,e){return this._parametersPerComputation.has(t)&&this._parametersPerComputation.get(t)===e}_invalidateComputation(t){this._parametersPerComputation.delete(t),this._updateThrottled(this._updateParameters)}_clearInvalidResults(t){for(const e of this._computations)this._isComputationValid(e,t)||(e.clearResult(),this._parametersPerComputation.delete(e))}_clearResults(){for(const t of this._computations)t.clearResult(),this._parametersPerComputation.delete(t)}};s([n({constructOnly:!0})],c.prototype,"analysis",void 0),s([n({constructOnly:!0})],c.prototype,"analysisViewData",void 0),s([n({constructOnly:!0})],c.prototype,"computationFactory",void 0),s([n({constructOnly:!0})],c.prototype,"view",void 0),s([n()],c.prototype,"error",void 0),s([n({readOnly:!0})],c.prototype,"effectiveDisplayUnits",null),s([n()],c.prototype,"progress",null),s([n()],c.prototype,"updating",null),s([n()],c.prototype,"results",null),s([n()],c.prototype,"statistics",null),s([n()],c.prototype,"hoveredPoints",null),s([n()],c.prototype,"_updateTask",void 0),s([n()],c.prototype,"_queue",void 0),s([n()],c.prototype,"_tileCache",null),s([n()],c.prototype,"_computationsCollection",void 0),s([n()],c.prototype,"_computations",null),s([n()],c.prototype,"_activeComputations",null),s([n({readOnly:!0})],c.prototype,"_minDemResolution",null),s([n()],c.prototype,"_minDemResolutions",null),s([n()],c.prototype,"_updateParameters",null),s([n()],c.prototype,"_generationParameters",null),s([n()],c.prototype,"elevationInfo",null),s([n()],c.prototype,"_options",null),c=s([f("esri.views.analysis.ElevationProfile.ElevationProfileController")],c);const He=new q({...ce});function W(t){if(t==null)return null;if(he(t))return X(t);const e=t.tileInfo;if(e==null)return null;const i=e.lods?.at(-1);return i==null?null:i.resolution*M(e.spatialReference)}function X(t){if(t==null)return null;const e=t.layers.items.map(je).filter(de);return Z(e)??null}function je(t){return t&&"tileInfo"in t?W(t):null}let C=class extends d{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=g(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),w),this._getStableGroundLayers=g(()=>this._ground?.layers?.toArray(),w)}get minDemResolution(){return X(this._ground)}get available(){return this._ground?.layers.some(e=>e.visible)===!0}initialize(){this.addHandles([m(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,i){const a=this._queryElevationDependencies;if(a==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:o}=a;if(o==null)throw new Error("No ground configured in the view");const l=await o.queryElevation(e,i),r=x(e.spatialReference),u=x(o.layers.at(0).spatialReference);if(r!==u){const p=l.geometry;p.points=p.points.map(([h,y,S])=>[h,y,S===i.noDataValue?S:S*u/r])}return l}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};s([n()],C.prototype,"minDemResolution",null),s([n()],C.prototype,"available",null),s([n()],C.prototype,"_queryElevationDependencies",null),s([n()],C.prototype,"_ground",null),C=s([f("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],C);let L=class extends d{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=g(()=>{const{view:e}=this.controller;if(!e)return null;const i=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:i,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},w),this._getStableElevationInfo=g(()=>this.controller.elevationInfo,O),this._getStableSpatialReference=g(()=>this.controller.view?.spatialReference,O),this._getStableLayerIds=g(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:ze(e)},w)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([m(()=>this._queryElevationDependencies,e,T),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:i,signal:a}){const o=this._queryElevationDependencies;if(o==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:l,spatialReference:r}=o;if(this._requiresElevationAlignment&&l.type==="3d"&&r){const u=await ye.fromGeometry(e).project(r,a);if(!u)return{geometry:e,noDataValue:i};const p=l.elevationProvider;return u.coordinates.forEach(h=>{h.z=p.getElevation(h.x,h.y,0,r,"ground")??0}),{geometry:u.export(),noDataValue:i}}return{geometry:e,noDataValue:i}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};s([n()],L.prototype,"_queryElevationDependencies",null),L=s([f("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],L);let R=class extends d{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return W(this.profile.source)}get available(){const{source:t}=this.profile;return!!t&&(t.visible==null||t.visible)&&(t.layers==null||t.layers.some(e=>e.visible))}initialize(){this.addHandles(m(()=>this.profile.source,()=>this.onInvalidate(this),T))}queryElevation(t,e){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(t,e)}};s([n({readOnly:!0})],R.prototype,"minDemResolution",null),s([n()],R.prototype,"available",null),R=s([f("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],R);let _=class extends D{constructor(t){super(t),this._sketchViewModels=new N,this._updatingHandles=new me,this._operationManager=new Te}initialize(){const{view:t}=this;this._graphicsLayer=new Me({listMode:"hide",internal:!0}),this.addHandles([m(()=>({map:t.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:i,state:a,geometryVisualizationVisible:o,visible:l})=>{Ze(e,i);const r=this.sketchGraphic;switch(r&&(r.visible=l),a){case"idle":case"reshaping-disabled":r&&!o&&(r.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":I(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},b),m(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},b)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>G(e));const t=this._graphicsLayer;this.view.map?.remove(t),t.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(t){t!==this._get("sketchGraphic")&&(this._set("sketchGraphic",t),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:t,interactive:e}=this.analysisViewData;if(!t)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?e?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(t=>t.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(t=>t.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Ne(this.view.type)}place(t){return this._operationManager.start("place",async e=>{const i=this._createSketchViewModel(),a=this._analysis.clone();this._ensureUpdatedSketchGraphic();const o=this.sketchGraphic,l=this._analysis.elevationInfo,r=E(()=>{this.sketchGraphic===o&&(this._graphicsLayer.elevationInfo=l)}),u=i.on("create",p=>{switch(p.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=p.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),e.stop();break;case"cancel":e.stop()}});e.handles.push(u,E(()=>(u.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?ve(t)||a.equals(this._analysis)?e.reject():void e.resolve({}):(this._clear(),e.reject()))),r),this._graphicsLayer.elevationInfo=Qe,await this._updatingHandles.addPromise(I(i.create("polyline")))},t)}async pickFeature(t){return this._operationManager.start("pick-feature",async e=>{const{view:i}=this;i.closePopup();let a=null;const o=r=>{r.defer(async()=>{a?.abort(),a=Q(async u=>{const{results:p}=await i.hitTest(r);B(u);let h=null;for(const y of p)if(y.type==="graphic"&&Le(y.graphic)&&!Oe(y.graphic)){h=y.graphic;break}h?(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=h.geometry,this._analysis.elevationInfo=new q({..._e(h)}),e.resolve({feature:h}),e.stop()):e.reject()}),await a.promise})},l=r=>{fe(r)&&(e.reject(),e.stop())};e.handles.push(i.on("immediate-click",o,A.TOOL),i.on("key-down",l,A.TOOL),i.acquireCursor("crosshair","high"),E(()=>{a?.abort(),e.reject()})),i.focus()},t)}_startReshape(){const t=this._createSketchViewModel();return this._sketchViewModels.add(t),this._operationManager.start("reshape",async e=>{const i=()=>{const o=this._ensureUpdatedSketchGraphic();return o?this._updatingHandles.addPromise(t.update(o,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const a=t.on("update",o=>{this._updateAnalysisFromSketchGraphic(),o.state==="complete"&&(this.state==="reshaping"?I(i()):e.resolve())});e.handles.push(a,E(()=>{a.remove(),this._sketchViewModels.remove(t),t.destroy(),e.resolve()})),await i()})}_createSketchViewModel(){return new qe({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:t}=this._analysis;if(!t)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const e=this.sketchGraphic??=new ge({symbol:this._lineSymbol,geometry:t});return e.geometry=t,this._addSketchGraphic(e),e}_addSketchGraphic(t){const{graphics:e}=this._graphicsLayer;e.includes(t)||e.add(t),e.length!==1&&e.removeMany(e.filter(i=>i!==t))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let t=this.sketchGraphic?.geometry;Ie(t)||(t=null);const e=this._analysis;e.geometry!==t&&(e.geometry=t)}};function Ne(t){if(t==="2d"){const e={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new we({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...e,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new be({color:[0,0,0,0]})}function Ze(t,e){e&&(e.removeFromParent(),t?.add(e))}s([n({constructOnly:!0})],_.prototype,"analysisViewData",void 0),s([n({constructOnly:!0})],_.prototype,"view",void 0),s([n()],_.prototype,"sketchGraphic",null),s([n({nonNullable:!0})],_.prototype,"state",null),s([n()],_.prototype,"updating",null),s([n()],_.prototype,"_sketching",null),s([n()],_.prototype,"_analysis",null),s([n()],_.prototype,"_lineSymbol",null),_=s([f("esri.views.analysis.ElevationProfile.ElevationProfileTool")],_);const Qe=new q({mode:"on-the-ground",offset:0});export{_ as L,k as a,C as b,c as k,ot as l,R as n,at as o,d as p,ze as r,g as t,L as u};
