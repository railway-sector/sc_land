import{aZ as E,a_ as f,ex as $,ds as b,db as D,fF as R,f as h,jA as H,b8 as P,Y as L,aA as T,dh as k,Z as p,_ as u,e as v,g as V,i4 as M,j4 as d}from"./index-BrQW8HOS.js";import{e as O,a as I}from"./visualizationUtils-mqN_vAaX.js";import{b as j}from"./settings-BTy7xayY.js";import{R as y}from"./OutlineVisualElement-B_g-3ypc.js";import{e as x}from"./GraphicState-C2r3pgB3.js";import{l as A}from"./throttle-CTJgdIni.js";import{l as w}from"./customElement-CfYEKQJO.js";import"./AnchorElementViewModel-Djy63Zpd.js";import"./createUtils-BntPyFG2.js";import"./Circle-CDzQBXRC.js";import"./geodesicUtils-BJZXB7Hp.js";import"./distanceOperator-BeiDdpLt.js";import"./Point2D-DNXcsliy.js";import"./Distance2DCalculator-CXhBP-8I-Dkb8-KBJ.js";import"./ProjectionTransformation-BjD312Kq.js";import"./Envelope2D-CUWyosZh.js";import"./Transformation2D-BUBnKQZf.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter---8F7iZ4.js";import"./jsonConverter-BHYd2kGf.js";import"./simplifyOperator-BQVvn5Fy.js";import"./operatorSimplify-C16tE3lk.js";import"./surfaceCoordinateSystems-BrNYf00T.js";import"./mat2d-BbBq4Byx.js";import"./mat2df64-DJ_RMjZ3.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-27K-ysdd.js";import"./VisualElement-BSXziD11.js";import"./LaserlinePath.glsl-C0_9wp_L.js";import"./line-JM6PBBRO.js";import"./line-CvBFIevE.js";import"./triangulationUtils-DRNEJzEV.js";import"./earcut-D9gy186-.js";import"./deduplicate-BmrPw5DR.js";import"./defaultUnit-DpiDHKcy.js";import"./getDefaultUnitForView-KDHdLbNY.js";import"./traversalUtils-DmE6QkgJ.js";import"./GraphicsLayer-CtVknZ1a.js";import"./SketchViewModel-NRhuw9HA.js";import"./isSupportedObject-DknMXN_6.js";import"./layerUtils-CdCZXuDJ.js";import"./SketchLabelOptions-BPF5xZLI.js";import"./SketchOptions-CHLlByzL.js";import"./SnappingManager-BWOfKl0d.js";import"./euclideanLengthMeasurementUtils-B8AL_WaV.js";import"./utils-D_VO_1nP.js";import"./geometry2dUtils-kADrF-iP.js";import"./geodeticLengthOperator-DifrZujk.js";import"./geodeticCurveType-CirnHLSB.js";import"./geodesicMeasurementUtils-CQw8IWGR.js";import"./automaticAreaMeasurementUtils-dI3X5owW.js";import"./geodesicAreaMeasurementUtils-CPlOyDe5.js";import"./automaticLengthMeasurementUtils-Cr-y0OEN.js";import"./substitute-D-eLZ17Q.js";import"./UnitSelect-8DP5dFVk.js";import"./useWidget-CYtf2hFT.js";import"./useView-Cya0Zpns.js";class z{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new j({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=f(this._highlightHandle),this._visualElementHandle=f(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!c(t))return;const i=t.layer;this._highlightTask=$(async e=>{const s=await this._params.view.whenLayerView(i);b(e),D(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const i=this._params.view,e=new y({view:i,geometry:c(t)?t.geometry:null,attached:!1,elevationInfo:R(t),renderOccluded:8,isDecoration:!0}),s=new x({graphic:t}),o=[h(()=>s.isDraped,a=>{e.isDraped=a}),s.on("changed",()=>{e.geometry=c(t)?t.geometry:null}),i.trackGraphicState(s),i.maskOccludee(t),H(e)];this._settings.visualElements.lineObjects.outline.apply(e),e.attached=!0,this._visualElementHandle=P(o)}}function c(r){return r.geometry!=null&&r.geometry.type==="polyline"}let m=class extends L{constructor(r){super(r),this._chartData=null,this._visualElements=[],this._update=t=>{const{chartData:i}=t;if(i==null)return this.remove();if(!i.refined)return;const e=this._visualElements,s=i.lines.filter(n=>n.viewVisualizationEnabled),o=s.length;for(;e.length>o;)e.pop().destroy();const a=w().profileLinesStyle3D;for(;e.length<o;){const n=new y({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:a.innerWidth,innerColor:a.innerColor,width:a.width,falloff:a.falloff,renderOccluded:a.renderOccluded,isDecoration:!0});e.push(n)}const l=t.spatialReference;for(let n=0;n<o;++n){const _=e[n],g=s[o-1-n];_.geometry=O(g,l),_.color=T(k.toUnitRGBA(g.color))}}}initialize(){const r=w().profileLinesUpdateThrottleMillis;let t=this._update;{const i=A(this._update,r);this.addHandles(i),t=i}this.addHandles([h(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),t,p)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};u([v()],m.prototype,"view",void 0),u([v()],m.prototype,"_chartData",void 0),m=u([V("esri.widgets.ElevationProfile.support.ProfileLines3D")],m);class Wt{constructor(t,i){this._handles=new M,this._inputRepresentation=new z({view:t}),this._hoveredPoints=new I({view:t}),this._profileLines=new m({view:t}),this._handles.add([h(()=>i.viewModel.hoveredPoints,e=>this._hoveredPoints.update(e),p),h(()=>{const{state:e,editable:s,highlightEnabled:o,viewModel:a}=i,l=a.input;return l&&(l.commitProperty("geometry"),l.commitProperty("layer")),{input:l,state:e,editable:s,highlightEnabled:o}},e=>this._updateInputRepresentation(e),p),h(()=>i.viewModel.chartData,e=>this._profileLines.update(e),p),h(()=>i.viewModel.input?.geometry,()=>{this._profileLines.remove()},p)])}destroy(){this._handles=d(this._handles),this._inputRepresentation=d(this._inputRepresentation),this._hoveredPoints=d(this._hoveredPoints),this._profileLines=d(this._profileLines)}_updateInputRepresentation({input:t,state:i,editable:e,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();i==="selected"?o.showHighlight(t):i!=="created"||e?o.remove():o.showReshaping(t)}}export{Wt as ElevationProfileView3D};
