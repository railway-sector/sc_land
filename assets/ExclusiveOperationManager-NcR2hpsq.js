import{e7 as v,aP as y,dz as O,gl as o,jh as u,d1 as S,gn as d}from"./index-Brd6-W-v.js";class w{constructor(){this._currentOperationSignal=v(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(p,c,h){const a=this._currentOperationSignal.value;a?.stop();const n=new AbortController,l=h?.signal,s=AbortSignal.any([n.signal,l].filter(y)),r=O();let e=!1;const i=()=>{e||(e=!0,r.reject(d()))},t={type:p,resolve:g=>{e||(e=!0,r.resolve(g))},reject:i,promise:r.promise,stop:()=>n.abort(),handles:[]};this._currentOperationSignal.value=t,t.handles.push(o(l,()=>{n.abort()}),o(s,()=>{u(t.handles),e||i()}));try{return a&&(await a.promise.catch(()=>{}),S(s)),await c(t,s),await r.promise}finally{u(t.handles),this._currentOperationSignal.value===t&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}export{w as s};
