import{d_ as v,aK as y,dq as O,gg as o,jc as u,cU as S,gi as _}from"./index-CVzGOCNQ.js";class w{constructor(){this._currentOperationSignal=v(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(p,c,g){const a=this._currentOperationSignal.value;a?.stop();const s=new AbortController,i=g?.signal,n=AbortSignal.any([s.signal,i].filter(y)),e=O();let r=!1;const l=()=>{r||(r=!0,e.reject(_()))},t={type:p,resolve:h=>{r||(r=!0,e.resolve(h))},reject:l,promise:e.promise,stop:()=>s.abort(),handles:[]};this._currentOperationSignal.value=t,t.handles.push(o(i,()=>{s.abort()}),o(n,()=>{u(t.handles),r||l()}));try{return a&&(await a.promise.catch(()=>{}),S(n)),await c(t,n),await e.promise}finally{u(t.handles),this._currentOperationSignal.value===t&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}export{w as s};
