const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UtilityNetworkAssociationInput-C_klZDqy.js","assets/index-aRi8Xk-b.js","assets/index-ni9qn0ie.css","assets/featureUtils-BDJwkMic.js","assets/FieldInput-Dr3x1qgq.js","assets/Heading-CViwC7qz.js","assets/featureFormUtils-BYZ3t-Lc.js","assets/dateUtils-B2jlgBP5.js","assets/FeatureUtilityNetworkAssociationsViewModel-BcJK5cyc.js","assets/getFeatureTitle-Mrr3SXNI.js","assets/index-BHW8fMr9.js","assets/index-D344BtUF.js","assets/utils4-Dymb_utz.js","assets/index-mvPjoixz.js","assets/index-7P_2ECUs.js","assets/customElement-D0WPozHq.js","assets/index-CPutAJp2.js","assets/index-Dm2qibni.js","assets/index-C0-aE-rq.js","assets/index-C-mZpnEU.js","assets/index-BQqLQoGp.js","assets/index-C0OVrMLM.js","assets/index-DDzPvFua.js","assets/throttle--VGC9LFn.js","assets/FeatureFormUtilityNetworkAssociationList-B6_Z7WPO.js","assets/getAssociationTitle-CbehvZwK.js","assets/isConnectivityMidspan-CkRr0dPu.js","assets/FeatureUtilityNetworkAssociations-f82GCPhX.js"])))=>i.map(i=>d[i]);
import{a7 as M,a5 as r,x as u,y as T,cZ as et,c$ as tt,cf as H,cc as se,aP as de,lP as it,lQ as st,EE as _e,er as ne,ez as ge,a9 as K,dz as Ge,mf as Ue,j as $,bH as He,bG as Ze,ou as We,b_ as ve,a3 as x,ep as Be,ex as be,Y as Ce,hG as ye,ef as nt,EF as ot,cq as at,b2 as ze,i$ as rt,cR as lt,ao as ut,a8 as dt,hQ as we,cV as pt,cM as xe,eD as ct,u0 as ht,EG as Q,N as qe,EH as Fe,oi as mt,EI as ft,EJ as yt,oh as _t,oe as Ve,x0 as gt,a1 as vt,a2 as bt,of as Ct,a4 as m,bJ as Ee,W,zy as wt,cF as Ie,bY as xt,tL as Ft,ab as Y,tO as Vt}from"./index-aRi8Xk-b.js";import{s as Ke,p as Et,O as Ae,r as It}from"./FieldInput-Dr3x1qgq.js";import{isRelatableFeatureSupportedLayer as Je}from"./featureUtils-BDJwkMic.js";import{K as pe,F as J,G as At,k as ce,M as Te,q as Re,z as Tt,B as Rt,D as $t,L as Ot,w as Lt,h as U,E as kt,N as he,T as Qe,_ as Mt,V as $e,O as Nt,U as oe,C as Oe,P as Dt,Q as St,I as jt,$ as Pt,e as Gt}from"./featureFormUtils-BYZ3t-Lc.js";import{_ as Ut}from"./FeatureRelationshipViewModel-rUwGRIWV.js";import{createArcadeProfile as Ht,createArcadeExecutor as Zt}from"./arcade-DY5pGzo1.js";import{T as Wt,F as Bt,j as X,V as ee,C as te,E as Le,b as zt,N as qt}from"./dateUtils-B2jlgBP5.js";import{s as Kt,l as Jt}from"./Heading-CViwC7qz.js";let D=class extends M{constructor(t){super(t),this.isRetired=!1}};r([u()],D.prototype,"id",void 0),r([u()],D.prototype,"isRetired",void 0),r([u()],D.prototype,"subtype",void 0),r([u()],D.prototype,"values",void 0),D=r([T("esri.layers.support.Contingency")],D);const ke=D;let B=class extends M{constructor(t){super(t)}};r([u()],B.prototype,"fieldGroup",void 0),r([u()],B.prototype,"type",void 0),B=r([T("esri.layers.support.ContingencyConstraintViolation")],B);const Me=B;let S=class extends M{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};r([u()],S.prototype,"objectType",void 0),r([u()],S.prototype,"maxValue",void 0),r([u()],S.prototype,"minValue",void 0),r([u()],S.prototype,"codedValue",void 0),S=r([T("esri.layers.support.ContingentValue")],S);const E=S;let z=class extends M{constructor(t){super(t)}};r([u()],z.prototype,"contingentValuesAllGroups",void 0),r([u()],z.prototype,"contingentValuesByFieldGroup",void 0),z=r([T("esri.layers.support.ContingentValuesResult")],z);const Qt=z;let j=class extends M{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};r([u()],j.prototype,"name",void 0),r([u()],j.prototype,"fields",void 0),r([u()],j.prototype,"isEditingRestrictive",void 0),r([u()],j.prototype,"contingencies",void 0),j=r([T("esri.layers.support.FieldGroup")],j);const me=j;var ie;let k=ie=class extends et(tt){constructor(e){super(e),this.request=H,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get loaded(){return super.loaded}get subtypeFieldName(){return pe(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const i=t?.hasContingentValuesDefinition;if(i)return new ie({layer:e}).load();if(i===void 0){const s=se(e.url);if(s==null)return null;const n=s.url.path;if((await De(n)).supportsQueryDataElements){const o=e.layerId.toString(),a=await Ne(n,o);if(a){const l=a.map(d=>({name:d.name,isEditingRestrictive:d.isEditingRestrictive,fields:d.fieldNames.names.map(p=>e.fieldsIndex.normalizeFieldName(p))}));return new ie({layer:e,fieldGroupDefinitions:l}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const i=Object.keys(e),s=[],n=[];for(const o of this.fieldGroups){const a=o.isEditingRestrictive?"error":"warning";if(t&&!o.fields.some(c=>t.includes(c)))continue;if(!o.fields.every(c=>i.includes(c))){n.push(new Me({fieldGroup:o,type:a}));continue}let l=!1;const d=e[this.subtypeFieldName],p=o.contingencies.filter(c=>!(!c.isRetired&&c.subtype)||c.subtype.code===d);if(p.length!==0){for(const c of p){let h=!0;for(const f in c.values){const y=c.values[f];if(y.objectType!=="any"){if(y.objectType==="null"){if(e[f]!=null){h=!1;break}}else if(y.objectType==="code"){if(e[f]!==y.codedValue.code){h=!1;break}}else if(y.objectType==="range"){const g=e[f];if(g<y.minValue||g>y.maxValue){h=!1;break}}}}if(h){l=!0;break}}l||s.push(new Me({fieldGroup:o,type:a}))}}return{invalid:s,incomplete:n}}getContingentValues(e,t,i=!1){const s=e[this.subtypeFieldName],n=s!=null,o={};let a=[];const l=this.fieldGroups.filter(d=>d.fields.includes(t));a.push(new E({objectType:"any"}));for(const d of l){let p=[];const c=d.contingencies.filter(y=>!(y.isRetired||y.subtype&&n&&y.subtype.code!==s));let h=!1;const f={};for(const y of c){let g,F=!0;for(const _ in y.values){const V=y.values[_];if(t!==_){if(e[_]!==void 0&&V.objectType!=="any"){if(V.objectType==="null")e[_]!==null&&(F=!1);else if(V.objectType==="code")e[_]!==V.codedValue.code&&(F=!1);else if(V.objectType==="range"){const Z=e[_];(Z<V.minValue||Z>V.maxValue)&&(F=!1)}}}else g=V,h=h||V.objectType==="range"}if(g&&F){if(g.objectType==="any"){p.length=0,p.push(g);break}const _=Yt(g);f[_]||p.push(g),f[_]=!0}}h&&(p=Xt(p)),o[d.name]=p,a=i?ii(a,p):[]}return l.length===1&&i&&(a=[]),new Qt({contingentValuesAllGroups:a,contingentValuesByFieldGroup:o})}async _initializeContingentValues(e,t){const i=e??await this._fetchFieldGroupDefs(t);if(i.length===0)return void(this.fieldGroups=[]);const s=await this._fetchContingentValues(i,t);this.fieldGroups=s}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,i=this.layer.layerId.toString(),s=se(this.layer.url).url.path;return t?.hasContingentValuesDefinition?(await si(s,i,e)).map(n=>({name:n.name,isEditingRestrictive:n.restrictive,fields:n.fields.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):t?.hasContingentValuesDefinition!==void 0?[]:De(s,e).then(async n=>n.supportsQueryDataElements?(await Ne(s,i,e)).map(o=>({name:o.name,isEditingRestrictive:o.isEditingRestrictive,fields:o.fieldNames.names.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):[])}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,s=this.layer.layerId.toString(),n=se(this.layer.url).url.path;if(i?.hasContingentValuesDefinition){const a=await oi(n,s,t);return this._constructFieldGroupsAGOL(e,a)}const o=await ni(n,s,t);return this._constructFieldGroupsEnterprise(e,o)}_constructFieldGroupsAGOL(e,t){return e.map(i=>{const s=t.contingentValuesDefinition.fieldGroups.find(n=>n.name===i.name);if(s){let n=[];return n=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,t,s.subTypes):this._parseAGOLFieldGroup(i,t,s.contingentValues),new me({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:n})}return null}).filter(de)}_parseAGOLFieldGroupSubtype(e,t,i){let s=[];return i?.forEach(n=>{const o=this._getSubtypeAGOL(n.name);s=s.concat(this._parseAGOLFieldGroup(e,t,n.contingentValues,o))}),s}_parseAGOLFieldGroup(e,t,i,s=null){const n=[];for(const o of i??[]){const a=this._parseAGOLContingency(o,e,t,s);n.push(a)}return n}_parseAGOLContingency(e,t,i,s){const n=e.id,o=!!e.retired&&e.retired===1,a={};for(let l=0,d=0;l<t.fields.length;l++){const p=t.fields[l],c=i.typeCodes[e.types[l]];if(c==="Code"){let h=e.values[d];d++;const f=this._getDomain(s,p);if(this.layer.getField(p)?.type==="string"){const _=i.stringDicts.find(V=>V.domain===f?.name);_&&(h=_.entries[h])}const g=f?.codedValues.find(_=>_.code===h),F=new E({codedValue:g,objectType:"code"});a[p]=F}else if(c==="Range"){const h=e.values[d];d++;const f=h.range[0],y=h.range[1],g=new E({minValue:f,maxValue:y,objectType:"range"});a[p]=g}else if(c==="Any"){const h=new E({objectType:"any"});a[p]=h}else{const h=new E({objectType:"null"});a[p]=h}}return new ke({id:n,isRetired:o,subtype:s,values:a})}_constructFieldGroupsEnterprise(e,t){const i=t.fieldGroups;return e.map(s=>{const n=i.find(o=>o.name===s.name);if(n){const o=n.contingencies.map(a=>{const l=a.id,d=a.isRetired||!1,p=this._getSubtypeEnterprise(a.subtypeCode),c={};for(let h=0;h<s.fields.length;h++){const f=s.fields[h];let y=a.values[h];if(typeof y=="number"||typeof y=="string"){const g=this._getDomain(p,f),F=this.layer.getField(f);it(F)?y=t.stringDictionary[y]:st(F)&&(y=new Date(`${y}+00:00`).getTime());const _=g?.codedValues.find(Z=>Z.code===y),V=new E({codedValue:_,objectType:"code"});c[f]=V}else if(typeof y=="object"){const g=y.minValue,F=y.maxValue,_=new E({minValue:g,maxValue:F,objectType:"range"});c[f]=_}else if(y){const g=new E({objectType:"any"});c[f]=g}else{const g=new E({objectType:"null"});c[f]=g}}return new ke({id:l,isRetired:d,subtype:p,values:c})});return new me({name:s.name,isEditingRestrictive:s.isEditingRestrictive,fields:s.fields,contingencies:o})}return null}).filter(de)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let i;if(t?.subtypes){const s=t.subtypes.find(n=>n.code===e);i=_e.fromJSON(s)}return i||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let i;if(t?.subtypes){const s=t.subtypes.find(n=>n.name===e);i=_e.fromJSON(s)}return i||null}_getDomain(e,t){const i=e?ai(e,t):this.layer.getFieldDomain(t);return i?.type==="inherited"?this.layer.getFieldDomain(t):i}};function Yt(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function Xt(e){let t,i;e.sort((n,o)=>n.objectType==="null"?-1:o.objectType==="null"?1:n.minValue-o.minValue);const s=[];for(const n of e)n.objectType!=="null"?t!=null&&i!=null?i<n.minValue?(s.push(new E({objectType:"range",minValue:t,maxValue:i})),t=n.minValue,i=n.maxValue):i<n.maxValue&&(i=n.maxValue):(t=n.minValue,i=n.maxValue):s.push(n);return s.push(new E({objectType:"range",minValue:t,maxValue:i})),s}function ei(e,t){const i=[];let s,n=0;for(const o of e)for(;n<t.length;n++){const a=t[n];if(o.objectType==="null"&&a.objectType==="null")i.push(new E({objectType:"null"}));else{if(o.objectType==="null")break;if(a.objectType==="null")continue}if(o.maxValue<a.minValue)break;if(o.maxValue===a.minValue){i.push(new E({objectType:"range",minValue:o.maxValue,maxValue:a.minValue}));break}if(!(o.minValue>a.maxValue))if(o.minValue!==a.maxValue){if(s=o.minValue>a.minValue?o.minValue:a.minValue,o.maxValue<a.maxValue){i.push(new E({objectType:"range",minValue:s,maxValue:o.maxValue}));break}i.push(new E({objectType:"range",minValue:s,maxValue:a.maxValue}))}else i.push(new E({objectType:"range",minValue:o.minValue,maxValue:a.maxValue}))}return i}function ti(e,t){const i=[];for(const s of e)t.some(n=>{if(s.objectType===n.objectType)switch(s.objectType){case"any":case"null":return!0;case"code":return s.codedValue.code===n.codedValue.code&&s.codedValue.name===n.codedValue.name}return!1})&&i.push(s);return i}function ii(e,t){if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const i=e[0].objectType==="range"||e[1]?.objectType==="range",s=t[0].objectType==="range"||t[1]?.objectType==="range";return i||s?ei(e,t):ti(e,t)}async function si(e,t,i){return H(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(s=>s.data.fieldGroups??[])}async function Ne(e,t,i){return H(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(s=>s.data.layerDataElements?.[0].dataElement.fieldGroups??[])}async function De(e,t){return H(e,{responseType:"json",query:{f:"json"},...t}).then(i=>i.data)}async function ni(e,t,i){return H(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(s=>s.data.contingentValueSets?.[0])}async function oi(e,t,i){return H(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(s=>s.data)}function ai(e,t){const i=e.domains;if(i){const[s,n]=Object.entries(i).find(([o])=>o.trim().toLowerCase()===t.trim().toLowerCase())||[];return n||null}return null}r([u({constructOnly:!0})],k.prototype,"layer",void 0),r([u({constructOnly:!0})],k.prototype,"request",void 0),r([u({type:[me]})],k.prototype,"fieldGroups",void 0),r([u({constructOnly:!0})],k.prototype,"fieldGroupDefinitions",void 0),r([u()],k.prototype,"subtypeFieldName",null),k=ie=r([T("esri.layers.support.LayerContingentValuesCache")],k);const ri=k,A="esri-feature-form",ae=`${A}__group`,P=`${A}__input`,re=`${A}__related-records`,w={base:A,form:`${A}__form`,formHeader:`${A}__form-header`,label:`${A}__label`,labelTextContent:`${A}__label-text-content`,fieldInput:`${P}`,inputRadio:`${P}--radio`,inputRadioGroup:`${P}--radio-group`,inputRadioLabel:`${P}--radio-label`,inputDisabled:`${P}--disabled`,inputSwitch:`${P}--switch`,centeredButton:`${A}__centered-button`,description:`${A}__description-text`,listObserver:`${A}__list-observer`,relatedRecordsHeader:`${re}_header`,relatedRecordsLabel:`${re}_label`,relatedRecordsList:`${re}_list`,dateInputContainer:`${`${A}__date`}-input-container`,textElement:`${A}__text-element`,group:ae,groupSequential:`${ae}--sequential`,groupActive:`${ae}--active`,disabledNotice:`${A}__disabled-notice`},le="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let O=class extends M{constructor(t){super(t),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...t.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(t=>t.isAsync)}get _baseContext(){const{editType:t,layer:i,map:s,originalFeature:n,spatialReference:o,timeZone:a}=this.arcadeContextInfo,l=i?.type==="scene"&&i.associatedLayer!=null?i.associatedLayer:i;return[{$originalfeature:n,$editcontext:{editType:t},$layer:l,$featureset:l,$datastore:i?.url,$map:s},{rawOutput:!0,spatialReference:o??void 0,timeZone:a}]}set feature(t){this._latestFieldValues={...t?.attributes},this._set("feature",t)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(t){return this._evaluate(t)}evaluateInvalidated(t){const{_fieldReferencesLookup:i,_latestFieldValues:s,feature:n}=this,o=new Set;for(const a of t)if(s[a]=n.getAttribute(a),i.has(a))for(const l of i.get(a))o.add(l);return this._evaluate([...o])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(le))return this._evaluate([...this._fieldReferencesLookup.get(le)])}resetExecutors(){for(const t of this.executors)t.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:t,_fieldsAffectedLookup:i,executors:s,preserveFieldValuesWhenHidden:n}=this,o=new Map(this.fieldInputs.map(d=>[d.name,d])),a=n===!1,l=new Map(s.map(d=>[d,new Array]));for(const d of s){for(const p of d.fieldsUsed){ne(t,p,()=>new Set).add(d);const c=o.get(p);[c?.valueExpressionExecutor,c?.editableExpressionExecutor,a?c?.group?.visibilityExpressionExecutor:null,a?c?.visibilityExpressionExecutor:null].filter(h=>h!=null&&h!==d).forEach(h=>{l.get(h).push(d),ne(i,h,()=>new Set).add(c)})}d.geometryUsed&&ne(t,le,()=>new Set).add(d)}return l}async _evaluate(t){const i=new Map,{_dependencyGraph:s,_fieldsAffectedLookup:n,_latestFieldValues:o}=this;for(const l of t)Ye(l,i,s);for(const[l,{resolver:d,dependencyPromises:p}]of i)Promise.all(p).then(async()=>{const[c,h]=this._makeContext(o);return l.executeAsync(c,h)}).then(()=>{if(n.has(l))for(const c of n.get(l))this._latestFieldValues[c.name]=c.value;d.resolve()},c=>{!c||ge(c)||Se(c)||l.markStale(),d.reject(c)});const a=(await Promise.allSettled(Array.from(i.values(),({resolver:l})=>l.promise))).filter(l=>l.status==="rejected"&&!(ge(l.reason)||Se(l.reason)));if(a.length>0){const l=new AggregateError(a,`One or more expression executions failed. First error message: ${a[0].reason}`);throw K.getLogger(this).error(l),l}}_makeContext(t){const[i,s]=this._baseContext,n=this.feature.clone();return n.attributes=t,[{...i,$feature:n},s]}get test(){}};r([u()],O.prototype,"_asyncExecutors",null),r([u()],O.prototype,"_baseContext",null),r([u()],O.prototype,"feature",null),r([u({constructOnly:!0})],O.prototype,"preserveFieldValuesWhenHidden",void 0),r([u()],O.prototype,"executors",void 0),r([u()],O.prototype,"fieldInputs",void 0),r([u()],O.prototype,"arcadeContextInfo",void 0),O=r([T("esri.widgets.FeatureForm.FormExpressionsManager")],O);const Ye=(e,t,i)=>{if(t.has(e))return;const s=Ge();t.set(e,{resolver:s,dependencyPromises:[]}),e.abort();const n=i.get(e);for(const o of n)Ye(o,t,i),t.get(o).dependencyPromises.push(s.promise)},Se=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let L=class extends Ke{constructor(t){super(t),this._expressionTrackingHandles=new Map,this.id=Ue().toString(),this.type="group"}initialize(){this.addHandles([$(()=>[this.visible,this.inputs],([t])=>{const{inputs:i}=this,s=!!t&&void 0;for(const n of i)J(n)&&(n.required=s)},{initial:!0,equals:(t,i)=>i[0]===t[0]&&i[1]===t[1]})])}destroy(){for(const t of this._expressionTrackingHandles.values())t.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(t){this.removeAllHandles(),t&&this.addHandles(t.map(i=>$(()=>i.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",t)}get label(){return super.label}get open(){return this.initialState==="expanded"}set open(t){this._override("open",t)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(t=>t.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:t}=this;t.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};r([u()],L.prototype,"id",void 0),r([u()],L.prototype,"initialState",null),r([u()],L.prototype,"inputs",null),r([u()],L.prototype,"open",null),r([u()],L.prototype,"type",void 0),r([u()],L.prototype,"visible",null),L=r([T("esri.widgets.FeatureForm.GroupInput")],L);const li=L,ui=3;let C=class extends Et{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([$(()=>({feature:this.feature,element:this.element,layer:this.layer}),t=>this._createRelationshipVM(t),He),Ze(()=>this.relatedLayer,"edits",()=>this._relationshipVM?.refresh())])}destroy(){this._relationshipVM?.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,relationship:i}=this;if(!i||!this.loaded||!this.relatedLayerAllowsAdds||this.allCategories?.length&&!this.activeCategory)return!1;const{cardinality:s,role:n}=i;return!(s==="one-to-one"&&t>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&n==="destination"&&t>0)&&e}get activeCategory(){return this._relationshipVM?.activeCategory}set activeCategory(e){const t=this._relationshipVM;t&&(t.activeCategory=e)}get allCategories(){const{relatedLayer:e}=this,t=this._relationshipVM?.categories;if(!We(e))return;const i=(e.subtypes??[]).map(({code:s,name:n})=>{const o=t?.find(a=>a.name===n);return{name:n,count:o?.count??0,value:o?.value??s}});return i.length?i:null}get categories(){return this.showAllEnabled?this.allCategories:this.allCategories?.slice(0,this.displayCount)}get displayCount(){return this.element.displayCount??ui}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){return this._relationshipVM?.featureCount??0}get label(){return this.activeCategory?.name?this.activeCategory.name:this.getFormattedLabel(this.element?.label)}get loaded(){return this._relationshipVM?.state!=="loading"}get map(){return this._get("map")}set map(e){e&&this._relationshipVM?.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){return this._relationshipVM?.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){const{_relationshipVM:e,timeZone:t}=this;if(!e?.relatedFeatures?.length||!e?.relatedLayer)return[];const{itemDescriptionFieldName:i,relatedFeatures:s,relatedLayer:n}=e,o=n&&"formTemplate"in n&&n.formTemplate?n.formTemplate.title:void 0;return s.map(a=>{let l;if(i){const d=a.getAttribute(i),p=n.fieldsIndex.get(i);if(p){const c=At({fields:[p],layer:n,values:[d],timeZone:t})[i];c!=null&&(l=c.toString())}}return{feature:a,description:l,title:o?ce({attributes:a.attributes,label:o,layer:n,timeZone:t}):void 0}}).toArray()}get relatedLayer(){return this._relationshipVM?.relatedLayer}get relatedLayerIsTable(){return!!this.relatedLayer?.isTable}get relatedLayerAllowsAdds(){const{relatedLayer:e}=this;return!e||!this.relatedLayerAllowsEdits?!1:!!ve(e)?.operations?.supportsAdd}get relatedLayerAllowsEdits(){const{relatedLayer:e}=this;return e?!!ve(e)?.operations?.supportsEditing:!1}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){this._relationshipVM?.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get showAllCategoriesVisible(){const e=this.allCategories?.length??0;return!this.showAllEnabled&&e>0&&e>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return t!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){return this._relationshipVM?.state==="loading"||this._relationshipVM?.state==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){return this._relationshipVM?.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){const{feature:t,element:i,layer:s}=e;if(this._relationshipVM?.destroy(),!t||!i||!s)return;const{displayCount:n,map:o,orderByFields:a,relationshipId:l,showAllEnabled:d}=this;Je(s)&&(this._relationshipVM=new Ut({graphic:t,displayCount:n,layer:s,map:o,orderByFields:a,relationshipId:l,showAllEnabled:d}))}};r([u()],C.prototype,"_relationshipVM",void 0),r([u()],C.prototype,"canAddRelatedFeature",null),r([u()],C.prototype,"activeCategory",null),r([u()],C.prototype,"allCategories",null),r([u()],C.prototype,"categories",null),r([u()],C.prototype,"displayCount",null),r([u()],C.prototype,"displayType",null),r([u()],C.prototype,"editable",null),r([u()],C.prototype,"featureCount",null),r([u()],C.prototype,"group",void 0),r([u()],C.prototype,"label",null),r([u()],C.prototype,"loaded",null),r([u()],C.prototype,"map",null),r([u()],C.prototype,"orderByFields",null),r([u()],C.prototype,"originHasValidKey",null),r([u()],C.prototype,"relationship",null),r([u()],C.prototype,"relationshipId",null),r([u()],C.prototype,"relatedFeatureInfos",null),r([u()],C.prototype,"relatedLayer",null),r([u()],C.prototype,"relatedLayerIsTable",null),r([u()],C.prototype,"relatedLayerAllowsAdds",null),r([u()],C.prototype,"relatedLayerAllowsEdits",null),r([u()],C.prototype,"showAllEnabled",null),r([u()],C.prototype,"showAllActionVisible",null),r([u()],C.prototype,"showAllCategoriesVisible",null),r([u({readOnly:!0})],C.prototype,"type",void 0),r([u()],C.prototype,"visible",null),r([u()],C.prototype,"updating",null),C=r([T("esri.widgets.FeatureForm.RelationshipInput")],C);const di=C;function pi(e){const t=/{[^{]+?}/g,i=[...e.matchAll(t)];let s=0;const n=[],o=[];for(const a of i){const l=a[0];n.push(e.slice(s,a.index)),o.push(l),s=a.index+l.length}return n.push(e.slice(s)),{literals:n,templates:o}}function ci(e,t){return t.reduce((i,s,n)=>i.concat(e.at(n),s),"").concat(e.at(-1))}let fe;const hi=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function mi(e){return fe||await fi(),fe.parse(e)}async function fi(){const{Marked:e}=await x(()=>import("./marked.esm-DLj1u0-2.js"),[]),t=function({text:o}){return`<span style="text-decoration:line-through;">${o}</span>`},i=function({href:o,text:a,title:l}){return`<a${o!=null?` href="${o}"`:""}${l!=null?` title="${l}"`:""} target="_blank">${a??""}</a>`},s=()=>"",n={};for(const o of hi)n[o]=s;fe=new e({renderer:{del:t,link:i,...n}})}let R=class extends Ke{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${Ue()}`,this.type="text",this._expressionReferences=new Be,this._expressionsUsed=new be,this._fieldsUsed=new be,this._literalParts=new Ce,this._templateParts=new Ce,this._updatingHandles=new ye}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(mi(e).then(t=>this._initializeTextParts(t))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(t=>`${this._expressionReferences.get(t)?.lastEvaluatedValue??""}`);return nt.sanitize(ci(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e?.updating)}setExpressionExecutor(e,t){this._expressionReferences.set(Te(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(Re(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:i,templates:s}=pi(e),n=[],o=[];for(let a=0;a<s.length;a++){const l=i[a],d=ot(s[a])[0];if(Tt(d))this._expressionsUsed.add(Rt(d)),this._expressionReferences.set(d,null),n.push(l),o.push(d);else if($t(d)){this._expressionsUsed.add(d);const p=Te(d);this._expressionReferences.set(p,null),n.push(l),o.push(p)}else if(t?.has(d)){const p=t.normalizeFieldName(d);this._fieldsUsed.add(p);const c=Re(p);this._expressionReferences.set(c,null),n.push(l),o.push(c)}else i[a+1]=l.concat(d,i[a+1])}n.push(i.at(-1)),this._literalParts.addMany(n),this._templateParts.addMany(o)}};r([u()],R.prototype,"expressionsUsed",null),r([u()],R.prototype,"fieldsIndex",null),r([u()],R.prototype,"fieldsUsed",null),r([u()],R.prototype,"group",void 0),r([u()],R.prototype,"id",void 0),r([u()],R.prototype,"rawText",null),r([u()],R.prototype,"text",null),r([u()],R.prototype,"textFormat",null),r([u()],R.prototype,"type",void 0),r([u()],R.prototype,"updating",null),R=r([T("esri.widgets.FeatureForm.TextElementInput")],R);const yi=R;var je;const _i=Symbol("FormExpressionArcadeExecutor");var Pe;let I=(Pe=class extends M{constructor(e){super(e),this[je]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._initialExecutionComplete=!1,this._stale=!1,this._updatingTracking=new ye,this._executeAsyncDebounced=ze(async(t,i,s)=>{const n=await this.executor.executeAsync(t,{...i,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=n,this._initialExecutionComplete=!0,this._stale=!1,n)})}get initialExecutionComplete(){return this._initialExecutionComplete}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const i=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=i,this._initialExecutionComplete=!0,i}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,t??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}},je=_i,Pe);r([u()],I.prototype,"_lastEvaluatedValue",void 0),r([u()],I.prototype,"_initialExecutionComplete",void 0),r([u()],I.prototype,"_stale",void 0),r([u()],I.prototype,"_updatingTracking",void 0),r([u({constructOnly:!0})],I.prototype,"executor",void 0),r([u()],I.prototype,"initialExecutionComplete",null),r([u()],I.prototype,"isAsync",null),r([u()],I.prototype,"fieldsUsed",null),r([u()],I.prototype,"syntaxTree",null),r([u()],I.prototype,"updating",null),r([u()],I.prototype,"stale",null),r([u()],I.prototype,"geometryUsed",null),r([u()],I.prototype,"variablesUsed",null),r([u()],I.prototype,"lastEvaluatedValue",null),I=r([T("esri.widgets.support.forms.expressions.FormExpressionArcadeExecutor")],I);const gi=async(e,t)=>{const i=Ht("form-calculation"),s=await Zt(e,i,{});return t?.fieldsIndex&&(s.fieldsUsed=at(t.fieldsIndex,s.fieldsUsed)),new I({executor:s})},ue=new ut({attributes:{}}),vi={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"],utilityNetworkAssociations:["editableExpression","visibilityExpression"]},bi="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",G="#JSAPI_CONTINGENT_VALUE_ANY_HASH",Ci="#JSAPI_CONTINGENT_VALUE_NULL_HASH";let v=class extends rt(lt){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=ue.clone(),this._initialFeature=ue.clone(),this._timeZone=null,this._updatingHandles=new ye,this.activeAssociation=null,this.editType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.callbacks=null,this.strict=!1,this.pendingSubtypeChoice=null,this._updateInputs=ze(async()=>{this._stopExpressions();const{_featureClone:t,_initialFeature:i,editType:s,formTemplate:n,inputs:o,layer:a,timeZone:l}=this;if(!a)return;const d={editType:s,feature:t,initialFeature:i,layer:a,timeZone:l},p=o.slice(),c=n?.elements&&n.elements.length>0?await this._updateInputsUsingFormElements(p,n.elements,d):this._updateInputsUsingLayerFields(p,a?.fields,d);this.inputs=c,this._startExpressions()})}initialize(){const e=$(()=>[this.layer,!!this.layer?.loaded,this.formTemplate,this._initialFeature,this.timeZone,this.editType],([s,n])=>{s!=null&&(n?this._updatingHandles.addPromise(this._updateInputs()):s.load().catch(()=>{}))},dt),t=$(()=>this._arcadeContextInfo,s=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=s,this._evaluateExpressions(n=>n.evaluateAll()))}),i=$(()=>this.layer,s=>{const n=s?.type==="subtype-sublayer"?s.parent:s?.type==="feature"?s:null;n&&this.addResolvingPromise(ri.createLoadedLayerContingentValuesCache(n).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,i])}destroy(){this.feature=null,this.layer=null,this._contingentValuesCache=we(this._contingentValuesCache),this.highlightHelper?.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){return new Map(this.formTemplate?.expressionInfos?.map(e=>[e.name,e]))}get activeAssociationInput(){return this.allAssociationInputs.find(e=>e.uid===this.associationId)}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId||e.activeCategory||e.showAllEnabled)}get _arcadeContextInfo(){const{_initialFeature:e,editType:t,layer:i,map:s,spatialReference:n,timeZone:o}=this;return{layer:pt(i)?i:null,originalFeature:e,editType:t,map:s,spatialReference:n,timeZone:o}}get associationId(){return this._get("associationId")}set associationId(e){e==null&&this.activeAssociationInput?.viewModel&&(this.activeAssociationInput.associatedLayer=null,this.activeAssociationInput.viewModel.activeAssociationType=null),this._set("associationId",e)}get associatedLayer(){return this.activeAssociationInput?.associatedLayer}set associatedLayer(e){this.activeAssociationInput&&(this.activeAssociationInput.associatedLayer=e)}get allAssociationInputs(){return Ot(this.inputs)}get allFieldInputs(){return Lt(this.inputs)}get allGroupInputs(){return this.inputs.filter(U)}get allRelationshipInputs(){return kt(this.inputs)}get _layerFieldsByName(){return new Map(this.layer?.fields.map(e=>[e.name,e]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");e!==t&&(this._featureClone=e?.clone()??ue.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(i=>i.feature=e)):(this.inputs.forEach(i=>i.destroy()),this.inputs.length=0),t!==e&&(this.pendingSubtypeChoice=null),this.contingencyConstraintViolations.clear(),this._set("feature",e),this._initialFeature=this._featureClone.clone())}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(t=>t.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e?.description&&t?ce({attributes:this.getValues(),label:e.description,layer:t,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e?.title&&t?ce({attributes:this.getValues(),label:e.title,layer:t,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,activeAssociationInput:t,formDescription:i,formTitle:s}=this;return!(e||t||!i&&!s)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){const e=this._initialFeature;return e?.sourceLayer&&"applyEdits"in e.sourceLayer?e.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||t.forEach(i=>{i.showAllEnabled=!1,i.activeCategory=null}),e!=null){const i=t.find(s=>s.relationshipId===e);i&&(i.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){return this.layer?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){return this.layer?.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return xe;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===ht?t||xe:this._timeZone||ct}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:t})=>t)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}findGroup(e){return this.allGroupInputs.find(t=>t.id===e)}getFieldValueOptionsForField(e,t){const i=this.findField(e);if(!i)return[[],[],[]];const s=i.domain?.type==="coded-value"?i.domain.codedValues.map(({name:a,code:l})=>({name:a,value:l})):[],n=i.value==null||s.some(a=>a.value===i.value)?[]:[{name:`${i.value}`,value:i.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){const a=new Set(o.map(l=>l.value));return[o,s.filter(l=>!a.has(l.value)),n]}return[s,[],n]}getValue(e){const t=this.layer?.getField(e);if(t!=null)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:i,strict:s}=this,n=this.findField(e);t=t===""?null:t,n&&i.getAttribute(e)!==t&&(n.value=t,s&&!n.valid||(this._afterValueChange(n),this._evaluateExpressions(o=>o.evaluateInvalidated([e]))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(n=>n.valid).map(({name:n})=>n)),i=e.filter(n=>!n.valid).map(({name:n})=>n),s=this.getValues();if(this.validateContingencyConstraints(s,{includeIncompleteViolations:!0}).length>0)for(const[n,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(t.delete(n),i.push(n));this.notifyChange("submittable"),this.notifyChange("valid"),this.emit("submit",{valid:[...t],invalid:i,values:s})}validateContingencyConstraints(e,t){const{_contingentValuesCache:i}=this,s=new Map;if(this.contingencyConstraintViolations=s,i==null)return[];const{invalid:n,incomplete:o}=i.validateContingencyConstraints(e),a=[...n,...t?.includeIncompleteViolations?o:[]];for(const l of a)for(const d of l.fieldGroup.fields)s.set(d,l);return a}notifyFeatureGeometryChanged(){const{feature:e,_featureClone:t}=this;e&&(t.geometry=e.geometry,this._evaluateExpressions(i=>i.evaluateInvalidatedByGeometry()))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:i}=this;for(const{name:s}of i){const n=t[s];n!=null&&this.setValue(s,n)}}_emitChangeEvent({name:e,valid:t,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:i,valid:t})}_evaluateExpressions(e){const t=this._expressionsManager;t!=null&&this._updatingHandles.addPromise(e(t).finally(()=>this._afterExpressionsEvaluated()))}async _updateInputsUsingFormElements(e,t,i){const s=new Map;for(const a of e)if(U(a)){s.set(a.element,a);for(const l of a.inputs)l.element&&s.set(l.element,l)}else a.element&&s.set(a.element,a);const n=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:s,updatedElements:t.filter(a=>this._isSupportedElement(a)),sharedInitializationProperties:i,group:null,newExpressionExecutorPromises:n});for(const[a,l]of s.entries())s.delete(a),l.destroy();return await Promise.all(Array.from(n.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:i,sharedInitializationProperties:s,group:n,newExpressionExecutorPromises:o}=e,a=[];for(const l of i){const d=t.has(l),p=d?t.get(l):Q(l)?await this._makeUtilityNetworkAssociationInputFromElement(l,s,n):this._makeInputFromElement(l,s,n);if(p){if(a.push(p),await qe(()=>!p.updating),this._assignExpressionExecutors(p,l,o),d)if(t.delete(l),U(p)){const{feature:c,timeZone:h}=s;p.set({feature:c,timeZone:h})}else if(he(p)){const c=this.relationshipId===l.relationshipId;p.set(s),p.set({map:this.map,showAllEnabled:c})}else Q(p)?(p.set(s),p.set({map:this.map})):p.set(s);if(Fe(l)){const c=l.elements.filter(h=>this._isSupportedElement(h));p.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:c,sharedInitializationProperties:s,group:p,newExpressionExecutorPromises:o})}}}return a}_updateInputsUsingLayerFields(e,t,i){if(!Array.isArray(t))return K.getLogger(this).warn(this.declaredClass,"No attribute fields found."),[];const s=new Map;for(const o of e)if(U(o)){for(const a of o.inputs)a.destroy();o.inputs.length=0,o.destroy()}else he(o)?o.destroy():J(o)&&(o.element!==null?o.destroy():s.set(o.field,o));const n=[];for(const o of t){const a=i.feature?.getAttribute(o.name)??null,l=s.get(o)??new Ae({field:o,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden});n.push(l.set({...i,value:a})),s.delete(o)}for(const[o,a]of s.entries())s.delete(o),a.destroy();return n}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)??null}_makeInputFromElement(e,t,i){return Fe(e)?wi(e,t):mt(e)?this._makeFieldInputFromElement(e,t,i):ft(e)?this._makeRelationshipInputFromElement(e,t,i):Q(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,i):yt(e)?xi(e,t):Q(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,i):_t()}_makeFieldInputFromElement(e,t,i){const{editType:s,feature:n,initialFeature:o,layer:a,timeZone:l}=t,{fieldName:d}=e,p=d&&this._layerFieldsByName.get(d);return p?new Ae({editType:s,element:e,field:p,value:n?.getAttribute(e.fieldName)??null,feature:n,initialFeature:o,layer:a,group:i,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden,timeZone:l}):null}_makeRelationshipInputFromElement(e,t,i=null){const{map:s}=this,{feature:n,layer:o,timeZone:a}=t,l=new di({element:e,feature:n,group:i,layer:o,map:s,timeZone:a});return l.addHandles(Ze(()=>l.relatedLayer,"edits",()=>this._evaluateExpressions(d=>d.evaluateAsyncExpressions()))),l}async _makeUtilityNetworkAssociationInputFromElement(e,t,i=null){const{map:s}=this,{feature:n,layer:o,timeZone:a}=t;return new(await x(async()=>{const{default:l}=await import("./UtilityNetworkAssociationInput-C_klZDqy.js");return{default:l}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))).default({element:e,feature:n,group:i,layer:o,map:s,timeZone:a})}_assignExpressionExecutors(e,t,i){const s=vi[t.type],n=[];for(const o of s){const a=`${o}Executor`;if(e[a]){this._useExecutor(e[a]);continue}const l=t[o];if(l!=null&&l!==""){const d=this._expressionInfosLookup.get(l)?.expression??l;n.push(this._getOrCreateExecutorForExpression(d,i).then(p=>{e[a]=this._useExecutor(p)}))}}return Qe(e)&&n.push(...this._assignTextElementExpressionExecutors(e,i)),n}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:i}=this,s=[];for(const n of e.expressionsUsed){const o=i.get(n);o!=null?s.push(this._getOrCreateExecutorForExpression(o.expression,t).then(a=>e.setExpressionExecutor(n,this._useExecutor(a)))):K.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${n}'`)}for(const n of e.fieldsUsed){const o=`return $feature['${n}'];`;s.push(this._getOrCreateExecutorForExpression(o,t).then(a=>e.setFieldExecutor(n,this._useExecutor(a))))}return s}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:i}=this;if(i.has(e))return i.get(e);if(t.has(e))return t.get(e);const s=gi(e,this.layer);t.set(e,s);const n=await s;return i.set(e,n),n}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:i,allFieldInputs:s,formTemplate:n}=this;this._expressionsManager=new O({executors:e,feature:i,arcadeContextInfo:t,fieldInputs:s,preserveFieldValuesWhenHidden:n?.preserveFieldValuesWhenHidden===!0})}_startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),this._evaluateExpressions(t=>t.evaluateAll())}_stopExpressions(){this._expressionsManager=we(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){const{name:t,value:i}=e,{_featureClone:s,formTemplate:n,layer:o}=this;if(!o)return;const a=s.getAttribute(t);s.setAttribute(t,i);const{typeFieldName:l,types:d}=pe(o);if((e.isSubtypeField||t===l)&&i!==a){if(o.type==="subtype-sublayer"){const c=o.parent?.findSublayerForFeature(s);c&&(this.feature&&(this.feature.sourceLayer=c),s.sourceLayer=c,this._initialFeature.sourceLayer=c)}const p=new Set;for(const c of d)if(c.domains&&typeof c.domains=="object")for(const h of Object.keys(c.domains))p.add(h);for(const c of p){const h=this.findField(c);h&&h.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(n!=null){const{description:p,title:c}=n;c&&Ve(c,t)&&this.notifyChange("formTitle"),p&&Ve(p,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:t}=pe(this.layer),i=t?this.getValue(t):null,s=[];for(const a of e.fieldGroups){const{contingencies:l,fields:d,name:p}=a,c=[];for(const h of l)h.isRetired||h.subtype!=null&&h.subtype.code!==i||c.push({values:h.values});c.length>0&&s.push({name:p,fields:d,contingencies:c})}const[n,o]=this._generateJoinPlan(s);return[...n.flatMap(a=>this._joinFieldGroupContingencies(a)),...o.flatMap(a=>a.contingencies)]}_generateJoinPlan(e){const t=new Map,i=[],s=new Set;for(const d of e)for(const p of d.fields)if(t.has(p)){const c=t.get(p),h=d,f=[c.name,h.name].sort().join("|");if(s.has(f))continue;i.push([c,h]),s.add(f),t.set(p,h)}else t.set(p,d);const n=new Set(i.flat()),o=new Set(e);for(const d of n)o.delete(d);const a=new Map,l=new Map;for(const d of new Set(i.flat())){const p=Symbol(d.name);a.set(p,new Set([d])),l.set(d,p)}for(const[d,p]of i){const c=l.get(d),h=l.get(p);if(c===h)continue;const f=a.get(c),y=a.get(h);for(const g of y)f.add(g),l.set(g,c);a.delete(h)}return[[...a.values()].map(d=>[...d]),[...o]]}_joinFieldGroupContingencies(e){const t=e.slice(),i=t.shift();let s=t.shift(),n=this._generateJoinKey(i.fields,s.fields),o=new Set([...i.fields,...s.fields]),a=new Map;for(const d of i.contingencies){const[p]=this._hashContingency(d,n.codedValueFields,!0);a.has(p)?a.get(p)?.push(d):a.set(p,[d])}for(;t.length>0;){const d=new Map,p=t.shift(),c=this._generateJoinKey(o,p.fields);for(const h of s.contingencies){const[f,y]=this._hashContingency(h,n.codedValueFields),g=y?this._findMatchingContingenciesWithAnyHashMask(a,f):a.get(f);if(a.has(G)&&g?.push(...this._findMatchingContingenciesContainingAny(h,a.get(G),n.codedValueFields)),g!=null)for(const F of g){const _=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(F,h,n.rangeFields):this._joinContingencies(F,h);if(_==null)break;const[V]=this._hashContingency(_,c.codedValueFields,!0);d.has(V)?d.get(V)?.push(_):d.set(V,[_])}}a=d,s=p,n=c,o=new Set([...o,...s.fields])}const l=[];for(const d of s.contingencies){const[p,c]=this._hashContingency(d,n.codedValueFields),h=c?this._findMatchingContingenciesWithAnyHashMask(a,p):a.get(p);if(a.has(G)&&h.push(...this._findMatchingContingenciesContainingAny(d,a.get(G),n.codedValueFields)),h!=null)for(const f of h){const y=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(f,d,n.rangeFields):this._joinContingencies(f,d);y!=null&&l.push(y)}}return l}_joinContingencies(e,t){const i={values:{...e.values,...t.values}};for(const[s,n]of Object.entries(i.values))n.objectType==="any"&&e.values[s]!=null&&(i.values[s]=e.values[s]);return i}_joinContingenciesWithRangeDomains(e,t,i){const s=this._joinContingencies(e,t);for(const n of i){const o=e.values[n],a=t.values[n],{leftIsNull:l,rightIsNull:d,bothAreNull:p,leftIsAny:c,rightIsAny:h,bothAreAny:f,leftIsRange:y,rightIsRange:g}=this._compareObjectTypes(o.objectType,a.objectType);if(p||f)continue;if(l&&h||d&&c){s.values[n]=new E({objectType:"null"});continue}if(l&&g||d&&y)return null;c?(o.minValue=-1/0,o.maxValue=1/0):h&&(a.minValue=-1/0,a.maxValue=1/0);const F=Math.max(o.minValue,a.minValue),_=Math.min(o.maxValue,a.maxValue);if(F>_)return null;s.values[n]=new E({objectType:"range",minValue:F,maxValue:_})}return s}_findMatchingContingenciesContainingAny(e,t,i){return t.filter(s=>i.every(n=>{const o=s.values[n],a=e.values[n];return o.objectType==="any"||a.objectType==="any"||o.codedValue?.code===a.codedValue?.code}))}_findMatchingContingenciesWithAnyHashMask(e,t){const i=new RegExp(`${t}$`),s=[];for(const[n,o]of e){if(n===G)break;i.test(n)&&s.push(...o)}return s}_generateJoinKey(e,t){const i=Array.isArray(e)?new Set(e):e,s=Array.isArray(t)?new Set(t):t,n=i.size<s.size?i:s,o=n===i?s:i,{feature:a}=this,l=new Set,d=new Set;for(const p of n)if(o.has(p)){const c=this.layer?.getFieldDomain(p,{feature:a??void 0,excludeImpliedDomains:!0});if(c==null)continue;switch(c.type){case"coded-value":l.add(p);break;case"range":d.add(p)}}return{codedValueFields:[...l],rangeFields:[...d]}}_contingencyIsValid(e,t){const i={};for(const{name:s,value:n}of this.allFieldInputs)this.fieldsWithContingentValues.has(s)&&n!=null&&s!==e&&(i[s]=n);return Object.entries(i).every(([s,n])=>!t.values.hasOwnProperty(s)||Mt(n,t.values[s]))}_getContingentValueOptionsForField(e,t){const i=this.joinedContingentValues.slice(),s=new Map,n={code:"",name:t??"No value"};for(const o of i){const a=o.values[e];if(a?.objectType==="code"||a?.objectType==="null"){const{code:l,name:d}=a.codedValue&&a.objectType!=="null"?a.codedValue:n;!s.has(l)&&this._contingencyIsValid(e,o)&&s.set(l,{name:d,value:l})}}return[...s.values()]}_hashContingency(e,t,i=!1){if(t.length<1)return[bi,!1];const s=[];let n=!1;for(const o of t){const a=e.values[o];if(a.objectType==="any"){if(i)return[G,!0];n=!0,s.push(`${o}:.*`)}else a.objectType==="null"?s.push(`${o}:${Ci}`):s.push(`${o}:${a.codedValue?.code}`)}return[s.sort().join("&"),n]}_compareObjectTypes(e,t){return{leftIsNull:e==="null",rightIsNull:t==="null",bothAreNull:e==="null"&&t==="null",leftIsAny:e==="any",rightIsAny:t==="any",bothAreAny:e==="any"&&t==="any",leftIsRange:e==="range",rightIsRange:t==="range"}}_isSupportedElement(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||e.type==="text"||e.type==="utilityNetworkAssociations"||(K.getLogger(this).warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}get test(){return{featureClone:this._featureClone}}};function wi(e,t){const{feature:i,layer:s}=t;return new li({element:e,inputs:[],feature:i,layer:s})}function xi(e,t,i=null){const{feature:s,layer:n,timeZone:o}=t;return new yi({element:e,feature:s,group:i,layer:n,timeZone:o})}r([u()],v.prototype,"_expressionInfosLookup",null),r([u()],v.prototype,"_featureClone",void 0),r([u()],v.prototype,"_initialFeature",void 0),r([u()],v.prototype,"_timeZone",void 0),r([u()],v.prototype,"activeAssociation",void 0),r([u()],v.prototype,"activeAssociationInput",null),r([u()],v.prototype,"activeRelationshipInput",null),r([u()],v.prototype,"_arcadeContextInfo",null),r([u()],v.prototype,"associationId",null),r([u()],v.prototype,"associatedLayer",null),r([u()],v.prototype,"allAssociationInputs",null),r([u()],v.prototype,"allFieldInputs",null),r([u()],v.prototype,"allGroupInputs",null),r([u()],v.prototype,"allRelationshipInputs",null),r([u()],v.prototype,"_layerFieldsByName",null),r([u()],v.prototype,"editType",void 0),r([u()],v.prototype,"contingencyConstraintViolations",void 0),r([u()],v.prototype,"disabled",void 0),r([u()],v.prototype,"feature",null),r([u()],v.prototype,"fieldsWithContingentValues",null),r([u({type:gt})],v.prototype,"formTemplate",null),r([u()],v.prototype,"formDescription",null),r([u()],v.prototype,"formTitle",null),r([u()],v.prototype,"formHeaderVisible",null),r([u()],v.prototype,"highlightHelper",void 0),r([u()],v.prototype,"inputs",void 0),r([u()],v.prototype,"joinedContingentValues",null),r([u()],v.prototype,"layer",null),r([u()],v.prototype,"map",void 0),r([u()],v.prototype,"callbacks",void 0),r([u()],v.prototype,"relationshipId",null),r([u()],v.prototype,"spatialReference",null),r([u()],v.prototype,"state",null),r([u()],v.prototype,"strict",void 0),r([u()],v.prototype,"submittable",null),r([u()],v.prototype,"timeZone",null),r([u()],v.prototype,"updating",null),r([u()],v.prototype,"valid",null),r([u()],v.prototype,"pendingSubtypeChoice",void 0),r([u()],v.prototype,"getValues",null),r([u()],v.prototype,"submit",null),r([u()],v.prototype,"test",null),v=r([T("esri.widgets.FeatureForm.FeatureFormViewModel")],v);const Fi=v;let q=class extends M{constructor(e){super(e),this.associationDetails=!0,this.readOnlyNotice=!0}};r([u({type:Boolean,nonNullable:!0})],q.prototype,"associationDetails",void 0),r([u({type:Boolean,nonNullable:!0})],q.prototype,"readOnlyNotice",void 0),q=r([T("esri.widgets.FeatureForm.VisibleElements")],q);const Xe=q,N="data-field-name";let b=class extends vt{constructor(e,t){super(e,t),this._associationsWidgetsMap=new Be,this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(i=>{i.length&&i[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this._featureFormUNAssociationList=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new Fi,this.visibleElements=new Xe,this._onShowAllRelatedRecordsClick=i=>{const{feature:s,callbacks:n}=this;s&&n?.showAllRelatedRecords&&n.showAllRelatedRecords({parentFeature:s,relationshipId:i})},this._onAddRelatedRecordsClick=(i,s,n)=>{const{feature:o,callbacks:a}=this;let l=n;if(o&&a?.addRelatedRecord){if(We(n)&&i.activeCategory){const d=i.activeCategory.value,p=n.findSublayerForSubtypeCode(d);p&&Je(p)&&(l=p)}a.addRelatedRecord({parentFeature:o,relatedLayer:l,relationshipId:s})}},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this),this._afterGroupCreate=this._afterGroupCreate.bind(this)}initialize(){this.addHandles([$(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),qe(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=e?.name||null,this._attemptFocusOnNextRender=!0})}),$(()=>[this._featureFormUNAssociationList,this.visibleElements.associationDetails],([e,t])=>{e&&(e.visibleElements.associationDetails=t)},He),$(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(i=>this._inputsWithChanges.add(i)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),$(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange()),$(()=>this.viewModel.activeAssociationInput,e=>{e&&this._featureFormUNAssociationList&&(this._featureFormUNAssociationList.associationInput=e,this._featureFormUNAssociationList.viewModel=e.viewModel)}),$(()=>this.viewModel.inputs.filter($e),async e=>{this._featureFormUNAssociationList||await this._setUpUtilityNetworkAssociationList();for(const t of e)this._associationsWidgetsMap.has(t)||this._associationsWidgetsMap.set(t,await this._makeAssociationsWidget(t))})])}loadDependencies(){return bt({block:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.OY),__vite__mapDeps([1,2])),button:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.OI),__vite__mapDeps([1,2])),chip:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.Ov),__vite__mapDeps([1,2])),combobox:()=>x(()=>import("./index-BHW8fMr9.js"),__vite__mapDeps([10,1,2,11,12])),"combobox-item":()=>x(()=>import("./index-D344BtUF.js"),__vite__mapDeps([11,1,2,12])),"combobox-item-group":()=>x(()=>import("./index-mvPjoixz.js"),__vite__mapDeps([13,1,2,12])),icon:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.Ou),__vite__mapDeps([1,2])),input:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.O_),__vite__mapDeps([1,2])),"input-date-picker":()=>x(()=>import("./index-7P_2ECUs.js"),__vite__mapDeps([14,1,2,15])),"input-message":()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.OZ),__vite__mapDeps([1,2])),"input-number":()=>x(()=>import("./index-CPutAJp2.js"),__vite__mapDeps([16,1,2])),"input-time-picker":()=>x(()=>import("./index-Dm2qibni.js"),__vite__mapDeps([17,1,2])),"input-time-zone":()=>x(()=>import("./index-C0-aE-rq.js"),__vite__mapDeps([18,1,2,11,12,10,13])),label:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.P9),__vite__mapDeps([1,2])),list:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.O$),__vite__mapDeps([1,2])),"list-item":()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.P1),__vite__mapDeps([1,2])),loader:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.OH),__vite__mapDeps([1,2])),notice:()=>x(()=>import("./index-aRi8Xk-b.js").then(e=>e.P5),__vite__mapDeps([1,2])),"radio-button":()=>x(()=>import("./index-C-mZpnEU.js"),__vite__mapDeps([19,1,2])),"radio-button-group":()=>x(()=>import("./index-BQqLQoGp.js"),__vite__mapDeps([20,1,2])),switch:()=>x(()=>import("./index-C0OVrMLM.js"),__vite__mapDeps([21,1,2])),"text-area":()=>x(()=>import("./index-DDzPvFua.js"),__vite__mapDeps([22,1,2,23]))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const{callbacks:e}=this;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _utilityNetworkAssociationsEnabled(){const{callbacks:e}=this;return!(!e?.viewAssociatedLayers||!e.viewAssociatedFeatures)}get _subtypes(){return Ct(this.layer)}get associationId(){return this.viewModel.associationId}set associationId(e){this.viewModel.associationId=e}get associatedLayer(){return this.viewModel.associatedLayer}set associatedLayer(e){this.viewModel.associatedLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get callbacks(){return this.viewModel.callbacks}set callbacks(e){this.viewModel.callbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{this._prompt?.cancel?.(),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return m("div",{class:this.classes(w.base,Ee.widget,Ee.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return m("div",null,m("form",{class:w.form,inert:!!this._prompt,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderReadOnlyNotice(),this._renderHeader(),this._renderContent()),this._prompt?m(It,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderReadOnlyNotice(){const{disabled:e,messages:t}=this;if(e&&this.visibleElements.readOnlyNotice)return m("calcite-notice",{class:w.disabledNotice,icon:"read-only-non-editable",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},t.disabledForm))}_renderHeader(){const e=this.viewModel,{formTitle:t,formDescription:i}=e;if(!e.formHeaderVisible)return;const s=t!=null&&m(Kt,{key:"title",level:this.headingLevel},t),n=i!=null&&m("p",{class:w.description,key:"description"},i);return m("div",{class:w.formHeader},s,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.activeAssociationInput?this._renderFeatureFormUtilityNetworkAssociationList():e.inputs.filter(de).filter(t=>t.visible).map(t=>this._renderInput(t))}_renderInput(e){return U(e)?this._renderGroup(e):J(e)?this._renderLabeledField(e):he(e)?this._renderRelationshipInput(e):Qe(e)?this._renderTextElementInput(e):$e(e)?this._renderUtilityNetworkAssociationsElementInput(e):void 0}_renderFeatureFormUtilityNetworkAssociationList(){return this._featureFormUNAssociationList?.render()}_selectAssociatedLayer(e){const{feature:t,callbacks:i}=this;t&&i?.viewAssociatedFeatures&&i.viewAssociatedFeatures({associatedLayer:e.layer})}async _selectAssociatedFeature(e){const{feature:t,callbacks:i}=this;t&&i?.selectAssociatedFeature&&await i.selectAssociatedFeature({parentFeature:t,...e})}_onAddAssociation(e){const{feature:t,callbacks:i}=this;t&&i?.addAssociation&&i.addAssociation(e)}async _setUpUtilityNetworkAssociationList(){if(!this._featureFormUNAssociationList){const e=(await x(async()=>{const{default:t}=await import("./FeatureFormUtilityNetworkAssociationList-B6_Z7WPO.js");return{default:t}},__vite__mapDeps([24,1,2,0,3,4,5,6,7,8,9,25,26]))).default;this._featureFormUNAssociationList=new e({onSelectLayer:this._selectAssociatedLayer.bind(this),onSelectFeature:this._selectAssociatedFeature.bind(this),onAddAssociation:this._onAddAssociation.bind(this)})}}async _makeAssociationsWidget(e){return new(await x(async()=>{const{default:t}=await import("./FeatureUtilityNetworkAssociations-f82GCPhX.js").then(i=>i.F);return{default:t}},__vite__mapDeps([27,1,2,5,8,3,9]))).default({onSelectAssociationType:({viewModel:t,listType:i})=>{t.activeAssociationType=i;const{feature:s,callbacks:n}=this;s&&n?.viewAssociatedLayers&&n.viewAssociatedLayers({associationId:e.uid})},viewModel:e.associationsViewModel})}_renderUtilityNetworkAssociationsElementInput(e){if(this._utilityNetworkAssociationsEnabled)return this._associationsWidgetsMap.get(e)?.render()}_renderDescriptionOrEmpty(e,t){return e==null?null:m("div",{class:this.classes(w.description),id:t},e)}_renderGroup(e){const{formTemplate:t,headingLevel:i}=this,{description:s,id:n,inputs:o,label:a,open:l}=e,d=o.filter(f=>f.visible),p=this.viewModel.findField(this._focusedFieldName),c=p?.group===e,h=this.groupDisplay==="sequential";return m("calcite-block",{afterCreate:this._afterGroupCreate,class:this.classes(w.group,h?w.groupSequential:null,c?w.groupActive:null),collapsible:!0,"data-group":e,description:s||void 0,expanded:l,heading:a??"",headingLevel:t?.title?Jt(i):i,id:n,key:n,onCalciteBlockToggle:({currentTarget:f})=>this._onGroupToggle(f,e)},d.map(f=>this._renderInput(f)))}_getFocusableInput(e,t){const i=Nt(this.viewModel.inputs);let s;if(e==="backward"&&i.reverse(),t)if(U(t)){const n=t.inputs.find(o=>o.visible);s=n?i.indexOf(n):0}else{let n;if(oe(t)&&!t.group.open){const o=t.group.inputs.filter(J);n=e==="forward"?o[o.length-1]:o[0]}else n=t;s=i.indexOf(n)+1}else s=0;for(let n=s;n<i.length;n++){const o=i[n];if(o.visible&&J(o)){if(this.disabled&&o.inputType&&(o.inputType==="switch"||o.inputType==="radio-buttons"))continue;return o}}return null}_renderLabeledField(e){const{dataType:t,feature:i,label:s,layer:n,required:o}=e,a={"aria-label":o?W(this.messages.requiredFieldLabel,{name:s}):s,class:w.label,key:`${n.id}-${i.uid}-${e.name}`},l=[m("div",{class:w.labelTextContent,key:"labelTextContainer"},s,o?m("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&e.domain?.type!=="coded-value"?m("label",{...a},l):m("calcite-label",{...a},l)}_renderFieldInput(e){const{dataType:t,domain:i,inputType:s,name:n}=e,o=this.getCommonInputProps(e);if(i?.type==="coded-value"){const a=this.viewModel.getFieldValueOptionsForField(n,this.messages.empty);return s!=="switch"||e.hasInvalidSwitchValue?s==="radio-buttons"?this._renderRadioButtonComponents(e,a.flat(),o):this._renderComboBoxComponent(e,a,o):this._renderSwitchComponent(e,o)}return s==="datetime-picker"||t==="date"?this._renderDateComponents(e,o):t==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?m("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:i=>this._saveValueFromComponent(i.currentTarget)}):m("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:i=>this._saveValueFromComponent(i.currentTarget)}):m("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:i=>this._saveValueFromComponent(i.currentTarget)})}_renderNumberComponent(e,t){const i=wt(e.field),s=i&&t.value!==""?Math.round(parseFloat(t.value)).toString():t.value;return m("calcite-input-number",{...t,integer:i,loading:e.updating,type:"number",value:s,onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.currentTarget)})}_renderDateComponents(e,t){const{field:i}=e;switch(i.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,Wt(i,t.value,{timeZone:this.timeZone,...Bt(i)}))}}_renderDateOnlyFieldComponent(e,t){const{range:i,valid:s,value:n}=e,{class:o,key:a,readOnly:l}=t,{rawMax:d,rawMin:p}=i;return m("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:o,"data-date-part":"date","data-field-name":t[N],key:`${a}-date-input`,max:Ie(d)?d:void 0,min:Ie(p)?p:void 0,numberingSystem:X,onblur:c=>{this._focusedFieldName=null,this._saveValueFromDateComponent(c.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:l,value:n!=null?`${n}`:void 0,onCalciteInputDatePickerChange:c=>this._saveValueFromDateComponent(c.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{valid:i,value:s}=e,{class:n,key:o,readOnly:a}=t;return m("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:n,"data-date-part":"time","data-field-name":t[N],key:`${o}-time-input`,numberingSystem:X,onblur:l=>{this._focusedFieldName=null,this._saveValueFromDateComponent(l.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:s!=null?`${s}`:void 0,onCalciteInputTimePickerChange:l=>this._saveValueFromDateComponent(l.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{name:i,range:s,timeZone:n,valid:o,value:a}=e,{class:l,key:d,readOnly:p}=t,{rawMax:c,rawMin:h}=s,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:X,overlayPositioning:"fixed",readOnly:p,[N]:i,onfocus:this._onComponentFocus},y=ee(c,n),g=ee(h,n),F=ee(a,n);return m("div",{class:w.dateInputContainer,key:`${d}-date-time-container`},m("calcite-input-date-picker",{...f,class:l,"data-date-part":"date",key:`${d}-date-input`,max:y?.date??void 0,min:g?.date??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:F.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),m("calcite-input-time-picker",{...f,class:l,"data-date-part":"time",key:`${d}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:e.timeStep,value:F.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),e.includeTimeOffset?m("calcite-input-time-zone",{...f,class:l,"data-date-part":"timeZone",disabled:p,key:`${d}-timezone-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:F.timeZoneOffset??"0",onCalciteInputTimeZoneChange:_=>this._saveValueFromDateComponent(_.currentTarget)}):null)}_renderDateFieldComponents(e,t){const{includeTime:i,name:s,valid:n,value:o}=e,{class:a,key:l,max:d,min:p,readOnly:c}=t,{timeZone:h}=this,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,numberingSystem:X,overlayPositioning:"fixed",readOnly:c,[N]:s,onfocus:this._onComponentFocus},y=te(o,h),g=te(d,h),F=te(p,h);return m("div",{class:w.dateInputContainer,key:`${l}-date-time-container`},m("calcite-input-date-picker",{...f,class:a,"data-date-part":"date",key:`${l}-date-input`,max:g?.date??void 0,min:F?.date??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:y.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),i?m("calcite-input-time-picker",{...f,class:a,"data-date-part":"time",key:`${l}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:1,value:y.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}):null)}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return m("calcite-input",{...i,class:this.classes(w.fieldInput,w.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:i.value})}_renderComboBoxComponent(e,t,i){const{value:s,name:n}=e,{viewModel:o,_inputsWithChanges:a}=this,l=o.editType==="INSERT",d=a.has(n),p=s==null&&(!l||d),c=l&&e.showNoValueOptionEnabled&&!d?()=>{}:i.onblur;return m("calcite-combobox",{...i,allowCustomValues:!1,clearDisabled:!0,onblur:c,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:h})=>{p&&h.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(h):e.isSubtypeField&&h.selectedItems.length===0?h.value=`${e.value}`:this._saveValueFromComponent(h)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:i,name:s}=e,{messages:n,messagesTemplates:o,viewModel:a,_inputsWithChanges:l}=this,[d,p,c]=t.map(F=>F.map(({name:_,value:V})=>m("calcite-combobox-item",{key:`#${V}`,selected:i===V,textLabel:_,value:`${V}`}))),h=[];p.length>0&&h.push(m("calcite-combobox-item-group",{key:"other",label:o.other},p)),c.length>0&&h.push(m("calcite-combobox-item-group",{key:"unsupported",label:n.subtypes.unsupportedDomainGroupTitle},c)),h.length>0?h.unshift(m("calcite-combobox-item-group",{key:"recommended",label:n.recommended},d)):h.push(...d);const f=a.editType==="INSERT",y=l.has(s),g=i==null&&(!f||y);return e.showNoValueOptionEnabled&&h.unshift(m("calcite-combobox-item",{key:"empty-option",selected:g,textLabel:e.showNoValueLabel||n.empty,value:""})),h}_renderRadioButtonComponents(e,t,i){const{name:s,value:n}=e,o=t.map(({name:a,value:l})=>this._renderRadioButtonComponent({key:a,label:a,name:s,value:l,selected:l===n,props:i}));if(e.showNoValueOptionEnabled){const l=e.showNoValueLabel||this.messages.empty,d=n===""||n===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:l,name:s,value:"",selected:d,props:i}))}return m("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:w.inputRadioGroup,"data-field-name":i[N],key:`${i.key}-radio-group`,layout:"vertical",name:i.key,required:i.required},o)}_renderSwitchComponent(e,t){const{value:i}=e,s=!!Oe(e.element,"switch")&&i===e.element.input.onValue;return m("calcite-switch",{...t,checked:s,class:w.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:n=>this._saveValueFromComponent(n.currentTarget)})}_renderRadioButtonComponent({key:e,name:t,value:i,selected:s,label:n,props:o}){return m("calcite-label",{class:w.inputRadioLabel,key:e,layout:"inline"},m("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:s,class:w.inputRadio,disabled:o.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:i,onCalciteRadioButtonChange:({currentTarget:a})=>{a.checked&&this._saveValueFromComponent(a)}}),n)}_renderAuxiliaryText(e){const t=e.name,i=this._inputsWithChanges.has(t)&&!e.submittable?Dt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return i!=null?m("calcite-input-message",{icon:!0,status:"invalid"},i):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?m("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){if(!e.showAllActionVisible||!this.callbacks?.showAllRelatedRecords)return;const t=this.messages;return m("calcite-list-item",{description:W(t.totalCount,{count:e.featureCount}),key:"show-all-related-features",label:t.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(e.relationshipId)},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:i,relatedLayer:s,editable:n}=e,{messages:o,callbacks:a,disabled:l}=this,d=!n||l;if(t&&a?.addRelatedRecord&&s&&!d)return m("calcite-button",{alignment:"center",appearance:"outline-fill",class:w.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${i}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(e,i,s)},round:!0,scale:"s",width:"full"},e.relatedLayerIsTable?o.addRecord:o.addFeature)}_renderRelatedRecordListItem(e,t,i){const{feature:s,description:n,title:o}=e,{feature:a,callbacks:l}=this,{highlightHelper:d}=this.viewModel,p=()=>{d?.removeAll(),l?.editRelatedRecord&&a&&l.editRelatedRecord({parentFeature:a,relationshipId:t,relatedFeature:s,readOnly:i})},c=d?()=>d.add(s):void 0,h=d?()=>d.remove(s):void 0;return m("calcite-list-item",{bind:this,description:n,key:`${t}-${s.uid}`,label:o,onmouseenter:c,onmouseleave:h,value:o,onCalciteListItemSelect:p},m("calcite-icon",{icon:St(s),slot:"content-start"}),m("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled)return;const{relationshipId:t,activeCategory:i}=e,s=i?null:this._renderDescriptionOrEmpty(e.description);return m("calcite-label",{class:this.classes(w.label,w.relatedRecordsLabel),key:`relationship-${t}-container`},m("div",null,this._renderRelatedRecordsHeaderContainer(e),s,this._renderRelationshipInputContent(e)),this._renderAddRelatedRecordButton(e))}_renderRelationshipInputContent(e){return e.featureCount>0?this._renderRelatedRecordsList(e):e.activeCategory&&e.featureCount===0?this._renderNoRelatedRecordsNotice():e.allCategories?.length?this._renderCategoryList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0}_renderCategoryList(e){return m("calcite-list",{displayMode:"flat",label:this.messages.relatedRecordsList,loading:e.updating},e.categories?.map(t=>this._renderCategory(e,t)),this._renderShowAllCategoriesListItem(e))}_renderCategory(e,t){const{count:i,name:s,value:n}=t,o=xt(i);return m("calcite-list-item",{key:`${s}-${n}`,label:s,onCalciteListItemSelect:()=>this._selectCategory(e,t)},m("calcite-chip",{label:o,scale:"s",slot:"content-end"},o),m("calcite-icon",{flipRtl:!0,icon:"chevron-left",scale:"s",slot:"content-end"}))}_selectCategory(e,t){this.relationshipId=e.relationshipId,e.activeCategory=t}_renderShowAllCategoriesListItem(e){if(!e.showAllCategoriesVisible)return;const t=this.messages;return m("calcite-list-item",{description:W(t.totalCount,{count:e.allCategories?.length??0}),key:"show-all-categories",label:t.showAll,value:!0,onCalciteListItemSelect:()=>e.showAllEnabled=!0},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderRelatedRecordsHeaderContainer(e){const t=e.updating||!e.loaded;return m("div",{class:w.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},m("span",null,e.label),t?m("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t,editable:i}=e,{disabled:s}=this,n=!i||s;return m("calcite-list",{class:w.relatedRecordsList,label:this.messages?.relatedRecordsList},e.relatedFeatureInfos.map(o=>this._renderRelatedRecordListItem(o,t,n)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){const{messages:t}=this,i=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,s=e.relationship?.keyField,n=this.viewModel.findField(s),o=e.layer?.fieldsIndex.get(s),a=n?.label||o?.alias||s,l=W(i,{relatedLayerName:e.relatedLayer?.title,originKeyField:a});return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},l))}_renderNoRelatedRecordsNotice(){return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return m("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:w.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return m("div",{class:w.textElement,"data-testid":`text-element-${e.label}`,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:i,hint:s,label:n,maxLength:o,minLength:a,name:l,range:{max:d,min:p},required:c,valid:h,value:f}=e,y=this._inputsWithChanges.has(l),g=!i||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(w.fieldInput,g?w.inputDisabled:null),status:y&&!h?"invalid":"idle",key:l,label:n,max:d??void 0,min:p??void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:s??void 0,readOnly:g,required:c,value:f==null?"":`${f}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[N]:l}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(N))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),i=e.dataset.datePart,s=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null&&t.value!=null){const n=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=te(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=ee(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}n.unobserve(e)});n.observe(e)}if(s!=null)switch(i){case"date":s.date=e;break;case"time":s.time=e;break;case"timeZone":s.timeZone=e}else this._dateComponentMap.set(t.name,{[i]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);jt(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,i=e.querySelector("calcite-radio-button"),s=t||i;s&&this._afterComponentCreateOrUpdate(s)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,i=this._getFieldInputFromHTMLElement(e),s=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&s===i&&(this._attemptFocusOnNextRender=!1,oe(i)&&(i.group.open=!0),Ft(e))}async _afterGroupCreate(e){const t=this.viewModel.findGroup(e.id),i=this.viewModel.findField(this._focusedFieldName);i&&t&&Pt(i,t)&&(!i.editable||this.disabled)&&(await e.componentOnReady(),this._attemptFocusOnNextRender=!0,this.scheduleRender())}_onComponentFocus(e){const t=e.target,i=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=i.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,"readOnly"in t&&t.readOnly||this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,i=this._getFieldInputFromHTMLElement(e),s=i.field.type,{name:n,range:o}=i,a=this._dateComponentMap.get(n);if(!a)return;let l=this.viewModel.getValue(n),d=null;s==="date-only"?d=Array.isArray(e.value)?e.value[0]:e.value:s==="time-only"?(l=Le(l),d=Le(e.value)):d=s==="timestamp-offset"?e.value!=null?zt({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:l,defaultTimeZone:t}):null:e.value!=null?qt({oldValue:l,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,d!==null&&e.value?l!==d&&this._updateFieldValue(n,d):this._updateFieldValue(n,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),i=this._parseValue(e),s=t.value;t.isSubtypeField&&Gt(this.layer,s,i)?this._pendingSubtypeChoice||i===s||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,i)):this._updateFieldValue(t.name,i)}async _handleSubtypeChoice(e,t){const{value:i,name:s}=e,{messages:n,viewModel:o,messagesCommon:a,_subtypes:l}=this;if(this._updateFieldValue(s,t),!l?.length)return;const d=l.find(g=>g.code===t),p=l.find(g=>g.code===i)?.name??`${i}`;if(!d)return;const c=Ge();o.pendingSubtypeChoice=c;let h="update-fields";const f=[{label:n.subtypes.useDefaultValuesOption,value:"update-fields"},{label:n.subtypes.keepCurrentValuesOption,value:"keep-existing"}],y={context:"info",title:n.subtypes.changeWarningTitle,message:W(n.subtypes.changeWarning,{originalType:p,newType:d.name}),radios:f,defaultRadioSelection:"update-fields",onRadioSelection:g=>h=g,actions:{primary:{label:a.apply,action:()=>c.resolve(h),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>c.resolve("undo")}},cancel:()=>c.reject()};try{switch(this.showPrompt(y),await c.promise){case"update-fields":o.applySubtypeDefaults(d),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,i)}}finally{o.pendingSubtypeChoice=null,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const i=this._getFieldInputFromHTMLElement(t);e==="Enter"&&oe(i)&&!i.group.open&&(i.group.open=!0)}_updateFieldValue(e,t){const i=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),i!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([t,i])=>i!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),i=e.value;return Oe(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:i==null||i===""?null:t.dataType==="number"?i==="-0"||i==="-0."||i==="-0,"?i:parseFloat(i):t.field.type==="date"?parseFloat(i):i}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:i}=e;i.length===0&&t&&"selected"in t?t.selected=!0:K.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){e.expanded?(t.open=!0,this._focusedFieldName=this._getFocusableInput("forward",t)?.name||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(i=>{i!==t&&(i.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){this.viewModel.activeRelationshipInput?.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(i=>i.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(i=>i.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};r([u()],b.prototype,"_listObserverNode",void 0),r([u()],b.prototype,"_relatedRecordsEnabled",null),r([u()],b.prototype,"_utilityNetworkAssociationsEnabled",null),r([u()],b.prototype,"_prompt",void 0),r([u()],b.prototype,"_subtypes",null),r([u()],b.prototype,"associationId",null),r([u()],b.prototype,"associatedLayer",null),r([u()],b.prototype,"disabled",null),r([u()],b.prototype,"feature",null),r([u()],b.prototype,"_featureFormUNAssociationList",void 0),r([u()],b.prototype,"formTemplate",null),r([u()],b.prototype,"groupDisplay",void 0),r([u()],b.prototype,"headingLevel",void 0),r([u()],b.prototype,"icon",null),r([u()],b.prototype,"label",null),r([u()],b.prototype,"layer",null),r([u()],b.prototype,"map",null),r([u(),Y("esri/widgets/FeatureForm/t9n/FeatureForm")],b.prototype,"messages",void 0),r([u(),Y("esri/t9n/common")],b.prototype,"messagesCommon",void 0),r([u(),Y("esri/widgets/Feature/t9n/Feature")],b.prototype,"messagesFeature",void 0),r([u(),Y("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],b.prototype,"messagesTemplates",void 0),r([u()],b.prototype,"callbacks",null),r([u()],b.prototype,"relationshipId",null),r([u()],b.prototype,"spatialReference",null),r([u()],b.prototype,"strict",null),r([u()],b.prototype,"timeZone",null),r([u()],b.prototype,"showPrompt",null),r([u()],b.prototype,"clearPrompt",null),r([u(),Vt(["value-change","submit"])],b.prototype,"viewModel",void 0),r([u({type:Xe,nonNullable:!0})],b.prototype,"visibleElements",void 0),r([u()],b.prototype,"test",null),b=r([T("esri.widgets.FeatureForm")],b);const ji=b;export{ri as D,Fi as Q,ji as Y};
