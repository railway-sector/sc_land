const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VersionManagementService-NjRF0AH1.js","assets/index-CgzAF5Ey.js","assets/index-ni9qn0ie.css","assets/index-DCotZYsY.js"])))=>i.map(i=>d[i]);
import{f8 as j,d4 as Ce,_ as s,e as o,cm as D,cn as P,g as A,ch as Fe,a5 as I,hf as Ve,cv as ke,dn as Me,O as F,V as _,du as Ee,a3 as se,qi as re,d6 as he,jb as ve,f6 as Oe,b3 as Ue,B as De,f as L,xg as Pe,a0 as G,pe as K,rl as ge,cs as xe,dq as E,wf as Ne,db as je,Z as W,bJ as be,bG as Be,$ as He,a_ as oe,ff as ae,y as qe,b_ as Re,ex as Ge,W as f,cg as Ie,jr as V,ap as ze,au as le,a1 as q,T as Je,I as Ke,DT as We,U as Ze,bK as Qe}from"./index-CgzAF5Ey.js";import{Z as Xe}from"./FeatureService-CeU7iukh.js";import{s as Ye}from"./utils-705cvpPF.js";import{s as et}from"./Heading-CsXYN9Dx.js";import{L as tt}from"./symbolUtils-0l5vVMbV.js";import{e as nt}from"./vmEvent-CsrnYMSK.js";const Z={key:Symbol(),label:"Other​"};function _e(e){return"templateInfos"in e}function it(e){const t=[];for(const{layer:n,templates:i}of e)for(const r of i)t.push({layer:n,template:r});return t}function st(e,t){const n=new Map;for(const i of e){const r=t(i),{key:a,label:d}=r.key!=null?r:Z;j(n,a,()=>({label:d,templateInfos:[]})).templateInfos.push(i)}return Array.from(n.values())}function Kt(e,t){return{label:e.title??"",templateInfos:t.map(n=>({layer:e,template:n}))}}async function rt(e,t){return e.type==="subtype-sublayer"?await e.parent?.load(t):await e.load(t),e}function ot(e){const t=new Map,n=[];for(const i of e)if($(i)){n.push(i);for(const r of i.items)t.set(r.template,r)}else t.set(i.template,i);return[t,n]}const $=e=>"items"in e;function at(e){return e.type==="feature"}function lt(e){return e.type==="group"}function dt(e){return e.type==="preset"}const de=new Ce({"{acd53634-cbc7-44d5-bde9-692fa8d45850}":"autocomplete-freehand-polygons","{6f5fc612-d1ef-4d32-a2e1-18a1cb22331c}":"autocomplete-polygons","{09c6f589-a3ce-48ab-81bc-46965c58f264}":"circle","{bccf295a-9c64-4adc-903e-62d827c10ef7}":"create-points-along-line","{756cadf6-91e6-04b1-2938-e172a97af51c}":"create-structures","{ddbe4c0c-063f-8b60-b2da-b349a1e42e84}":"difference-polygon","{a5f4db5f-4a6b-29bd-1f32-9d81bf262c76}":"elevation-point-from-contour","{285ec4bb-60a8-7184-2088-5bee2149f2a4}":"elevation-point-from-dem","{28c04532-3daf-4d3d-b7be-a589c9c9a03e}":"ellipse","{0a7c16b9-1cfd-467f-8ece-6ba376192431}":"freehand","{af2dbf8f-280e-44db-8860-e399d0b30cf1}":"line","{bc485127-2ea2-4c8b-85ef-e8237959eb64}":"multipoint","{d304243a-5c3a-4ccc-b98b-93684b15fd83}":"parcel-seed","{2a8b3331-5238-4025-972e-452a69535b06}":"point","{d376f8e5-69e0-4273-9478-724e9e0d81ac}":"point-and-rotation","{93ce7077-f09e-455e-ade7-b7413cddc393}":"point-at-end-of-line","{8f79967b-66a0-4a1c-b884-f44bc7e26921}":"polygon","{a947ba80-1c29-4bcd-8672-1963b7b9dde0}":"radial-line","{6f0ed2cc-c099-4895-bd7e-beec2f78adbf}":"rectangle","{a281e635-0f22-47d4-a438-e4d29b920e22}":"regular-polygon","{5664cae4-c7de-432a-9933-9586bc15ed39}":"regular-polyline","{c5c42e29-44da-4a1c-8688-e02c07535bc3}":"right-angle-line","{ee16991b-6303-4a8a-9143-1914b2010c1a}":"right-angle-polygon","{7d3e17cf-30dd-4593-9bd8-0b2b8770f52a}":"split","{e00209dd-05c5-4424-be62-51581f9f811d}":"stream-line","{6c6970a7-5ca9-448c-9c7d-0d716cd2ac64}":"stream-polygon","{e22f7d98-007d-427c-8282-13704f7c84c3}":"trace","{6cf59352-8e14-402c-8f4c-ed72647f5e42}":"two-point-line"});let u=class extends Fe{constructor(t){super(t),this.type="feature",this.templateId=null,this.defaultTool=null,this.description=null,this.globalId="",this.hash="",this.layerIds=[],this.name="",this.subtypeCode=null,this.status=null,this.userIdentity=null,this.tags=[],this.visible=!0}readThumbnail(t){return t==null||t===""?null:{contentType:"png",imageData:t,height:64,width:64}}writeThumbnail(t,n){n.thumbnail=t?.imageData??null}readDefaultTool(t){return t==null?null:de.fromJSON(t.toLowerCase())}writeDefaultTool(t,n){t&&(n.defaultTool=de.toJSON(t.toLowerCase()))}readLayerIds(t,n){return n.layerIds!=null?n.layerIds.split(",").map(i=>parseInt(i.trim(),10)):n.layerId!=null?[n.layerId]:[]}writeLayerIds(t,n){n.layerIds=t.toString()}readTags(t,n){const i=n.tag??n.tags;return i==null?[]:i.split(";").map(r=>r.trim())}writeTags(t,n){n.tags=(t??[]).join("; ")}};s([o({json:{write:!0}})],u.prototype,"type",void 0),s([o({json:{read:!1,write:!1}})],u.prototype,"featureService",void 0),s([o()],u.prototype,"thumbnail",void 0),s([D("thumbnail")],u.prototype,"readThumbnail",null),s([P("thumbnail")],u.prototype,"writeThumbnail",null),s([o({json:{write:!0}})],u.prototype,"templateId",void 0),s([o()],u.prototype,"defaultTool",void 0),s([D("defaultTool")],u.prototype,"readDefaultTool",null),s([P("defaultTool")],u.prototype,"writeDefaultTool",null),s([o({json:{write:!0}})],u.prototype,"description",void 0),s([o({json:{write:!0}})],u.prototype,"globalId",void 0),s([o()],u.prototype,"hash",void 0),s([o()],u.prototype,"layerIds",void 0),s([D("layerIds",["layerIds","layerId"])],u.prototype,"readLayerIds",null),s([P("layerIds")],u.prototype,"writeLayerIds",null),s([o({json:{write:!0}})],u.prototype,"name",void 0),s([o({json:{name:"subtype",write:!0}})],u.prototype,"subtypeCode",void 0),s([o({json:{write:!0}})],u.prototype,"status",void 0),s([o()],u.prototype,"userIdentity",void 0),s([o()],u.prototype,"tags",void 0),s([D("tags",["tag","tags"])],u.prototype,"readTags",null),s([P("tags")],u.prototype,"writeTags",null),s([o({json:{write:!0}})],u.prototype,"visible",void 0),u=s([A("esri.editing.sharedTemplates.SharedTemplateMetadata")],u);const ct=u;function ce(e){return e==null||!e.length}async function ut({featureService:e,query:t,requestOptions:n={}}){if(ce(t.layers)&&ce(t.templateIds)&&(t.layers=e.layerInfos.map(d=>d.id),!t.layers.length))throw new I("query-shared-templates:invalid-parameters","Must supply a value for either the 'layers' or the 'templateIds' parameters");const i=Ve(e.url,"sharedTemplates","query"),r={f:"json",...n.query,...t};r.layers&&(r.layers=R(r.layers)),r.templateIds&&(r.templateIds=R(r.templateIds)),r.tags&&(r.tags=R(r.tags));const a={...n,responseType:"json",query:r};return(await ke(i,a)).data.templates.map(d=>{const l=ct.fromJSON(d);return l.featureService=e,l})}function R(e){return Array.isArray(e)?e.join(","):""}let h=class extends Me{constructor(t){super(t),this.canCreateVersion=!0,this.canEditVersionedData=!0,this.layers=new F,this.lockType="none",this.tables=new F,this.versionInfo=null,this.versionService=null}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}get layersAndTables(){return new F([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}async syncVersionInfo(){this.loaded&&await this._syncVersionInfo()}async _load(t){const{featureService:n}=this;await n.load(t);const i=await pt(n.url),r=i?.user?.username;if(this.loggedInServiceUser=r??"",i&&r&&(this.hasAdvancedEditingUserTypeExtension=await Ye(i,r,"advediting")),n.versionManagementServiceUrl){const a=new(await _(async()=>{const{default:d}=await import("./VersionManagementService-NjRF0AH1.js").then(l=>l.V);return{default:d}},__vite__mapDeps([0,1,2]))).default({url:n.versionManagementServiceUrl});this.versionService=a,await a.load(),await this._syncVersionInfo()}}async _syncVersionInfo(){const{layersAndTables:t,versionService:n}=this;if(!n||t.length===0)return;const i=t.getItemAt(0)?.gdbVersion,r=i?await n.getVersionIdentifierFromName(i):n.defaultVersionIdentifier;this.versionInfo=await n.getVersionInfoExtended(r)}};async function pt(e){const t=Ee?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const n=`${t.owningSystemUrl}/sharing/rest`,i=se.getDefault();return i?.loaded&&re(i.restUrl)===re(n)?i:new se({authMode:"immediate",url:t.owningSystemUrl}).load()}s([o({constructOnly:!0})],h.prototype,"canCreateVersion",void 0),s([o({constructOnly:!0})],h.prototype,"canEditVersionedData",void 0),s([o({constructOnly:!0})],h.prototype,"featureService",void 0),s([o({constructOnly:!0})],h.prototype,"layers",void 0),s([o()],h.prototype,"layersAndTables",null),s([o()],h.prototype,"lockType",void 0),s([o({constructOnly:!0})],h.prototype,"tables",void 0),s([o()],h.prototype,"versionInfo",void 0),s([o()],h.prototype,"versionService",void 0),s([o()],h.prototype,"hasAdvancedEditingUserTypeExtension",void 0),s([o()],h.prototype,"loggedInServiceUser",void 0),s([o()],h.prototype,"featureServiceVersion",null),h=s([A("esri.undoredo.support.ServiceVersionInfo")],h);function mt(e){return!e||e.trim().length===0}const ue=new Map;function ft(e){return j(ue,e,()=>{const t=new S({view:e});return e.addHandles({remove(){ue.delete(e),t.destroy()}}),t})}let S=class extends he{constructor(e){super(e),this._updatingHandles=new ve,this.items=new F,this.tablesAndLayersLookup=new Oe,this.additionalLayers=new F,this._debouncedCheckAndUpdateServiceInfos=Ue(async()=>{const t=[];for(const n of this.items){if(n.layersAndTables.length===0)continue;n.layersAndTables.getItemAt(0)?.gdbVersion!==n.versionInfo?.versionIdentifier.name&&t.push(n)}t.length!==0&&(await De(()=>!this.updating),await this._updateVersionInfos(t))}),this._processed=new Set}initialize(){this._syncServiceInfos(),this.addHandles([L(()=>this.view.map,()=>{this._reset()}),L(()=>this._allLayersAndTables,()=>this._syncServiceInfos()),L(()=>this.items.map(e=>e.layersAndTables.map(t=>t.gdbVersion??"").join(",")),()=>{Pe(this.checkAndUpdateServiceInfos(),G.getLogger(this))})])}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}get updating(){return this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,n)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,n=this._findServiceInfo(t);if(!n?.versionService)throw new I("services:no-version-management-service","No version management service");const i=n.loggedInServiceUser.toUpperCase(),r=mt(e.ownerName)?i:e.ownerName?.trim().toUpperCase();if(r!==i&&n.featureServiceVersion<=11.1)throw new I("services:versioning-api-error","Version management API too old");if(r?.toUpperCase()==="SDE"&&e.versionName.toUpperCase()==="DEFAULT")throw new I("services:no-valid-version-name","No valid version name");if((await n.versionService.getVersionInfos())?.find(l=>l.versionIdentifier.name.toUpperCase()===(r+"."+e.versionName).toUpperCase()||l.versionIdentifier.name.toUpperCase()===(i+"."+e.versionName).toUpperCase()))throw new I("services:no-valid-version-name","No valid version name");const a=await n.versionService.createVersion({versionName:e.versionName,access:r!==i?"public":e.access,description:e.description});if(r!==i){const{guid:d,name:l}=a.versionIdentifier;await n.versionService.alterVersion({guid:d,name:l},{ownerName:r,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:n.versionService})})())}deleteVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{const i=this._findServiceInfo(e);if(!i?.versionService)throw new I("services:no-version-management-service","No version management service");if(i.featureServiceVersion<=11.1)throw new I("services:versioning-api-error","Version management API too old");const r={name:t,guid:n};await i.versionService.deleteVersion(r)&&(await i.syncVersionInfo(),this.emit("version-deleted",{versionIdentifier:r,versionManagementService:i.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new I("services:no-version-management-service","No version management service");const n=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let i=!0;(t.versionService.getLockType(n)!=="none"||(i=await t.versionService.startReading(n),i))&&(i=await t.versionService.startEditing(n),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const n=this._findServiceInfo(e);if(!n?.versionService)throw new I("services:no-version-management-service","No version management service");const i=n.versionInfo?.versionIdentifier??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid},r=n.versionService.getLockType(i);if(r!=="none")return r==="read"?(await n.versionService.stopReading(i),void n.updateLockType()):r==="edit"?(await n.versionService.stopEditing(i,t),await n.versionService.stopReading(i),void n.updateLockType()):void 0})())}async loadAll(){await this._updatingHandles.addPromise(Promise.allSettled(this.items.map(e=>e.load())))}async loadServiceVersionInfoForLayer(e){return await this.tablesAndLayersLookup.get(e)?.load()}async _changeVersionInternal(e,t,n){const i=this._findServiceInfo(e);if(!i?.versionService)throw new I("services:no-version-management-service","No version management service");const r=i.versionInfo?.versionIdentifier??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},a={name:t,guid:n};await i.versionService.changeVersion(this.view?.map,r,a)&&await i.syncVersionInfo()}_findServiceInfo(e){return this.items.find(t=>t.featureService.url===e)??null}_removeFeatureService(e){this.items.remove(e)}_reset(){this.additionalLayers.removeAll(),this._processed.clear(),this.tablesAndLayersLookup.clear(),this.items.removeAll()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await t.syncVersionInfo().catch(n=>{G.getLogger(this).error("Failed to update version details",n)})})())}_addServiceInfo(e,t){const n=new Xe({url:e}),i=t.isTable?[]:[t],r=t.isTable?[t]:[],a=new h({featureService:n,layers:new F(i),tables:new F(r)});return this.items.push(a),this.tablesAndLayersLookup.set(t,a),a}get _allLayersAndTables(){return[...this.view.map?.allLayers??[],...this.view.map?.allTables??[],...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const n of e)n.type!=="feature"&&n.type!=="subtype-group"||this._processed.has(n)||t.push(n);for(const n of this._processed)if(!e.has(n)&&(K(n)||ge(n))){const i=this.tablesAndLayersLookup.get(n);if(!i)continue;this.tablesAndLayersLookup.delete(n),n.isTable?i.tables.remove(n):i.layers.remove(n),i.layersAndTables.length===0&&this._removeFeatureService(i)}return this._processed=e,t}_syncServiceInfos(){const e=this._detectNewLayersAndTables();if(e.length!==0){for(const t of e)if(t.type==="feature"||t.type==="subtype-group"){if(!t.url)continue;const n=xe(t.url).url.path,i=this._findServiceInfo(n);i?(this.tablesAndLayersLookup.set(t,i),t.isTable?i.tables.push(t):i.layers.push(t)):this._addServiceInfo(n,t)}}}};s([o({constructOnly:!0})],S.prototype,"view",void 0),s([o()],S.prototype,"items",void 0),s([o()],S.prototype,"tablesAndLayersLookup",void 0),s([o()],S.prototype,"additionalLayers",void 0),s([o()],S.prototype,"updating",null),s([o()],S.prototype,"_allLayersAndTables",null),S=s([A("esri.undoredo.support.Services")],S);const yt=()=>G.getLogger("esri.editing.templateUtils");function ht(e){return e!=null&&"prototype"in e}function we(e){return Q(e)&&!("definition"in e)}function B(e){return Q(e)&&"definition"in e}function Q(e){return e!=null&&"templateId"in e}function Qt(e){return B(e)&&e?.type==="feature"&&(e.definition==null||at(e.definition))}function Xt(e){return B(e)&&e?.type==="group"&&(e.definition==null||lt(e.definition))}function Yt(e){return B(e)&&e?.type==="preset"&&(e.definition==null||dt(e.definition))}function en(e){return B(e)&&e?.definition!=null}const pe=e=>e==null||typeof e!="object"?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(t=>t.templates):[]];async function vt({layers:e,view:t,signal:n,queryOptions:i}){if(t==null)return e.map(c=>({layer:c,templates:pe(c)}));const r=await It(e,t);E(n);const a=new Map,d=Array.from(r).map(async c=>(await c.load(),await gt({serviceInfo:c,out:a,signal:n,queryOptions:i}))),l=await Promise.allSettled(d);for(const c of l.filter(b=>b.status==="rejected"))yt().warn("Failed to fetch shared templates for service. Will use standard templates if available.",c.reason);return e.map(c=>({layer:c,templates:a.get(c)??pe(c)}))}async function gt({serviceInfo:e,out:t,signal:n,queryOptions:i}){const{featureService:r,layersAndTables:a}=e,d=await bt({featureService:r,layers:a.toArray(),signal:n,queryOptions:i});E(n);for(const[l,c]of d.entries())if(c.length!==0)if(K(l)){const b=wt(c),y=[],k=b.get(1/0)??y;for(const O of l.sublayers){const H=b.get(O.subtypeCode)??y;t.set(O,[...H,...k])}}else t.set(l,c)}async function bt({featureService:e,layers:t,signal:n,queryOptions:i}){if(!e.capabilities?.editing.supportsSharedTemplates)return new Map;const r=new Map(t.map(l=>[l.layerId,l])),a=await ut({featureService:e,query:{layers:Array.from(r.keys()),...i},requestOptions:{signal:n}}),d=new Map;for(const l of a)for(const c of l.layerIds)r.has(c)&&j(d,r.get(c),()=>[]).push(l);return d}async function It(e,t){const n=ft(t),i=new Set;for(const r of e)Ne(i,_t(n,r));return await Promise.all(Array.from(i).map(r=>r.load())),i}function _t(e,t){return je(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):ge(t)?e.tablesAndLayersLookup.get(t):null}function wt(e){const t=new Map;for(const n of e)j(t,n.subtypeCode??1/0,()=>[]).push(n);return t}var z;let g=z=class extends W{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(L(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},be))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}–${this.layer?.id}`}get supportsUpload(){return this.layer?.type==="scene"}clone(){const e=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,t=new z({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};s([o()],g.prototype,"description",null),s([o()],g.prototype,"disabled",null),s([o()],g.prototype,"disabledFunction",void 0),s([o()],g.prototype,"label",null),s([o()],g.prototype,"layer",void 0),s([o()],g.prototype,"template",void 0),s([o()],g.prototype,"thumbnail",void 0),s([o()],g.prototype,"id",null),s([o()],g.prototype,"supportsUpload",null),g=z=s([A("esri.widgets.FeatureTemplates.TemplateItem")],g);const St=g;let T=class extends Be(W){constructor(t){super(t),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:t}=this;return t==null||t(this)?this.allItems:this.allItems.filter(t)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(t){return this.items.find(n=>n.template===t)}};s([o()],T.prototype,"allItems",void 0),s([o()],T.prototype,"filterFunction",void 0),s([o()],T.prototype,"items",null),s([o()],T.prototype,"label",void 0),s([o()],T.prototype,"id",null),T=s([A("esri.widgets.FeatureTemplates.TemplateItemGroup")],T);const Tt=T,$t=({layer:e})=>({key:e,label:e.title??""}),Lt=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let m=class extends he{constructor(e){super(e),this._allItems=[],this._updatingHandles=new ve,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([L(()=>[this.templateInfos,this.layers],([e],t)=>{e&&e===t?.at(0)||(this._updateTask=oe(this._updateTask),e?this._updateAllItems(e):this._getTemplatesAndUpdateAllItems())},He),L(()=>this._groupByFunction,()=>{this.templateInfos==null&&(this._updateTask=oe(this._updateTask),this._getTemplatesAndUpdateAllItems())},ae),L(()=>this.filterFunction,e=>{for(const t of this._allItems)$(t)&&(t.filterFunction=e)},ae)])}set groupBy(e){if(this._set("groupBy",e),typeof e!="function")switch(e){case"layer":this._groupByFunction=$t;break;case"geometry":this._groupByFunction=Lt;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map(i=>qe(()=>i.loadStatus,n)),t)}this._set("layers",e)}get state(){return this.updating?"loading":this.layers.length!==0||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce((e,t)=>$(t)?e+t.allItems.length:e+1,0)}get items(){const{filterFunction:e}=this;return e==null?this._allItems:this._allItems.filter(t=>$(t)?t.items.length>0:e(t))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)$(e)&&e.reapplyFilter()}select(e,{emit:t=!0}={}){const n=this.selectedItem,i=e?.clone()||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:n,template:i?.template??null})}_createItem(e,t){return new St({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return typeof e=="string"?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(e.length===0)return At(t),void(this._allItems=[]);const[n,i]=ot(t),r=l=>{const c=n.get(l.template);return c?(n.delete(l.template),c):this._createItem(l.template,l.layer)},{filterFunction:a}=this,d=e.filter(J).map(l=>_e(l)?new Tt({filterFunction:a,label:l.label,allItems:l.templateInfos.filter(J).map(c=>r(c))}):r(l));for(const l of[...n.values(),...i])l.destroy();this._allItems=d}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map(async l=>{await rt(l,n),E(e);const c=Re(l)?.operations;c?.supportsEditing&&c?.supportsAdd&&(K(l)?t.push(...l.sublayers):t.push(l))}));const i=await vt({layers:t,view:this.view,signal:e,queryOptions:{returnVisibleTemplatesOnly:!0}});E(e);const r=it(i),a=this._groupByFunction;if(a==null)return r;const d=st(r,a);return d.length===1&&d[0].label===Z.label?d[0].templateInfos:d}async _getTemplatesAndUpdateAllItems(){if(this.layers.length===0)return;const e=Ge(async t=>{const n=await this._getTemplatesFromLayers(t);E(t),this._updateAllItems(n)});this._updateTask=e,await this._updatingHandles.addPromise(e.promise)}};function At(e){for(const t of e){if($(t))for(const n of t.items)n.destroy();t.destroy()}}function J(e){return _e(e)?e.templateInfos.some(J):!Q(e.template)||e.template.visible!==!1}s([o()],m.prototype,"_allItems",void 0),s([o()],m.prototype,"_groupByFunction",void 0),s([o()],m.prototype,"_updatingHandles",void 0),s([o()],m.prototype,"disabled",void 0),s([o()],m.prototype,"disabledItemFunction",void 0),s([o({value:null})],m.prototype,"filterFunction",void 0),s([o()],m.prototype,"groupBy",null),s([o({value:[]})],m.prototype,"layers",null),s([o()],m.prototype,"state",null),s([o({readOnly:!0})],m.prototype,"numberOfFeatureTemplates",null),s([o({readOnly:!0})],m.prototype,"items",null),s([o({readOnly:!0})],m.prototype,"selectedItem",void 0),s([o()],m.prototype,"templateInfos",void 0),s([o()],m.prototype,"updating",null),s([o()],m.prototype,"view",void 0),m=s([A("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],m);const Ct=m;let N=class extends W{constructor(e){super(e),this.filter=!0}};s([o({type:Boolean,nonNullable:!0})],N.prototype,"filter",void 0),N=s([A("esri.widgets.FeatureTemplates.VisibleElements")],N);const Se=N,C="esri-item-list",x=`${C}__list-item`,w={filterContainerSticky:`${C}__filter-container--sticky`,group:`${C}__group`,groupHeader:`${C}__group__header`,item:x,itemDisabled:`${x}--disabled`,itemIcon:`${x}-icon`,itemContentEnd:`${x}-content-end`,noMatchesMessage:`${C}__no-matches-message`,scroller:`${C}__scroller`,scrollerEnabled:`${C}__scroller--enabled`},Ft=4;function Vt(e){const{disabled:t,filterText:n="",id:i,messages:r,onFilterChange:a,...d}=e;return f("div",{key:i},e.filterEnabled??1?Et({disabled:t,filterText:n,id:i,messages:r,onFilterChange:a}):null,Mt({...d,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:n,messages:r}))}function kt(e){return!!e.items}function Mt(e){const{headingLevel:t,items:n,...i}=e;return n.length===0?f("div",{class:w.noMatchesMessage,key:"no-matches"},e.messages.noMatches):f("div",{class:Ie({[w.scroller]:!0,[w.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},n.map(r=>kt(r)?Ot({...i,group:r,headingLevel:t}):Te({...i,grouped:!0,item:r})))}function Et(e){const{disabled:t,messages:n,filterText:i,enableListScroll:r}=e;return f("div",{class:r?void 0:w.filterContainerSticky,key:"filter"},f("calcite-input",{disabled:t,placeholder:n.filterPlaceholder,type:"search",value:i,onCalciteInputInput:a=>{const d=a.currentTarget;e.onFilterChange?.(d.value)}}))}function Te(e){const{disabled:t,identify:n,item:i,onItemMouseEnter:r,onItemMouseLeave:a,onItemSelect:d,renderIcon:l,renderCustomItem:c,renderItemContent:b,renderItemContentEnd:y,renderItemLabel:k,renderItemDescription:O,renderItemActionEnd:H,renderItemTitle:$e,selectedItem:Le}=e,X=me(i,n),Y=X===me(Le,n),ee=c?.(e);if(ee)return ee;const U=b?.(i),te=y?.(i),Ae=H?.(i),ne=!(!i.disabled&&!t),ie=l?.(i);return f("calcite-list-item",{afterUpdate:v=>{v.selected=Y},class:Ie({[w.item]:!0,[w.itemDisabled]:ne}),"data-item":i,description:U?void 0:O?.(i)??void 0,disabled:ne,key:X,label:U?void 0:k?.(i)??i.label??void 0,onblur:v=>a?.(M(v)),onfocus:v=>r?.(M(v)),onmouseenter:v=>r?.(M(v)),onmouseleave:v=>a?.(M(v)),selected:Y,title:$e?.(i)??void 0,onCalciteListItemSelect:v=>{v.preventDefault(),d?.(M(v))}},ie?f("div",{class:w.itemIcon,key:"content-start",slot:"content-start"},ie):void 0,U?f("div",{key:"content",slot:"content"},U):null,te?f("div",{class:w.itemContentEnd,key:"content-end",slot:"content-end"},te):null,Ae??null)}function me(e,t){return e?`${t?.(e)||e.id}__${e.label}`:""}function M(e){return e.currentTarget["data-item"]}function Ot(e){const{disabled:t,group:n,headingLevel:i=Ft,selectionMode:r="none",renderCustomGroupContent:a,...d}=e,l=a?.(e);return f("div",{class:w.group,key:n.label??void 0},f(et,{class:w.groupHeader,level:i},n.label),l||f("calcite-list",{disabled:t,label:n.label??"",selectionAppearance:"border",selectionMode:r},n.items.map(c=>Te({...d,disabled:t,item:c,grouped:!0}))))}async function Ut(e,t,n){if(!V(e)&&we(e)&&e.thumbnail){const a=`data:image/png;base64,${e.thumbnail.imageData}`,d=document.createElement("div");return d.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&d.classList.add(`esri-thumbnail-preview--${t.geometryType}`),d.style.backgroundImage=`url(${a})`,d}const i=await Dt(t,e);if(i==null)return null;const r={maxSize:le(n?.maxSize??32),ariaLabel:n?.ariaLabel};if((V(e)||ht(e))&&"renderer"in t&&t.renderer?.type==="dictionary"&&(r.fieldMap=t.renderer.fieldMap??void 0,r.feature=V(e)?e:{attributes:e.prototype.attributes??{}}),V(e)&&e.geometry&&n?.useGeometry!==!1&&!e.geometry.type.includes("point")){r.geometry=e.geometry,r.useMarkerSymbolSize=!1;const a=le(n?.maxSize??22);r.size={width:a,height:a}}return await tt(i,r)}async function Dt(e,t){if(!V(t)&&we(t))return fe(e);if("renderer"in e&&e.renderer){const{renderer:n}=e,i=V(t)?t:new ze({attributes:t.prototype.attributes});if("getSymbolAsync"in n){const r=await n.getSymbolAsync(i);if(r)return r}}return fe(e)}async function fe(e){if(!("geometryType"in e))return null;const{geometryType:t}=e,n=t==="point"||t==="multipoint"?await _(()=>import("./index-CgzAF5Ey.js").then(i=>i.MK),__vite__mapDeps([1,2])):t==="polyline"?await _(()=>import("./index-CgzAF5Ey.js").then(i=>i.MI),__vite__mapDeps([1,2])):t==="polygon"||t==="mesh"||t==="multipatch"?await _(()=>import("./index-CgzAF5Ey.js").then(i=>i.MJ),__vite__mapDeps([1,2])):null;return n?new n.default:null}const Pt={base:"esri-feature-templates"};function xt(e){return e.length>0&&$(e[0])}function Nt(e){return e.id}let p=class extends Je{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesLegend=null,this.selectionMode="none",this.viewModel=new Ct,this.visibleElements=new Se,this.renderCustomItem=n=>null,this.renderCustomGroupContent=n=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=n=>null,this.renderItemContentEnd=n=>null,this._iconIntersectionObserver=new IntersectionObserver((n,i)=>{n.forEach(async r=>{if(r.isIntersecting){const a=r.target;if(Bt(a))return void i.unobserve(a);const d=jt(a),{layer:l,template:c}=d;ye(a,!0);const b=d.label?Ke(this.messagesLegend.previewTemplateAriaLabel,{label:d.label}):this.messagesCommon.preview,y=await Ut(c,l,{ariaLabel:b}).catch(()=>(ye(a,!1),null));if(y==null)return;a.appendChild(y)}})}),this._renderItemIcon=n=>We(n.layer)?f("span",{"data-has-icon":!0,"data-item":n,key:"icon"},f("calcite-icon",{icon:"table"})):f("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":n,key:"icon"}),this._afterItemCreateOrUpdate=n=>{this._iconIntersectionObserver?.observe(n)},this._afterItemRemoved=n=>{this._iconIntersectionObserver?.unobserve(n)}}initialize(){const e=({label:t})=>!this.filterText||!!t?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(L(()=>this.viewModel,(t,n)=>{t&&!t.filterFunction&&(this.filterFunction=e),n&&n!==t&&n.filterFunction===e&&(n.filterFunction=null)},be))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return Ze({icon:()=>_(()=>import("./index-CgzAF5Ey.js").then(e=>e.MT),__vite__mapDeps([1,2])),loader:()=>_(()=>import("./index-CgzAF5Ey.js").then(e=>e.MU),__vite__mapDeps([1,2])),input:()=>_(()=>import("./index-CgzAF5Ey.js").then(e=>e.N9),__vite__mapDeps([1,2])),list:()=>_(()=>import("./index-CgzAF5Ey.js").then(e=>e.Na),__vite__mapDeps([1,2])),"list-item":()=>_(()=>import("./index-CgzAF5Ey.js").then(e=>e.Ne),__vite__mapDeps([1,2])),notice:()=>_(()=>import("./index-DCotZYsY.js"),__vite__mapDeps([3,1,2]))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:n,headingLevel:i,messages:r,viewModel:{items:a,numberOfFeatureTemplates:d,selectedItem:l,state:c}}=this,b=this.visibleElements.filter&&d>1;if(xt(a)){const y=a.find(k=>k.label===Z.label);y&&(y.label=r.other)}return f("div",{"aria-label":r.widgetLabel,class:this.classes(Pt.base,Qe.widget)},c==="loading"?f("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):c==="ready"?f(Vt,{disabled:e,enableListScroll:t,filterEnabled:b,filterText:n,headingLevel:i,id:this.id,identify:Nt,items:a,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:l??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:y=>{this.filterText=y},onItemSelect:y=>!$(y)&&this.viewModel.select(y)}):null)}};function jt(e){return e?.["data-item"]}function Bt(e){return!!e?.["data-has-icon"]}function ye(e,t){e&&(e["data-has-icon"]=t)}s([o()],p.prototype,"disabled",null),s([o()],p.prototype,"enableListScroll",void 0),s([o()],p.prototype,"filterFunction",null),s([o()],p.prototype,"filterText",void 0),s([o()],p.prototype,"groupBy",null),s([o()],p.prototype,"headingLevel",void 0),s([o()],p.prototype,"icon",null),s([o()],p.prototype,"label",null),s([o()],p.prototype,"layers",null),s([o(),q("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],p.prototype,"messages",void 0),s([o(),q("esri/t9n/common")],p.prototype,"messagesCommon",void 0),s([o(),q("esri/widgets/Legend/t9n/Legend")],p.prototype,"messagesLegend",void 0),s([o({readOnly:!0})],p.prototype,"selectedItem",null),s([o()],p.prototype,"selectionMode",void 0),s([o(),nt("select")],p.prototype,"viewModel",void 0),s([o({type:Se,nonNullable:!0})],p.prototype,"visibleElements",void 0),s([o()],p.prototype,"renderCustomItem",void 0),s([o()],p.prototype,"renderCustomGroupContent",void 0),s([o()],p.prototype,"renderItemLabel",void 0),s([o()],p.prototype,"renderItemDescription",void 0),s([o()],p.prototype,"renderItemContent",void 0),s([o()],p.prototype,"renderItemContentEnd",void 0),p=s([A("esri.widgets.FeatureTemplates")],p);const nn=p;export{Xt as A,nn as F,ft as I,Ct as O,vt as S,Ut as a,de as c,B as d,Q as g,Yt as h,ct as i,en as j,Kt as l,Te as m,Vt as s,at as t,Qt as w,ht as y};
