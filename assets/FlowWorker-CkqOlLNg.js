import{_ as m,g}from"./index-BrQW8HOS.js";import{f as h,d as w}from"./dataUtils-GsysffW0.js";import{x as _,f as D}from"./loadUtils-Bu2EDyoz.js";import"./FeatureTileDescriptor-B5Z4jHg4.js";let u=class{constructor(){this._tileData=new Map}async generateStreamlines(i){const{flowData:n,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=i,o=d(h(l,n),l,t.modelSize,e,f);return{result:{streamlines:o},transferList:o?.map(a=>a.vertices.buffer)}}async generateTiledStreamlines(i){const{flowDataTiles:n,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:o}=i;this._updateTileData(n,l);const a=d(_(f,this._tileData,t),f,t.modelSize,e,o);return{result:{streamlines:a},transferList:a?.map(r=>r.vertices.buffer)??[]}}_updateTileData(i,n){n&&this._tileData.forEach((t,e)=>{i.get(e)==null&&this._tileData.delete(e)}),i.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};u=m([g("esri.views.3d.support.flow.FlowWorker")],u);const E=u;function d(i,n,t,e,l){if(i==null)return;const f=w(n,i,t[0],t[1],{positions:l}),o=[],a=D(e);for(const{vertices:r,stage:p}of f){const c=new Float32Array(r.length*a);for(let s=0;s<r.length;s++)c[s*a]=r[s].x,c[s*a+1]=r[s].y,c[s*a+2]=r[s].t,e&&(c[s*a+3]=r[s].speed);o.push({vertices:c,stage:p,hasMagnitude:e})}return o}export{E as default};
