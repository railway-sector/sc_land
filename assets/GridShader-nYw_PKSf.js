import{a as I}from"./WGLContainer-CR63FtLL.js";import{a5 as r,rC as _,hZ as Le,G2 as Be,c5 as de,a7 as X,yx as Ae,x as w,y as Y,ny as Qt,aX as Oe,G3 as pe,qO as Q,G4 as Fe,ar as Ie,nr as gt,ai as vt,K as ce,G5 as yt,Bx as Ge,bh as qe,kv as De,aE as Ne,zZ as he,G6 as Ze,G7 as Ue,gM as It,G8 as Ve,bq as We,G9 as He,aq as at,Ga as je,Gb as Gt,Gc as Qe,aN as Xe,hQ as rt,Gd as Xt}from"./index-Brd6-W-v.js";import{P as K,_ as h,d as v,p as M,b as R,C as u,v as E,q as A,Y as g,Q as ye,X as qt,t as P,G as wt,x as G,y as ge,A as ve,B as Yt,w as we,D as fe,f as F,m as p,n as ft,i as J,j as k,c as x,U as f,g as b,I as tt,e as _t,E as _e,F as Ye,H as Ke,J as Je,r as be,K as ti,W as ei,L as ii,M as oi,u as si,T as ni,N as Dt,O as Kt,S as Jt,R as ai}from"./GraphShaderModule-BTy7eLIj.js";import{g as xe,E as y,I as ri,F as te}from"./utils-C5tgiKHk.js";import{t as li}from"./CircularArray-CujHzHWW.js";import{n as ui}from"./SymbolFader-DC-05TZ9.js";import{I as mi}from"./constants-BBnGEY1d.js";const Pi={vertexShader:I("bitBlit/bitBlit.vert"),fragmentShader:I("bitBlit/bitBlit.frag")},Ri={vertexShader:I("stencil/stencil.vert"),fragmentShader:I("stencil/stencil.frag")};class Ce extends J{}r([F(0,x)],Ce.prototype,"position",void 0);class di extends tt{}class it extends k{}r([p(f)],it.prototype,"layerTexture",void 0),r([p(f)],it.prototype,"backbufferTexture",void 0),r([p(u)],it.prototype,"opacity",void 0),r([p(u)],it.prototype,"inFadeOpacity",void 0);let lt=class extends K{constructor(){super(...arguments),this.type="BlendShader"}vertex(t){return{uv:t.position,glPosition:new h(xe(t.position),0,1)}}fragment(t){const e=new E,i=v(this.config.layerTexture,t.uv),a=v(this.config.backbufferTexture,t.uv),s=M(R(i.a,new u(0)),i.rgb,i.rgb.divide(i.a)),n=M(R(a.a,new u(0)),a.rgb,a.rgb.divide(a.a)),l=this.config.opacity.multiply(i.a),m=a.a;switch(this.blendMode){case"destination-over":e.fragColor=new h(s.multiply(l).multiply(y(m)).add(n.multiply(m)),l.add(m).subtract(l.multiply(m)));break;case"source-in":{const d=new h(s.multiply(l).multiply(m),l.multiply(m)),c=new h(n.multiply(m),m).multiply(y(this.config.opacity)).multiply(this.config.inFadeOpacity);e.fragColor=d.add(c)}break;case"destination-in":{const d=new h(n.multiply(m).multiply(l),m.multiply(l)),c=new h(n.multiply(m),m).multiply(new h(y(this.config.opacity).multiply(this.config.inFadeOpacity)));e.fragColor=d.add(c)}break;case"source-out":e.fragColor=new h(s.multiply(l).multiply(y(m)),l.multiply(y(m)));break;case"destination-out":e.fragColor=new h(n.multiply(m).multiply(y(l)),m.multiply(y(l)));break;case"source-atop":e.fragColor=new h(s.multiply(l).multiply(m).add(n.multiply(m.multiply(y(l)))),m);break;case"destination-atop":e.fragColor=new h(s.multiply(l.multiply(y(m))).add(n.multiply(m).multiply(l)),l);break;case"xor":e.fragColor=new h(s.multiply(l.multiply(y(m))).add(n.multiply(m.multiply(y(l)))),l.multiply(y(m)).add(m.multiply(y(l))));break;case"multiply":e.fragColor=new h(s.multiply(l).multiply(n.multiply(m)).add(s.multiply(l).multiply(y(m))).add(n.multiply(m).multiply(y(l))),l.add(m.multiply(y(l))));break;case"screen":e.fragColor=new h(s.add(n).subtract(s.multiply(n)).multiply(l.multiply(m)).add(s.multiply(l).multiply(y(m))).add(n.multiply(m).multiply(y(l))),l.add(m.multiply(y(l))));break;case"overlay":{const d=new g(Ct(n.r,s.r),Ct(n.g,s.g),Ct(n.b,s.b));e.fragColor=T(d,s,n,l,m)}break;case"darken":{const d=P(s,n);e.fragColor=T(d,s,n,l,m)}break;case"lighter":e.fragColor=new h(s.multiply(l).add(n.multiply(m)),l.add(m));break;case"lighten":{const d=qt(s,n);e.fragColor=T(d,s,n,l,m)}break;case"color-dodge":{const d=A(new g(pt(n.r,s.r),pt(n.g,s.g),pt(n.b,s.b)),new g(0),new g(1));e.fragColor=T(d,s,n,l,m)}break;case"color-burn":{const d=new g(ct(n.r,s.r),ct(n.g,s.g),ct(n.b,s.b));e.fragColor=T(d,s,n,l,m)}break;case"hard-light":{const d=new g(Tt(n.r,s.r),Tt(n.g,s.g),Tt(n.b,s.b));e.fragColor=T(d,s,n,l,m)}break;case"soft-light":{const d=new g($t(n.r,s.r),$t(n.g,s.g),$t(n.b,s.b));e.fragColor=T(d,s,n,l,m)}break;case"difference":{const d=ye(n.subtract(s));e.fragColor=T(d,s,n,l,m)}break;case"exclusion":{const d=s.add(n).subtract(new u(2).multiply(s).multiply(n));e.fragColor=T(d,s,n,l,m)}break;case"invert":e.fragColor=new h(new g(1).subtract(n).multiply(l).multiply(m).add(n.multiply(m).multiply(y(l))),m);break;case"vivid-light":{const d=new g(A(Mt(n.r,s.r),new u(0),new u(1)),A(Mt(n.g,s.g),new u(0),new u(1)),A(Mt(n.b,s.b),new u(0),new u(1)));e.fragColor=T(d,s,n,l,m)}break;case"hue":{const d=ie(s,n,n);e.fragColor=T(d,s,n,l,m)}break;case"saturation":{const d=ie(n,s,n);e.fragColor=T(d,s,n,l,m)}break;case"color":{const d=Zt(s,n);e.fragColor=T(d,s,n,l,m)}break;case"luminosity":{const d=Zt(n,s);e.fragColor=T(d,s,n,l,m)}break;case"plus":e.fragColor=A(new h(i.r.add(n.r),i.g.add(n.g),i.b.add(n.b),l.add(m)),new h(0),new h(1));break;case"minus":e.fragColor=new h(A(new g(n.r.subtract(i.r),n.g.subtract(i.g),n.b.subtract(i.b)),new g(0),new g(1)),m.multiply(l));break;case"average":{const d=n.add(s).divide(2);e.fragColor=T(d,s,n,l,m)}break;case"reflect":{const d=A(new g(St(n.r,s.r),St(n.g,s.g),St(n.b,s.b)),new g(0),new g(1));e.fragColor=T(d,s,n,l,m)}break;default:e.fragColor=i.multiply(this.config.opacity)}return e}};function T(o,t,e,i,a){return new h(o.multiply(i).multiply(a).add(t.multiply(i).multiply(y(a))).add(e.multiply(a).multiply(y(i))),i.add(a.multiply(y(i))))}function Ct(o,t){return new u(1).subtract(G(new u(.5),t)).multiply(y(new u(2).multiply(y(t).multiply(y(o))))).add(G(new u(.5),t).multiply(new u(2).multiply(t).multiply(o)))}function pt(o,t){return M(R(o,new u(0)),new u(0),M(R(t,new u(1)),new u(1),P(new u(1),o.divide(new u(1).subtract(t)))))}function ct(o,t){return M(R(o,new u(1)),new u(1),M(R(t,new u(0)),new u(0),y(P(new u(1),y(o).divide(t)))))}function Tt(o,t){return new u(1).subtract(G(new u(.5),t)).multiply(new u(2).multiply(t).multiply(o)).add(G(new u(.5),t).multiply(y(new u(2).multiply(y(t).multiply(y(o))))))}function $t(o,t){return ge([Yt(t,new u(.5)),()=>{const e=new u(2).multiply(t),i=y(e),a=y(o);return o.subtract(i.multiply(o).multiply(a))}],[Yt(o,new u(.25)),()=>{const e=new u(2).multiply(t),i=te(e).multiply(o),a=new u(16).multiply(o).subtract(new u(12)).multiply(o).add(new u(3));return o.add(i.multiply(a))}],[!0,()=>{const e=new u(2).multiply(t),i=te(e),a=ve(o).subtract(o);return o.add(i.multiply(a))}])}function Mt(o,t){const e=y(G(new u(.5),t)).multiply(ct(o,new u(2).multiply(t))),i=G(new u(.5),t).multiply(pt(o,new u(2).multiply(ri(t,.5))));return e.add(i)}function Ht(o){return P(P(o.r,o.g),o.b)}function Te(o){return qt(qt(o.r,o.g),o.b)}function Nt(o){return we(o,new g(.3,.59,.11))}function ee(o){return Te(o).subtract(Ht(o))}function pi(o){const t=Nt(o),e=Ht(o),i=Te(o);return ge([fe(e,new u(0)),()=>{const a=o.subtract(t).multiply(t),s=t.subtract(e);return t.add(a.divide(s))}],[wt(i,new u(1)),()=>{const a=o.subtract(t),s=y(t),n=a.multiply(s),l=i.subtract(t);return t.add(n.divide(l))}],[!0,o])}function Zt(o,t){const e=Nt(o),i=Nt(t).subtract(e);return pi(o.add(new g(i)))}function ie(o,t,e){const i=Ht(o),a=ee(o),s=ee(t);return Zt(M(wt(a,new u(0)),()=>o.subtract(i).multiply(s).divide(a),new g(0)),e)}function St(o,t){return M(R(t,new u(1)),t,()=>{const e=y(t),i=o.multiply(o).divide(e);return P(i,new u(1))})}r([ft],lt.prototype,"blendMode",void 0),r([p(it)],lt.prototype,"config",void 0),r([_(0,b(Ce))],lt.prototype,"vertex",null),r([_(0,b(di))],lt.prototype,"fragment",null);let $e=class extends J{};r([F(0,x)],$e.prototype,"position",void 0);let ci=class extends tt{},Ut=class extends k{};r([p(f)],Ut.prototype,"layerTexture",void 0),r([p(u)],Ut.prototype,"opacity",void 0);let kt=class extends K{constructor(){super(...arguments),this.type="OpacityShader"}vertex(t){return{uv:t.position,glPosition:new h(t.position.subtract(new x(.5)).multiply(2),0,1)}}fragment(t){const e=new E;return e.fragColor=v(this.config.layerTexture,t.uv).multiply(this.config.opacity),e}};r([p(Ut)],kt.prototype,"config",void 0),r([_(0,b($e))],kt.prototype,"vertex",null),r([_(0,b(ci))],kt.prototype,"fragment",null);const Ii={vertexShader:I("highlight/textured.vert"),fragmentShader:I("highlight/highlight.frag")},Gi={vertexShader:I("highlight/textured.vert"),fragmentShader:I("highlight/blur.frag")};let Me=class extends J{};r([F(0,x)],Me.prototype,"position",void 0);let N=class extends tt{};class q extends K{constructor(){super(...arguments),this.type="PostProcessingShader"}vertex(t){return{uv:t.position,glPosition:new h(xe(t.position),0,1)}}}r([_(0,b(Me))],q.prototype,"vertex",null);class Se extends k{}r([p(f)],Se.prototype,"blitTexture",void 0);let oe=class extends q{fragment(t){const e=new E;return e.fragColor=v(this.blitConfig.blitTexture,t.uv),e}};r([p(Se)],oe.prototype,"blitConfig",void 0),r([_(0,b(N))],oe.prototype,"fragment",null);class V extends k{}r([p(f)],V.prototype,"luminosityTexture",void 0),r([p(g)],V.prototype,"defaultColor",void 0),r([p(u)],V.prototype,"defaultOpacity",void 0),r([p(u)],V.prototype,"luminosityThreshold",void 0),r([p(u)],V.prototype,"smoothWidth",void 0);let se=class extends q{constructor(){super(...arguments),this.type="LuminosityHighPassShader"}fragment(t){const e=new E,i=v(this.luminosityHighPassConfig.luminosityTexture,t.uv),a=new g(.299,.587,.114),s=we(i.xyz,a),n=new h(this.luminosityHighPassConfig.defaultColor.rgb,this.luminosityHighPassConfig.defaultOpacity),l=_e(this.luminosityHighPassConfig.luminosityThreshold,this.luminosityHighPassConfig.luminosityThreshold.add(this.luminosityHighPassConfig.smoothWidth),s);return e.fragColor=_t(n,i,l),e}};r([p(V)],se.prototype,"luminosityHighPassConfig",void 0),r([_(0,b(N))],se.prototype,"fragment",null);let L=class extends k{};r([p(f)],L.prototype,"blurTexture1",void 0),r([p(f)],L.prototype,"blurTexture2",void 0),r([p(f)],L.prototype,"blurTexture3",void 0),r([p(f)],L.prototype,"blurTexture4",void 0),r([p(f)],L.prototype,"blurTexture5",void 0),r([p(u)],L.prototype,"bloomStrength",void 0),r([p(u)],L.prototype,"bloomRadius",void 0),r([p(Ye.ofType(u,5))],L.prototype,"bloomFactors",void 0),r([p(g)],L.prototype,"bloomTintColor",void 0);let Et=class extends q{constructor(){super(...arguments),this.type="CompositeShader"}fragment(t){const e=new E,{blurTexture1:i,blurTexture2:a,blurTexture3:s,blurTexture4:n,blurTexture5:l,bloomStrength:m,bloomFactors:d,bloomTintColor:c}=this.compositeConfig,$=this._lerpBloomFactor(d[0]).multiply(new h(c,1).multiply(v(i,t.uv))),C=this._lerpBloomFactor(d[1]).multiply(new h(c,1).multiply(v(a,t.uv))),z=this._lerpBloomFactor(d[2]).multiply(new h(c,1).multiply(v(s,t.uv))),Z=this._lerpBloomFactor(d[3]).multiply(new h(c,1).multiply(v(n,t.uv))),bt=this._lerpBloomFactor(d[4]).multiply(new h(c,1).multiply(v(l,t.uv))),xt=m.multiply($.add(C.add(z.add(Z.add(bt)))));return e.fragColor=A(xt,new u(0),new u(1)),e}_lerpBloomFactor(t){const e=new u(1.2).subtract(t);return _t(t,e,this.compositeConfig.bloomRadius)}};r([ft],Et.prototype,"numMips",void 0),r([p(L)],Et.prototype,"compositeConfig",void 0),r([_(0,b(N))],Et.prototype,"fragment",null);let ot=class extends k{};r([p(f)],ot.prototype,"texture",void 0),r([p(x)],ot.prototype,"texSize",void 0),r([p(x)],ot.prototype,"direction",void 0),r([p(u)],ot.prototype,"sigma",void 0);let zt=class extends q{constructor(){super(...arguments),this.type="GaussianBlurShader"}fragment(t){const e=new E,i=new u(1).divide(this.gaussianBlurConfig.texSize),a=this.gaussianBlurConfig.sigma;let s=ne(new u(0),a),n=v(this.gaussianBlurConfig.texture,t.uv).multiply(s);for(let l=1;l<this.kernelRadius;l++){const m=new u(l),d=ne(m,a),c=this.gaussianBlurConfig.direction.multiply(i).multiply(m),$=v(this.gaussianBlurConfig.texture,t.uv.add(c)),C=v(this.gaussianBlurConfig.texture,t.uv.subtract(c));n=n.add($.multiply(d)).add(C.multiply(d)),s=s.add(new u(2).multiply(d))}return e.fragColor=n.divide(s),e}};function ne(o,t){return new u(.39894).multiply(Ke(new u(-.5).multiply(o).multiply(o).divide(t.multiply(t))).divide(t))}r([ft],zt.prototype,"kernelRadius",void 0),r([p(ot)],zt.prototype,"gaussianBlurConfig",void 0),r([_(0,b(N))],zt.prototype,"fragment",null);class ke extends k{}r([p(f)],ke.prototype,"texture",void 0);const hi=1,yi=2.2,gi=[-.08,-.05,-.03,-.02,-.01,.01,.02,.03,.05,.08];class Pt extends q{constructor(){super(...arguments),this.type="RadialBlurShader"}fragment(t){const e=new E;let i=new u(.5).subtract(t.uv);const a=ve(i.x.multiply(i.y).add(i.y.multiply(i.y)));i=i.divide(a);const s=v(this.radialBlurConfig.texture,t.uv);let n=s;for(let d=0;d<10;d++){const c=v(this.radialBlurConfig.texture,t.uv.add(i).multiply(new u(gi[d]).multiply(hi)));n=n.add(c)}const l=new u(1).divide(new u(11));n=n.multiply(l);let m=a.multiply(yi);return m=A(m,new u(0),new u(1)),e.fragColor=_t(s,n,m),e}}r([ft],Pt.prototype,"kernelRadius",void 0),r([p(ke)],Pt.prototype,"radialBlurConfig",void 0),r([_(0,b(N))],Pt.prototype,"fragment",null);let Vt=class extends k{};r([p(f)],Vt.prototype,"colorTexture",void 0),r([p(Je)],Vt.prototype,"coefficients",void 0);let ae=class extends q{constructor(){super(...arguments),this.type="FilterEffectShader"}fragment(t){const e=new E,i=v(this.filterEffectConfig.colorTexture,t.uv),a=M(wt(i.a,new u(0)),i.rgb.divide(i.a),new g(0)),s=this.filterEffectConfig.coefficients.multiply(new h(a,1)),n=i.a;return e.fragColor=new h(n.multiply(s.rgb),n),e}};r([p(Vt)],ae.prototype,"filterEffectConfig",void 0),r([_(0,b(N))],ae.prototype,"fragment",null);let W=class extends k{};r([p(f)],W.prototype,"layerFBOTexture",void 0),r([p(f)],W.prototype,"blurTexture",void 0),r([p(h)],W.prototype,"shadowColor",void 0),r([p(x)],W.prototype,"shadowOffset",void 0),r([p(be)],W.prototype,"displayViewMat3",void 0);let re=class extends q{constructor(){super(...arguments),this.type="CompositeShader"}fragment(t){const e=new E,{layerFBOTexture:i,blurTexture:a,shadowColor:s,shadowOffset:n,displayViewMat3:l}=this.compositeConfig,m=l.multiply(new g(n,new u(0))),d=v(i,t.uv),c=v(a,t.uv.subtract(m.xy.divide(2)));return e.fragColor=c.a.multiply(s).multiply(new u(1).subtract(d.a)).add(d),e}};r([p(W)],re.prototype,"compositeConfig",void 0),r([_(0,b(N))],re.prototype,"fragment",null);const S=!!de("esri-2d-profiler");class Ki{constructor(t,e){if(this._events=new Le,this._entries=new Map,this._timings=new li(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!S)return;this._ext=Be(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let a;for(a in i)if(typeof i[a]=="function"){const s=i[a],n=a.includes("draw");i[a]=(...l)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:a,args:l,isDrawCommand:n}),this._currentSummary&&(this._currentSummary.commands++,n&&this._currentSummary.drawCommands++),s.apply(i,l))}}get enableCommandLogging(){return typeof S=="object"&&S.commandLogging}get enableTimeLogging(){return typeof S=="object"&&S.timeLogging}get lastTime(){return this._timings.peekLast()}recordContainerStart(t){S&&(this._currentContainer=t)}recordContainerEnd(){S&&(this._currentContainer=null)}recordPassStart(t){S&&(this._currentPass=t,this._initSummary())}recordPassEnd(){S&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){S&&(this._currentBrush=t)}recordBrushEnd(){S&&(this._currentBrush=null)}recordStart(t){if(S&&this._ext!=null){if(this._entries.has(t)){const i=this._entries.get(t),a=this._ext.resultAvailable(i.query),s=this._ext.disjoint();if(a&&!s){const n=this._ext.getResult(i.query)/1e6;let l=0;if(this._timings.enqueue(n)!=null&&this.enableTimeLogging){const c=this._timings.entries,$=c.length;let C=0;for(const z of c)C+=z;l=C/$}const m=n.toFixed(2),d=l?l.toFixed(2):"--";this.enableCommandLogging?(this.enableTimeLogging?console.groupCollapsed(`Frame report for ${t}, ${m} ms (${d} last 10 avg)
              ${i.commandsLen} Commands (${i.drawCommands} draw)`):console.groupCollapsed(`Frame report for ${t}
              ${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):this.enableTimeLogging&&console.log(`Frame report for ${t}, ${m} ms (${d} last 10 avg)`),this.enableTimeLogging&&(this._debugOutput.innerHTML=`${m} (${d})`)}for(const n of i.handles)n.remove();this._ext.deleteQuery(i.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",i=>{e.commandsLen++,e.commands.push(i),i.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",i=>{e.summaries.push(i)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){S&&this._ext!=null&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}let ht=class extends J{};r([F(0,x)],ht.prototype,"position",void 0),r([F(1,x)],ht.prototype,"texcoord",void 0),r([F(2,u)],ht.prototype,"w",void 0);let vi=class extends tt{};class Wt extends k{}r([p(f)],Wt.prototype,"texture",void 0),r([p(u)],Wt.prototype,"opacity",void 0);let Rt=class extends K{constructor(){super(...arguments),this.type="VideoScreenShader"}vertex(t){const{position:e,texcoord:i,w:a}=t;return{glPosition:new h(e,0,a),texcoord:i}}fragment(t){const e=new E;return e.fragColor=v(this.config.texture,t.texcoord).multiply(this.config.opacity),e}};r([p(Wt)],Rt.prototype,"config",void 0),r([_(0,b(ht))],Rt.prototype,"vertex",null),r([_(0,b(vi))],Rt.prototype,"fragment",null);const wi=7e6;let fi=class{constructor(){this.styles=new Map,this.layerContexts=new Map}get cachedStyles(){return this.styles}setLabelClassStyle(t,e,i){this.layerContexts.set(t,e),this.styles.set(t,i)}removeContainer(t){for(const[e,i]of this.layerContexts.entries())i===t&&this.layerContexts.delete(e)}},et=class extends X{constructor(t){super(t),this._faderWorkingSet=[],this._styleRepository=new fi,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null;const e=(i,a)=>{i.updateLabelVisibility(),i.requestRender(),i.isReady&&(i.decluttered=!0)};this.symbolFader=new ui("feature-tile",this._styleRepository,e,this._faderWorkingSet,Ae,wi)}get updating(){return de("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(t){this.doUpdate(t)?this.updateRequested=!1:(this.updateRequested=!0,this.view?.requestUpdate())}setLabelSchemaStyles(t,e){let i;switch(t.type){case"label":i=t.classes;break;case"subtype":i=Array.from(Object.values(t.renderers).flatMap(a=>a.classes));break;case"cluster":i=[...t.cluster.classes,...t.feature.classes];break;case"track":i=[...t.latestObservation.classes,...t.previousObservation.classes,...t.trackLine.classes]}for(const a of i){const s=_i(a);this._styleRepository.setLabelClassStyle(a.labelClassId,e,s)}}removeContainer(t){this._styleRepository.removeContainer(t),this.requestUpdate()}doUpdate(t){this._faderWorkingSet.length=0;const e=this.view;if(!e)return!1;const i=e.allLayerViews.map(a=>a.featureContainer).filter(a=>!!a&&a?.hasLabels);if(i.length>0){for(const n of i)for(const l of n.tiles||[])l.setTransform(t.state),this._faderWorkingSet.push(l);const a=t.state.scale,s=e.featuresTilingScheme.scaleToZoom(a);return this.symbolFader.update(s,t.state)}return!0}};function _i(o){const t=o.geometryType==="esriGeometryPolyline"?0:1,e=o.geometryType==="esriGeometryPolyline"?0:1;return{geometryType:o.geometryType,iconAllowOverlap:!o.deconflictionEnabled,iconIgnorePlacement:!1,textAllowOverlap:!o.deconflictionEnabled,textIgnorePlacement:!1,iconRotationAlignment:t,textRotationAlignment:t,iconTranslateAnchor:e,iconTranslate:[0,0],textTranslateAnchor:e,textTranslate:[0,0]}}r([w()],et.prototype,"updateRequested",void 0),r([w()],et.prototype,"updating",null),r([w()],et.prototype,"view",void 0),et=r([Y("esri.views.2d.LabelManager")],et);const ut="esri-zoom-box",mt={container:`${ut}__container`,overlay:`${ut}__overlay`,background:`${ut}__overlay-background`,box:`${ut}__outline`},Lt={zoom:"Shift",counter:"Control"};let st=class extends X{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[Lt.zoom],e=>this._handleDrag(e,1),Qt.INTERNAL),t.on("drag",[Lt.zoom,Lt.counter],e=>this._handleDrag(e,-1),Qt.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,a){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=a,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,a,s){const n=this.view,l=n.toMap(Oe(t+.5*i,e+.5*a));let m=Math.max(i/n.width,a/n.height);s===-1&&(m=1/m),this._destroyOverlay(),this.navigation.end(),n.goTo({center:l,scale:n.scale*m},{animationMode:"always",duration:pe()})}_updateBox(t,e,i,a){const s=this._boxShape;s.setAttributeNS(null,"x",""+t),s.setAttributeNS(null,"y",""+e),s.setAttributeNS(null,"width",""+i),s.setAttributeNS(null,"height",""+a),s.setAttributeNS(null,"class",mt.box)}_updateBackground(t,e,i,a){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,a,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=mt.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",mt.background);const a=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),s.setAttributeNS(null,"class",mt.overlay),s.appendChild(i),s.appendChild(a),this._container.appendChild(s),this._backgroundShape=i,this._boxShape=a,this._overlay=s}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,a,s,n){const l=t+i,m=e+a;return"M 0 0 L "+s+" 0 L "+s+" "+n+" L 0 "+n+" ZM "+t+" "+e+" L "+t+" "+m+" L "+l+" "+m+" L "+l+" "+e+" Z"}_handleDrag(t,e){const i=t.x,a=t.y,s=t.origin.x,n=t.origin.y;let l,m,d,c;switch(i>s?(l=s,d=i-s):(l=i,d=s-i),a>n?(m=n,c=a-n):(m=a,c=n-a),t.action){case"start":this._start();break;case"update":this._update(l,m,d,c);break;case"end":this._end(l,m,d,c,e)}t.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:t,y:e,width:i,height:a}=this._box;this._updateBox(t,e,i,a),this._updateBackground(t,e,i,a),this._rafId=requestAnimationFrame(this._redraw)}};r([w()],st.prototype,"navigation",void 0),r([w()],st.prototype,"view",null),st=r([Y("esri.views.2d.navigation.ZoomBox")],st);let H=class extends X{constructor(t){super(t),this.animationTime=Q(0),this.momentumEstimator=new Fe(500,6,.92),this.momentum=null,this.tmpMomentum=Ie(),this.momentumFinished=!1,this.viewpoint=new gt({targetGeometry:new vt,scale:0,rotation:0}),this._previousDrag=null,this.addHandles(ce(()=>this.momentumFinished,()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,a=e.center.y;const s=this._previousDrag;i=s?s.center.x-i:-i,a=s?a-s.center.y:a,t.viewpoint=yt(this.viewpoint,t.viewpoint,[i||0,a||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled&&!Ge();this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=Q(0),this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,a=De(-e,i),s=Ne(-e,i,0);this.momentumEstimator.add(a,s,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,(e,i)=>{const{momentum:a,animationTime:s,tmpMomentum:n}=this,l=this.momentumFinished=!a||a.isFinished(s),m=he(i);if(!l){const d=a.valueDelta(s,m);qe(n,a.direction,d),yt(e,e,n),t.constraints.constrainByGeometry(e)}this.animationTime=Q(this.animationTime+m)})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};r([w()],H.prototype,"momentumFinished",void 0),r([w()],H.prototype,"viewpoint",void 0),r([w()],H.prototype,"navigation",void 0),H=r([Y("esri.views.2d.navigation.actions.Pan")],H);let j=class extends X{constructor(t){super(t),this._animationTime=Q(0),this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new Ze(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new Ue,this._zoomOnly=null,this.viewpoint=new gt({targetGeometry:new vt,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles(ce(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){this._updateTimestamp===null&&(this._updateTimestamp=e.timestamp);const i=e.angle,a=e.radius,s=e.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),l=Math.abs(a-this._startRadius),m=this._startRadius/a;if(this._previousRadius&&this._previousCenter){const d=a/this._previousRadius;let c=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=d>=1?1:-1,t.constraints.rotationEnabled?(this._zoomOnly===null&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=l-n>0),this._zoomOnly===null||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):c=0,this.addToZoomEstimator(e,m),this.navigation.setViewpoint([s.x,s.y],1/d,c,[this._previousCenter.x-s.x,s.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=a,this._previousCenter=s}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=Q(0),(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return i===0||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return i===0||e<i}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,(e,i)=>{const a=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,s=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=a||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),l=he(i);if(this._momentumFinished=s&&n,!this._momentumFinished){const m=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,l))*this._rotationDirection*180/Math.PI:0;let d=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,l)):1;const c=at(),$=at();if(this._previousCenter){It(c,this._previousCenter.x,this._previousCenter.y),Ve($,t.size,t.padding),We(c,c,$);const{constraints:C,scale:z}=t,Z=z*d;d<1&&!C.canZoomInTo(Z)?(d=z/C.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):d>1&&!C.canZoomOutTo(Z)&&(d=z/C.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),He(e,t.viewpoint,d,m,c,t.size),t.constraints.constrainByGeometry(e)}}this._animationTime=Q(this._animationTime+l)})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};r([w()],j.prototype,"_momentumFinished",void 0),r([w()],j.prototype,"viewpoint",void 0),r([w()],j.prototype,"navigation",void 0),j=r([Y("esri.views.2d.navigation.actions.Pinch")],j);const Bt=at(),le=at();let nt=class extends X{constructor(t){super(t),this._previousCenter=at(),this.viewpoint=new gt({targetGeometry:new vt,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),It(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:i,padding:a}}=t;It(Bt,e.center.x,e.center.y),je(le,i,a),t.viewpoint=Gt(this.viewpoint,t.state.paddedViewState.viewpoint,Qe(le,this._previousCenter,Bt)),Xe(this._previousCenter,Bt)}end(){this.navigation.end()}};r([w()],nt.prototype,"viewpoint",void 0),r([w()],nt.prototype,"navigation",void 0),nt=r([Y("esri.views.2d.navigation.actions.Rotate")],nt);const U=10,ue=1,At=new gt({targetGeometry:new vt}),Ot=[0,0],me=250;let B=class extends X{constructor(o){super(o),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new H({navigation:this}),this.rotate=new nt({navigation:this}),this.pinch=new j({navigation:this}),this.zoomBox=new st({view:this.view,navigation:this})}destroy(){this.pan=rt(this.pan),this.rotate=rt(this.rotate),this.pinch=rt(this.pinch),this.zoomBox=rt(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(me)}async zoom(o,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return o<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,o,0,[0,0])}async zoomIn(o){const t=this.view,e=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(e,o)}async zoomOut(o){const t=this.view,e=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(e,o)}setViewpoint(o,t,e,i){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,o,t,e,i),this.end()}setViewpointImmediate(o,t=0,e=[0,0],i=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,i,o,t,e)}continuousRotateClockwise(){const o=this.view.viewpoint;this.animationManager?.animateContinuous(o,t=>{Gt(t,t,-ue)})}continuousRotateCounterclockwise(){const o=this.view.viewpoint;this.animationManager?.animateContinuous(o,t=>{Gt(t,t,ue)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-U,0])}continuousPanRight(){this._continuousPan([U,0])}continuousPanUp(){this._continuousPan([0,U])}continuousPanDown(){this._continuousPan([0,-U])}continuousPanVector({x:o,y:t}){this._continuousPan([o*U,t*U])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(o){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,e=>{yt(e,e,o),this.view.constraints.constrainByGeometry(e)})}_startTimer(o){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<me?this._endTimer=this._startTimer(t):this._set("interacting",!1)},o)),this._endTimer}_getDefaultAnchor(){const{size:o,padding:{left:t,right:e,top:i,bottom:a}}=this.view;return Ot[0]=.5*(o[0]-e+t),Ot[1]=.5*(o[1]-a+i),Ot}async _zoomToScale(o,t=this._getDefaultAnchor()){const{view:e}=this,{constraints:i,scale:a,viewpoint:s,size:n,padding:l}=e,m=i.canZoomInTo(o),d=i.canZoomOutTo(o);if(!(o<a&&!m||o>a&&!d))return Xt(At,s,o/a,0,t,n,l),i.constrainByGeometry(At),e.goTo(At,{animate:!0,animationMode:"always",duration:pe(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(o,t,e,i,a){const{view:s}=this,{size:n,padding:l,constraints:m,scale:d,viewpoint:c}=s,$=d*e,C=m.canZoomInTo($),z=m.canZoomOutTo($);return(e<1&&!C||e>1&&!z)&&(e=1),yt(c,c,a),Xt(o,c,e,i,t,n,l),m.constrainByGeometry(o)}};r([w()],B.prototype,"animationManager",void 0),r([w({type:Boolean,readOnly:!0})],B.prototype,"interacting",void 0),r([w()],B.prototype,"pan",void 0),r([w()],B.prototype,"pinch",void 0),r([w()],B.prototype,"rotate",void 0),r([w()],B.prototype,"view",void 0),r([w()],B.prototype,"zoomBox",void 0),B=r([Y("esri.views.2d.navigation.MapViewNavigation")],B);const lo=B;class Ee extends J{}r([F(0,x)],Ee.prototype,"position",void 0);class bi extends tt{}class O extends k{}r([p(f)],O.prototype,"readbackTexture",void 0),r([p(f)],O.prototype,"maskTexture",void 0),r([p(f)],O.prototype,"overlayTexture",void 0),r([p(h)],O.prototype,"background",void 0),r([p(h)],O.prototype,"drawPos",void 0),r([p(u)],O.prototype,"maskEnabled",void 0),r([p(u)],O.prototype,"overlayEnabled",void 0);class Ft extends K{constructor(){super(...arguments),this.type="MagnifierShader"}vertex(t){const e=t.position,i=t.position.subtract(new x(.5)).multiply(this.config.drawPos.zw),a=this.config.drawPos.xy.add(i);return{glPosition:new h(a,0,1),texCoord:e}}fragment(t){let e=v(this.config.readbackTexture,xi(t.texCoord));e=e.add(new u(1).subtract(e.a)).multiply(this.config.background);const i=M(R(this.config.maskEnabled,new u(1)),v(this.config.maskTexture,t.texCoord).a,new u(1));e=e.multiply(i);const a=M(R(this.config.overlayEnabled,new u(1)),v(this.config.overlayTexture,t.texCoord),new h(0)),s=new E;return s.fragColor=a.add(new u(1).subtract(a.a).multiply(e)),s}}function xi(o){const t=o.multiply(new x(2)).subtract(1);return M(R(t.x,new u(0)).and(R(t.y,new u(0))),new x(.5),()=>{const e=ti(t.y,t.x),i=ei(ii(t),new u(mi)),a=new x(oi(e),si(e));return i.multiply(a).multiply(new x(.5)).add(new u(.5))})}r([p(O)],Ft.prototype,"config",void 0),r([_(0,b(Ee))],Ft.prototype,"vertex",null),r([_(0,b(bi))],Ft.prototype,"fragment",null);class ze extends J{}r([F(0,x)],ze.prototype,"position",void 0);class Ci extends tt{}class Pe extends k{}r([p(be)],Pe.prototype,"dvs",void 0);class D extends k{}r([p(u)],D.prototype,"halfWidth",void 0),r([p(u)],D.prototype,"aaWidth",void 0),r([p(u)],D.prototype,"pxPerCell",void 0),r([p(h)],D.prototype,"minorLineColor",void 0),r([p(h)],D.prototype,"majorLineColor",void 0),r([p(Dt)],D.prototype,"majorLineInterval",void 0);class dt extends K{constructor(){super(...arguments),this.type="GridShader"}vertex(t){const e=t.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new g(e,1)).xy,glPosition:new h(e,0,1)}}fragment(t){const e=ye(t.gridPos),i=ni(e),a=P(i.x,new u(1).subtract(i.x)),s=P(i.y,new u(1).subtract(i.y)),n=new x(a,s).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),l=P(n.x,n.y),m=new u(1).subtract(_e(new u(0),this.config.aaWidth,l)),d=new Dt(Kt(e.x)),c=new Dt(Kt(e.y)),$=new u(Jt(d,this.config.majorLineInterval)),C=new u(Jt(c,this.config.majorLineInterval)),z=M(fe(n.x,n.y),$,C),Z=wt(ai(G(n.x,this.config.aaWidth),G(n.y,this.config.aaWidth)),new u(.5)),bt=P($,C),xt=M(Z,bt,z),Re=_t(this.config.majorLineColor,this.config.minorLineColor,P(xt,new u(1))),jt=new E;return jt.fragColor=Re.multiply(m),jt}}r([p(Pe)],dt.prototype,"transform",void 0),r([p(D)],dt.prototype,"config",void 0),r([_(0,b(ze))],dt.prototype,"vertex",null),r([_(0,b(Ci))],dt.prototype,"fragment",null);export{Et as C,lt as E,Ft as P,Pt as R,Ri as a,zt as b,ae as c,re as d,Ii as e,oe as f,Ki as g,Gi as h,Rt as i,et as l,dt as q,Pi as r,kt as v,se as x,lo as y};
