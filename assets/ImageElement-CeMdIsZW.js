import{gn as v,a5 as y,g1 as I,h8 as u,h9 as w,ha as H,hb as d,hc as b,hd as E,cv as P,he as $,hf as L,hg as T,_ as s,e as l,cm as M,cn as R,g as U}from"./index-CgzAF5Ey.js";import{u as O,x as _,g as x}from"./VideoElement-E5DMr6hw.js";import{n as W}from"./mediaLayerUtils-BJ-DU5EY.js";var g,p;let o=(p=class extends O{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[g]=!0,this.image=null}load(){const e=this.image;if(typeof e=="string"){const t=v(e).then(n=>{this._set("content",n)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new y("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,n){return I(t.url,n)}writeImage(e,t,n,i){if(e==null)return;const r=i?.portalItem,m=i?.resources;if(!r||!m)return void(typeof e=="string"&&(t[n]=u(e,i)));const h=C(e)?e:null;if(h){if(w(h)==null)return void(t[n]=h);const a=u(h,{...i,verifyItemRelativeUrls:i?.verifyItemRelativeUrls?{writtenUrls:i.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1);if(r&&a&&!H(a))return m.toKeep.push({resource:r.resourceFromPath(a),compress:!1}),void(t[n]=a)}t[n]="<pending>",m.pendingOperations.push(D(e).then(a=>{const c=j(a,r);t[n]=c.itemRelativeUrl,m.toAdd.push({resource:c,content:{type:"blob",blob:a},compress:!1,finish:f=>{this.image=f.url}})}))}},g=W,p);function C(e){return typeof e=="string"&&!d(e)&&!b(e)}async function D(e){return typeof e=="string"?d(e)?E(e):(await P(e,{responseType:"blob"})).data:new Promise(t=>F(e).toBlob(t))}function F(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,i=document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=n,e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),i}function j(e,t){const n=$(),i=`${L("media",n)}.${T({type:"blob",blob:e})}`;return t.resourceFromPath(i)}s([l()],o.prototype,"animationOptions",void 0),s([l({readOnly:!0})],o.prototype,"content",void 0),s([l({readOnly:!0})],o.prototype,"contentWidth",null),s([l({readOnly:!0})],o.prototype,"contentHeight",null),s([l(_)],o.prototype,"image",void 0),s([M("image",["url"])],o.prototype,"readImage",null),s([R("image")],o.prototype,"writeImage",null),s([l(x)],o.prototype,"type",void 0),o=s([U("esri.layers.support.ImageElement")],o);export{o as E};
