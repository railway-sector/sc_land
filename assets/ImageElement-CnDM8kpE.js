import{fA as y,bz as v,fB as I,fC as h,fD as H,fE as b,fF as g,fG as w,fH as E,c6 as $,fI as P,fJ as L,fK as T,Z as s,$ as l,b$ as M,fL as R,a0 as U}from"./index-CVzGOCNQ.js";import{u as O,x as _,g as x}from"./VideoElement-Cx_qDNzB.js";import{n as W}from"./mediaLayerUtils-BJ-DU5EY.js";var p,f;let o=(f=class extends O{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[p]=!0,this.image=null}load(){const e=this.image;if(typeof e=="string"){const t=y(e).then(n=>{this._set("content",n)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new v("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,n){return I(t.url,n)}writeImage(e,t,n,i){if(e==null)return;const r=i?.portalItem,m=i?.resources;if(!r||!m)return void(typeof e=="string"&&(t[n]=h(e,i)));const c=C(e)?e:null;if(c){if(H(c)==null)return void(t[n]=c);const a=h(c,{...i,verifyItemRelativeUrls:i?.verifyItemRelativeUrls?{writtenUrls:i.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1);if(r&&a&&!b(a))return m.toKeep.push({resource:r.resourceFromPath(a),compress:!1}),void(t[n]=a)}t[n]="<pending>",m.pendingOperations.push(D(e).then(a=>{const u=A(a,r);t[n]=u.itemRelativeUrl,m.toAdd.push({resource:u,content:{type:"blob",blob:a},compress:!1,finish:d=>{this.image=d.url}})}))}},p=W,f);function C(e){return typeof e=="string"&&!g(e)&&!w(e)}async function D(e){return typeof e=="string"?g(e)?E(e):(await $(e,{responseType:"blob"})).data:new Promise(t=>F(e).toBlob(t))}function F(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,i=document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=n,e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),i}function A(e,t){const n=P(),i=`${L("media",n)}.${T({type:"blob",blob:e})}`;return t.resourceFromPath(i)}s([l()],o.prototype,"animationOptions",void 0),s([l({readOnly:!0})],o.prototype,"content",void 0),s([l({readOnly:!0})],o.prototype,"contentWidth",null),s([l({readOnly:!0})],o.prototype,"contentHeight",null),s([l(_)],o.prototype,"image",void 0),s([M("image",["url"])],o.prototype,"readImage",null),s([R("image")],o.prototype,"writeImage",null),s([l(x)],o.prototype,"type",void 0),o=s([U("esri.layers.support.ImageElement")],o);export{o as E};
