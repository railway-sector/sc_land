import{fF as y,bI as v,fG as I,fH as h,fI as H,fJ as w,fK as g,fL as b,fM as P,cf as E,fN as L,fO as $,fP as M,a5 as s,x as l,c8 as T,fQ as O,y as R}from"./index-aRi8Xk-b.js";import{u as U,x,g as _}from"./VideoElement-B-R-4fHC.js";import{n as W}from"./mediaLayerUtils-BJ-DU5EY.js";var p,f;let o=(f=class extends U{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[p]=!0,this.image=null}load(){const e=this.image;if(typeof e=="string"){const t=y(e).then(n=>{this._set("content",n)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new v("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,n){return I(t.url,n)}writeImage(e,t,n,i){if(e==null)return;const r=i?.portalItem,m=i?.resources;if(!r||!m)return void(typeof e=="string"&&(t[n]=h(e,i)));const c=F(e)?e:null;if(c){if(H(c)==null)return void(t[n]=c);const a=h(c,{...i,verifyItemRelativeUrls:i?.verifyItemRelativeUrls?{writtenUrls:i.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1);if(r&&a&&!w(a))return m.toKeep.push({resource:r.resourceFromPath(a),compress:!1}),void(t[n]=a)}t[n]="<pending>",m.pendingOperations.push(C(e).then(a=>{const u=K(a,r);t[n]=u.itemRelativeUrl,m.toAdd.push({resource:u,content:{type:"blob",blob:a},compress:!1,finish:d=>{this.image=d.url}})}))}},p=W,f);function F(e){return typeof e=="string"&&!g(e)&&!b(e)}async function C(e){return typeof e=="string"?g(e)?P(e):(await E(e,{responseType:"blob"})).data:new Promise(t=>D(e).toBlob(t))}function D(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,i=document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=n,e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),i}function K(e,t){const n=L(),i=`${$("media",n)}.${M({type:"blob",blob:e})}`;return t.resourceFromPath(i)}s([l()],o.prototype,"animationOptions",void 0),s([l({readOnly:!0})],o.prototype,"content",void 0),s([l({readOnly:!0})],o.prototype,"contentWidth",null),s([l({readOnly:!0})],o.prototype,"contentHeight",null),s([l(x)],o.prototype,"image",void 0),s([T("image",["url"])],o.prototype,"readImage",null),s([O("image")],o.prototype,"writeImage",null),s([l(_)],o.prototype,"type",void 0),o=s([R("esri.layers.support.ImageElement")],o);export{o as E};
