import{_ as i,e as n,g as v,a5 as x,gh as E,dq as $,eX as F,am as u}from"./index-CgzAF5Ey.js";import{a as _}from"./rasterFieldUtils-owWC2Tqk.js";import{i as D}from"./timeSupport-CVOq4qnd.js";import{j as I,I as N}from"./rasterProjectionHelper-FtdA54qR.js";import{n as S}from"./popupUtils-CNYyKlIB.js";const L=c=>{const y=c;let e=class extends y{constructor(...r){super(...r),this.view=null}get timeExtent(){return D(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(r,l){const{layer:t}=this;if(!r)throw new x("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:d}=t,p=S(t,l);if(!d||p==null)return[];const h=await p.getRequiredFields(null,{index:new E(t.rasterFields),partitions:new Map([["$pixel",t.rasterFields.filter(a=>a.name.startsWith(_)).map(a=>a.name)],["$imageCollectionItem",t.fields.map(a=>a.name)]])});$(l);const s=new F;s.timeExtent=this.timeExtent,s.geometry=r,s.outFields=h,s.outSpatialReference=r.spatialReference;const{resolution:o,spatialReference:m}=this.view,w=this.view.type==="2d"?new u(o,o,m):new u(.5*o,.5*o,m),{returnTopmostRaster:f,showNoDataRecords:R}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},g={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:w,showNoDataRecords:R,signal:l?.signal};return t.queryVisibleRasters(s,g)}async getSourceScale(){return await I(),await this.layer.load(),N(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return i([n()],e.prototype,"layer",void 0),i([n()],e.prototype,"suspended",void 0),i([n({readOnly:!0})],e.prototype,"timeExtent",null),i([n()],e.prototype,"view",void 0),e=i([v("esri.views.layers.ImageryLayerView")],e),e};export{L as y};
