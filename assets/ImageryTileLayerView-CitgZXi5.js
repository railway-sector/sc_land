import{a5 as n,x as s,y as P,bI as _,ao as j}from"./index-aRi8Xk-b.js";import{V as L,i as l,a as $}from"./rasterFieldUtils-ewF5JZJG.js";import{i as A}from"./timeSupport-DVHtDRpz.js";import{t as z}from"./datasetUtils-DdDUWBI2.js";import{v as C,u as x,I as D}from"./rasterProjectionHelper-B5cSg6T6.js";import{n as N}from"./popupUtils-lp22Q4NK.js";const K=E=>{const w=E;let r=class extends w{constructor(...t){super(...t),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return A(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:t}=this.layer;return!!(t?.type==="raster-stretch"&&t.dynamicRangeAdjustment&&!(t.stretchType==="min-max"||t.stretchType==="standard-deviation"))}get datumTransformation(){try{return this.layer.loaded?C(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(t){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,t)}catch{return!1}}async fetchPopupFeaturesAtLocation(t,p){const{layer:e}=this;if(!t)throw new _("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,I=N(e,p);if(!T||I==null)return[];const f=[],{value:o,magdirValue:m,processedValue:b}=await e.identify(t,{timeExtent:this.timeExtent,signal:p?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map(y=>e.getStandardTimeValue(y)).join(", "):o.join(", ");const i={ObjectId:0};i[l.servicePixelValue]=e.type==="imagery-tile"&&z(e.raster)?b?.join(", "):c,i[l.rawServicePixelValue]=c;const h=e.raster?.rasterInfo??e.serviceRasterInfo,d=h?.attributeTable;if(d!=null){const{fields:y,features:F}=d,v=y.find(({name:a})=>a.toLowerCase()==="value"),O=i[l.servicePixelValue],u=v?F.find(a=>String(a.attributes[v.name])===O):null;if(u)for(const a in u.attributes)u.attributes.hasOwnProperty(a)&&(i[$+a]=u.attributes[a])}const g=h?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(i[l.magnitude]=m?.[0],i[l.direction]=m?.[1]);const{multidimensionalDefinition:R}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});L(e.rasterFields,i,R);const{graphicOrigin:V}=e,S=new j({geometry:this.fullExtent?.clone(),attributes:i,layer:e,origin:V,sourceLayer:e});f.push(S)}return f}async getSourceScale(){return await this.layer.load(),D(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([s()],r.prototype,"fullExtent",null),n([s()],r.prototype,"layer",void 0),n([s({readOnly:!0})],r.prototype,"timeExtent",null),n([s()],r.prototype,"tileInfo",void 0),n([s({readOnly:!0})],r.prototype,"hasTilingEffects",null),n([s()],r.prototype,"datumTransformation",null),r=n([P("esri.views.layers.ImageryTileLayerView")],r),r};export{K as f};
