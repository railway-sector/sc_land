import{Y as d,cR as c,dz as p,a5 as s,x as r,y as v}from"./index-aRi8Xk-b.js";class _{constructor(){this._isToolEditable=!0,this._manipulators=new d,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=0){this.addMany([t],e)}addMany(t,e=0){for(const o of t){const n={manipulator:o,visibilityPredicate:e,attached:!1};this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const o=this._manipulators.splice(e,1)[0];this._detachManipulator(o);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,o=>{e(o)})}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(e=>t.push(e.manipulator)),t}intersect(t,e){let o=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:l,attached:u})=>{if(!u||!l.interactive)return;const h=l.intersectionDistance(t,e);h!=null&&h<n&&(n=h,o=l)}),o}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===2||(this._isToolEditable?t.visibilityPredicate===0:t.visibilityPredicate===1)}}let i=class extends c{constructor(a){super(a),this.manipulators=new _,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=p()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(a){this._get("visible")!==a&&(this._set("visible",a),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(a){this.setEditableFlag(0,a)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit("cancel")}handleInputEvent(a){this.onInputEvent(a)}handleInputEventAfter(a){this.onInputEventAfter(a)}setEditableFlag(a,t){this._editableFlags.set(a,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),a===0&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(a){return this._editableFlags.get(a)??!1}endDrag(){const a=this.view.inputManager.latestPointerInfo?.location;if(!a)return;let t=!1;this.manipulators.forEach(({manipulator:e})=>{e.dragging&&(t=!0,e.events.emit("drag",{action:"end",start:a,screenPoint:a}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(a){}onInputEventAfter(a){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};s([r({constructOnly:!0})],i.prototype,"view",void 0),s([r({readOnly:!0})],i.prototype,"active",null),s([r({value:!0})],i.prototype,"visible",null),s([r({value:!0})],i.prototype,"editable",null),s([r({readOnly:!0})],i.prototype,"manipulators",void 0),s([r({readOnly:!0})],i.prototype,"updating",null),s([r()],i.prototype,"cursor",null),s([r({readOnly:!0})],i.prototype,"automaticManipulatorSelection",void 0),s([r()],i.prototype,"hasFocusedManipulators",null),s([r()],i.prototype,"hasGrabbedManipulators",void 0),s([r()],i.prototype,"hasHoveredManipulators",void 0),s([r()],i.prototype,"firstGrabbedManipulator",void 0),s([r({readOnly:!0})],i.prototype,"created",void 0),s([r({readOnly:!0})],i.prototype,"removeIncompleteOnCancel",void 0),i=s([v("esri.views.interactive.InteractiveToolBase")],i);export{_ as a,i as r};
