import{O as f,_ as o,e as n,g,d6 as M,f as d,bJ as c}from"./index-CgzAF5Ey.js";import{e as w}from"./utils-BQBvadb7.js";import{I as _}from"./ListItem-DyzSo_ob.js";import{m as L,u as H}from"./layerListUtils-CrO8uhQ1.js";const l={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},V="hide",I=f.ofType(_);let r=class extends M{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new I,this.view=null}initialize(){this.addHandles([d(()=>this.view?.ready===!0,()=>this._viewHandles(),c),d(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),d(()=>w(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],l.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,s,i){const a=e?.layer;if(!a||a.type==="subtype-sublayer"||a.type==="sublayer")return;const h=this.view?.map?.layers,y=t?L(t):h,m=s?L(s):h;if(!y||!m)return;const{operationalItems:p}=this,b=t?.children||p,v=s?.children||p,u=m.length-i;e.parent=s||null,b.remove(e),y.remove(a),v.includes(e)||v.add(e,u),m.includes(a)||m.add(a,u),this._compileList()}_createLayerViewHandles(e){this.removeHandles(l.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),l.layerViews)}_createMapLayerHandles(e){this.removeHandles(l.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),l.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:s,checkPublishStatusEnabled:i,listModeDisabled:a}=this;return new _({checkPublishStatusEnabled:i,listModeDisabled:a,layer:e,listItemCreatedFunction:s,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>H(t)!==V):void 0}_watchLayersListMode(e){this.removeHandles(l.layerListMode),e&&!this.listModeDisabled&&this.addHandles(d(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),l.layerListMode)}_compileList(){const e=this.view?.map?.layers,t=w(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:i})=>i==="link-chart"):e;this._watchLayersListMode(t);const s=this._getViewableLayers(t);s?.length?(this._createNewItems(s),this._removeItems(s),this._sortItems(s)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(s=>{t.some(i=>i.layer===s)||t.add(this._createListItem(s))})}_removeItems(e){const{operationalItems:t}=this,s=[];t.forEach(i=>{i&&e&&e.includes(i.layer)||s.push(i)}),t.destroyMany(s)}_sortItems(e){const{operationalItems:t}=this;t.sort((s,i)=>{const a=e.indexOf(s.layer),h=e.indexOf(i.layer);return a>h?-1:a<h?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([l.mapLayers,l.layerViews,l.viewLayers]),e?.ready?this.addHandles([d(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),c),d(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),c)],l.viewLayers):this._removeAllItems()}};o([n()],r.prototype,"checkPublishStatusEnabled",void 0),o([n()],r.prototype,"listItemCreatedFunction",void 0),o([n({nonNullable:!0})],r.prototype,"listModeDisabled",void 0),o([n({type:I})],r.prototype,"operationalItems",void 0),o([n({readOnly:!0})],r.prototype,"state",null),o([n()],r.prototype,"totalItems",null),o([n()],r.prototype,"view",void 0),r=o([g("esri.widgets.LayerList.LayerListViewModel")],r);const $=r;export{$ as v};
