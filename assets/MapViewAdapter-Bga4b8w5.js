import{fZ as N,ao as y,d1 as j,aP as U,b5 as B,mZ as O,ez as X,a9 as _}from"./index-aRi8Xk-b.js";import{S as V,h as k,s as q,X as G}from"./customElement-Duf7jtxI.js";import"./OrientedImageryLayer-DNUkew_7.js";import"./projectOperator-pbpmSpqo.js";import"./operatorProject-Bp6D6u9T.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ElevationLayer-BtAhVoF1.js";import"./ArcGISCachedService-D8WBQN18.js";import"./TileInfoTilemapCache-DpPwfrSR.js";import"./LercDecoder-Ba_HK_eF.js";import"./ImageryLayer-C1WpU_1u.js";import"./isImageryGraphicOrigin-Ccuhb4eK.js";import"./multidimensionalUtils-DPCJo6rl.js";import"./RasterJobHandlerMixin-ZMXsKT3M.js";import"./RasterSymbolizer-B_xou3r7.js";import"./PixelBlock-D6s_WAG4.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./vectorFieldUtils-nfa_tg3e.js";import"./datasetUtils-DdDUWBI2.js";import"./ClassBreaksDefinition-DT1Dgqyb.js";import"./dataUtils-BlaM2BDe.js";import"./imageBitmapUtils-DWFhzbXj.js";import"./rasterFieldUtils-ewF5JZJG.js";import"./RasterPresetRendererMixin-BCm-HQgI.js";import"./executeForIds-BOIvqEB-.js";import"./query-zZV_LNG5.js";import"./pbfQueryUtils-Cjywei14.js";import"./pbf-D2pQhulj.js";import"./executeQueryJSON-BsEB0j6G.js";import"./GraphicsLayer-aZe0Dbdm.js";import"./Mesh-Dxc9QN5X.js";import"./MeshComponent-DO-Vuh-B.js";import"./meshProperties-DWLWd_LJ.js";import"./MeshTransform-DL7voDcB.js";import"./MeshVertexAttributes-myWlh2p7.js";import"./triangulationUtils-Bx6S2VF2.js";import"./earcut-D9gy186-.js";import"./deduplicate-DCdpRX6I.js";import"./vertexSpaceConversion--9VICkO9.js";import"./vec4-CJuiouB0.js";import"./External-CRHviFCd.js";import"./MediaLayer-BSg-18GK.js";import"./VideoElement-B-R-4fHC.js";import"./perspectiveUtils-DkWurYV9.js";import"./normalizeUtilsSync-DladfY4H.js";import"./ControlPoint-roJedap0.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./ImageElement-oWmrClPK.js";import"./BoundsStore-DeNuAjVw.js";import"./Circle-VvoTd42k.js";import"./deepClone-C3prMmcx.js";import"./languageUtils-BFDfiQjg.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-DNQAIdLr.js";import"./number-CRnfhq1R.js";import"./Draw-B5Y6tvI-.js";import"./SnappingVisualizer2D-CuIzKepu.js";import"./euclideanLengthMeasurementUtils-4a6kHLjp.js";import"./geometry2dUtils-CgYtdIFN.js";import"./geodeticLengthOperator-BPMj1oiZ.js";import"./geodeticCurveType-CirnHLSB.js";import"./SnappingVisualizer-DcEQkqUs.js";import"./PointSnappingHint-B1wS2G__.js";import"./coordinateHelper-DuZS2XLt.js";import"./EditGeometryOperations-BtS6ng1n.js";import"./rotate-BMbD9698.js";import"./curveOperationUtils-DNLI8alC.js";import"./SnappingContext-lR2hMWGP.js";import"./SnappingOperation-STPFAn9b.js";import"./automaticLengthMeasurementUtils-CCfVEmrk.js";import"./DrawingMode-Cvvf0VVz.js";import"./surfaceCoordinateSystems-H1MVPt50.js";import"./drawUtils-Br2aF8oP.js";import"./areaOperator-JiNZPKm3.js";import"./Point2D-8Py_srEd.js";import"./Envelope2D-DQ3Tn1o-.js";import"./ProjectionTransformation-CepNZ9PX.js";import"./Transformation2D-Ckyhe4wc.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-BSFqafDe.js";import"./apiConverter-FnkTMlaa.js";import"./geodeticAreaOperator-DYnNn27m.js";import"./geodeticDensifyOperator-BbdO1oBy.js";import"./operatorGeodeticDensify-CqM-82EQ.js";import"./lengthOperator-B93QPg-F.js";import"./simplifyOperator-BRnc_X18.js";import"./operatorSimplify-BOKlU8rf.js";import"./operators-Ca4ZfP-e.js";import"./affineTransformOperator-CYcPpYBN.js";import"./operatorGeodesicBuffer-9fSni0Zj.js";import"./simplifyOGCOperator-BrAX_zNk.js";import"./OperatorSimplifyOGC-C4cFJI6O.js";import"./Transformation-B5QFC7mB.js";import"./bufferOperator-CSTG6DI2.js";import"./operatorBuffer-CIZ3g07A.js";import"./Bufferer-Dw9Qi4T1-D8yKlGHi.js";import"./OperatorGeneralize-DoFoqaxi.js";import"./centroidOperator-__ITf3sI.js";import"./Centroid-DZi-eb9F-bsuFT5fW.js";import"./clipOperator-B-c7w6tM.js";import"./containsOperator-ClgHXVAE.js";import"./operatorConvexHull-D2b8GS3k.js";import"./OperatorCrosses-h4jZOYNE.js";import"./cutOperator-D3MceKr1.js";import"./densifyOperator-DHWBdh-U.js";import"./operatorDensify-Cd1Qu20O.js";import"./differenceOperator-By7S1Y_y.js";import"./distanceOperator-DXoZ1ofm.js";import"./Distance2DCalculator-CXhBP-8I-Ci-vwecj.js";import"./equalsOperator-VICYJXZz.js";import"./generalizeOperator-DeqIVVGV.js";import"./operatorGeneralize-DgWCTRem.js";import"./intersectionOperator-ClmheFJp.js";import"./operatorIntersection-D5fgKHb0.js";import"./intersectsOperator-C2mY84EI.js";import"./OperatorIntersects-BedDA8cr.js";import"./labelPointOperator-R7L8jZGU.js";import"./OperatorProximity-gMgF6_DS.js";import"./OperatorOverlaps-BeZHQzly.js";import"./proximityOperator-P1L3GlzQ.js";import"./relateOperator-BP9UkBE5.js";import"./symmetricDifferenceOperator-Y7nMmrf_.js";import"./OperatorTouches-8n8ac3eQ.js";import"./unionOperator-DbwqLb2E.js";import"./operatorUnion-D0Yl3krj.js";import"./OperatorWithin-OGsjnXMO.js";import"./offset-C4oRIUmr.js";import"./unitConversion-CuhlvP-p.js";import"./operatorOffset-BnhEHmGh.js";import"./ImageryTileLayer-ahBg2tJx.js";import"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import"./xmlUtilities-BrCIVSt6.js";import"./QueueProcessor-BBZoq4x6.js";import"./RawBlockCache-DcA_xtd5.js";import"./rasterProjectionHelper-B5cSg6T6.js";import"./clipUtils-CIPL8g4V.js";import"./rasterFunctionHelper-Dc05Qk8O.js";import"./PolynomialTransform-D9daHnVQ.js";import"./SketchViewModel-CgPwD4NK.js";import"./isSupportedObject-BODRvkc7.js";import"./layerUtils-kYGDyovj.js";import"./SketchLabelOptions-CdsKprwo.js";import"./SketchOptions-CwjAcyI0.js";import"./SnappingManager-DCRQCwjI.js";import"./automaticAreaMeasurementUtils-BDF5aXgy.js";import"./geodesicAreaMeasurementUtils-thvXrmuo.js";class Bo{constructor(E){this.viewModel=E,this.createFootprints=async u=>{await N(u);const{coveragePolygons:m,currentBestFeature:r,isAdditionalCoverageVisible:i}=this.viewModel;for(const t of m)t?.imageID===r.attributes.objectId?this.viewModel.bestFeatureFootprint=new y({attributes:{imageID:t?.imageID},geometry:t,symbol:V,visible:!1}):this.viewModel.additionalFootprints.push(new y({attributes:{imageID:t?.imageID},geometry:t,symbol:k.clone(),visible:i}))},this.updateFootprint=async(u,m,r)=>{const{activeViewer:i,mode:t,currentBestFeature:w,currentCoverageVisible:M,footprintExtent:C}=this.viewModel,h=t==="video"?q:i?.imageSize,c=m??w;if(w&&h&&C&&c)try{const a=await this.viewModel.getMapPoint(u,{feature:c,mode:"default",imageSize:h});j(r);const s=a.filter(U);if(!s.length)return;const e=[s.map(({x:P,y:o})=>[P,o,1])];e[0].push(e[0][0]);const p=new B({rings:e,spatialReference:s[0].spatialReference}),d=this.viewModel.view?.spatialReference.equals(p.spatialReference)?p:await O(p,this.viewModel.view.spatialReference,r);this.viewModel.updateCurrentCoveragePolygon(new y({geometry:d,attributes:{imageID:c.attributes.objectId},symbol:V,visible:M}))}catch(a){X(a)||_.getLogger(this.viewModel).error("update-footprint",a)}else this.viewModel.updateCurrentCoveragePolygon(null)},this.updateFootprintPanorama=async(u,m)=>{const{horizontalFieldOfView:r,pitch:i,verticalFieldOfView:t,yaw:w,feature:M}=u,{activeViewer:C,currentBestFeature:h,currentCoverageVisible:c,footprintExtent:a,mode:s}=this.viewModel,e=s==="video"||s==="panoramic-video"?q:C?.imageSize,p=M??h;if(!p||!e||!a)return void this.viewModel.updateCurrentCoveragePolygon(null);const{cameraPitch:d,objectId:P}=p.attributes;if(i+d-t/2>180)return void this.viewModel.updateCurrentCoveragePolygon(null);const o=[],n=t/2,v=r/2,z=i-n,x=d+z,S=d+(i+n);if(x>180)return void this.viewModel.updateCurrentCoveragePolygon(null);const F=z<0,L=[-v,n],Z=[v,n],f=[v,-n],b=[-v,-n];if(x<180&&S>180){o.push(F?f:b);const l=Math.floor(r/5),g=r/l;for(let D=0;D<=l;D++)o.push([D*g-v,90-i]);o.push(F?b:f)}S<180&&(o.push(L,Z),F?o.push(b,f):o.push(f,b));const A=o.map(([l,g])=>G(w+l,i+g,e[0],e[1])),$=await this.viewModel.getMapPoint(A,{feature:p,mode:"panorama",imageSize:e});j(m);const I=[$.map(({x:l,y:g})=>[l,g,1])];I[0].push(I[0][0]);const R=new B({rings:I,spatialReference:$[0].spatialReference}),H=this.viewModel.view?.spatialReference.equals(R.spatialReference)?R:await O(R,this.viewModel.view.spatialReference,m);this.viewModel.updateCurrentCoveragePolygon(new y({geometry:H,attributes:{imageID:P},symbol:V.clone(),visible:c}))}}}export{Bo as default};
