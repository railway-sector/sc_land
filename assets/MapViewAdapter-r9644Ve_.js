import{fZ as N,ao as y,d1 as j,aP as U,b5 as B,mZ as O,ez as X,a9 as _}from"./index-Brd6-W-v.js";import{S as V,h as k,s as q,X as G}from"./customElement-CylCUDy4.js";import"./OrientedImageryLayer-CGCTLGQL.js";import"./projectOperator-DQU7kq6r.js";import"./operatorProject-C8LDDLeY.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ElevationLayer-PaNzkFhZ.js";import"./ArcGISCachedService-D8QiBCXi.js";import"./TileInfoTilemapCache-CyMbI9A0.js";import"./LercDecoder-Dq-2uiu6.js";import"./ImageryLayer-CVc8v0Gm.js";import"./isImageryGraphicOrigin-Ccuhb4eK.js";import"./multidimensionalUtils-DlXvOn1-.js";import"./RasterJobHandlerMixin-BF5RvW5p.js";import"./RasterSymbolizer-D6P-rQlr.js";import"./PixelBlock-C9mzrKen.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./vectorFieldUtils-BI-Dtq9V.js";import"./datasetUtils-DdDUWBI2.js";import"./ClassBreaksDefinition-DcgRXgKZ.js";import"./dataUtils-DQsCgPxD.js";import"./imageBitmapUtils-BxOSOqu4.js";import"./rasterFieldUtils-CXXo2xQr.js";import"./RasterPresetRendererMixin-By9Whm_W.js";import"./executeForIds-CrTwncYm.js";import"./query-CPne1rkp.js";import"./pbfQueryUtils-BFeOMlM9.js";import"./pbf-DHSkgwDZ.js";import"./executeQueryJSON-DpYzV-vo.js";import"./GraphicsLayer-CjG4lAYI.js";import"./Mesh-C7f-1ZHQ.js";import"./MeshComponent-Bwx93ux8.js";import"./meshProperties-DWLWd_LJ.js";import"./MeshTransform-Dbi_AwF7.js";import"./MeshVertexAttributes-6DmuGZUv.js";import"./triangulationUtils-eGhoHB2Y.js";import"./earcut-D9gy186-.js";import"./deduplicate-DwuzT7Mm.js";import"./vertexSpaceConversion-mL2qfoZZ.js";import"./vec4-D7S8ID6U.js";import"./External-BhfIKVKf.js";import"./MediaLayer-DSAv823D.js";import"./VideoElement-CWtMD9ZQ.js";import"./perspectiveUtils-OFZBya5W.js";import"./normalizeUtilsSync-BZw0Uotp.js";import"./ControlPoint-JJGti1Pl.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./ImageElement-DuPV76gQ.js";import"./BoundsStore-Bdlpg8BR.js";import"./Circle-BQ_vcP4p.js";import"./deepClone-DbPEgwiE.js";import"./languageUtils-VTg8aC1C.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-DsYHIy08.js";import"./number-CnUbDFCW.js";import"./Draw-3q23Kx-J.js";import"./SnappingVisualizer2D-DYjuS6Ks.js";import"./euclideanLengthMeasurementUtils-DM9lZgm8.js";import"./geometry2dUtils-BOHjqgu-.js";import"./geodeticLengthOperator-DnkggiH8.js";import"./geodeticCurveType-CirnHLSB.js";import"./SnappingVisualizer-DmZrCf5x.js";import"./PointSnappingHint-ZiE-SXoE.js";import"./coordinateHelper-DvQOiAfn.js";import"./EditGeometryOperations-DxdlE7nu.js";import"./rotate-OuprA1zY.js";import"./curveOperationUtils-CoLaLuTr.js";import"./SnappingContext-lR2hMWGP.js";import"./SnappingOperation-By_c1Abi.js";import"./automaticLengthMeasurementUtils-DtR3CDX6.js";import"./DrawingMode-Cvvf0VVz.js";import"./surfaceCoordinateSystems-BwSuGL3d.js";import"./drawUtils-NQXIF0Cp.js";import"./areaOperator-BbXjY47m.js";import"./Point2D-8Py_srEd.js";import"./Envelope2D-DQ3Tn1o-.js";import"./ProjectionTransformation-CfbkWcJt.js";import"./Transformation2D-Ckyhe4wc.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-C7-7hi8T.js";import"./apiConverter-CH50OwTE.js";import"./geodeticAreaOperator-DGRYxXTa.js";import"./geodeticDensifyOperator-CsSq104o.js";import"./operatorGeodeticDensify-BfuBD9y_.js";import"./lengthOperator-iEMdnNxf.js";import"./simplifyOperator-CuJaEDXS.js";import"./operatorSimplify-CJeXdbKY.js";import"./operators-BQdgWosn.js";import"./affineTransformOperator-ClvGfjr-.js";import"./operatorGeodesicBuffer-DpGV55JM.js";import"./simplifyOGCOperator-DDqB5MwB.js";import"./OperatorSimplifyOGC-CQ-OmjdM.js";import"./Transformation-7qzaN5Rw.js";import"./bufferOperator-CAWz_57I.js";import"./operatorBuffer-COnw5bql.js";import"./Bufferer-Dw9Qi4T1-C7Az0kZx.js";import"./OperatorGeneralize-DcAPfmEk.js";import"./centroidOperator-CdZAfEyu.js";import"./Centroid-DZi-eb9F-bsuFT5fW.js";import"./clipOperator-FDwqYY1k.js";import"./containsOperator-CQYyML-M.js";import"./operatorConvexHull-CQxrV0hb.js";import"./OperatorCrosses-CGwKer_U.js";import"./cutOperator-B2v-vuui.js";import"./densifyOperator-CL0Qx5Wo.js";import"./operatorDensify-BeU0sdeF.js";import"./differenceOperator-DP4mfhhI.js";import"./distanceOperator-B10WR_pd.js";import"./Distance2DCalculator-CXhBP-8I-BWP43z-Q.js";import"./equalsOperator-BYVD66vw.js";import"./generalizeOperator-yPk8qUj9.js";import"./operatorGeneralize--L3mEeM1.js";import"./intersectionOperator-BKYNpJpe.js";import"./operatorIntersection-B5xxihVn.js";import"./intersectsOperator-CnRdOJlB.js";import"./OperatorIntersects-DKd2MBN0.js";import"./labelPointOperator-ghgspqFH.js";import"./OperatorProximity-BkUw5cdk.js";import"./OperatorOverlaps-BjhlWFZP.js";import"./proximityOperator-r8ORaB7x.js";import"./relateOperator-Bkr4RU97.js";import"./symmetricDifferenceOperator-B1V1ffNY.js";import"./OperatorTouches-DORsYM6z.js";import"./unionOperator-B2pITRiT.js";import"./operatorUnion-BqZpz-pb.js";import"./OperatorWithin-DZieup8w.js";import"./offset-DSKuDQ8k.js";import"./unitConversion-CEVYnSTg.js";import"./operatorOffset--hCJqbie.js";import"./ImageryTileLayer-DTF5Kgid.js";import"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import"./xmlUtilities-Dh6NWOkz.js";import"./QueueProcessor-iN0JAthU.js";import"./RawBlockCache-BSJt-lHC.js";import"./rasterProjectionHelper-CjSqXq1I.js";import"./clipUtils-DiAwM47P.js";import"./rasterFunctionHelper-CN3HkO1R.js";import"./PolynomialTransform-BhHmQpxh.js";import"./SketchViewModel-B60c25uC.js";import"./isSupportedObject-CBU7VL65.js";import"./layerUtils-61hESGqR.js";import"./SketchLabelOptions-C_8uwBga.js";import"./SketchOptions-DVOz4iqy.js";import"./SnappingManager-C6oen82f.js";import"./automaticAreaMeasurementUtils-OmtWBaHK.js";import"./geodesicAreaMeasurementUtils-DJGxN27X.js";class Bo{constructor(E){this.viewModel=E,this.createFootprints=async u=>{await N(u);const{coveragePolygons:m,currentBestFeature:r,isAdditionalCoverageVisible:i}=this.viewModel;for(const t of m)t?.imageID===r.attributes.objectId?this.viewModel.bestFeatureFootprint=new y({attributes:{imageID:t?.imageID},geometry:t,symbol:V,visible:!1}):this.viewModel.additionalFootprints.push(new y({attributes:{imageID:t?.imageID},geometry:t,symbol:k.clone(),visible:i}))},this.updateFootprint=async(u,m,r)=>{const{activeViewer:i,mode:t,currentBestFeature:w,currentCoverageVisible:M,footprintExtent:C}=this.viewModel,h=t==="video"?q:i?.imageSize,c=m??w;if(w&&h&&C&&c)try{const a=await this.viewModel.getMapPoint(u,{feature:c,mode:"default",imageSize:h});j(r);const s=a.filter(U);if(!s.length)return;const e=[s.map(({x:P,y:o})=>[P,o,1])];e[0].push(e[0][0]);const p=new B({rings:e,spatialReference:s[0].spatialReference}),d=this.viewModel.view?.spatialReference.equals(p.spatialReference)?p:await O(p,this.viewModel.view.spatialReference,r);this.viewModel.updateCurrentCoveragePolygon(new y({geometry:d,attributes:{imageID:c.attributes.objectId},symbol:V,visible:M}))}catch(a){X(a)||_.getLogger(this.viewModel).error("update-footprint",a)}else this.viewModel.updateCurrentCoveragePolygon(null)},this.updateFootprintPanorama=async(u,m)=>{const{horizontalFieldOfView:r,pitch:i,verticalFieldOfView:t,yaw:w,feature:M}=u,{activeViewer:C,currentBestFeature:h,currentCoverageVisible:c,footprintExtent:a,mode:s}=this.viewModel,e=s==="video"||s==="panoramic-video"?q:C?.imageSize,p=M??h;if(!p||!e||!a)return void this.viewModel.updateCurrentCoveragePolygon(null);const{cameraPitch:d,objectId:P}=p.attributes;if(i+d-t/2>180)return void this.viewModel.updateCurrentCoveragePolygon(null);const o=[],n=t/2,v=r/2,z=i-n,x=d+z,S=d+(i+n);if(x>180)return void this.viewModel.updateCurrentCoveragePolygon(null);const F=z<0,L=[-v,n],Z=[v,n],f=[v,-n],b=[-v,-n];if(x<180&&S>180){o.push(F?f:b);const l=Math.floor(r/5),g=r/l;for(let D=0;D<=l;D++)o.push([D*g-v,90-i]);o.push(F?b:f)}S<180&&(o.push(L,Z),F?o.push(b,f):o.push(f,b));const A=o.map(([l,g])=>G(w+l,i+g,e[0],e[1])),$=await this.viewModel.getMapPoint(A,{feature:p,mode:"panorama",imageSize:e});j(m);const I=[$.map(({x:l,y:g})=>[l,g,1])];I[0].push(I[0][0]);const R=new B({rings:I,spatialReference:$[0].spatialReference}),H=this.viewModel.view?.spatialReference.equals(R.spatialReference)?R:await O(R,this.viewModel.view.spatialReference,m);this.viewModel.updateCurrentCoveragePolygon(new y({geometry:H,attributes:{imageID:P},symbol:V.clone(),visible:c}))}}}export{Bo as default};
