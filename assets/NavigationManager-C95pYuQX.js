import{Y as I,ds as O,al as M,d0 as S,_ as v,e as y,g as _}from"./index-BrQW8HOS.js";import{i as $,c as b,u as x,F as E,z as q,b as F,e as B,o as R,d as A}from"./customElement-C8MorqK0.js";import"./OrientedImageryLayer-T2nz_Xpq.js";import"./a11yUtils-BrnjXW_g.js";import"./projectOperator-p23D9sjF.js";import"./operatorProject-DxiD_TZp.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ElevationLayer-mcjhsuEV.js";import"./ArcGISCachedService-CjQQR1Jv.js";import"./TileInfoTilemapCache-DZPzARxb.js";import"./LercDecoder-CQqToE6M.js";import"./ImageryLayer-BC1GWxe2.js";import"./isImageryGraphicOrigin-Ccuhb4eK.js";import"./multidimensionalUtils-C73Q5ZGV.js";import"./RasterJobHandlerMixin-MT2g2T_q.js";import"./RasterSymbolizer-B2A1UV2B.js";import"./PixelBlock-BLuOu6Ty.js";import"./pixelRangeUtils-BvOub3JO.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./vectorFieldUtils-BtFp6QX2.js";import"./datasetUtils-DdDUWBI2.js";import"./utils-6_NAbAK3.js";import"./cimSymbolUtils-CmFYUdpV.js";import"./gfxUtils-DDSu4Luj.js";import"./ClassBreaksDefinition-Bdvs4GrJ.js";import"./dataUtils-GsysffW0.js";import"./imageBitmapUtils-CV2jqiy6.js";import"./rasterFieldUtils-Ch69mkjb.js";import"./RasterPresetRendererMixin-B-VKGZPd.js";import"./executeForIds-Cnn1OWXP.js";import"./query-D5mFMRFz.js";import"./pbfQueryUtils-PegbNvJC.js";import"./pbf-bO1aG1II.js";import"./executeQueryJSON-CQzDonsh.js";import"./requestPresets-CKwN6OUr.js";import"./ExpandViewModel-CFigZjjU.js";import"./widget-lSGAz9tN.js";import"./GraphicsLayer-CtVknZ1a.js";import"./Mesh-fhI0Tv0o.js";import"./MeshComponent-BJOK3WKo.js";import"./meshProperties-DWLWd_LJ.js";import"./MeshTransform-wQhxY5y6.js";import"./MeshVertexAttributes-D5nCmuxt.js";import"./triangulationUtils-DRNEJzEV.js";import"./earcut-D9gy186-.js";import"./deduplicate-BmrPw5DR.js";import"./vertexSpaceConversion-DeCTRUfs.js";import"./vec4-CDOmPIEg.js";import"./External-B7cfwcdG.js";import"./vmEvent-CsrnYMSK.js";import"./MediaLayer-CCxfRpfr.js";import"./VideoElement-H0PUUZ6l.js";import"./MediaElementView-B-fdwXAA.js";import"./normalizeUtilsSync-DbZEvtY3.js";import"./ControlPoint-BjgmUvqO.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./ImageElement-CQTHnHSe.js";import"./BoundsStore-DpCEPPZ3.js";import"./Circle-CDzQBXRC.js";import"./geodesicUtils-BJZXB7Hp.js";import"./deepClone-CS2OSa44.js";import"./languageUtils-DuyO7Ix1.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-DBXlHENV.js";import"./number-CjVmF4xk.js";import"./floorFilterUtils-DKzVzLpH.js";import"./MapView-YOBSX6K6.js";import"./View2D-CXXq0vs5.js";import"./clippingUtils-BM7WDzJt.js";import"./viewpointUtils-CqwA4uEG.js";import"./mat2d-BbBq4Byx.js";import"./mat2df64-DJ_RMjZ3.js";import"./mat2df32-Dpt2CT5P.js";import"./hitTestUtils-DuJ-LfGM.js";import"./rbush-DRx18tQf.js";import"./Tile-BIybhnuW.js";import"./arcadeUtils-MYBE13Eg.js";import"./Timeline-Cz5T4vl1.js";import"./utils-D_VO_1nP.js";import"./Draw-C_AMmCSB.js";import"./SnappingVisualizer2D-D8AbMCG0.js";import"./euclideanLengthMeasurementUtils-B8AL_WaV.js";import"./geometry2dUtils-kADrF-iP.js";import"./geodeticLengthOperator-DifrZujk.js";import"./geodeticCurveType-CirnHLSB.js";import"./geodesicMeasurementUtils-CQw8IWGR.js";import"./SnappingVisualizer-C6MiCxsp.js";import"./PointSnappingHint-Bb4Sdzt2.js";import"./coordinateHelper-DrvFu3jL.js";import"./EditGeometryOperations-vGO-F4bG.js";import"./rotate-BhR0-nSl.js";import"./curveOperationUtils-DH-ids6k.js";import"./SnappingContext-lR2hMWGP.js";import"./SnappingOperation-C2jjQrkg.js";import"./automaticLengthMeasurementUtils-Cr-y0OEN.js";import"./DrawingMode-Cvvf0VVz.js";import"./surfaceCoordinateSystems-BrNYf00T.js";import"./drawUtils-SR7_OwBd.js";import"./quantityFormatUtils-DM7lTTMC.js";import"./areaOperator-D3kAgWzZ.js";import"./Point2D-DNXcsliy.js";import"./Envelope2D-CUWyosZh.js";import"./ProjectionTransformation-BjD312Kq.js";import"./Transformation2D-BUBnKQZf.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-BHYd2kGf.js";import"./apiConverter---8F7iZ4.js";import"./geodeticAreaOperator-ByYk3Bkb.js";import"./geodeticDensifyOperator-BOpsJkz4.js";import"./operatorGeodeticDensify-nwbiaD87.js";import"./lengthOperator-Br-Q2qCg.js";import"./simplifyOperator-BQVvn5Fy.js";import"./operatorSimplify-C16tE3lk.js";import"./operators-CXiTjj3T.js";import"./affineTransformOperator-BKNCSN4p.js";import"./operatorGeodesicBuffer-D8PQ9jFi.js";import"./simplifyOGCOperator-DDBsrw9u.js";import"./OperatorSimplifyOGC-DcNrF_Mf.js";import"./Transformation-CXt5h21i.js";import"./bufferOperator-BiJUv4mF.js";import"./operatorBuffer-CaIv_CSz.js";import"./Bufferer-Dw9Qi4T1-CvYDX-1r.js";import"./OperatorGeneralize-DppLq4y-.js";import"./centroidOperator-Cjo9P-qe.js";import"./Centroid-DZi-eb9F-ClGofmgB.js";import"./clipOperator-CZe8yiJF.js";import"./containsOperator-DNx102s3.js";import"./operatorConvexHull-CLXAmAdc.js";import"./OperatorCrosses-DB7FRg7V.js";import"./cutOperator-C_GdDi0E.js";import"./densifyOperator-vKowcNxj.js";import"./operatorDensify-BYGdpA54.js";import"./differenceOperator-CyhDoPG_.js";import"./distanceOperator-BeiDdpLt.js";import"./Distance2DCalculator-CXhBP-8I-Dkb8-KBJ.js";import"./equalsOperator-DvQtL8Uf.js";import"./generalizeOperator-COoaBFuG.js";import"./operatorGeneralize-Cl8mifHq.js";import"./intersectionOperator-BerN0YBP.js";import"./operatorIntersection-Dk662p0x.js";import"./intersectsOperator-CKuf4yKG.js";import"./OperatorIntersects-DfaHxqTc.js";import"./labelPointOperator-Cx7qMfIy.js";import"./OperatorProximity-Bx0bzIXN.js";import"./OperatorOverlaps-n6lZ5y_F.js";import"./proximityOperator-CeAOEVUj.js";import"./relateOperator-BbKNGnbr.js";import"./symmetricDifferenceOperator-BDttf2Xk.js";import"./OperatorTouches-DGMDJcwi.js";import"./unionOperator-CEwj5emJ.js";import"./operatorUnion-B1Eso4ej.js";import"./OperatorWithin-D4IqirkT.js";import"./offset-5dJF8WuL.js";import"./unitConversion-xbmYuQOc.js";import"./operatorOffset-Dh_0wl36.js";import"./ImageryTileLayer-Bw8EVTFT.js";import"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import"./xmlUtilities-0Gc5qIUC.js";import"./QueueProcessor-CL6qRd0z.js";import"./RawBlockCache-Dkglau7b.js";import"./rasterProjectionHelper-daQRJxKm.js";import"./clipUtils-C90NVAfo.js";import"./rasterFunctionHelper-CVPDO2RW.js";import"./PolynomialTransform-B3lvtn1Q.js";import"./SketchViewModel-NRhuw9HA.js";import"./isSupportedObject-DknMXN_6.js";import"./layerUtils-CdCZXuDJ.js";import"./SketchLabelOptions-BPF5xZLI.js";import"./SketchOptions-CHLlByzL.js";import"./SnappingManager-BWOfKl0d.js";import"./automaticAreaMeasurementUtils-dI3X5owW.js";import"./geodesicAreaMeasurementUtils-CPlOyDe5.js";import"./substitute-D-eLZ17Q.js";import"./useWidget-CYtf2hFT.js";import"./useView-Cya0Zpns.js";let c=class extends I{constructor(o){super(o),this.viewModel=null}get currentNode(){return this.viewModel.currentNode}get layer(){return this.viewModel.layer}get navigationNodes(){return this.viewModel.navigationNodes}async _queryAndHandleFeatureResponse(o,t,i,r){const{error:e,nextLocation:p,response:l}=await $(o,t,i,r);if(O(r),e)throw e;this.viewModel.selectedPoint=p,await this.viewModel.processFeatureResponse(l,p,{signal:r?.signal,loadBestImage:!1})}async afterNavigate(o,t,i){return await this.viewModel.selectBestFeature(t.id,i),t}async navigate(o,t){let i;if("direction"in t?i=await this.navigateInDirection(o,t):("step"in t||"goTo"in t)&&(i=await this.navigateInSequence(o,t)),!i)throw new Error("No next node found");return await this.afterNavigate(o,i,t)}async navigateBySkippingSteps(o,t){const{step:i}=t,{layer:r}=this,{floorFilterClause:e}=this.viewModel;if(!r)throw new Error("Layer is not defined");const p=o.attributes.sequenceOrder;if(await b(r,e,{signal:t.signal})===0||!p)throw new Error("No sequence found");const{response:l,error:a}=await x(r,p,i,1,e,{signal:t.signal});if(a)throw new Error("Error querying sequence features");const m=l?.features[0];if(!m)throw new Error("No next node found");const w=E.fromJSON({...m.toJSON(),layer:r}),{polygon:g}=q(w),d=M.fromJSON(S(g)),{response:n,error:u,nextLocation:s}=await F(r,d,e,{signal:t.signal});if(u)throw new Error("Error querying sequence features");const f=[...n.features];f.push(m),n.features=f,this.viewModel.selectedPoint=s;const N=m.attributes.objectId;return await this.viewModel.processFeatureResponse(n,s,{signal:t.signal,loadBestImage:!1}),this.viewModel.selectedPoint=s,this.viewModel.navigationNodes.find(h=>h.id===N)}async navigateInDirection(o,t){const{viewModel:i}=this,{layer:r,floorFilterClause:e}=i,{direction:p,signal:l}=t,a=o?.[p];if(!a)throw new B(p);const m=i.getFeatureSectorById(a.id);if(!m)throw new R(a);const[w,g]=m.split("_"),d=g??w,n=`NEAR_${d}`,u=`FAR_${d}`,s=i.getActiveSectors();return J(m,s.includes(n),s.includes(u),d,n,u)&&await this._queryAndHandleFeatureResponse(r,a,e,{signal:l}),a}async navigateInSequence(o,t){return"step"in t?this.navigateBySkippingSteps(o,t):this.navigateTo(t)}async navigateTo(o){const{goTo:t}=o,{layer:i}=this,{floorFilterClause:r}=this.viewModel;if(!i)throw new Error("Layer is not defined");const e=typeof t=="number"?t:1,p=this.viewModel.navigationNodes.find(h=>h.id===e);if(p)return p;const{response:l,error:a}=await A(i,e,1,t==="end"?"DESC":"ASC",r,{signal:o.signal});if(a)throw new Error("Error querying sequence features");const m=l?.features[0];if(!m)throw new Error("No next node found");const w=E.fromJSON({...m.toJSON(),layer:i}),{polygon:g}=q(w),d=M.fromJSON(S(g)),{response:n,error:u,nextLocation:s}=await F(i,d,r,{signal:o.signal});if(u)throw new Error("Error querying sequence features");const f=[...n.features];f.push(m),n.features=f,this.viewModel.selectedPoint=s;const N=m.attributes.objectId;return await this.viewModel.processFeatureResponse(n,s,{signal:o.signal,loadBestImage:!1}),this.viewModel.selectedPoint=s,this.viewModel.navigationNodes.find(h=>h.id===N)}};function J(o,t,i,r,e,p){return o===p||o===e&&!i||o===r&&!t&&!i}v([y()],c.prototype,"currentNode",null),v([y()],c.prototype,"layer",null),v([y()],c.prototype,"navigationNodes",null),v([y({constructOnly:!0})],c.prototype,"viewModel",void 0),c=v([_("esri.widgets.OrientedImageryViewer.navigation.NavigationManager")],c);export{c as default};
