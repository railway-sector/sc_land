import{_ as P,g as b,a4 as l,cH as m,ko as v}from"./index-BrQW8HOS.js";import{n as u,p as I}from"./popupUtils-C4kz55Ao.js";const L=d=>{const y=d;let r=class extends y{_validateFetchPopupFeatures(t){const{layer:s}=this,{popupEnabled:n}=s;if(!n)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!u(s,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,s){if(this._validateFetchPopupFeatures(s),t.length===0)return[];const n=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let o=[];"fieldsIndex"in this.layer&&(o=m(this.layer.fieldsIndex,await I(n,u(this.layer,s)))),await this.prepareFetchPopupFeatures(o);const c=new Set,p=[],a=[];for(const e of t)v(e,o,c)?a.push(e):p.push(e);if(a.length===0)return p;const i=new Map;for(let e=0;e<t.length;e++)i.set(t[e].getObjectId()??0,e);const h=await this.whenGraphicAttributes(a,[...c]).catch(()=>a).then(e=>p.concat(e));return h.sort((e,f)=>{const w=e.getObjectId()??0,F=i.get(w)??0,g=f.getObjectId()??0;return F-(i.get(g)??0)}),h}};return r=P([b("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{L as i};
