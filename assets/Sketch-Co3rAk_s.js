const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bp3GeDhQ.js","assets/index-ni9qn0ie.css"])))=>i.map(i=>d[i]);
import{Z as r,$ as l,a0 as E,Y as c,rj as q,W as x,X as L,_ as b,nb as H,a6 as I,a2 as Q,Q as Y,hL as W,aK as K,k as R,a3 as B,aV as z,b4 as X,q as Z,aY as G,O as V,a4 as J,tM as ee}from"./index-Bp3GeDhQ.js";import{n as te}from"./SketchOptions-DkZT37r7.js";import{d as U}from"./SketchViewModel-BRoViF94.js";import{a as F,y as oe,p as ie,k as se,l as re,f as le}from"./SelectionToolbar-BB-c1Flk.js";import"./SketchLabelOptions-CvfS2rfH.js";import"./GraphicsLayer-n_skBp8O.js";import"./isSupportedObject-BoTASd6h.js";import"./layerUtils-D3xv-kL2.js";import"./SnappingManager-BICxJWyY.js";import"./euclideanLengthMeasurementUtils-D9l_P3ES.js";import"./geometry2dUtils-2tpfJ_8-.js";import"./geodeticLengthOperator-i8Sfrrr_.js";import"./geodeticCurveType-CirnHLSB.js";import"./automaticAreaMeasurementUtils-DsNHnpIJ.js";import"./geodesicAreaMeasurementUtils-CpeJNyDK.js";import"./earcut-D9gy186-.js";import"./automaticLengthMeasurementUtils-B7UwQrK7.js";import"./directionModeIcons-Br5woIHu.js";const m={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},N={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function j(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(i=>j(i,t))??[]}const A=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(o){const s=this._get("measurementManager");o!==s&&(s&&s.managedElements.remove(this),this._set("measurementManager",o),o?.managedElements.add(this))}set budgetedLength(o){this.budgetedLength!==o&&(this._set("budgetedLength",o),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(o=>j(o,"calcite-action"))??[]}get activeChildElement(){const o=this.actionChildren.find(s=>s.properties?.active===!0);return o?(this._set("lastActiveKey",o.properties?.key),o):this.lastActiveKey?this.actionChildren.find(s=>s.properties?.key===this.lastActiveKey):void 0}_handleClick(o){o?.dataset&&"dataset"in o&&o.dataset.actionKey&&(this.lastActiveKey=o.dataset.actionKey)}};return r([l()],i.prototype,"priority",void 0),r([l()],i.prototype,"measurementManager",null),r([l()],i.prototype,"budgetedLength",null),r([l()],i.prototype,"actionChildren",null),r([l()],i.prototype,"activeChildElement",null),r([l()],i.prototype,"scale",void 0),r([l()],i.prototype,"slot",void 0),r([l()],i.prototype,"lastActiveKey",void 0),r([l()],i.prototype,"layout",void 0),i=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],i),i},D=Symbol("on-resize-handle-key");let M=class extends A(x){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return c("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(q(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),D)},afterRemoved:()=>this.removeHandles(D)},this.children)}};r([l()],M.prototype,"_measuredWidth",void 0),r([l()],M.prototype,"_measuredHeight",void 0),r([l()],M.prototype,"lengthOptions",null),r([l()],M.prototype,"_measuredElement",void 0),M=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],M);var S;let O=(S=class extends A(x){constructor(t){super(t),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return L({action:()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.OP),__vite__mapDeps([0,1])),"action-group":()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.P5),__vite__mapDeps([0,1])),"action-menu":()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.OR),__vite__mapDeps([0,1]))})}get minimumLength(){const{actionChildren:t,scale:i}=this;return t.length?this.allowCollapse?m.groupSeparator+m.action[i]*Math.min(t.length,2):m.groupSeparator+m.action[i]*t.length:0}get lengthOptions(){const{actionChildren:t,scale:i,minimumLength:o,allowCollapse:s,priority:n}=this,p=[o];if(t.length<=2||!s||n<1)return p;for(let d=1;d<t.length-1;d++)p.push(o+m.action[i]*d);return p}render(){if(!this.actionChildren.length)return c(H,null,void 0);const{budgetedLength:t,actionChildren:i,activeChildElement:o,layout:s,slot:n,scale:p}=this,d=Math.floor(t/m.action[p]),u=[],g=[];if(d>=i.length)u.push(...i);else{const h=o??u.at(0);if(u.push(...i.slice(0,d-1)),g.push(...i.slice(d-1)),h&&g.includes(h)){const[$]=g.splice(g.indexOf(h),1),v=u.pop();u.push($),v&&g.unshift(v)}}return c("calcite-action-group",{key:"overflow-button-group",layout:s,onclick:h=>this._handleClick(h.target),slot:n},u.map(h=>this._renderManagedAction(h)),g.length>0?c("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},c("calcite-action",{icon:N.overflow,key:"split-button-dropdown-trigger",scale:p,slot:"trigger",text:this.messagesCommon.more}),g.map(h=>this._renderManagedAction(h))):void 0)}_renderManagedAction(t){return c("calcite-action",{...t?.properties,"data-action-key":t?.properties?.key,text:t?.properties?.text??""})}},S.vnodeSelector="calcite-action-group",S);r([l()],O.prototype,"allowCollapse",void 0),r([l()],O.prototype,"minimumLength",null),r([l(),I("esri/t9n/common")],O.prototype,"messagesCommon",void 0),r([l()],O.prototype,"lengthOptions",null),O=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],O);let T=class extends Q{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new Y,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let o=0;for(const s of i){const n=s.lengthOptions[0];e.set(s,n),o+=n}for(const s of i)for(;o<t;){const n=e.get(s);if(!n)break;const p=s.lengthOptions.find(u=>u>n);if(!p)break;const d=o-n+p;if(d>t)break;e.set(s,p),o=d}for(const[s,n]of e)s.budgetedLength=n}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};r([l()],T.prototype,"measuredElement",void 0),r([l()],T.prototype,"managedElements",void 0),r([l()],T.prototype,"_sortedElements",null),r([l()],T.prototype,"availableLength",void 0),r([l()],T.prototype,"layout",void 0),T=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],T);const ne={splitButtonBase:"esri-split-button--split-part"};var P;let k=(P=class extends A(x){constructor(t){super(t),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return L({action:()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.OP),__vite__mapDeps([0,1])),"action-group":()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.P5),__vite__mapDeps([0,1])),"action-menu":()=>b(()=>import("./index-Bp3GeDhQ.js").then(t=>t.OR),__vite__mapDeps([0,1]))})}get minimumLength(){const t=this.actionChildren;return t.length?t.length===1?m.action[this.scale]+m.groupSeparator:this.allowCollapse?m.action[this.scale]+m.splitButtonPart[this.layout][this.scale]+m.groupSeparator:m.action[this.scale]*t.length+m.groupSeparator:0}get lengthOptions(){const{actionChildren:t,minimumLength:i,layout:o,scale:s,priority:n,allowCollapse:p}=this;if(t.length<2||n<0||!p)return[i];const d=m.groupSeparator+m.action[s]*t.length;return[m.groupSeparator+m.action[s]+m.splitButtonPart[o][s],d]}render(){if(!this.actionChildren.length)return c(H,null,void 0);const{actionChildren:t,minimumLength:i,budgetedLength:o,layout:s,slot:n,allowCollapse:p}=this,d=!p||t.length<2||o>i;return c("calcite-action-group",{key:"split-button-group",layout:s,onclick:u=>this._handleClick(u.target),slot:n},d?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:t,layout:i,actionChildren:o,scale:s,messagesCommon:n}=this,p=t??o.at(0);if(!p)return;const d=o.filter(u=>u!==p);return[this._renderManagedAction(p),c("calcite-action-menu",{key:"split-button-dropdown",label:n.more,overlayPositioning:"fixed",placement:i==="horizontal"?"bottom-end":"right-end"},c("calcite-action",{class:`${ne.splitButtonBase}--${i}--${this.scale}`,compact:i==="horizontal",icon:N.splitButton[i],key:"split-button-dropdown-trigger",scale:s,slot:"trigger",text:n.more}),d?.map(u=>this._renderManagedAction(u)))]}_renderUnSplit(){return this.actionChildren.map(t=>this._renderManagedAction(t))}_renderManagedAction(t){return c("calcite-action",{...t?.properties,"data-action-key":t?.properties?.key,text:t?.properties?.text??""})}},P.vnodeSelector="calcite-action-group",P);r([l()],k.prototype,"minimumLength",null),r([l()],k.prototype,"allowCollapse",void 0),r([l()],k.prototype,"lengthOptions",null),r([l(),I("esri/t9n/common")],k.prototype,"messagesCommon",void 0),k=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],k);const _="esri-responsive-toolbar",y={rulerBase:`${_}__ruler`,rulerBarHorizontal:`${_}__ruler--bar`,rulerBarVertical:`${_}__ruler--bar--vertical`,rulerPadVertical:`${_}__ruler--pad--vertical`,rulerPadHorizontal:`${_}__ruler--pad--horizontal`,bar:`${_}__bar`,barHorizontal:`${_}__bar--horizontal`,barVertical:`${_}__bar--vertical`,pad:`${_}__pad`,padVertical:`${_}__pad--vertical`,padHorizontal:`${_}__pad--horizontal`};let f=class extends x{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new T,this._managedWidgets=new Map}loadDependencies(){return L({"action-bar":()=>b(()=>import("./index-Bp3GeDhQ.js").then(e=>e.P6),__vite__mapDeps([0,1]))})}destroy(){this._measurementManager=W(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e=this.barStyle==="docked",t=this.layout==="vertical";return{[y.barHorizontal]:e&&!t,[y.barVertical]:e&&t,[y.bar]:e,[y.padHorizontal]:!e&&!t,[y.padVertical]:!e&&t,[y.pad]:!e}}render(){const{layout:e,scale:t,barStyle:i}=this,o={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},s=i==="docked"?e==="vertical"?y.rulerBarVertical:y.rulerBarHorizontal:e==="horizontal"?y.rulerPadHorizontal:y.rulerPadVertical;return c("div",null,c("div",{afterCreate:n=>{this._measurementManager?.connect(n)},class:this.classes(y.rulerBase,s)}),c("calcite-action-bar",{...o,classes:this._barClasses,floating:i!=="docked",overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(o=>o.properties?.key!==void 0&&"group-kind"in o.properties),t=new Set,i=e.map(o=>{const s=o.properties,n=s.key;t.add(n);const p=this.barStyle==="docked"?s.slot??void 0:void 0,d=s.priority??0,u=s["group-kind"]??"overflow-group",g=s["allow-collapse"]??!0,h=this._managedWidgets.get(n);if(h)return h.children=o.children,h.priority=d,"allowCollapse"in h&&(h.allowCollapse=g),h.slot=p,h.layout=this.layout,h.scale=this.scale,h.measurementManager=this._measurementManager,h;const $={scale:this.scale,priority:d,measurementManager:this._measurementManager,children:o.children,slot:p,layout:this.layout};switch(u){case"split-button":{const v=new k({...$,allowCollapse:g});return this._managedWidgets.set(n,v),v}case"overflow-group":{const v=new O({...$,allowCollapse:g});return this._managedWidgets.set(n,v),v}case"measured-content":{const v=new M({...$});return this._managedWidgets.set(n,v),v}}}).filter(K);return Array.from(this._managedWidgets.keys()).filter(o=>!t.has(o)).forEach(o=>{this._managedWidgets.get(o)?.destroy(),this._managedWidgets.delete(o)}),this._measurementManager?.allocate(),i.map(o=>o.render())}};r([l()],f.prototype,"scale",void 0),r([l({value:"horizontal"})],f.prototype,"layout",null),r([l()],f.prototype,"barStyle",void 0),r([l()],f.prototype,"_measurementManager",void 0),r([l()],f.prototype,"_managedWidgets",void 0),r([l()],f.prototype,"_barClasses",null),f=r([E("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],f);const C="esri-sketch",w={base:C,vertical:`${C}--vertical`,docked:`${C}-bar`,floating:`${C}-pad`,chipHorizontal:`${C}__selection-count-chip--horizontal`,chipVertical:`${C}__selection-count-chip--vertical`,chipVerticalSmall:`${C}__selection-count-chip--vertical--s`,popoverWrapper:`${C}__popover-wrapper`},ae={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand",text:"add-text"};let a=class extends x{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new F,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new U({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=t?.type==="2d",o=new oe({persistSelection:!1,visibleElements:new ie({chip:!1,lassoTool:i,operationTypeControls:!1,pan:!1,pointTool:!1,rectangleTool:i}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([R(()=>this.viewModel,s=>{this._viewModelHandlesGroup=z(this._viewModelHandlesGroup),s&&(this._viewModelHandlesGroup=X([s.on("create",()=>this.scheduleRender()),s.on("update",()=>this.scheduleRender()),s.on("delete",n=>this.emit("delete",n)),s.on("undo",()=>this.scheduleRender()),s.on("redo",()=>this.scheduleRender()),R(()=>s.layer,n=>{this._selectionToolbar&&(this._selectionToolbar.sources=n?[n]:null)}),R(()=>s.view,n=>{this._selectionToolbar&&(this._selectionToolbar.view=n)}),R(()=>s.state,()=>this.notifyChange("state"))]))},B),Z(()=>o.activeOperation,()=>this.viewModel.cancel()),o.on("complete",s=>this._onSelectionOperationComplete(s)),R(()=>{const{view:s,visibleElements:{selectionTools:n}}=this;return{lassoTool:s?.type!=="3d"&&!!n?.["lasso-selection"],rectangleTool:s?.type!=="3d"&&!!n?.["rectangle-selection"]}},s=>{Object.assign(o.visibleElements,s)},B)]),this._selectionToolbar=o}loadDependencies(){return L({action:()=>b(()=>import("./index-Bp3GeDhQ.js").then(e=>e.OP),__vite__mapDeps([0,1])),chip:()=>b(()=>import("./index-Bp3GeDhQ.js").then(e=>e.Ot),__vite__mapDeps([0,1])),popover:()=>b(()=>import("./index-Bp3GeDhQ.js").then(e=>e.OQ),__vite__mapDeps([0,1]))})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=z(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:o}=this.viewModel;return i==="polygon"&&o==="freehand"&&t?.includes("freehandPolygon")?"freehandPolygon":i==="polyline"&&o==="freehand"&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&W(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,o=e?.filter(s=>!!i.createTools?.[s]);return t?.type==="3d"?o?.filter(s=>s!=="multipoint"):o}create(e,t,i){const o=i?.createOptions??t;return this._activeCustomToolOptions=i,G(this.viewModel.create(e,o))}update(e,t){return G(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,o=this.customActions?.filter(s=>s.position==="selection-toolbar");return c("div",null,c("div",{classes:{[w.base]:!0,[w.floating]:e==="floating",[w.docked]:e==="docked",[w.vertical]:t==="vertical"}},c(f,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),c("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??0},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),o?.map(s=>this._renderToolbarItem(s))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:o,visibleElements:s}=this;if(!this._calcitePopoverReferenceElement)return;const n={directionModePicker:s.directionModePicker,labelsToggle:s.labelsToggle,tooltipsToggle:s.tooltipsToggle},p=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return c("calcite-popover",{closable:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:p,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:d=>this._remeasurePopoverSizes(d.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},c("div",{class:w.popoverWrapper},Object.values(n).includes(!0)?c(se,{sketchOptions:o.sketchOptions,viewType:i?.type,visibleElements:new re(n)}):void 0,s.snappingControls&&i&&t?c(le,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:s.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e?.length?c(f,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return c("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??10,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(o=>{o.position==="settings-before"?t.push(o):o.position==="settings-after"&&e.push(o)});const i=[...t.map(o=>this._renderToolbarItem(o)),this._renderSettingsMenuButton(),...e.map(o=>this._renderToolbarItem(o))].filter(K);if(i.length)return c("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??1e3,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=this.customActions?.filter(s=>s.position==="before-selection-set"),i=this.customActions?.filter(s=>s.position==="after-selection-set"),o=this.groupCollapsePriorities?.get("selectionSet")??100;return[c("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:o,slot:e},this._renderFeatureCountChip()),c("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:o,slot:e},t?.map(s=>this._renderToolbarItem(s)),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map(s=>this._renderToolbarItem(s)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(i=>this._renderBuiltInCreateToolItem(i))??[],t=this.customToolOptions?.flatMap(i=>this._renderCustomToolItem(i))??[];return c("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??100},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:ae[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:o,updateGraphics:{length:s}}=this,n=V(t.selectedCount,{count:s}),p=i==="s"?99:999,d=s>p?V(t.selectedCountTruncated,{truncated:p}):s,u=i==="s"&&e==="vertical",g=u?`${o}-selection-chip-small`:`${o}-selection-chip`;return[u?c("span",{classes:{[w.chipVertical]:!0,[w.chipVerticalSmall]:this.scale==="s"},id:g,tabIndex:0,title:n},d):c("calcite-chip",{appearance:"outline",class:e==="horizontal"?w.chipHorizontal:w.chipVertical,id:g,kind:"brand",label:n,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?n:void 0},e==="vertical"?d:n)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:o,onclick:s,active:n,flipRTL:p,afterCreate:d,afterUpdate:u,afterRemoved:g}){const h=`${this.id}-${e}`;return[c("calcite-action",{active:n,afterCreate:d,afterRemoved:g,afterUpdate:u,bind:this,"data-testid":e,disabled:o||this.state==="disabled",icon:i,iconFlipRtl:p??!1,id:h,key:e,onclick:s,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),o=t?.style;if(!(t&&i&&o&&this.view?.container?.contains(t)))return;const s=this._calcitePopoverReferenceElement;if(!s)return;const{bottom:n,top:p}=s.getBoundingClientRect();if(this.layout==="horizontal"){const u=n<i.height/2;u!==(this._relativeLocation==="top")&&(this._relativeLocation=u?"top":"bottom"),u?(o?.setProperty("--sketch-view-height-offset",n-i.top+"px"),o?.setProperty("--sketch-view-margin-offset","30px")):(o?.setProperty("--sketch-view-height-offset",i.bottom-p+"px"),o?.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(o.setProperty("--sketch-view-height-offset","15px"),o.setProperty("--sketch-view-margin-offset","15px"));const d=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;o.setProperty("--sketch-popover-header-offset",`${d}px`)}catch(t){J.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,i){const o=this._activeCustomToolOptions;if(i||o){if(i?.toolKey===o?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const o=t.tool,s=i.length>1&&o==="reshape"?"transform":o;this.update(i,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};r([l()],a.prototype,"_activeCustomToolOptions",void 0),r([l()],a.prototype,"activeTool",null),r([l({readOnly:!0})],a.prototype,"activeTooltip",null),r([l({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh","text"]);return e.filter(i=>t.has(i))}})],a.prototype,"availableCreateTools",void 0),r([l({readOnly:!0})],a.prototype,"createGraphic",null),r([l()],a.prototype,"creationMode",null),r([l()],a.prototype,"customToolOptions",void 0),r([l()],a.prototype,"customActions",void 0),r([l()],a.prototype,"defaultCreateOptions",null),r([l()],a.prototype,"defaultUpdateOptions",null),r([l()],a.prototype,"icon",null),r([l()],a.prototype,"label",null),r([l()],a.prototype,"labelOptions",null),r([l()],a.prototype,"layer",null),r([l({type:["horizontal","vertical"],value:"horizontal"})],a.prototype,"layout",null),r([l({value:"m"})],a.prototype,"scale",null),r([l()],a.prototype,"toolbarKind",void 0),r([l()],a.prototype,"contextualToolLocation",void 0),r([l()],a.prototype,"groupCollapsePriorities",void 0),r([l()],a.prototype,"groupAllowCollapseOptions",void 0),r([l(),I("esri/widgets/Sketch/t9n/Sketch")],a.prototype,"messages",void 0),r([l(),I("esri/t9n/common")],a.prototype,"messagesCommon",void 0),r([l()],a.prototype,"snappingOptions",null),r([l()],a.prototype,"state",null),r([l()],a.prototype,"tooltipOptions",null),r([l({readOnly:!0})],a.prototype,"updateGraphics",null),r([l({type:te,nonNullable:!0})],a.prototype,"valueOptions",null),r([l()],a.prototype,"view",null),r([l({type:U}),ee(["create","update","undo","redo"])],a.prototype,"viewModel",null),r([l({type:F,nonNullable:!0})],a.prototype,"visibleElements",void 0),r([l()],a.prototype,"_effectiveAvailableCreateTools",null),r([l()],a.prototype,"_defaultViewModel",void 0),r([l()],a.prototype,"_calcitePopoverReferenceElement",void 0),r([l()],a.prototype,"_relativeLocation",void 0),r([l()],a.prototype,"_popoverOpen",void 0),a=r([E("esri.widgets.Sketch")],a);const Ee=a;export{Ee as default};
