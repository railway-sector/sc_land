import{BX as _e,ay as T,Aj as je,Ie as ye,Il as se,Je as ie,In as Oe,Id as ke,Ip as Te,Iq as We,V as De,Ir as Fe,Iv as Le,JY as He,IB as Je,JZ as ze,IL as Be,IJ as Ee,aC as ae,sD as Ge,ra as we,xu as ve,am as Ve,Jc as Ke,gD as C,ml as c,fw as qe,z8 as Ce,J_ as N,xz as Ne,gU as ne,be as h,Cj as Qe,a0 as Xe,J$ as Ye,aD as B,jx as p,AX as ee,xC as D,pN as Me,pQ as W,aJ as v,m3 as Pe,gH as Ze,bg as _,bf as j,xA as et,Fr as tt,bh as M,K0 as Q,K1 as rt,K2 as st,em as it,AZ as xe,bi as w,pa as at,jy as nt,f as ot,bJ as ct,mo as lt,df as S,m5 as oe,as as E,Co as ce,An as le,et as q,or as de,bj as ue,K3 as ge,A$ as he,aF as X,Fp as dt}from"./index-CgzAF5Ey.js";import{j as ut,g as gt,u as fe,v as ht,C as z,e as ft,i as pe,n as Ue,x as Y,U as pt,S as be,l as bt,a as mt,c as $t}from"./sliceToolConfig-B55WsN8B.js";import{c as _t}from"./SlicePlane-qYrw7-2F.js";import{o as wt,p as vt,w as Ct,r as Mt,Y as Pt,t as R}from"./ShadedColorMaterial.glsl-BINTjINc.js";import{f as Ae}from"./DefaultLayouts-B06_QInD.js";import{i as xt}from"./TriangleMaterial-DICTJlsX.js";import{m as H}from"./ColorMaterial.glsl-QTgC0gy-.js";const Ut=T(0,0,0,.04);function At({accentColor:e}){return _e(e,.5)}function It({accentColor:e}){return _e(e,.7)}function Ie(e){const t=new je,{vertex:n,fragment:a,attributes:s,varyings:i}=t;return ye(n,e),s.add("position","vec3"),s.add("uv0","vec2"),i.add("vUV","vec2"),n.main.add(se`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),a.uniforms.add(new ie("backgroundColor",r=>r.backgroundColor),new ie("gridColor",r=>r.gridColor),new Oe("gridWidth",r=>r.gridWidth)).main.add(se`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const St=Object.freeze(Object.defineProperty({__proto__:null,build:Ie},Symbol.toStringTag,{value:"Module"}));class Rt extends ke{constructor(){super(...arguments),this.backgroundColor=T(1,0,0,.5),this.gridColor=T(0,1,0,.5),this.gridWidth=4}}class jt extends Te{constructor(t,n){super(t,n,new We(St,()=>De(()=>Promise.resolve().then(()=>Bt),void 0)),Ae.locations)}initializePipeline(){return Fe({blending:He,depthTest:{func:513},colorWrite:Le})}}class yt extends xt{constructor(t){super(t,kt),this.produces=new Map([[8,n=>Je(n)]]),this._configuration=new ze}get visible(){return!0}createGLMaterial(t){return new Ot(t)}createBufferWriter(){return new Be(Ae)}getConfiguration(){return this._configuration}}class Ot extends Ee{constructor(t){super(t)}beginSlot(t){return this.getTechnique(jt,t)}}class kt extends Rt{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}class Tt extends wt{constructor(t){super(t),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=T(1,0,0,1),this._backgroundColor=T(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){ae(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){ae(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new yt(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(t){t(this._material)}createGeometries(t){if(this._material!=null){const n=Ge(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material?.setParameters(this._materialParameters)}}function Xt(e,t,n,a,s,i,r,o){return Wt(t,r.worldUpAtPosition(e,c.get()),s,i,o.basis1,o.basis2),h(o.basis1,o.basis1,n),h(o.basis2,o.basis2,a),v(o.origin,e),Ce(o.basis2,o.basis1,o.origin,o.plane),o}function Wt(e,t,n,a,s,i){const r=j(e,t),o=c.get(),l=c.get();switch(a===0?Math.abs(r)>ft?1:2:a){case 2:{const u=Math.abs(r)<=pe?e:n.viewUp;w(o,u,t),v(l,t);break}case 1:w(o,n.viewUp,t),w(l,t,o);break;case 3:{const u=Math.abs(r)<=pe?t:n.viewUp;w(o,u,e),w(l,e,o);break}}const d=w(c.get(),o,l);j(d,n.viewForward)>0&&h(l,l,-1),M(s,o),M(i,l)}function Dt(e,t,n){const a=t.worldUpAtPosition(e.origin,c.get()),s=e.basis1,i=re(e,a),r=Math.round(i/y)*y;return N(e,r-i,s,n)}function Yt(e,t,n,a,s,i){const r=v(c.get(),s.origin);p(r,r,h(c.get(),s.basis1,e.direction[0]<0?1:-1)),p(r,r,h(c.get(),s.basis2,e.direction[1]<0?1:-1));const o=C(s.basis1),l=C(s.basis2),d=_(c.get(),n,r),u=_(c.get(),t,r);let g=0,b=0;if(Re(e)){const V=Z(s),O=Z(i);g=o-.5*e.direction[0]*j(s.basis1,u)/o,b=l-.5*e.direction[1]*j(s.basis2,u)/l;const F=O/V;g*=F,b*=F}const f=g+.5*e.direction[0]*j(s.basis1,d)/o,$=b+.5*e.direction[1]*j(s.basis2,d)/l,A=h(c.get(),s.basis1,f/o),P=h(c.get(),s.basis2,$/l);(f<=0||me(i.origin,A,a)<=fe)&&v(A,i.basis1),($<=0||me(i.origin,P,a)<=fe)&&v(P,i.basis2);const m=v(c.get(),r);return p(m,m,h(c.get(),A,e.direction[0]<0?-1:1)),p(m,m,h(c.get(),P,e.direction[1]<0?-1:1)),et(m,A,P,i)}function Zt(e,t){return ht*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function er(e,t,n,a){const s=w(c.get(),t,n);return w(s,s,t),Pe(e,s,a)}function tr(e,t){return Ct(e.basis1,e.basis2,e.origin,t)}function rr(e,t,n,a){const s=t.worldUpAtPosition(e.origin,c.get()),i=c.get();switch(n){case 1:v(i,s);break;case 2:v(i,e.basis1)}return Pe(e.origin,i,a)}function sr(e,t,n,a){const s=te(n,2),i=D.get();tt(i,t,s.edge*Math.PI/2);const r=M(c.get(),s.basis);let o=h(c.get(),r,s.direction*a.computeScreenPixelSizeAt(s.position)*z);p(o,o,s.position);const l=a.projectToRenderScreen(o,Q(c.get())),d=Ft(a,l);rt(a,l,J),M(J.direction,J.direction);const u=c.get();!d&&st(n,J,u)&&(o=u),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=it(o),d?e.state|=G:e.state&=~G}function Ft(e,t){if(t==null)return!1;const[n,a,s,i]=e.viewport,r=Math.min(s,i)/16;let o=!0;return t[0]<n+r?(t[0]=n+r,o=!1):t[0]>n+s-r&&(t[0]=n+s-r,o=!1),t[1]<a+r?(t[1]=a+r,o=!1):t[1]>a+i-r&&(t[1]=a+i-r,o=!1),o}function ir(e,t,n,a){const s=C(a.basis1),i=C(a.basis2),r=Se(a),o=Z(a),l=B(c.get(),0,0,0);p(l,h(c.get(),a.basis1,t.direction[0]),h(c.get(),a.basis2,t.direction[1])),p(l,a.origin,l);let d=0,u=1;if(Re(t))t.direction[0]===1&&t.direction[1]===-1?d=y:t.direction[0]===1&&t.direction[1]===1?d=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(d=3*Math.PI/2),u=o;else{const b=t.direction[0]!==0?1:2;d=b===1?y:0,u=(b===1?i:s)-r}const g=ee(D.get(),d);Me(g,g,B(c.get(),u,u,u)),W(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=l}function ar(e,t,n,a){const s=a.worldUpAtPosition(n.origin,c.get()),i=te(n,0),r=ee(D.get(),i.edge*Math.PI/2);xe(r,r,-re(n,s)),W(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=i.position}function nr(e,t,n){const a=te(n,1),s=ee(D.get(),a.edge*Math.PI/2);xe(s,s,y),W(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}function te(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:p(c.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:p(c.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:_(c.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:_(c.get(),e.origin,e.basis2),edge:t}}}function me(e,t,n){const a=n.projectToRenderScreen(p(c.get(),e,t),Q(c.get())),s=n.projectToRenderScreen(_(c.get(),e,t),Q(c.get()));return a&&s?at(_(a,a,s)):0}function Se(e){const t=C(e.basis1),n=C(e.basis2);return gt*Math.min(t,n)}function Z(e){return Se(e)}function Re(e){return e.direction[0]!==0&&e.direction[1]!==0}function or(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new vt({view:e,attached:!1,color:It(e.effectiveTheme),width:ut,renderOccluded:4,geometry:[t],isDecoration:!0})}function cr(e){return new Tt({view:e,attached:!1,backgroundColor:Ut,gridColor:At(e.effectiveTheme),gridWidth:4,renderOccluded:4,isDecoration:!0})}function lr(e,t,n,a=new _t){if(e==null)return null;const{renderCoordsHelper:s}=t,i=s.fromRenderCoords(e.origin,new Ve({spatialReference:t.spatialReference}));if(i==null)return null;const r=Ke(i,n);if(r==null)return null;a.position=r;const o=2*C(e.basis1),l=2*C(e.basis2),d=we.renderUnitScaleFactor(t.spatialReference,n);a.width=o*d,a.height=l*d;const u=s.worldUpAtPosition(e.origin,c.get());return a.tilt=qe(re(e,u)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function re(e,t){return Ye(t,e.basis2,e.basis1)+y}function Lt(e,t,n,a,s,i,r=ve()){return i.toRenderCoords(e,r.origin)?(i.worldBasisAtPosition(r.origin,0,r.basis1),i.worldBasisAtPosition(r.origin,1,r.basis2),Ce(r.basis2,r.basis1,r.origin,r.plane),N(r,-ne(t),Ne(r),r),N(r,ne(n),r.basis1,r),h(r.basis1,r.basis1,a/2),h(r.basis2,r.basis2,s/2),Qe(r),r):(Xe.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function dr(e,t){if(e?.position==null)return null;const n=Mt(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const a=we.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*a,i=e.height*a;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:i}}function ur(e,t,n,a=ve()){if(e==null)return null;const s=Lt(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return n.tiltEnabled||s==null||Dt(s,t.renderCoordsHelper,s),s}const U=16,G=32,J=Ze(),y=Math.PI/2,gr=16,hr=32;function fr(e){return(e.type==="building-scene-3d"?e:null)!=null}let pr=class extends Pt{constructor(t,n){const a=new nt({width:1,renderOccluded:4,isDecoration:!0},t.state.isGlobal),s=new H({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new H({cullFace:2,renderOccluded:16,isDecoration:!0}),r=new H({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new H({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:t,...Ht({offsetMode:n,tubeMaterial:s,tipMaterial:i,capMaterial:r,outlineMaterial:o,calloutMaterial:a})}),this._themeHandle=ot(()=>t.effectiveTheme.accentColor,l=>{const d=lt(l),u=S.toUnitRGBA(l),g=S.toUnitRGBA(d),b=S.toUnitRGBA(S.blendColors(d,l,.4)),f=S.toUnitRGBA(S.blendColors(d,l,.14));a.setParameters({color:u}),s.setParameters({color:f}),i.setParameters({color:g}),r.setParameters({color:b}),o.setParameters({color:u})},ct)}destroy(){this._themeHandle.remove(),super.destroy()}};function Ht({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:a,outlineMaterial:s,calloutMaterial:i}){const r=e===0?z:0,o=[X(r,0,-be/2),X(r,0,be/2)],l=zt(o),d=$e({vertices:o,padding:0,materials:{tube:t,tip:n,cap:a}}),u=$e({vertices:o,padding:pt,materials:{tube:s,tip:s,cap:s}}),g=oe(i,[[r,0,0],[r-z,0,0]]),b=oe(i,[[r,0,0],[r-z,0,0]]);return{renderObjects:[...d.normal.map(f=>new R(f,1|U)),...u.normal.map(f=>new R(f,1|U)),new R(g,1|U|G),...d.focused.map(f=>new R(f,2|U)),...u.focused.map(f=>new R(f,2|U)),new R(b,2|U|G)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:Ue,state:U}}function $e({vertices:e,padding:t,materials:n}){const a=s=>{const i=e.slice(),r=_(c.get(),i[0],i[1]);M(r,r);const o=_(c.get(),i[i.length-1],i[i.length-2]);if(M(o,o),t>0){const k=h(E(),o,-t);i[i.length-1]=p(k,k,i[i.length-1]);const I=h(E(),r,-t);i[0]=p(I,I,i[0])}const l=s?$t:1,d=Y*l,u=Ue*l,g=ce(D.get());if(t>0){const k=d/4,I=B(c.get(),0,k,0),L=1+t/k;le(g,g,I),Me(g,g,B(c.get(),L,L,L)),le(g,g,h(I,I,-1/L))}const b=ce(q()),f=X(0,1,0),$=de(q(),ue(ge.get(),f,o));$[12]=i[i.length-1][0],$[13]=i[i.length-1][1],$[14]=i[i.length-1][2],W($,$,g);const A=n.tube,P=Jt(bt*(s?mt:1)+t,i,A);P.transformation=b;const m=[P],V=n.tip,O=he(V,d,u,24,!1,!1,!0);O.transformation=$,m.push(O);const F=n.cap,K=he(F,d,u,24,!1,!0,!1);K.transformation=$,m.push(K);const x=de(q(),ue(ge.get(),f,r));return x[12]=i[0][0],x[13]=i[0][1],x[14]=i[0][2],W(x,x,g),m.push(O.instantiate({transformation:x})),m.push(K.instantiate({transformation:x})),m};return{normal:a(!1),focused:a(!0)}}function Jt(e,t,n){const a=[];for(let i=0;i<12;i++){const r=i/12*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}return dt(n,a,t,[],[],!1)}function zt(e,t){const n=_(E(),e[e.length-1],e[e.length-2]);M(n,n),h(n,n,Y),p(n,n,e[e.length-1]);{const a=_(E(),e[0],e[1]);return M(a,a),h(a,a,Y),p(a,a,e[0]),[a,...e,n]}}const Bt=Object.freeze(Object.defineProperty({__proto__:null,build:Ie},Symbol.toStringTag,{value:"Module"}));export{gr as C,fr as L,ur as R,G as S,dr as U,pr as _,Xt as a,Re as b,sr as c,nr as d,It as e,Ut as f,At as g,or as h,Z as i,cr as j,hr as k,ir as l,Zt as n,er as o,rr as r,tr as s,Yt as t,ar as u,lr as w,U as x};
