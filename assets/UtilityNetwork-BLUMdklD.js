const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/queryNamedTraceConfigurations-CdM7NO5B.js","assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/typeUtils-Dszw1S4V.js","assets/networkFieldUtils-CaYZrGFV.js","assets/TelecomNetworkElement-CwMWpoWJ.js","assets/NetworkElement-te1zus-P.js","assets/QueryNamedTraceConfigurationsParameters-BIqAQDZA.js","assets/validateNetworkTopology-Dv415trD.js","assets/ValidateNetworkTopologyParameters-BBrz8UHO.js","assets/CircuitManager-MxYA2BvO.js","assets/UnitIdentifierManager-D01VXTmE.js","assets/queryAssociations-DSMK35U6.js","assets/Association-BGd3HRsE.js","assets/QueryAssociationsParameters-7IvPRXrO.js","assets/synthesizeAssociationGeometries-B46ixSOo.js","assets/SynthesizeAssociationGeometriesParameters-BsOcMuhi.js","assets/trace-BOaTdmtt.js","assets/TraceParameters-CloPnVkP.js"])))=>i.map(i=>d[i]);
import{_ as o,e as s,g,ch as k,cR as Pt,cE as Mt,cv as W,hL as xt,cw as Lt,a4 as Y,U as T,ja as Gt,dd as Bt,r7 as Xt,dL as Zt,f7 as Dt,h4 as te,dq as Jt,F1 as Ot,dz as gt,yB as ee,F2 as re,fe as oe,$ as at,g0 as se,cs as Ut,dD as At,dy as Ct,dt as $t,aa as zt,ao as qt,dY as ie,b3 as ne,bD as ae,fa as le,cI as ft,qe as Vt,cm as ot,tu as ue,Y as de,dM as vt,d6 as ce,cn as mt,ad as St,f as Ht,bI as pe,aQ as ye,b4 as me,ae as he,f8 as we,eX as ge,vS as fe}from"./index-BrQW8HOS.js";import{c as ut,e as dt,o as bt,i as J,t as It,s as be,r as Ie,a as ve}from"./typeUtils-Dszw1S4V.js";import{t as Te}from"./networkFieldUtils-CaYZrGFV.js";import{s as K}from"./TelecomNetworkElement-CwMWpoWJ.js";import{s as Wt}from"./NetworkElement-te1zus-P.js";let R=class extends k{constructor(t){super(t),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};o([s({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],R.prototype,"moment",void 0),o([s({type:Boolean,json:{write:!0}})],R.prototype,"fullUpdate",void 0),o([s({type:Boolean,json:{write:!0}})],R.prototype,"validateErrorsCreated",void 0),o([s({type:Boolean,json:{write:!0}})],R.prototype,"exceededTransferLimit",void 0),o([s({type:[Object],json:{write:!0}})],R.prototype,"serviceEdits",void 0),o([s({type:[Object],json:{write:!0}})],R.prototype,"discoveredSubnetworks",void 0),R=o([g("esri.rest.networks.support.ValidateNetworkTopologyResult")],R);const Se=R,ke=Pt()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let G=class extends Se{constructor(t){super(t),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const r={...t,query:{f:"json"}},{data:i}=await W(this.statusUrl,r);return this.read(i),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(t={}){const{interval:r=1e3,statusCallback:i}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(xt()),this.checkJobStatus().then(d=>{const{status:u}=d;switch(this.status=u,u){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":i&&i(this)}},d=>{this._clearTimer(),a(d)})},r);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};o([s()],G.prototype,"editsResolver",void 0),o([s({type:String,json:{write:!0}})],G.prototype,"statusUrl",void 0),o([Mt(ke)],G.prototype,"status",void 0),o([s({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],G.prototype,"submissionTime",void 0),o([s({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],G.prototype,"lastUpdatedTime",void 0),G=o([g("esri.networks.support.TopologyValidationJobInfo")],G);const je=G;function Ne(e,t,r="from"){const{fromRuleElement:i,viaRuleElement:n,toRuleElement:a}=Yt(e),l=[];switch(e.ruleType){case 2:case 3:r==="from"&&U(t,i,!1)?l.push(a):r==="to"&&U(t,a,!1)&&l.push(i);break;case 4:case 1:U(t,i,!0)?l.push(a):U(t,a,!0)&&l.push(i);break;case 5:n&&(U(t,n,!0)?(l.push(i),l.push(a)):(U(t,i,!0)||U(t,a,!0))&&l.push(n));break;default:return[]}return l}function nt(e,t,r){const{fromRuleElement:i,viaRuleElement:n,toRuleElement:a}=Yt(e);switch(e.ruleType){case 2:case 3:return ct(t,r,i,a,!1,!1);case 4:case 1:return ct(t,r,i,a,!0,!0);case 5:return ct(t,r,i,n,!0,!0)||ct(t,r,a,n,!0,!0);default:return!1}}function ct(e,t,r,i,n,a){if(!r||!i)return!1;const l=U(e,r,a),d=U(t,i,a);if(n){const u=U(e,i,a),c=U(t,r,a);return l&&d||u&&c}return l&&d}function _e(e,t){const r=e.terminal?.terminalId,i=t.terminalId;return r==null&&i==null||(r===1?i==null||i===1:r===i)}function U(e,t,r){const{assetGroupCode:i,assetTypeCode:n}=e;return("layerId"in e?e.layerId===t.networkSource?.layerId:e.networkSourceId===t.networkSource?.sourceId)&&(i==null||i===t.assetGroup?.assetGroupCode)&&(n==null||n===t.assetType?.assetTypeCode)&&(!r||!("terminalId"in e)||_e(t,e))}function Yt(e){return{fromRuleElement:{networkSource:e.fromNetworkSource,assetGroup:e.fromAssetGroup,assetType:e.fromAssetType,terminal:e.fromTerminal},viaRuleElement:e.viaNetworkSource?{networkSource:e.viaNetworkSource,assetGroup:e.viaAssetGroup,assetType:e.viaAssetType,terminal:e.viaTerminal}:void 0,toRuleElement:{networkSource:e.toNetworkSource,assetGroup:e.toAssetGroup,assetType:e.toAssetType,terminal:e.toTerminal}}}function Z(e){let t=null,r=null,i=null;if(Gt(e))t=Tt(e),[r,i]=Ee(e);else if(Bt(e)){t=e.parent?.layerId??null;const[n]=ht(e);n===e.subtypeField&&(r=e.subtypeCode)}else t=e.layerId??null;return{layerId:t,assetGroupCode:r,assetTypeCode:i}}function Tt(e){const{sourceLayer:t}=e;let r;return Xt(t)?r=t.layerId:Bt(t)&&(r=t.parent?.layerId),r??null}function Ee(e){const[t,r]=ht(e.sourceLayer);return[t?e.attributes[t]:null,r?e.attributes[r]:null]}function ht(e){return!e||!("fieldsIndex"in e)?[null,null]:[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]}async function We(e,t){const r=e.layers,i=e.layerInfos,n=e.returnGeometry||!1,a=e.outSpatialReference;return await Promise.all(r.map(async l=>{await l.load()})),(await Promise.all(r.map(async l=>{const d=i.find(p=>p.layerUrl===l.parsedUrl?.path);if(!d?.objectIds?.length)return{layer:l,featureSet:void 0};const u=l.createQuery();u.returnGeometry=n,u.outFields=d.outFields||["*"],u.outSpatialReference=a,u.gdbVersion=l.gdbVersion,u.objectIds=d.objectIds;const c=Zt.fromJSON(await Dt(l,u));return c.features.forEach(p=>{p.layer=p.sourceLayer=l}),{layer:l,featureSet:c}}))).filter(l=>l.featureSet!==void 0)}async function Rt(e,t){if(e==="Utility Network Layer"){const{default:r}=await T(()=>Promise.resolve().then(()=>xe),void 0);return new r({layerUrl:t})}return null}async function Le(e){let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof Lt||(t={...t,portalItem:new Lt(t.portalItem)});const r=t.portalItem;if(await r.load(),r.type!=="Feature Service")throw new Y("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});const i=r.url,n=await W(i,{responseType:"json",query:{f:"json"}}),a="Network Layer";if(n.data.type?.includes(a))return Rt(n.data.type,i);if(n.data.layers){const l=n.data.layers.find(d=>d.type.includes(a));if(l){const d=`${i}/${l.id}`;return Rt(l.type,d)}}return null}let w=class extends te(Jt){static fromPortalItem(e){return Le(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this._historicMoment=null,this._gdbVersion=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=t=>{const{serviceUrl:r,gdbVersion:i,result:n}=t,a=r===this.featureServiceUrl,l=Ot(r,i,this.gdbVersion);a&&l&&n.then(d=>{gt(r,i)&&(this.historicMoment=d.historicMoment)})},this._updateMomentHandler=t=>{const{serviceUrl:r,gdbVersion:i,moment:n}=t,a=r===this.featureServiceUrl,l=Ot(r,i,this.gdbVersion);a&&l&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([ee(this._applyEditsHandler),re(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{oe(e)||at.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get loaded(){return super.loaded}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return se(this.layerUrl)}get featureServiceUrl(){return Ut(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return Ut(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}get gdbVersion(){return this._gdbVersion}set gdbVersion(e){this._gdbVersion=e}get historicMoment(){return this._historicMoment}set historicMoment(e){this._historicMoment=e}async load(e){return this.addResolvingPromise(this._load(e)),this}async _load(e){await Promise.all([this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e),this._fetchLayerMetaData(this.layerUrl,e)])}getLayerIdBySourceId(e){if(!this.dataElement)return null;const t=this._layerIdBySourceId.get(e);if(t!=null)return t;const r=this.dataElement.domainNetworks,i=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return i>=0?i:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const t=this._sourceIdByLayerId.get(e);if(t!=null)return t;const r=this.dataElement.domainNetworks,i=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return i>=0?i:null}getObjectIdsFromElements(e){const t=[],r=new Map;for(const n of e){const a=this.getLayerIdBySourceId(n.networkSourceId);if(a==null)continue;let l=r.get(a);l===void 0&&(l=[]),l.push(n.objectId),r.set(a,l)}const i=this.featureServiceUrl;return r.forEach((n,a)=>t.push({layerUrl:`${i}/${a}`,objectIds:n})),t}async queryNamedTraceConfigurations(e,t){const[{queryNamedTraceConfigurations:r},{default:i}]=await Promise.all([T(()=>import("./queryNamedTraceConfigurations-CdM7NO5B.js"),__vite__mapDeps([0,1,2,3,4,5,6])),T(()=>import("./QueryNamedTraceConfigurationsParameters-BIqAQDZA.js"),__vite__mapDeps([7,1,2]))]),n=this.networkServiceUrl,a=i.from(e);return(await r(n,a,{...t}))?.namedTraceConfigurations}async validateTopology(e,t){if(!e.validateArea)throw new Y("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:r},{default:i}]=await Promise.all([T(()=>import("./validateNetworkTopology-Dv415trD.js"),__vite__mapDeps([8,1,2,3,4,5,6])),T(()=>import("./ValidateNetworkTopologyParameters-BBrz8UHO.js"),__vite__mapDeps([9,1,2,3]))]),n=i.from(e);gt(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=At,await Ct(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const a=this.networkServiceUrl,l=this.featureServiceUrl,d=$t(l,null,this.gdbVersion,!0),u=await r(a,n,{...t});if(u?.serviceEdits){const c=[];for(const p of u.serviceEdits){const{editedFeatures:h}=p,f=h?.spatialReference?new zt(h.spatialReference):null;c.push({layerId:p.layerId,editedFeatures:{adds:h?.adds?.map(I=>pt(I,f))||[],updates:h?.updates?.map(I=>({original:pt(I[0],f),current:pt(I[1],f)}))||[],deletes:h?.deletes?.map(I=>pt(I,f))||[],spatialReference:f}})}d.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:c,exceededTransferLimit:!1,historicMoment:u.moment})}return u}async submitTopologyValidationJob(e,t){let r=null;if(!e.validateArea)throw new Y("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const c=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(await W(c,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:i},{default:n}]=await Promise.all([T(()=>import("./validateNetworkTopology-Dv415trD.js"),__vite__mapDeps([8,1,2,3,4,5,6])),T(()=>import("./ValidateNetworkTopologyParameters-BBrz8UHO.js"),__vite__mapDeps([9,1,2,3]))]),a=n.from(e);gt(this.featureServiceUrl,this.gdbVersion||null)?(a.sessionID=At,await Ct(this.featureServiceUrl,this.gdbVersion,!0)):a.sessionID=null,a.gdbVersion=this.gdbVersion||r;const l=this.networkServiceUrl,d=this.featureServiceUrl?$t(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,u=await i(l,a,{...t});return new je({statusUrl:u,editsResolver:d})}getSourceTypeById(e){if(!this.dataElement)return null;for(const t of this.dataElement.domainNetworks)for(const r of[t.edgeSources??[],t.junctionSources??[]])for(const i of r)if(i.sourceId===e)return r===t.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,t,r,i,n){for(const a of e)for(const l of[a.edgeSources??[],a.junctionSources??[]])for(const d of l)if(d[r]===n)return t.set(n,d[i]),d[i];return-1}async _fetchLayerMetaData(e,t){const r=await W(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,t,r){if(this.dataElement)return;const i=await W(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...r}).then(n=>n.data.layerDataElements?.[0]);i&&this.read(i,{origin:"service"})}};function pt(e,t){return new qt({attributes:e.attributes,geometry:ie({...e.geometry,spatialReference:t})})}o([s({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],w.prototype,"id",void 0),o([s({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],w.prototype,"title",void 0),o([s({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],w.prototype,"layerUrl",void 0),o([s({type:Object,json:{origins:{service:{read:!0}},read:!1}})],w.prototype,"dataElement",void 0),o([s({type:ne,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],w.prototype,"fullExtent",void 0),o([s({type:zt,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],w.prototype,"spatialReference",void 0),o([s({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],w.prototype,"type",void 0),o([s({readOnly:!0})],w.prototype,"datasetName",null),o([s({readOnly:!0})],w.prototype,"owner",null),o([s({readOnly:!0})],w.prototype,"schemaGeneration",null),o([s({readOnly:!0})],w.prototype,"parsedUrl",null),o([s({readOnly:!0})],w.prototype,"featureServiceUrl",null),o([s({readOnly:!0})],w.prototype,"networkServiceUrl",null),o([s({readOnly:!0})],w.prototype,"layerId",null),o([s()],w.prototype,"sourceJSON",void 0),o([s({readOnly:!0})],w.prototype,"networkSystemLayers",null),o([s({type:String})],w.prototype,"gdbVersion",null),o([s({type:Date})],w.prototype,"historicMoment",null),o([s()],w.prototype,"_historicMoment",void 0),o([s()],w.prototype,"_gdbVersion",void 0),w=o([g("esri.networks.Network")],w);const Oe=w;let B=class extends ae(Jt){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=W}initialize(){}async load(e){const t=this.rulesLayer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(t),this}getFeaturesCanAssociateWithClause(e,t,r){const i=new Map,[n,a]=ht(e.sourceLayer);if(!n||!a)return"";const l=Z(e),d=Z(t);r.forEach(c=>{const{type:p,direction:h}=c;this._getRulesForAssociationType(p).forEach(f=>{Ne(f,l,h).filter(I=>I.networkSource?.layerId===d.layerId).forEach(I=>{const S=I.assetGroup?.assetGroupCode,V=I.assetType?.assetTypeCode;if(S!=null&&V!=null){const m=i.get(S)??new Set;m.add(V),i.set(S,m)}})})});let u=[];return this._mergeAssetCodes(i).forEach((c,p)=>{const h=`${n} IN (${p})`,f=le(a,[...c]);h&&f&&u.push(ft(h,f))}),u.length>1&&(u=u.map(c=>`(${c})`)),u.join(" OR ")}getFeaturesCanAssociateWith(e,t,r){return Tt(e)==null?[]:t.filter(i=>this.canAssociateFeatures(e,i,r))}canAssociateFeatures(e,t,r){if(!this._canSupportAssociations([e,t]))return!1;const i=Z(e),n=Z(t);return r.some(a=>{const{type:l,direction:d}=a;return this._getRulesForAssociationType(l).some(u=>d==="to"?nt(u,n,i):nt(u,i,n))})}getLayersCanAssociateWith(e,t,r){return Tt(e)==null?[]:t.filter(i=>this.canAssociateFeatureToLayer(e,i,r))}canAssociateFeatureToLayer(e,t,r){if(!this._canSupportAssociations([e,t]))return!1;const i=Z(e),n=Z(t);return r.some(a=>{const{type:l,direction:d}=a;return this._getRulesForAssociationType(l).some(u=>d==="to"?nt(u,n,i):nt(u,i,n))})}getFeatureSQL(e,t){const r=e.layerId.toString(),i=e.fieldsIndex?.normalizeFieldName("assetGroup"),n=e.fieldsIndex?.normalizeFieldName("assetType"),a=i?t.attributes[i]:null,l=n?t.attributes[n]:null,d=this.rulesHash[r];if(d){const u=d.assetGroupHash[a];if(u)return u.assetTypeHash[l]||null}return null}_initializeRulesTable(){const e={},t=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const r of this.rules){if(r.ruleType===3){this.rulesCategorized.attachment.push(r);continue}if(r.ruleType===2){this.rulesCategorized.containment.push(r);continue}if(r.ruleType===1){this.rulesCategorized.connectivity.push(r);continue}this.rulesCategorized.connectivity.push(r);let i=[[0,1],[1,0]];r.ruleType===5&&(i=[[0,2],[2,0],[1,2],[2,1]]);for(const n of i){const a=n.shift(),l=n.shift();let d=!1;switch(r.ruleType){case 5:d=a===0||a===1;break;case 4:d=a===1}const u=t[a],c=r[u.networkSourceId]?.layerId.toString()??"",p=r[u.assetGroupId]?.assetGroupCode?.toString(),h=r[u.assetTypeId],f=h?.assetTypeCode?.toString(),I=t[l],S=r[I.networkSourceId]?.layerId.toString()??"",V=r[I.assetGroupId]?.assetGroupCode?.toString(),m=r[I.assetTypeId],A=m?.assetTypeCode?.toString(),Q=e[c]??{assetGroupHash:{}};if(!(p&&f&&V&&A))continue;const st=Q.assetGroupHash[p]??{assetTypeHash:{}},v=st.assetTypeHash[f]??{};if(v[S]=v[S]??{},d){v[c]=v[c]??{};const X=ft(`assetgroup = ${p}`,`assettype = ${f}`);m?.connectivityPolicy==="esriNECPEndVertex"?v[c].endVertex=v[c]?.endVertex?`${v[c].endVertex}`:`(${X})`:v[c].anyVertex=v[c].anyVertex?`${v[c].anyVertex}`:`(${X})`}const C=ft(`assetgroup = ${V}`,`assettype = ${A}`);m?.connectivityPolicy==="esriNECPEndVertex"?v[S].endVertex=v[S]?.endVertex?Vt(v[S].endVertex,C):`(${C})`:v[S].anyVertex=v[S]?.anyVertex?Vt(v[S].anyVertex,C):`(${C})`,st.assetTypeHash[f]=v,Q.assetGroupHash[p]=st,e[c]=Q}}this._set("rulesHash",e)}_getRulesForAssociationType(e){const{rulesCategorized:t}=this;switch(e){case"attachment":return t.attachment;case"containment":return t.containment;case"connectivity":case"junction-junction-connectivity":return t.connectivity.filter(r=>r.ruleType===1);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return t.connectivity.filter(r=>r.ruleType===4||r.ruleType===5);default:return[]}}_areSetsEqual(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}_mergeAssetCodes(e){const t=new Map,r=new Set;for(const[i,n]of e){const a=new Set([i]);for(const[d,u]of e)i!==d&&!r.has(d)&&this._areSetsEqual(n,u)&&(a.add(d),r.add(d));const l=Array.from(a).sort().join(",");t.set(l,n)}return t}_canSupportAssociations(e){return e.every(t=>{const r=Gt(t)?t.sourceLayer:t,[i,n]=ht(r);return i!=null&&n!=null})}};o([s({constructOnly:!0})],B.prototype,"rulesLayer",void 0),o([s({constructOnly:!0})],B.prototype,"rules",void 0),o([s({readOnly:!0})],B.prototype,"rulesHash",void 0),o([s()],B.prototype,"rulesCategorized",void 0),o([s({constructOnly:!0})],B.prototype,"request",void 0),B=o([g("esri.networks.RulesTable")],B);let E=class extends k{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};o([s({type:[Object],json:{write:!0}})],E.prototype,"conditionBarriers",void 0),o([s({type:[Object],json:{write:!0}})],E.prototype,"outputConditions",void 0),o([s({type:[Object],json:{write:!0}})],E.prototype,"functions",void 0),o([s({type:[Object],json:{write:!0}})],E.prototype,"functionBarriers",void 0),o([s({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],E.prototype,"traversabilityScope",void 0),o([s({type:String,json:{write:!0}})],E.prototype,"shortestPathNetworkAttributeName",void 0),o([s({type:Boolean,json:{write:!0}})],E.prototype,"includeBarriers",void 0),o([s({type:Boolean,json:{write:!0}})],E.prototype,"validateConsistency",void 0),o([s({type:Boolean,json:{write:!0}})],E.prototype,"ignoreBarriersAtStartingPoints",void 0),E=o([g("esri.networks.support.TraceConfiguration")],E);const kt=E;let y=class extends kt{constructor(t){super(t),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.circuitName=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.inferConnectivity=null,this.maxHops=null,this.nearestNeighbor=null,this.numPaths=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};o([s({type:[Object],json:{write:!0}})],y.prototype,"filterBarriers",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"arcadeExpressionBarrier",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"circuitName",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"domainNetworkName",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"filterBitsetNetworkAttributeName",void 0),o([s({type:[Object],json:{write:!0}})],y.prototype,"filterFunctionBarriers",void 0),o([s({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],y.prototype,"filterScope",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"includeContainers",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"includeContent",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"includeIsolated",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"includeStructures",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"allowIndeterminateFlow",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"includeUpToFirstSpatialContainer",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"inferConnectivity",void 0),o([s({type:Number,json:{write:!0}})],y.prototype,"maxHops",void 0),o([s({type:Object,json:{write:!0}})],y.prototype,"nearestNeighbor",void 0),o([s({type:Number,json:{write:!0}})],y.prototype,"numPaths",void 0),o([s({type:[Object],json:{write:!0}})],y.prototype,"outputFilterCategories",void 0),o([s({type:[Object],json:{write:!0}})],y.prototype,"outputFilters",void 0),o([s({type:[Object],json:{write:!0}})],y.prototype,"propagators",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"subnetworkName",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"targetTierName",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"diagramTemplateName",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"tierName",void 0),o([s({type:Boolean,json:{write:!0}})],y.prototype,"validateLocatability",void 0),y=o([g("esri.networks.support.UNTraceConfiguration")],y);const Ue=y;let j=class extends ue{constructor(t){super(t),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(t,r){return t.tierName!==void 0?Ue.fromJSON(t):kt.fromJSON(t)}};o([s({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],j.prototype,"globalId",void 0),o([s({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],j.prototype,"title",void 0),o([s({type:kt,json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"traceConfiguration",void 0),o([ot("service","traceConfiguration")],j.prototype,"readTraceConfiguration",null),o([s({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"creationDate",void 0),o([s({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"creator",void 0),o([s({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"description",void 0),o([s({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],j.prototype,"minStartingPoints",void 0),o([s({json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"resultTypes",void 0),o([s({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],j.prototype,"tags",void 0),o([s({type:ut.apiValues,json:{type:ut.jsonValues,origins:{service:{read:ut.read,write:ut.write}},read:!1}})],j.prototype,"traceType",void 0),j=o([g("esri.networks.support.NamedTraceConfiguration")],j);const Ae=j;let N=class extends de{constructor(t){super(t),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTable=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){this.associationsTable?.destroy()}async loadAssociationsTable(t){if(!this.associationsTable){const{associationsTableUrl:r}=this;if(!r)throw new Y("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new vt({url:r})}return await this.associationsTable.load(t),this.associationsTable}async loadSubnetworksTable(t){if(!this.subnetworksTable){const{subnetworksTableUrl:r}=this;if(!r)throw new Y("utility-network-system-layers:missing-subnetworks-table-url","Unable to load the subnetworks table, as the `subnetworksTableUrl` is not set.");this.subnetworksTable=new vt({url:r})}return await this.subnetworksTable.load(t),this.subnetworksTable}};o([s({constructOnly:!0})],N.prototype,"rulesTableId",void 0),o([s({constructOnly:!0})],N.prototype,"rulesTableUrl",void 0),o([s()],N.prototype,"subnetworksTable",void 0),o([s({constructOnly:!0})],N.prototype,"subnetworksTableId",void 0),o([s({constructOnly:!0})],N.prototype,"subnetworksTableUrl",void 0),o([s({constructOnly:!0})],N.prototype,"dirtyAreasLayerId",void 0),o([s({constructOnly:!0})],N.prototype,"dirtyAreasLayerUrl",void 0),o([s()],N.prototype,"associationsTable",void 0),o([s({constructOnly:!0})],N.prototype,"associationsTableId",void 0),o([s({constructOnly:!0})],N.prototype,"associationsTableUrl",void 0),N=o([g("esri.networks.support.NetworkSystemLayers")],N);let tt=class extends k{constructor(t){super(t),this.id=null,this.name=null}};o([s({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],tt.prototype,"id",void 0),o([s({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],tt.prototype,"name",void 0),o([s({type:Boolean,json:{write:!0}})],tt.prototype,"isUpstreamTerminal",void 0),tt=o([g("esri.networks.support.Terminal")],tt);const Ce=tt,yt=new ce({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let x=class extends k{constructor(t){super(t),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};o([s({type:String,json:{write:!0}})],x.prototype,"defaultConfiguration",void 0),o([s({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],x.prototype,"id",void 0),o([s({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],x.prototype,"name",void 0),o([s({type:[Ce],json:{write:!0}})],x.prototype,"terminals",void 0),o([s({type:yt.apiValues,json:{type:yt.jsonValues,read:yt.read,write:yt.write}})],x.prototype,"traversabilityModel",void 0),x=o([g("esri.networks.support.TerminalConfiguration")],x);let F=class extends k{constructor(t){super(t),this.edgeElement=null,this.junctionElement=null}readEdgeElement(t,r){return new K({networkSourceId:r.edgeNetworkSourceId,globalId:r.edgeGlobalId,objectId:r.edgeObjectId,positionFrom:r.edgePositionFrom,positionTo:r.edgePositionTo,firstUnit:r.edgeFirstUnit,numUnits:r.edgeNumUnits})}writeEdgeElement(t,r){r.edgeNetworkSourceId=t.networkSourceId,r.edgeGlobalId=t.globalId,r.edgeObjectId=t.objectId,r.edgePositionFrom=t.positionFrom,r.edgePositionTo=t.positionTo,r.edgeFirstUnit=t.firstUnit,r.edgeNumUnits=t.numUnits}readJunctionElement(t,r){return new K({networkSourceId:r.junctionNetworkSourceId,globalId:r.junctionGlobalId,objectId:r.junctionObjectId,terminalId:r.junctionTerminalId,firstUnit:r.junctionFirstUnit,numUnits:r.junctionNumUnits})}writeJunctionElement(t,r){r.junctionNetworkSourceId=t.networkSourceId,r.junctionGlobalId=t.globalId,r.junctionObjectId=t.objectId,r.junctionTerminalId=t.terminalId,r.junctionFirstUnit=t.firstUnit,r.junctionNumUnits=t.numUnits}};o([s({type:K,json:{read:{source:["edgeNetworkSourceId","edgeGlobalId","edgeObjectId","edgePositionFrom","edgePositionTo","edgeFirstUnit","edgeNumUnits"]},write:!0}})],F.prototype,"edgeElement",void 0),o([ot("edgeElement")],F.prototype,"readEdgeElement",null),o([mt("edgeElement")],F.prototype,"writeEdgeElement",null),o([s({type:K,json:{read:{source:["junctionNetworkSourceId","junctionGlobalId","junctionObjectId","junctionTerminalId","junctionFirstUnit","junctionNumUnits"]},write:!0}})],F.prototype,"junctionElement",void 0),o([ot("junctionElement")],F.prototype,"readJunctionElement",null),o([mt("junctionElement")],F.prototype,"writeJunctionElement",null),F=o([g("esri.networks.support.CircuitPathConnectivityElement")],F);const $e=F;let O=class extends k{constructor(t){super(t),this.globalId=null,this.isFilterBarrier=!1,this.percentAlong=null,this.terminalId=null,this.type=null,this.firstUnit=null,this.numUnits=null,this.networkSourceId=null}};o([s({type:String,json:{write:!0}})],O.prototype,"globalId",void 0),o([s({type:Boolean,json:{write:!0}})],O.prototype,"isFilterBarrier",void 0),o([s({type:Number,json:{write:!0}})],O.prototype,"percentAlong",void 0),o([s({type:Number,json:{write:!0}})],O.prototype,"terminalId",void 0),o([s({type:dt.apiValues,json:{type:dt.jsonValues,read:{reader:dt.read,source:"traceLocationType"},write:{writer:dt.write,target:"traceLocationType"}}})],O.prototype,"type",void 0),o([s({type:Number,json:{write:!0}})],O.prototype,"firstUnit",void 0),o([s({type:Number,json:{write:!0}})],O.prototype,"numUnits",void 0),o([s({type:Number})],O.prototype,"networkSourceId",void 0),O=o([g("esri.rest.networks.support.TraceLocation")],O);const Ft=O;let P=class extends k{constructor(t){super(t),this.pathId=null,this.order=null,this.startingPoint=null,this.stoppingPoint=null,this.pathConnectivity=[],this.geometry=null}};o([s({type:Number,json:{write:!0}})],P.prototype,"pathId",void 0),o([s({type:Number,json:{write:!0}})],P.prototype,"order",void 0),o([s({type:Ft,json:{write:!0}})],P.prototype,"startingPoint",void 0),o([s({type:Ft,json:{write:!0}})],P.prototype,"stoppingPoint",void 0),o([s({type:[$e],json:{write:!0}})],P.prototype,"pathConnectivity",void 0),o([s({type:St,json:{write:!0}})],P.prototype,"geometry",void 0),P=o([g("esri.networks.support.CircuitPath")],P);const jt=P;let D=class extends k{constructor(t){super(t),this.sourceId=null,this.globalId=null,this.terminalId=1,this.firstUnit=1,this.numUnits=1}};o([s({type:Number,json:{write:!0}})],D.prototype,"sourceId",void 0),o([s({type:String,json:{write:!0}})],D.prototype,"globalId",void 0),o([s({type:Number,json:{write:!0}})],D.prototype,"terminalId",void 0),o([s({type:Number,json:{write:!0}})],D.prototype,"firstUnit",void 0),o([s({type:Number,json:{write:!0}})],D.prototype,"numUnits",void 0),D=o([g("esri.networks.support.CircuitLocation")],D);const wt=D;let M=class extends k{constructor(t){super(t),this.name=null,this.globalId=null,this.providerId=null,this.consumerId=null,this.isReserved=!1,this.attributes=null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,r){this.attributes?this.attributes[t]=r:this.attributes={[t]:r}}};o([s({type:String,json:{write:!0}})],M.prototype,"name",void 0),o([s({type:String,json:{write:!0}})],M.prototype,"globalId",void 0),o([s({type:String})],M.prototype,"providerId",void 0),o([s({type:String})],M.prototype,"consumerId",void 0),o([s({type:Boolean,json:{write:!0}})],M.prototype,"isReserved",void 0),o([s({json:{write:{allowNull:!0,writer:(e,t)=>t.attributes=e??{}}}})],M.prototype,"attributes",void 0),M=o([g("esri.networks.support.Subcircuit")],M);const Kt=M;let $=class extends k{constructor(t){super(t),this.sectionId=null,this.role="start-and-end",this.sectionType="physical",this.startLocation=null,this.stopLocation=null,this.subcircuit=null,this.path=null}normalizeCtorArgs(t){if(t===void 0)return t;const{sectionId:r,startLocation:i,stopLocation:n,subcircuit:a}=t;return(i||n)&&a?(delete t.startLocation,delete t.stopLocation,at.getLogger(this).warn("Cannot instantiate CircuitSection with both start/stop locations and subcircuit.",`CircuitSection with ID '${r}' was defaulted to having a subcircuit only.`)):(i&&!n||!i&&n)&&!a&&at.getLogger(this).warn(`CircuitSection with ID '${r}' must have both start and stop locations.`,"Create/alter operations involving this section will fail unless both are populated."),t}setStartStopLocations(t,r){this.startLocation=t,this.stopLocation=r,this.subcircuit=null}setSubcircuit(t){this.subcircuit=t,this.startLocation=null,this.stopLocation=null}};o([s({type:Number,json:{write:!0}})],$.prototype,"sectionId",void 0),o([s({type:bt.apiValues,json:{type:bt.jsonValues,read:bt.read},readOnly:!0})],$.prototype,"role",void 0),o([s({type:J.apiValues,json:{type:J.jsonValues,read:J.read,write:J.write}})],$.prototype,"sectionType",void 0),o([s({type:wt,json:{write:!0}})],$.prototype,"startLocation",void 0),o([s({type:wt,json:{write:!0}})],$.prototype,"stopLocation",void 0),o([s({type:Kt,json:{write:!0}})],$.prototype,"subcircuit",void 0),o([s({type:jt,readOnly:!0})],$.prototype,"path",void 0),$=o([g("esri.networks.support.CircuitSection")],$);let b=class extends k{constructor(t){super(t),this._sectionIdLookup=new Map,this.attributes=null,this.circuitManager=null,this.circuitType="physical",this.globalId=null,this.isDeleted=!1,this.lastExportedTime=null,this.lastVerifiedTime=null,this.name=null,this.sections=null,this.startLocation=null,this.status="dirty",this.stopLocation=null,this.subcircuits=[]}initialize(){this.addHandles([Ht(()=>this.sections,t=>{this._sectionIdLookup.clear(),t!=null&&Array.from(t.keys()).forEach(r=>this._sectionIdLookup.set(r.sectionId,r))},pe)])}normalizeCtorArgs(t){if(t===void 0)return t;const{name:r,startLocation:i,stopLocation:n,sections:a}=t;return(i||n)&&a?(delete t.startLocation,delete t.stopLocation,at.getLogger(this).warn("Cannot instantiate Circuit with both start/stop locations and sections.",`Circuit '${r}' was defaulted to having sections only.`)):(i&&!n||!i&&n)&&!a&&at.getLogger(this).warn(`Non-sectioned circuit '${r}' must have both start and stop locations.`,"Create/alter operations involving this circuit will fail unless both are populated."),t}get isSectioned(){return this.startLocation==null&&this.stopLocation==null&&this.sections!=null}readSections(t,r){const{sectionOrder:i,sections:n}=r,a=new Map;if(n==null)return null;if(this._sectionIdLookup.clear(),n.forEach(l=>this._sectionIdLookup.set(l.sectionId,$.fromJSON(l))),i==null)return Array.from(this._sectionIdLookup.values()).forEach(l=>a.set(l,[])),a;for(const[l,d]of Object.entries(i)){const u=Number(l),c=this._sectionIdLookup.get(u);if(c==null)continue;const p=d.map(h=>this._sectionIdLookup.get(h)).filter(ye);a.set(c,p)}return a}writeSections(t,r){const i={},n=[];t?.forEach((a,l)=>{const d=l.sectionId.toString(),u=a.map(c=>c.sectionId);i[d]=u,n.push(l.toJSON())}),r.sectionOrder=i,r.sections=n}getSectionById(t){return this._sectionIdLookup.get(t)??null}setStartStopLocations(t,r){this.startLocation=t,this.stopLocation=r,this.sections=null}setSections(t){this.sections=t,this.startLocation=null,this.stopLocation=null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,r){this.attributes?this.attributes[t]=r:this.attributes={[t]:r}}};o([s({json:{write:{allowNull:!0,writer:(e,t)=>t.attributes=e??{}}}})],b.prototype,"attributes",void 0),o([s()],b.prototype,"circuitManager",void 0),o([s({type:J.apiValues,json:{type:J.jsonValues,read:J.read,write:J.write}})],b.prototype,"circuitType",void 0),o([s({type:String,json:{write:!0}})],b.prototype,"globalId",void 0),o([s({type:Boolean,readOnly:!0})],b.prototype,"isDeleted",void 0),o([s({type:Boolean,json:{write:!0},readOnly:!0})],b.prototype,"isSectioned",null),o([s({type:Date,json:{read:{reader:e=>typeof e=="number"?new Date(e):null}},readOnly:!0})],b.prototype,"lastExportedTime",void 0),o([s({type:Date,json:{read:{reader:e=>typeof e=="number"?new Date(e):null}},readOnly:!0})],b.prototype,"lastVerifiedTime",void 0),o([s({type:String,json:{write:!0}})],b.prototype,"name",void 0),o([s({json:{read:{source:["sectionOrder","sections"]},write:!0}})],b.prototype,"sections",void 0),o([ot("sections")],b.prototype,"readSections",null),o([mt("sections")],b.prototype,"writeSections",null),o([s({type:wt,json:{write:!0}})],b.prototype,"startLocation",void 0),o([s({type:It.apiValues,json:{type:It.jsonValues,read:It.read}})],b.prototype,"status",void 0),o([s({type:wt,json:{write:!0}})],b.prototype,"stopLocation",void 0),o([s({type:[Kt],json:{write:!0}})],b.prototype,"subcircuits",void 0),b=o([g("esri.networks.support.Circuit")],b);let q=class extends k{constructor(e){super(e),this.circuit=null,this.geometry=null,this.path=null}readCircuit(e,t){return b.fromJSON(t)}};o([s({type:b,json:{write:!0,read:{source:["name","globalId","isSectioned","sectionOrder","startLocation","stopLocation","sections","subcircuits","lastVerifiedTime","lastExportedTime","circuitType","status"]}}})],q.prototype,"circuit",void 0),o([ot("circuit")],q.prototype,"readCircuit",null),o([s({type:St,json:{write:!0}})],q.prototype,"geometry",void 0),o([s({type:jt,json:{write:!0}})],q.prototype,"path",void 0),q=o([g("esri.rest.networks.circuits.support.CircuitTraceResult")],q);const Ve=q;let et=class extends k{constructor(t){super(t),this.line=null,this.multipoint=null,this.polygon=null}};o([s({type:St,json:{write:!0},readOnly:!0})],et.prototype,"line",void 0),o([s({type:me,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],et.prototype,"multipoint",void 0),o([s({type:he,json:{write:!0},readOnly:!0})],et.prototype,"polygon",void 0),et=o([g("esri.rest.networks.support.AggregatedGeometry")],et);const Re=et;let rt=class extends k{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};o([s({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],rt.prototype,"functionType",void 0),o([s({type:String,json:{write:!0},readOnly:!0})],rt.prototype,"networkAttributeName",void 0),o([s({type:Number,json:{write:!0},readOnly:!0})],rt.prototype,"result",void 0),rt=o([g("esri.rest.networks.support.FunctionResult")],rt);const Fe=rt;let _=class extends k{constructor(e){super(e),this.aggregatedGeometry=null,this.circuits=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.paths=null,this.startingPointsIgnored=!1,this.warnings=null}readNetworkElements(e,t){return t.elements!=null&&Array.isArray(t.elements)?t.elements.map(r=>"firstUnit"in r&&"numUnits"in r?new K({...r}):new Wt({...r})):[]}writeNetworkElements(e,t){t.elements=e.map(r=>r.toJSON())}};o([s({type:Re,json:{write:!0},readOnly:!0})],_.prototype,"aggregatedGeometry",void 0),o([s({type:[Ve],json:{write:!0},readOnly:!0})],_.prototype,"circuits",void 0),o([s({type:[Wt],json:{write:!0},readOnly:!0})],_.prototype,"elements",void 0),o([ot("elements")],_.prototype,"readNetworkElements",null),o([mt("elements")],_.prototype,"writeNetworkElements",null),o([s({type:[Fe],json:{write:!0},readOnly:!0})],_.prototype,"globalFunctionResults",void 0),o([s({type:Boolean,json:{write:!0},readOnly:!0})],_.prototype,"kFeaturesForKNNFound",void 0),o([s({type:[jt],json:{write:!0},readOnly:!0})],_.prototype,"paths",void 0),o([s({type:Boolean,json:{write:!0},readOnly:!0})],_.prototype,"startingPointsIgnored",void 0),o([s({type:[String],json:{write:!0},readOnly:!0})],_.prototype,"warnings",void 0),_=o([g("esri.rest.networks.support.TraceResult")],_);const Pe=Pt()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let H=class extends _{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await W(this.statusUrl,t),i=r.traceResults?{...r.traceResults,...r}:r;return this.read(i),this}async waitForJobCompletion(e={}){const{interval:t=1e3,statusCallback:r}=e;return new Promise((i,n)=>{this._clearTimer();const a=setInterval(()=>{this._timer||n(xt()),this.checkJobStatus().then(l=>{const{status:d}=l;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),i(this);break;case"job-waiting":case"job-executing":r&&r(this)}},l=>{this._clearTimer(),n(l)})},t);this._timer=a})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};o([s({type:String,json:{write:!0}})],H.prototype,"statusUrl",void 0),o([Mt(Pe)],H.prototype,"status",void 0),o([s({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],H.prototype,"submissionTime",void 0),o([s({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],H.prototype,"lastUpdatedTime",void 0),H=o([g("esri.networks.support.TraceJobInfo")],H);let L=class extends Oe{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._circuitManagerMap=new Map,this._terminalById=new Map,this._unitIdentifierManager=null}initialize(){this.addHandles(Ht(()=>[this.gdbVersion,this.historicMoment],()=>{this.networkSystemLayers.associationsTable&&(this.networkSystemLayers.associationsTable.gdbVersion!==this.gdbVersion&&(this.networkSystemLayers.associationsTable.gdbVersion=this.gdbVersion),this.networkSystemLayers.associationsTable.historicMoment!==this.historicMoment&&(this.networkSystemLayers.associationsTable.historicMoment=this.historicMoment))}))}get _rulesLayer(){const{gdbVersion:e,historicMoment:t}=this,r=this.networkSystemLayers.rulesTableUrl;return new vt({url:r,gdbVersion:e,historicMoment:t})}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map(t=>{t?.edgeSources?.map(({layerId:r,sourceId:i})=>{this._layerIdBySourceId.set(i,r),this._sourceIdByLayerId.set(r,i),e.add(r)}),t?.junctionSources?.map(({layerId:r,sourceId:i})=>{this._layerIdBySourceId.set(i,r),this._sourceIdByLayerId.set(r,i),e.add(r)})}),e}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new N({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>x.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get hasTelecomNetwork(){return this.dataElement?.domainNetworks.some(e=>e.isTelecomNetwork)??!1}get associationsTable(){return this.networkSystemLayers.associationsTable}async load(e){return this.addResolvingPromise(this._load(e)),this}async _load(e){await super._load(e),await Promise.all([this._loadNamedTraceConfigurationsFromNetwork(e),this.networkSystemLayers.loadAssociationsTable(e)])}getTerminalConfiguration(e){let t=null,r=null;const i=e.sourceLayer;let n=null;if(i?.type==="feature"){if(n=i.layerId,n===null)return null}else if(i?.type!=="subtype-sublayer"||(n=i?.parent?.layerId??null,n===null))return null;const a=e.attributes;if(a==null)return null;for(const u of Object.keys(a))u.toUpperCase()==="ASSETGROUP"&&(t=e.getAttribute(u)),u.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(u));if(!this.dataElement)return null;let l=null;const d=this.dataElement.domainNetworks;for(const u of d){const c=u.junctionSources?.find(p=>p.layerId===n);if(c){const p=c.assetGroups?.find(h=>h.assetGroupCode===t);if(p){const h=p.assetTypes?.find(f=>f.assetTypeCode===r);if(h?.isTerminalConfigurationSupported){l=h.terminalConfigurationId;break}}}}if(l!=null){const u=this.dataElement.terminalConfigurations,c=u?.find(p=>p.terminalConfigurationId===l);return c?x.fromJSON(c):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(r=>r.domainNetworkName===e)?.tiers?.map(r=>r.name)||[]}async getRulesTable(){const e=this._rulesLayer;e.loaded||await e.load();const t=this.dataElement?.domainNetworks;if(!t)return null;const r=t.flatMap(n=>[...n.edgeSources||[],...n.junctionSources||[]]),i=(await this._queryRulesTable(e)).map(n=>this._hydrateRuleInfo(e,r,n));return new B({rulesLayer:e,rules:i})}async getCircuitManager(e){if(!this.hasTelecomNetwork)return null;const t=this.dataElement?.domainNetworks.find(i=>i.domainNetworkName===e&&i.isTelecomNetwork);if(!t)return null;const{default:r}=await T(()=>import("./CircuitManager-MxYA2BvO.js"),__vite__mapDeps([10,1,2,3,4,5,6]));return we(this._circuitManagerMap,e,()=>new r({utilityNetwork:this,telecomDomainNetwork:t}))}async getUnitIdentifierManager(){if(!this.hasTelecomNetwork)return null;if(this._unitIdentifierManager)return this._unitIdentifierManager;const{default:e}=await T(()=>import("./UnitIdentifierManager-D01VXTmE.js"),__vite__mapDeps([11,1,2,3,4,5,6]));return this._unitIdentifierManager=new e({utilityNetwork:this}),this._unitIdentifierManager}getTerminalById(e){if(!this.dataElement||e==null)return null;const t=this._terminalById.get(e);return t??(this.terminalConfigurations.forEach(r=>{r.terminals.forEach(i=>{this._terminalById.set(i.id,i)})}),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?e.layerId!=null&&this._utilityLayerList.has(e.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!(e.type!=="subtype-sublayer"||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e,t){const[{queryAssociations:r},{default:i}]=await Promise.all([T(()=>import("./queryAssociations-DSMK35U6.js"),__vite__mapDeps([12,1,2,3,13,6,5])),T(()=>import("./QueryAssociationsParameters-7IvPRXrO.js"),__vite__mapDeps([14,1,2,3,6]))]),n=i.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await r(this.networkServiceUrl,n,t)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:t},{default:r}]=await Promise.all([T(()=>import("./synthesizeAssociationGeometries-B46ixSOo.js"),__vite__mapDeps([15,1,2,13,3,6,5])),T(()=>import("./SynthesizeAssociationGeometriesParameters-BsOcMuhi.js"),__vite__mapDeps([16,1,2]))]),i=r.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,t(this.networkServiceUrl,i)}async trace(e){const[{trace:t},{default:r}]=await Promise.all([T(()=>import("./trace-BOaTdmtt.js"),__vite__mapDeps([17,1,2,3,4,5,6])),T(()=>import("./TraceParameters-CloPnVkP.js"),__vite__mapDeps([18,1,2,3,4,5,6]))]),i=r.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,t(this.networkServiceUrl,i)}async submitTraceJob(e){const[{submitTraceJob:t},{default:r}]=await Promise.all([T(()=>import("./trace-BOaTdmtt.js"),__vite__mapDeps([17,1,2,3,4,5,6])),T(()=>import("./TraceParameters-CloPnVkP.js"),__vite__mapDeps([18,1,2,3,4,5,6]))]),i=r.from(e);i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment;const n=await t(this.networkServiceUrl,i);return new H({statusUrl:n})}async canAddAssociation(e){const t=await this.getRulesTable();if(!t)return!1;const{fromNetworkElement:r,toNetworkElement:i}=e;if(!r||!i)return!1;await t.load();let n=null;switch(e.associationType){case"containment":n=t.rulesCategorized.containment;break;case"attachment":n=t.rulesCategorized.attachment;break;default:n=t.rulesCategorized.connectivity}return n.some(a=>nt(a,r,i))}generateAddAssociations(e){const{associationsTable:t}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:i,fromTerminalId:n,fromFirstUnit:a,fromNumUnits:l,toNetworkSourceId:d,toGlobalId:u,toTerminalId:c,toFirstUnit:p,toNumUnits:h,associationType:f,isContentVisible:I,percentAlong:S,globalId:V}=Te(t);return{addFeatures:e.map(m=>{const A=new qt({attributes:{[r]:m.fromNetworkElement?.networkSourceId,[i]:m.fromNetworkElement?.globalId,[n]:m.fromNetworkElement?.terminalId,[d]:m.toNetworkElement?.networkSourceId,[u]:m.toNetworkElement?.globalId,[c]:m.toNetworkElement?.terminalId,[f]:be[m.associationType],[I]:m.isContentVisible==null?void 0:m.isContentVisible?1:0,[S]:m.percentAlong,[V]:m.globalId}});return m.fromNetworkElement instanceof K&&(A.attributes[a]=m.fromNetworkElement?.firstUnit,A.attributes[l]=m.fromNetworkElement?.numUnits),m.toNetworkElement instanceof K&&(A.attributes[p]=m.toNetworkElement?.firstUnit,A.attributes[h]=m.toNetworkElement?.numUnits),A}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:t,associationsTableId:r}=this.networkSystemLayers,i={id:r,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}};if(this.dataElement?.schemaGeneration===-8){const a=this._generateDeleteTelecomAssociationPayload(e);return{...i,deleteAssociations:a}}const n=e.map(a=>({globalId:a.globalId}));return{...i,deleteFeatures:n}}generateCombineNetworkElements(e){return{id:this._ensureSingleSourceIdAsValidLayerId(e),combineGroupedObjects:[{globalIds:e.map(t=>t.globalId)}]}}generateDivideNetworkElements(e,t){return{id:this._ensureSingleSourceIdAsValidLayerId([e]),divideGroupedObjects:[{globalId:e.globalId,numUnits:t}]}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async loadSubnetworksTable(){return this.networkSystemLayers.loadSubnetworksTable()}async _loadNamedTraceConfigurationsFromNetwork(e){if(this.sharedNamedTraceConfigurations?.length===0)return;const t=this.sharedNamedTraceConfigurations.map(i=>i.globalId),r=await this.queryNamedTraceConfigurations({globalIds:t},e);for(const i of this.sharedNamedTraceConfigurations){const n=r?.find(a=>a.globalId===i.globalId);if(n){const a=n.write({},{origin:"service"});i.read(a,{origin:"service"})}}}_hydrateRuleInfo(e,t,r){const i=e.fieldsIndex,n=i.get("RULETYPE"),a=i.get("CREATIONDATE"),l=i.get("FROMNETWORKSOURCEID"),d=i.get("FROMASSETGROUP"),u=i.get("FROMASSETTYPE"),c=i.get("FROMTERMINALID"),p=i.get("TONETWORKSOURCEID"),h=i.get("TOASSETGROUP"),f=i.get("TOASSETTYPE"),I=i.get("TOTERMINALID"),S=i.get("VIANETWORKSOURCEID"),V=i.get("VIAASSETGROUP"),m=i.get("VIAASSETTYPE"),A=i.get("VIATERMINALID"),Q=r.attributes[n.name],st=new Date(r.attributes[a.name]),v=[{networkSourceId:r.attributes[l.name],assetGroupId:r.attributes[d.name],assetTypeId:r.attributes[u.name],terminalId:r.attributes[c.name]},{networkSourceId:r.attributes[p.name],assetGroupId:r.attributes[h.name],assetTypeId:r.attributes[f.name],terminalId:r.attributes[I.name]},{networkSourceId:r.attributes[S.name],assetGroupId:r.attributes[V.name],assetTypeId:r.attributes[m.name],terminalId:r.attributes[A.name]}],C={ruleType:Q,creationDate:st};for(const X of[0,1,2]){if(Q!==5&&X===2)continue;const lt=v[X],Nt=t.find(it=>it.sourceId===lt.networkSourceId),_t=Nt?.assetGroups.find(it=>it.assetGroupCode===lt.assetGroupId),Et=_t?.assetTypes.find(it=>it.assetTypeCode===lt.assetTypeId),Qt=this._getTerminal(Et,lt);let z="";switch(X){case 0:z="from";break;case 1:z="to";break;case 2:z="via"}C[`${z}NetworkSource`]=Nt,C[`${z}AssetGroup`]=_t,C[`${z}AssetType`]=Et,C[`${z}Terminal`]=Qt?.toJSON()}return C}_getTerminal(e,t){const r=e?.terminalConfigurationId;return this.terminalConfigurations?.find(n=>n.id===r)?.terminals?.find(n=>n.id===t.terminalId)??null}async _queryRulesTable(e){const{gdbVersion:t,historicMoment:r}=this,i=new ge({where:"1=1",outFields:["*"],gdbVersion:t,historicMoment:r});return(await Dt(e,i)).features}_generateDeleteTelecomAssociationPayload(e){return e.map(t=>({globalId:t.globalId??Ie,associationType:ve.toJSON(t.associationType),fromSourceId:t.fromNetworkElement.networkSourceId,fromGlobalId:t.fromNetworkElement.globalId,fromTerminalId:t.fromNetworkElement.terminalId,toSourceId:t.toNetworkElement.networkSourceId,toGlobalId:t.toNetworkElement.globalId,toTerminalId:t.toNetworkElement.terminalId}))}_ensureSingleSourceIdAsValidLayerId(e){const t=fe(e.map(n=>n.networkSourceId));if(t.length>1)throw new Y("utility-network:invalid-source-id","'networkSourceId' is not valid. Ensure that all network elements have the same 'networkSourceId' and that it corresponds to a valid layer in the utility network.");const r=t[0],i=this.getLayerIdBySourceId(r);if(i==null)throw new Y("utility-network:invalid-source-id","'networkSourceId' is not valid. Ensure that all network elements have the same 'networkSourceId' and that it corresponds to a valid layer in the utility network.");return i}};o([s({readOnly:!0})],L.prototype,"_rulesLayer",null),o([s({type:[Ae],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],L.prototype,"sharedNamedTraceConfigurations",void 0),o([s({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],L.prototype,"type",void 0),o([s({readOnly:!0})],L.prototype,"serviceTerritoryFeatureLayerId",null),o([s({readOnly:!0})],L.prototype,"networkSystemLayers",null),o([s({readOnly:!0})],L.prototype,"terminalConfigurations",null),o([s({readOnly:!0})],L.prototype,"domainNetworkNames",null),o([s({readOnly:!0})],L.prototype,"hasTelecomNetwork",null),o([s({readOnly:!0,json:{read:!1}})],L.prototype,"associationsTable",null),L=o([g("esri.networks.UtilityNetwork")],L);const Me=L,xe=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{Me as N,wt as a,_ as c,Ae as d,Se as i,We as k,b as m,Ue as n,Ft as p};
