import{bF as c,iW as y,f as l,bI as p,b1 as h,bH as m,_ as s,e as i,g}from"./index-BrQW8HOS.js";import{isAssociatedFeatureSupportedLayer as u}from"./featureUtils-D2UmGJHI.js";import{p as _}from"./FieldInput-BRbP2Bp9.js";import{v as f}from"./FeatureUtilityNetworkAssociationsViewModel-bOY5P1li.js";import"./utils-BJ7fw6dI.js";import"./Heading-Bx03M7LB.js";import"./featureFormUtils-NJdl1KAp.js";import"./dateUtils-DCwqoPkL.js";import"./substitute-D-eLZ17Q.js";import"./NetworkElement-te1zus-P.js";import"./getFeatureTitle-Mrr3SXNI.js";let e=class extends c(_){constructor(t){super(t),this.group=null,this.type="utilityNetworkAssociations",this.featureItem=null,this._updatingHandlesSetUp=new y,this.addHandles([l(()=>({feature:this.feature,element:this.element,layer:this.layer}),a=>this._createAssociationVM(a),p),l(()=>this.feature,()=>this._setFeatureItem()),l(()=>this.associatedLayer,(a,o)=>this._updateLayerEditHandle(a,o),p)])}destroy(){this._associationsVM?.destroy(),this._updatingHandlesSetUp.destroy()}get activeAssociationType(){return this._associationsVM?.activeAssociationType}get associatedFeatures(){const{associatedLayer:t}=this;if(t)return this.associatedFeatureInfos.get(t)}get associatedFeatureInfos(){const{_associationsVM:t}=this;if(!t?.associationFeatures?.size||!t?.utilityNetwork)return new Map;const{associationFeatures:a}=t,o=new Map;return a.forEach((r,n)=>{o.set(n,r)}),o}get associatedLayer(){return this._get("associatedLayer")}set associatedLayer(t){this._associationsVM.showAllEnabled=t!=null,this._set("associatedLayer",t)}get associationsViewModel(){return this._associationsVM}get canAddAssociation(){const{editable:t,utilityNetwork:a}=this;return!(!a||!this.loaded)&&t}get editable(){return this.evaluatedEditableExpression??!0}get featureCount(){return this._associationsVM?.featureCount??0}get viewModel(){return this._associationsVM}get loaded(){return this._associationsVM?.state!=="loading"&&!this._updatingHandlesSetUp.updating}get map(){return this._get("map")}set map(t){t&&this._associationsVM?.set("map",t),this._set("map",t)}get utilityNetwork(){return this._associationsVM?.utilityNetwork}get associationTypes(){return this._associationsVM?.associationTypes??this.element.associationTypes}get visible(){const{utilityNetwork:t}=this;return!!t&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){return this._associationsVM?.state==="loading"||this._associationsVM?.state==="querying"}async refresh(){await h(this._associationsVM.refresh())}_updateLayerEditHandle(t,a){a&&"layerId"in a&&this.removeHandles(a?.layerId),u(t)&&this.addHandles(m(()=>t,"edits",()=>this.refresh()),t.layerId)}_createAssociationVM(t){const{feature:a,element:o,layer:r}=t;if(this._associationsVM?.destroy(),!a||!o||!r)return;const{map:n,associationTypes:d}=this;u(r)&&(this._associationsVM=new f({graphic:a,layer:r,map:n,associationTypes:d,source:"featureForm",title:this.label,description:this.description}))}_setFeatureItem(){this._updatingHandlesSetUp.addPromise((async()=>{const{feature:t,layer:a}=this;t&&a&&"getFeatureTitle"in a&&(this.featureItem={feature:t,label:await a.getFeatureTitle(t)})})())}};s([i()],e.prototype,"_associationsVM",void 0),s([i()],e.prototype,"activeAssociationType",null),s([i()],e.prototype,"associatedFeatures",null),s([i()],e.prototype,"associatedFeatureInfos",null),s([i()],e.prototype,"associatedLayer",null),s([i()],e.prototype,"associationsViewModel",null),s([i()],e.prototype,"canAddAssociation",null),s([i()],e.prototype,"editable",null),s([i()],e.prototype,"featureCount",null),s([i()],e.prototype,"viewModel",null),s([i()],e.prototype,"group",void 0),s([i()],e.prototype,"loaded",null),s([i()],e.prototype,"map",null),s([i()],e.prototype,"utilityNetwork",null),s([i()],e.prototype,"associationTypes",null),s([i({readOnly:!0})],e.prototype,"type",void 0),s([i()],e.prototype,"visible",null),s([i()],e.prototype,"updating",null),s([i()],e.prototype,"featureItem",void 0),e=s([g("esri.widgets.FeatureForm.UtilityNetworkAssociationInput")],e);const k=e;export{k as default};
