import{gq as w,ov as v,ow as b}from"./index-Brd6-W-v.js";import{M as f}from"./feature-utils-CkZNMcLf.js";import{w as y}from"./actionUtils-Bz6k3Mog.js";function E(e,t){return y(e,t)}const s=new w({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}"}),z=new w({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}"}),c=new w({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}"}),C=new b({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",value:!1});function V(e){if(e.icon)return e.icon;if(!("image"in e&&e.image)&&!e.className)return"question"}function k(e){return e?{backgroundImage:`url(${e})`}:{}}function F(e){const{selectedFeature:t,location:i,view:r}=e;return r?t??i??null:null}async function T(e,t){const{location:i,selectedFeature:r,view:o,zoomFactor:a}=e;await t?.viewModel?.updateGeometry();const n=t?.graphic,g=n?.geometry?n:F(e);if(!o||!g){const u="zoom-to:invalid-target-or-view: Cannot zoom to location without a target and view.",d=new Error(u);throw console.error(u,{target:g,view:o}),d}const h=o.scale/a,l=n?.geometry??e.selectedFeature?.geometry??i,m=l!=null&&l.type==="point"&&await E(n??r,o);s.active=!0,s.disabled=!0;try{await e.zoomTo({target:{target:g,scale:m?h:void 0}})}catch(u){if(v(u))return;const d="zoom-to:invalid-graphic: Could not zoom to the location of the graphic.",p=new Error(d);throw console.error(d,{graphic:n??r}),p}finally{s.active=!1,s.disabled=!1,m&&e.location!==l&&(e.location=l)}}function A(e){return!!e&&e.isAggregate&&f(e)?.featureReduction?.type==="cluster"}async function M(e,t){const i=await e.whenLayerView(f(t)),r=i.createQuery(),o=t.getObjectId();return r.aggregateIds=o!=null?[o]:[],[i,r]}async function $(e){const{selectedFeature:t,view:i}=e;if(i?.type!=="2d")throw new Error("zoomToCluster:invalid-view: View must be 2d MapView.");if(!t||!A(t))throw new Error("zoomToCluster:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.");const[r,o]=await M(i,t);c.active=!0,c.disabled=!0;const{extent:a}=await r.queryExtent(o);a&&await e.zoomTo({target:a}),c.active=!1,c.disabled=!1}const O=async(e,t)=>{if(!e)throw new Error("trigger-action:missing-arguments: Event has no action");const{disabled:i,id:r}=e;if(!r)throw new Error("trigger-action:invalid-action: action.id is missing");if(i)throw new Error("trigger-action:invalid-action: Action is disabled");if(r===s.id)return await T(t).catch(o=>{if(!v(o))throw o});if(r===c.id)return await $(t);if(r===C.id){t.browseClusterEnabled=!t.browseClusterEnabled,t.featureMenuOpen=t.browseClusterEnabled;return}if(r===z.id){t.visible=!1;const{selectedFeature:o}=t;if(!o)throw new Error("trigger-action:missing-selected-feature: Cannot remove selected feature without a selected feature.");const a=f(o);a?a.remove(o):t.view?.graphics.remove(o)}};export{O as B,T as F,V as Z,k,s};
