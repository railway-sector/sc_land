import{hO as m,O as x,oO as F,oP as B,a5 as c,fe as C,pf as M,a0 as P}from"./index-CgzAF5Ey.js";import{i as v}from"./legacyIcon-BpbXCnGp.js";const q=x.ofType({key:"type",defaultKeyValue:"button",base:B,typeMap:{button:m,toggle:F}}),l=new m({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:v.zoomInMagnifyingGlass}),h=new m({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:v.trash}),d=new m({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:v.zoomInMagnifyingGlass}),u=new F({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:v.table,value:!1}),E="esri.widgets.Popup.PopupViewModel",w=()=>P.getLogger(E),I=e=>{const{event:a,view:r,viewModel:t}=e,{action:i}=a;if(!i)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));const{disabled:n,id:o}=i;if(!o)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new c("trigger-action:invalid-action","Action is disabled"));if(o===l.id)return L(t).catch(M);if(o===d.id)return O(t);if(o===u.id)return t.browseClusterEnabled=!t.browseClusterEnabled,t.featureMenuOpen=t.browseClusterEnabled,Promise.resolve();if(o===h.id){t.visible=!1;const{selectedFeature:s}=t;if(!s)return Promise.reject(new c(`trigger-action:${h.id}`,"selectedFeature is required",{selectedFeature:s}));const{sourceLayer:g}=s;return g?g.remove(s):r?.graphics.remove(s),Promise.resolve()}return Promise.resolve()};function G(e){const{selectedFeature:a,location:r,view:t}=e;return t?a??r??null:null}function z(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}async function V(e,a){if(a?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const r=a.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let t=null;try{t=await r.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]}return!0}async function L(e,a){const{location:r,selectedFeature:t,view:i,zoomFactor:n}=e;await a?.viewModel?.updateGeometry();const o=a?.graphic,s=o?.geometry?o:G(e);if(!i||!s){const f=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});throw w().error(f),f}const g=i.scale/n,p=o?.geometry??e.selectedFeature?.geometry??r,b=p!=null&&p.type==="point"&&await V(o??t,i);l.active=!0,l.disabled=!0;try{await e.zoomTo({target:{target:s,scale:b?g:void 0}})}catch(f){if(C(f))return;const $=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:o??t});w().error($)}finally{l.active=!1,l.disabled=!1,e.zoomToLocation=null,b&&(e.location=p)}}async function O(e){const{selectedFeature:a,view:r}=e;if(r?.type!=="2d"){const o=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw w().error(o),o}if(!a||!z(a)){const o=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:a});throw w().error(o),o}const[t,i]=await y(r,a);d.active=!0,d.disabled=!0;const{extent:n}=await t.queryExtent(i);n&&await e.zoomTo({target:n}),d.active=!1,d.disabled=!1}async function N(e){const{view:a,selectedFeature:r}=e;if(!a||!r)return;const[t,i]=await y(a,r),{extent:n}=await t.queryExtent(i);e.selectedClusterBoundaryFeature.geometry=n,a.graphics.add(e.selectedClusterBoundaryFeature)}async function A(e){const{selectedFeature:a,view:r}=e;if(!r||!a)return;const[t,i]=await y(r,a);u.active=!0,u.disabled=!0;const{features:n}=await t.queryFeatures(i);u.active=!1,u.disabled=!1,u.value=!0;const o={features:[a].concat(n)};e?.initialDisplayMode==="feature"&&(o.featureMenuOpen=!0),e?.open(o)}async function y(e,a){const r=await e.whenLayerView(a.sourceLayer),t=r.createQuery(),i=a.getObjectId();return t.aggregateIds=i!=null?[i]:[],[r,t]}function k(e){u.value=!1;const a=e.features.filter(r=>z(r));a.length&&(e.features=a)}export{d as a,G as d,L as f,z as g,k as h,q as i,I as l,u as m,l as n,A as p,N as v,V as w};
