import{bY as y,en as g,el as h,f as a,n as f,d as $,Z as m,W as w,i as _,l as A}from"./index-Brd6-W-v.js";import{ArcgisUtilityNetworkAssociationList as b}from"./customElement-DOww5-ok.js";import"./featureUtils-ptB3zprR.js";import"./featureUtils-C9FquY4Q.js";const v=_`:host{position:relative;flex:1 1 auto}.list-item--hidden{display:none}.feature-observer{bottom:var(--calcite-spacing-xxl);position:relative;text-align:center;z-index:2}.loading-container{display:flex;justify-content:center;padding:var(--calcite-spacing-md) 0;width:100%}.notice-container{margin-bottom:var(--calcite-spacing-xs)}`,I="nested",d=class d extends b{constructor(){super(...arguments),this.displayCount=3,this.flowType="feature-utility-network-association-type"}get endIndex(){const{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:s}=this;return Math.min(e*t,s)}_featureViewModelMatch(e,t){const s=e.graphic,i=s?.layer;let n=null;i?.type==="subtype-sublayer"&&i.parent?n=i.parent.globalIdField??null:i&&"globalIdField"in i&&(n=i.globalIdField);const l=n?s?.attributes[n]:null,r=t.graphic,o=r?.layer;let c=null;o?.type==="subtype-sublayer"&&o.parent?c=o.parent.globalIdField??null:o&&"globalIdField"in o&&(c=o.globalIdField);const p=c?r?.attributes[c]:null;return l&&p&&l===p}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!=="feature-association")return!1;const s=t.viewModel;return this._featureViewModelMatch(s,e)})??-1}_formatPercentAlong(e){const{percentAlong:t}=e;return t==null?"":y(t,{style:"percent",maximumFractionDigits:2})}async _handleFeatureClick(e,t,s){const{flowItems:i}=this;if(e){i?.removeAll();return}if(t<0||!i){await this._selectAssociation(s);return}for(;i.length>t+1;)i.pop()}_isConnectivityAssociation(e){const{associationType:t}=e;return t==="connectivity"||t==="junction-junction-connectivity"||t==="junction-edge-from-connectivity"||t==="junction-edge-midspan-connectivity"||t==="junction-edge-to-connectivity"}_isConnectivityMidspanAssociation(e){return e.associationType==="junction-edge-midspan-connectivity"}_isParentFeature(e){const t=this.flowItems?.getItemAt(0);if(!t)return!1;const s=t.parentFeatureViewModel;return this._featureViewModelMatch(s,e)}async _selectAssociation(e){const{flowItems:t}=this;t&&t.push(g(h(this.parentFeatureViewModel,a`<arcgis-feature .flowItems=${t} .flowType=${"feature-utility-network-associations"} .graphic=${e.graphic} .map=${this.map} show-utility-network-content .spatialReference=${this.spatialReference} .timeZone=${this.timeZone} .view=${this.view}></arcgis-feature>`)))}_showAllAssociations(e){const{flowItems:t,description:s}=this;if(!t||!e)return;this.showAllEnabled=!0;const i=e?.title??"";t.push(g(a`<arcgis-feature-utility-network-association-list .associationViewModels=${this.associationViewModels} .description=${s} .flowItems=${t} .flowType=${this.flowType} .messages=${this.messages} .parentFeatureViewModel=${this.parentFeatureViewModel} .selectedLayer=${e} .showAllEnabled=${this.showAllEnabled} title=${i??f}></arcgis-feature-utility-network-association-list>`))}render(){const{associationViewModels:e,state:t}=this,s=this.selectedLayer?.title??this.messages?.noTitle??"";return a`<div>${t==="loading"||t==="querying"?this._renderLoading():a`<calcite-list .displayMode=${I} .filterEnabled=${this.showAllEnabled&&!!this.selectedLayer} .filterLabel=${this.messages?.associationFilterPlaceholder} .filterPlaceholder=${this.messages?.associationFilterPlaceholder} .label=${s}>${this.showAllEnabled&&this.selectedLayer?a`${this._renderFeatureCountWarning()}${this._renderAssociatedFeatureListPage()}${this._renderFeatureObserver()}`:Array.from(e.keys(),i=>this._renderTypeList(i))}</calcite-list>`}</div>`}_renderAssociatedFeature(e){const{featureViewModel:t,title:s}=e,i=this.state==="loading",n=this._findFlowItem(t),l=n<0&&this._isParentFeature(t),r=l||n>=0,o=`associated-feature-${e.association.globalId}`;return a`<calcite-list-item class=${$(i?"list-item--hidden":"")} .description=${m(e.terminalName??"")} .label=${m(s)} @calciteListItemSelect=${async()=>await this._handleFeatureClick(l,n,t)}>${this._isConnectivityAssociation(e.association)?this._renderConnectivityIcon(e.association.associationType,o):null}${this._isConnectivityMidspanAssociation(e.association)?a`<calcite-chip .label=${this._formatPercentAlong(e.association)} scale=s slot=content-end>${this._formatPercentAlong(e.association)}</calcite-chip>`:null}${this._renderChevronIconNode(r)}</calcite-list-item>`}_renderAssociatedFeatureList(e){return e.toArray().map(t=>this._renderAssociatedFeature(t))}_renderAssociatedFeatureListPage(){const e=this.associationViewModels.get(this.selectedLayer).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderChevronIconNode(e){return a`<calcite-icon flip-rtl .icon=${e?"move-up":"chevron-right"} scale=s slot=content-end></calcite-icon>`}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this,s=`associated-feature-${e.association.globalId}`;return this._isConnectivityAssociation(e.association)?a`<calcite-tooltip overlay-positioning=fixed .referenceElement=${t.get(s)}>${this.getConnectivityTooltip(e.association.associationType)}</calcite-tooltip>`:null}_renderTypeList(e){const{messages:t}=this,{displayCount:s}=this,i=this.associationViewModels.get(e),n=i.slice(0,s),l=n.length<i.length,r=w(t?.numberRecords??"",{number:i.length.toString()}),o=t?.showAll??"";return h("show-all",a`<calcite-list-item expanded .label=${e.title} .value=${e.id}><calcite-chip .label=${String(i.length)} scale=s slot=content-end>${i.length}</calcite-chip><calcite-list .group=${e.id} .label=${e.title??""}>${[this._renderTooltips(n),this._renderAssociatedFeatureList(n)]}${l?h("show-all-item",a`<calcite-list-item .description=${r} .label=${o} @calciteListItemSelect=${()=>this._showAllAssociations(e)}><calcite-icon icon=list scale=s slot=content-end></calcite-icon></calcite-list-item>`):null}</calcite-list></calcite-list-item>`)}_renderTooltips(e){return e.toArray().map(t=>this._renderItemTooltip(t))}};d.properties={description:1,displayCount:9,endIndex:32,flowItems:0,flowType:1,map:0,spatialReference:0,timeZone:1,view:0},d.styles=v;let u=d;A("arcgis-feature-utility-network-association-list",u);export{u as ArcgisFeatureUtilityNetworkAssociationList};
