const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/webglDeps-B9o0_o0s.js","assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-Bs6-tONO.js","assets/mapViewDeps-2LS2qwiv.js","assets/FeatureCommandQueue-CHlQJ5HC.js","assets/CIMSymbolHelper-BlfMWOZ7.js","assets/BidiEngine-BvER9tXK.js","assets/labelPoint-CgDrQQb-.js","assets/rasterizingUtils-Bv-DctWv.js","assets/mat2d-BbBq4Byx.js","assets/mat2df32-Dpt2CT5P.js","assets/Rect-CUzevAry.js","assets/BoundingBox-BuUpzzb5.js","assets/Technique-Ci8QnsGB.js","assets/UpdateTracking2D-Gzh35eIq.js","assets/utils-CBgvkwBp.js","assets/constants-BBnGEY1d.js","assets/clippingUtils-BM7WDzJt.js","assets/viewpointUtils-CqwA4uEG.js","assets/mat2df64-DJ_RMjZ3.js","assets/a11yUtils-BrnjXW_g.js","assets/heatmapTextureUtils-Cv1fg6rl.js","assets/WGLContainer-DgjgvKgu.js","assets/Utils-BF-wCUzY.js","assets/WGLBrushVTLSymbol-CFvVF_EM.js","assets/Container-YjeysbeO.js","assets/EffectView-c1UGgQSH.js","assets/earcut-D9gy186-.js","assets/streamLayerUtils-DFlbJ4P1.js","assets/QueueProcessor-CL6qRd0z.js","assets/SDFHelper-CqlEtc05.js","assets/TexturedLineMeshWriter-BWh-438Z.js","assets/TurboLine-D-njSPA9.js","assets/OverrideHelper-Dz66q1dD.js","assets/callExpressionWithFeature-DHWn7DZ3.js","assets/VTLMaterialManager-Diyp9F_8.js","assets/GridShader-DV3a9Dp3.js","assets/CircularArray-CujHzHWW.js","assets/SymbolFader-BGgCIfM5.js","assets/VertexStream-DLzAWWPP.js","assets/CIMResourceManager-CKLYpEab.js","assets/pbf-bO1aG1II.js","assets/AttributeStore-Bv1ugamN.js","assets/FeatureStoreQueryAdapter-CXh0LPML.js","assets/queryUtils-DtYhZp0I.js","assets/timeSupport-B35Pi50H.js","assets/utils-B_75WYOH.js","assets/grouping-C2yK9O40.js","assets/utils-DDjZAYSk.js","assets/MeshWriterRegistry-ChzM_sSV.js","assets/Timeline-Cz5T4vl1.js","assets/projectOperator-p23D9sjF.js","assets/operatorProject-DxiD_TZp.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/GraphicsView2D-DBV8Wl3n.js","assets/FeatureMetadata-gpV2fKss.js","assets/rbush-DRx18tQf.js","assets/normalizeUtilsSync-DbZEvtY3.js","assets/densifyCurvedGeometry-B2pHq9-y.js","assets/GraphicContainer-D0ufj8hZ.js","assets/AGraphicContainer-hQjoSDU1.js","assets/TechniqueInstance-DzGeiMc7.js","assets/TileContainer-BWbERXiu.js","assets/gridUtils-qPxjKPob.js","assets/geodesicUtils-BJZXB7Hp.js","assets/VideoOperationalDataView-BTjfIwtp.js","assets/hitTestUtils-DuJ-LfGM.js","assets/Tile-BIybhnuW.js","assets/arcadeUtils-MYBE13Eg.js"])))=>i.map(i=>d[i]);
import{rT as z,_ as o,e as r,g as M,rU as A,rV as H,jN as L,Y as I,rW as D,aa as Z,f as h,bI as j,B as f,Z as d,j4 as G,dh as U,ck as W,al as V,b3 as C,U as _,hh as N,bO as q,ac as B,L as F,v as S,e$ as Y,c as J,rX as X,rY as K,b as $,rZ as R,D as x,d as b,r_ as Q,r$ as tt,i as et,l as it}from"./index-BrQW8HOS.js";import{load as at,execute as st}from"./projectOperator-p23D9sjF.js";import{V as ot,a as rt}from"./VideoElement-H0PUUZ6l.js";import{i as nt}from"./MediaElementView-B-fdwXAA.js";import{b as ht,d as lt,z as pt,f as dt,c as mt,x as ct}from"./clippingUtils-BM7WDzJt.js";import"./CIMSymbolHelper-BlfMWOZ7.js";import"./OverrideHelper-Dz66q1dD.js";import{n as yt}from"./Container-YjeysbeO.js";import"./WGLContainer-DgjgvKgu.js";import"./Utils-BF-wCUzY.js";import{y as ut}from"./GridShader-DV3a9Dp3.js";import"./pbf-bO1aG1II.js";import"./FeatureCommandQueue-CHlQJ5HC.js";import"./UpdateTracking2D-Gzh35eIq.js";import"./mat2d-BbBq4Byx.js";import"./mat2df32-Dpt2CT5P.js";import"./TexturedLineMeshWriter-BWh-438Z.js";import"./GraphicsView2D-DBV8Wl3n.js";import"./earcut-D9gy186-.js";import{R as vt}from"./Overlay-C1dDxz6A.js";import{f as ft}from"./OverlayContainer-DNOZrAhT.js";import"./operatorProject-DxiD_TZp.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ControlPoint-BjgmUvqO.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./normalizeUtilsSync-DbZEvtY3.js";import"./viewpointUtils-CqwA4uEG.js";import"./mat2df64-DJ_RMjZ3.js";import"./a11yUtils-BrnjXW_g.js";import"./BidiEngine-BvER9tXK.js";import"./labelPoint-CgDrQQb-.js";import"./rasterizingUtils-Bv-DctWv.js";import"./Rect-CUzevAry.js";import"./BoundingBox-BuUpzzb5.js";import"./callExpressionWithFeature-DHWn7DZ3.js";import"./EffectView-c1UGgQSH.js";import"./WGLBrushVTLSymbol-CFvVF_EM.js";import"./ShaderCompiler-G2XYGDs6.js";import"./ProgramTemplate-Bs6-tONO.js";import"./Technique-Ci8QnsGB.js";import"./utils-CBgvkwBp.js";import"./constants-BBnGEY1d.js";import"./CircularArray-CujHzHWW.js";import"./SymbolFader-BGgCIfM5.js";import"./heatmapTextureUtils-Cv1fg6rl.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./QueueProcessor-CL6qRd0z.js";import"./TurboLine-D-njSPA9.js";import"./AttributeStore-Bv1ugamN.js";import"./FeatureStoreQueryAdapter-CXh0LPML.js";import"./queryUtils-DtYhZp0I.js";import"./timeSupport-B35Pi50H.js";import"./FeatureMetadata-gpV2fKss.js";import"./rbush-DRx18tQf.js";import"./densifyCurvedGeometry-B2pHq9-y.js";import"./utils-B_75WYOH.js";import"./grouping-C2yK9O40.js";import"./utils-DDjZAYSk.js";let c=class extends z{constructor(t){super(t),this.components=["zoom"]}};o([r()],c.prototype,"components",void 0),c=o([M("esri.views.ui.video.DefaultUIVideo")],c);const E=c,gt=new U("#000");let P;async function _t(){const[,{ParentStage:t}]=await Promise.all([_(()=>import("./webglDeps-B9o0_o0s.js"),__vite__mapDeps([0,1,2,3,4,5])),_(()=>import("./mapViewDeps-2LS2qwiv.js"),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,3,5,28,29,30,31,32,33,34,35,36,37,38,4,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67]))]);P=t}const g=.01,wt=["feature","geojson","csv","stream","ogc-feature","catalog","wfs","parquet","graphics","group"];let s=class extends ht(lt(A(H(L(I))))){constructor(t){super(t),this._isValid=!1,this._prevZoomEnabled=!1,this._prevRotationEnabled=!1,this.stage=null,this.childStage=null,this._operationalDataView=null,this.operationalDataVisible=!1,this.layer=null,this.map=null,this.navigation=new D,this.ready=!1,this.spatialReference=new Z({wkid:0}),this.stateManager=new pt({constraints:new dt({view:this,minScale:1,maxScale:g})}),this.type="2d",this.ui=new E,this.view2dType="video",this.addHandles([h(()=>this.preconditionsReady,e=>e?this._startup():this._teardown()),h(()=>this.layer,(e,i)=>{i&&(this._teardown(),this._startup()),this.addResolvingPromise(f(()=>this.ready))},j),h(()=>this.videoSize,([e,i])=>{this._extent&&e&&i&&(this._extent.xmax=e,this._extent.ymax=i)}),h(()=>this.size,e=>{this._operationalDataView&&this._operationalDataView.stateManager.resize(e[0],e[1])}),h(()=>[this.layer?.frameEffect,this._effectsContainer],()=>{this._effectsContainer&&(this._effectsContainer.effect=this.layer?.frameEffect??null)},d)])}initialize(){this._prevZoomEnabled=this.navigation.actionMap.mouseWheel==="zoom"&&this.ui.components.includes("zoom"),this._prevRotationEnabled=this.navigation.actionMap.dragSecondary==="rotate"&&this.ui.components.includes("compass"),this.addHandles([h(()=>[this.operationalDataVisible,this.childStage],()=>{this.childStage&&(this.childStage.videoScreenRenderer.visible=this.operationalDataVisible),this.operationalDataVisible&&(this.scale=1,this.rotation=0),this.navigation&&(this._prevZoomEnabled&&(this.navigation.actionMap.mouseWheel=this.operationalDataVisible?"none":"zoom",this.navigation.actionMap.dragPrimary=this.operationalDataVisible?"none":"pan",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="zoom"):[...new Set([...this.ui.components,"zoom"])])),this._prevRotationEnabled&&(this.navigation.actionMap.dragSecondary=this.operationalDataVisible?"none":"rotate",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="compass"):[...new Set([...this.ui.components,"compass"])])))},d)]),this.addResolvingPromise(_t().then(()=>(this._isValid=!0,f(()=>this.ready))))}destroy(){this._teardown(),this.removeAllHandles(),this._set("preconditionsReady",!1),this.frameTask=G(this.frameTask),this.goToManager.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get constraintsInfo(){return{lods:null,spatialReference:this.spatialReference}}get preconditionsReady(){return!(!this._isValid||this.width===0||this.height===0||this.videoSize[0]===0||this.videoSize[1]===0)}get rendering(){return this.stage?.renderRequested??!1}get scale(){return this.stateManager?.scale??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get videoSize(){if(!this.layer?.videoWidth||!this.layer?.videoHeight)return[0,0];const[t,e]=this.size,i=(this.layer?.videoWidth||0)/(this.layer?.videoHeight||0),a=e*i,n=t/i;return t/e>=1?i>=1?a<=t?[a,e]:[t,n]:n<=e?[t,n]:[a,e]:i>=1?n<=e?[t,n]:[a,e]:a<=t?[a,e]:[t,n]}async hitTest(t,e){return this._operationalDataView&&this._operationalDataView.ready?this._operationalDataView.hitTest(t,e):{screenPoint:t,results:[]}}_startup(){if(!this.layer)return;const t=this._getViewpoint();this.stateManager.startup(t,this.size,t.targetGeometry.spatialReference);const e={renderingOptions:this.renderingOptions,backgroundColor:gt,groundControlPoints:()=>this.layer?.groundControlPoints,getSize:()=>this.videoSize},i=new P(this.surface,e,new mt(this.surface));this.stage=i,this._prepareStage(this.stage),this.childStage=i.childStage,this._prepareChildStage(this.childStage);const a=new ct({view:this});this._set("animationManager",a);const n=new ut({view:this,animationManager:a});this._set("mapViewNavigation",n),this._updateConstraints(),this.frameTask.start(),this._set("ready",!0)}_teardown(){this.stage.destroy(),this.stage=null,this._videoElementView=null,this._overlayContainer.removeAllChildren(),this._overlayContainer=null,this.removeHandles("video-view"),this._set("ready",!1),this.stateManager.teardown(),this.frameTask.stop(),this.stationaryManager.clear()}_getViewpoint(){return new W({targetGeometry:new V({x:this.videoSize[0]/2,y:this.videoSize[1]/2,spatialReference:this.spatialReference}),scale:1})}_prepareStage(t){this.addHandles([h(()=>this.stationary,a=>t.stationary=a,d),h(()=>this.state.id,()=>t.state=this.state,d),h(()=>this.renderingOptions,a=>t.renderingOptions=a,d)],"video-view"),this._extent=new C({xmin:0,ymin:0,xmax:this.videoSize[0],ymax:this.videoSize[1],spatialReference:{wkid:0}}),this._videoElementView=new nt({element:new ot({video:this.layer?.videoElement,georeference:new rt({extent:this._extent}),autoplay:!1}),spatialReference:this.spatialReference});const e=new vt(this._videoElementView);this._overlayContainer=new ft,this._overlayContainer.addChild(e),this._effectsContainer=new yt,this._effectsContainer.addChild(this._overlayContainer),this.stage.addChild(this._effectsContainer);const i=document.createElement("div");i.classList.add("esri-video-poster"),this.container?.classList.add("esri-video-view"),this.container?.appendChild(i)}_prepareChildStage(t){this.addHandles([h(()=>this.map,async e=>{if(!e)return;const{default:i}=await _(()=>import("./VideoOperationalDataView-BTjfIwtp.js"),__vite__mapDeps([68,1,2,20,21,12,22,23,13,69,59,70,71,53]));this._operationalDataView=new i({stage:t,layerViewFilter:a=>new Set(wt).has(a.type),width:this.size[0],height:this.size[1],map:e}),f(()=>this._operationalDataView?.ready).then(()=>{t.videoScreenRenderer.visible=this.operationalDataVisible})},d),h(()=>this.layer?.groundControlPoints,async()=>{if(!this.layer?.groundControlPoints||!t.state)return;const e=this.layer.groundControlPoints,i=e?.length;if(!i)return;await at();const a=new Array(i),n=t.state.spatialReference;for(let p=0;p<i;p++){const{lat:T,lon:k}=e[p];a[p]=st(new V(k,T),n)}let m=1/0,l=1/0,u=-1/0,v=-1/0;for(const p of a)m=Math.min(m,p.x),l=Math.min(l,p.y),u=Math.max(u,p.x),v=Math.max(v,p.y);const O=C.fromJSON({xmin:m,ymin:l,xmax:u,ymax:v,spatialReference:n});await this._operationalDataView?.goTo(O,{animate:!1}).catch(()=>{})},d)])}_updateConstraints(){this._updateZoomConstraints(),this._updatePanConstraints()}_updateZoomConstraints(){const t=this.videoSize,e=Math.max(t[0]/this.size[0],t[1]/this.size[1]),i=[];for(let n=e;n>g;n/=2)i.push(n);i.push(g);const{lods:a}=N.create({scales:i});this.constraints.set({lods:a,minScale:e})}_updatePanConstraints(){const t=e=>{if(!e.targetGeometry)return e;const[i,a]=this.videoSize,n=i*e.scale/2,m=a*e.scale/2,l=e.targetGeometry.clone();return l.x=Math.max(n,Math.min(i-n,l.x)),l.y=Math.max(m,Math.min(a-m,l.y)),e.targetGeometry=l,e};this.constraints.customConstraints.add({constrain:t,applyPanConstraint:t})}};o([r()],s.prototype,"_overlayContainer",void 0),o([r()],s.prototype,"_isValid",void 0),o([r()],s.prototype,"_effectsContainer",void 0),o([r()],s.prototype,"constraintsInfo",null),o([r()],s.prototype,"operationalDataVisible",void 0),o([r()],s.prototype,"layer",void 0),o([r()],s.prototype,"map",void 0),o([r({type:D,nonNullable:!0})],s.prototype,"navigation",void 0),o([r({readOnly:!0})],s.prototype,"preconditionsReady",null),o([r({readOnly:!0})],s.prototype,"ready",void 0),o([r({readOnly:!0})],s.prototype,"rendering",null),o([r()],s.prototype,"scale",null),o([r()],s.prototype,"spatialReference",void 0),o([r()],s.prototype,"stateManager",void 0),o([r()],s.prototype,"type",void 0),o([r(),q(t=>t instanceof z?t:B(E,t))],s.prototype,"ui",void 0),o([r({readOnly:!0})],s.prototype,"videoSize",null),o([r({readOnly:!0})],s.prototype,"view2dType",void 0),s=o([M("esri.views.VideoView")],s);const Vt=s;const Ct=et`:host{width:100%;height:100%}`,St=tt(Vt),y=class y extends F{constructor(){super(),this._containerRef=S(),this._direction=Y(),this._mapRef=S(),this.autoDestroyDisabled=!1,this.view=St(this),this.aria=this.view.aria,this.ready=this.view.ready,this.layer=this.view.layer,this.map=this.view.map,this.arcgisViewReadyChange=J()}async destroy(){await this.manager.destroy()}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.manager.onLifecycle(()=>[h(()=>this.layer,()=>{this.layer&&this.view&&(this.view.layer=this.layer,this.layer.loaded||this.layer.load())},{initial:!0}),h(()=>this.view.ready,()=>{this.view.ready&&this.arcgisViewReadyChange.emit()},{initial:this.view.ready})])}renderMain(){return b`<div class=${$(R.base)} ${x(this._mapRef)}></div>`}render(){return b`<section class=${$(R.containerUI)} ${x(this._containerRef)}>${Q(this._direction)}</section>${this.renderMain()}`}};y.properties={autoDestroyDisabled:5,view:32,aria:0,ready:4,layer:0,map:0},y.styles=[X,K,Ct];let w=y;it("arcgis-video",w);export{w as ArcgisVideo};
