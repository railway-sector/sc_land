const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/webglDeps-Iw6_Tych.js","assets/index-Bp3GeDhQ.js","assets/index-ni9qn0ie.css","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-DFRUyVk4.js","assets/mapViewDeps-BQbcVU7_.js","assets/FeatureCommandQueue-D-vKFjJp.js","assets/GraphShaderModule-CCW1VMLX.js","assets/UpdateTracking2D-C8DVwQXN.js","assets/utils-BeQ50sRX.js","assets/constants-BBnGEY1d.js","assets/heatmapTextureUtils-ColEuyyj.js","assets/WGLContainer-CZ4x-7LC.js","assets/Utils-oGjGfAOE.js","assets/WGLBrushVTLSymbol-BvIOksZC.js","assets/Container-BtEjTRut.js","assets/earcut-D9gy186-.js","assets/streamLayerUtils-DFlbJ4P1.js","assets/QueueProcessor-MYygY2pz.js","assets/SDFHelper-1-eMUJfu.js","assets/TexturedLineMeshWriter-BRLynIBs.js","assets/TurboLine-5JxtLEwZ.js","assets/VTLMaterialManager-Diyp9F_8.js","assets/GridShader-DkfY6DBr.js","assets/CircularArray-CujHzHWW.js","assets/SymbolFader-CXmPUJqA.js","assets/VertexStream-CFhwkzJT.js","assets/pbf-BOitBNaq.js","assets/AttributeStore-CJXjxAbR.js","assets/FeatureStoreQueryAdapter-Db4vOtyS.js","assets/queryUtils-BtajduH0.js","assets/timeSupport-H_wYRwS_.js","assets/utils-VA0D0gEu.js","assets/grouping-XC-b8k0t.js","assets/utils-DDjZAYSk.js","assets/MeshWriterRegistry-BmwmU96J.js","assets/projectOperator-BsNRNJmF.js","assets/operatorProject-C2RzYUdo.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/GraphicsView2D-KnZyR_cf.js","assets/FeatureMetadata-BmbF3QpE.js","assets/normalizeUtilsSync-zs8v83lw.js","assets/densifyCurvedGeometry-D8oDrNTt.js","assets/GraphicContainer-CwhBkohl.js","assets/AGraphicContainer-BhJUyPI5.js","assets/TechniqueInstance-B_oGtUBJ.js","assets/TileContainer-ETAk5vyT.js","assets/gridUtils-B9Wq5yiA.js","assets/VideoOperationalDataView-BvbvFlEM.js"])))=>i.map(i=>d[i]);
import{rn as M,Z as o,$ as r,a0 as D,ro as L,nd as A,rp as H,rq as I,iW as Z,a2 as G,rr as b,ag as W,rs as F,rt as j,k as h,by as q,y as f,a3 as p,hL as N,eB as U,ru as B,nn as J,nm as K,ad as V,a_ as C,_,fM as Q,bF as X,af as Y,L as tt,e as S,e7 as et,c as it,rv as at,rw as st,F as x,rx as R,C as $,f as z,ry as ot,rz as rt,i as nt,l as ht}from"./index-Bp3GeDhQ.js";import{load as lt,execute as dt}from"./projectOperator-BsNRNJmF.js";import{V as pt,a as ct}from"./VideoElement-CcGjr6mK.js";import{i as mt}from"./perspectiveUtils-D9PRqmF2.js";import{n as yt}from"./Container-BtEjTRut.js";import"./WGLContainer-CZ4x-7LC.js";import"./Utils-oGjGfAOE.js";import{y as ut}from"./GridShader-DkfY6DBr.js";import"./pbf-BOitBNaq.js";import"./FeatureCommandQueue-D-vKFjJp.js";import"./UpdateTracking2D-C8DVwQXN.js";import"./TexturedLineMeshWriter-BRLynIBs.js";import"./GraphicsView2D-KnZyR_cf.js";import"./earcut-D9gy186-.js";import{R as vt}from"./Overlay-ZzTNtZtT.js";import{f as ft}from"./OverlayContainer-Bbu8-1oV.js";import"./operatorProject-C2RzYUdo.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ControlPoint-CooeIELo.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./normalizeUtilsSync-zs8v83lw.js";import"./WGLBrushVTLSymbol-BvIOksZC.js";import"./ShaderCompiler-G2XYGDs6.js";import"./ProgramTemplate-DFRUyVk4.js";import"./GraphShaderModule-CCW1VMLX.js";import"./utils-BeQ50sRX.js";import"./constants-BBnGEY1d.js";import"./CircularArray-CujHzHWW.js";import"./SymbolFader-CXmPUJqA.js";import"./heatmapTextureUtils-ColEuyyj.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./QueueProcessor-MYygY2pz.js";import"./TurboLine-5JxtLEwZ.js";import"./AttributeStore-CJXjxAbR.js";import"./FeatureStoreQueryAdapter-Db4vOtyS.js";import"./queryUtils-BtajduH0.js";import"./timeSupport-H_wYRwS_.js";import"./FeatureMetadata-BmbF3QpE.js";import"./densifyCurvedGeometry-D8oDrNTt.js";import"./utils-VA0D0gEu.js";import"./grouping-XC-b8k0t.js";import"./utils-DDjZAYSk.js";let m=class extends M{constructor(t){super(t),this.components=["zoom"]}};o([r()],m.prototype,"components",void 0),m=o([D("esri.views.ui.video.DefaultUIVideo")],m);const E=m,gt=new U("#000");let P;async function _t(){const[,{ParentStage:t}]=await Promise.all([_(()=>import("./webglDeps-Iw6_Tych.js"),__vite__mapDeps([0,1,2,3,4,5])),_(()=>import("./mapViewDeps-BQbcVU7_.js"),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,3,5,16,17,18,19,20,21,22,23,4,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))]);P=t}const g=.01,wt=["feature","geojson","csv","stream","ogc-feature","catalog","wfs","parquet","graphics","group"];let s=class extends L(A(H(I(Z(G))))){constructor(t){super(t),this._isValid=!1,this._prevZoomEnabled=!1,this._prevRotationEnabled=!1,this.stage=null,this.childStage=null,this._operationalDataView=null,this.operationalDataVisible=!1,this.layer=null,this.map=null,this.navigation=new b,this.ready=!1,this.spatialReference=new W({wkid:0}),this.stateManager=new F({constraints:new j({view:this,minScale:1,maxScale:g})}),this.type="2d",this.ui=new E,this.view2dType="video",this.addHandles([h(()=>this.preconditionsReady,e=>e?this._startup():this._teardown()),h(()=>this.layer,(e,i)=>{i&&(this._teardown(),this._startup()),this.addResolvingPromise(f(()=>this.ready))},q),h(()=>this.videoSize,([e,i])=>{this._extent&&e&&i&&(this._extent.xmax=e,this._extent.ymax=i)}),h(()=>this.size,e=>{this._operationalDataView&&this._operationalDataView.stateManager.resize(e[0],e[1])}),h(()=>[this.layer?.frameEffect,this._effectsContainer],()=>{this._effectsContainer&&(this._effectsContainer.effect=this.layer?.frameEffect??null)},p)])}initialize(){this._prevZoomEnabled=this.navigation.actionMap.mouseWheel==="zoom"&&this.ui.components.includes("zoom"),this._prevRotationEnabled=this.navigation.actionMap.dragSecondary==="rotate"&&this.ui.components.includes("compass"),this.addHandles([h(()=>[this.operationalDataVisible,this.childStage],()=>{this.childStage&&(this.childStage.videoScreenRenderer.visible=this.operationalDataVisible),this.operationalDataVisible&&(this.scale=1,this.rotation=0),this.navigation&&(this._prevZoomEnabled&&(this.navigation.actionMap.mouseWheel=this.operationalDataVisible?"none":"zoom",this.navigation.actionMap.dragPrimary=this.operationalDataVisible?"none":"pan",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="zoom"):[...new Set([...this.ui.components,"zoom"])])),this._prevRotationEnabled&&(this.navigation.actionMap.dragSecondary=this.operationalDataVisible?"none":"rotate",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="compass"):[...new Set([...this.ui.components,"compass"])])))},p)]),this.addResolvingPromise(_t().then(()=>(this._isValid=!0,f(()=>this.ready))))}destroy(){this._teardown(),this.removeAllHandles(),this._set("preconditionsReady",!1),this.frameTask=N(this.frameTask),this.goToManager.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get constraintsInfo(){return{lods:null,spatialReference:this.spatialReference}}get preconditionsReady(){return!(!this._isValid||this.width===0||this.height===0||this.videoSize[0]===0||this.videoSize[1]===0)}get rendering(){return this.stage?.renderRequested??!1}get scale(){return this.stateManager?.scale??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get videoSize(){if(!this.layer?.videoWidth||!this.layer?.videoHeight)return[0,0];const[t,e]=this.size,i=(this.layer?.videoWidth||0)/(this.layer?.videoHeight||0),a=e*i,n=t/i;return t/e>=1?i>=1?a<=t?[a,e]:[t,n]:n<=e?[t,n]:[a,e]:i>=1?n<=e?[t,n]:[a,e]:a<=t?[a,e]:[t,n]}async hitTest(t,e){return this._operationalDataView&&this._operationalDataView.ready?this._operationalDataView.hitTest(t,e):{screenPoint:t,results:[]}}_startup(){if(!this.layer)return;const t=this._getViewpoint();this.stateManager.startup(t,this.size,t.targetGeometry.spatialReference);const e={renderingOptions:this.renderingOptions,backgroundColor:gt,groundControlPoints:()=>this.layer?.groundControlPoints,getSize:()=>this.videoSize},i=new P(this.surface,e,new B(this.surface));this.stage=i,this._prepareStage(this.stage),this.childStage=i.childStage,this._prepareChildStage(this.childStage);const a=new J({view:this});this._set("animationManager",a);const n=new ut({view:this,animationManager:a});this._set("mapViewNavigation",n),this._updateConstraints(),this.frameTask.start(),this._set("ready",!0)}_teardown(){this.stage.destroy(),this.stage=null,this._videoElementView=null,this._overlayContainer.removeAllChildren(),this._overlayContainer=null,this.removeHandles("video-view"),this._set("ready",!1),this.stateManager.teardown(),this.frameTask.stop(),this.stationaryManager.clear()}_getViewpoint(){return new K({targetGeometry:new V({x:this.videoSize[0]/2,y:this.videoSize[1]/2,spatialReference:this.spatialReference}),scale:1})}_prepareStage(t){this.addHandles([h(()=>this.stationary,a=>t.stationary=a,p),h(()=>this.state.id,()=>t.state=this.state,p),h(()=>this.renderingOptions,a=>t.renderingOptions=a,p)],"video-view"),this._extent=new C({xmin:0,ymin:0,xmax:this.videoSize[0],ymax:this.videoSize[1],spatialReference:{wkid:0}}),this._videoElementView=new mt({element:new pt({video:this.layer?.videoElement,georeference:new ct({extent:this._extent}),autoplay:!1}),spatialReference:this.spatialReference});const e=new vt(this._videoElementView);this._overlayContainer=new ft,this._overlayContainer.addChild(e),this._effectsContainer=new yt,this._effectsContainer.addChild(this._overlayContainer),this.stage.addChild(this._effectsContainer);const i=document.createElement("div");i.classList.add("esri-video-poster"),this.container?.classList.add("esri-video-view"),this.container?.appendChild(i)}_prepareChildStage(t){this.addHandles([h(()=>this.map,async e=>{if(!e)return;const{default:i}=await _(()=>import("./VideoOperationalDataView-BvbvFlEM.js"),__vite__mapDeps([49,1,2]));this._operationalDataView=new i({stage:t,layerViewFilter:a=>new Set(wt).has(a.type),width:this.size[0],height:this.size[1],map:e}),f(()=>this._operationalDataView?.ready).then(()=>{t.videoScreenRenderer.visible=this.operationalDataVisible})},p),h(()=>this.layer?.groundControlPoints,async()=>{if(!this.layer?.groundControlPoints||!t.state)return;const e=this.layer.groundControlPoints,i=e?.length;if(!i)return;await lt();const a=new Array(i),n=t.state.spatialReference;for(let d=0;d<i;d++){const{lat:T,lon:k}=e[d];a[d]=dt(new V(k,T),n)}let c=1/0,l=1/0,u=-1/0,v=-1/0;for(const d of a)c=Math.min(c,d.x),l=Math.min(l,d.y),u=Math.max(u,d.x),v=Math.max(v,d.y);const O=C.fromJSON({xmin:c,ymin:l,xmax:u,ymax:v,spatialReference:n});await this._operationalDataView?.goTo(O,{animate:!1}).catch(()=>{})},p)])}_updateConstraints(){this._updateZoomConstraints(),this._updatePanConstraints()}_updateZoomConstraints(){const t=this.videoSize,e=Math.max(t[0]/this.size[0],t[1]/this.size[1]),i=[];for(let n=e;n>g;n/=2)i.push(n);i.push(g);const{lods:a}=Q.create({scales:i});this.constraints.set({lods:a,minScale:e})}_updatePanConstraints(){const t=e=>{if(!e.targetGeometry)return e;const[i,a]=this.videoSize,n=i*e.scale/2,c=a*e.scale/2,l=e.targetGeometry.clone();return l.x=Math.max(n,Math.min(i-n,l.x)),l.y=Math.max(c,Math.min(a-c,l.y)),e.targetGeometry=l,e};this.constraints.customConstraints.add({constrain:t,applyPanConstraint:t})}};o([r()],s.prototype,"_overlayContainer",void 0),o([r()],s.prototype,"_isValid",void 0),o([r()],s.prototype,"_effectsContainer",void 0),o([r()],s.prototype,"constraintsInfo",null),o([r()],s.prototype,"operationalDataVisible",void 0),o([r()],s.prototype,"layer",void 0),o([r()],s.prototype,"map",void 0),o([r({type:b,nonNullable:!0})],s.prototype,"navigation",void 0),o([r({readOnly:!0})],s.prototype,"preconditionsReady",null),o([r({readOnly:!0})],s.prototype,"ready",void 0),o([r({readOnly:!0})],s.prototype,"rendering",null),o([r()],s.prototype,"scale",null),o([r()],s.prototype,"spatialReference",void 0),o([r()],s.prototype,"stateManager",void 0),o([r()],s.prototype,"type",void 0),o([r(),X(t=>t instanceof M?t:Y(E,t))],s.prototype,"ui",void 0),o([r({readOnly:!0})],s.prototype,"videoSize",null),o([r({readOnly:!0})],s.prototype,"view2dType",void 0),s=o([D("esri.views.VideoView")],s);const Vt=s;const Ct=nt`:host{width:100%;height:100%}`,St=rt(Vt),y=class y extends tt{constructor(){super(),this._containerRef=S(),this._direction=et(),this._mapRef=S(),this.autoDestroyDisabled=!1,this.view=St(this),this.aria=this.view.aria,this.ready=this.view.ready,this.layer=this.view.layer,this.map=this.view.map,this.arcgisViewReadyChange=it()}async destroy(){await this.manager.destroy()}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.manager.onLifecycle(()=>[h(()=>this.layer,()=>{this.layer&&this.view&&(this.view.layer=this.layer,this.layer.loaded||this.layer.load())},{initial:!0}),h(()=>this.view.ready,()=>{this.view.ready&&this.arcgisViewReadyChange.emit()},{initial:this.view.ready})])}renderMain(){return z`<div class=${x(R.base)} ${$(this._mapRef)}></div>`}render(){return z`<section class=${x(R.containerUI)} ${$(this._containerRef)}>${ot(this._direction)}</section>${this.renderMain()}`}};y.properties={autoDestroyDisabled:5,view:32,aria:0,ready:4,layer:0,map:0},y.styles=[at,st,Ct];let w=y;ht("arcgis-video",w);export{w as ArcgisVideo};
