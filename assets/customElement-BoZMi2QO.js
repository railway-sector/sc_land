import{bE as T,dn as j,O as p,a0 as b,a5 as h,_ as l,e as d,g as z,f8 as G,aq as W,Z as B,jb as M,f as k,bI as P,dt as q,a3 as Z,u3 as J,L as K,v as Q,c as C,u4 as X,h_ as Y,d as V,b as ee,D as ie,i as re,l as oe}from"./index-CgzAF5Ey.js";import{t as te}from"./utils-705cvpPF.js";import{Z as $}from"./FeatureService-CeU7iukh.js";import{p as ne}from"./utils-J9tZODVe.js";import{p as y,S as A}from"./VersionManagementService-NjRF0AH1.js";import{s as se}from"./useT9n-CtkFUew7.js";import{v as ae}from"./useViewModel-C2OUFn4j.js";import"./applyEditsUtils-Dnse8Gdk.js";import"./MeshTransform-Dit-XLCt.js";import"./editingSupport-DJtUgSza.js";import"./useView-CMtXgKA0.js";let g=class extends T(j){constructor(e){super(e),this.versionManagementService=null,this.featureServiceUrl=null,this.url=null,this.currentVersion=null,this.currentVersionInfo=null,this.versionInfos=[],this.versionableItems=new p,this.usePersistentReadSessions=!1,this.state="lock-none"}initialize(){this.url=this.versionManagementService.url,this.featureServiceUrl=this.url.replace(/\/VersionManagementServer/i,"/FeatureServer"),this.addHandles([this.versionableItems.on("before-add",e=>{if(e.item.featureServiceUrl.toLowerCase()!==this.featureServiceUrl.toLowerCase())return e.preventDefault(),void b.getLogger(this).error("#add()","Cannot add versionAdapter, feature service urls do not match.")}),this.versionableItems.on("before-remove",e=>{if(this.versionableItems.items.length===0&&this.currentVersion&&"name"in this.currentVersion&&this.versionManagementService.getLockType(this.currentVersion)!=="none")return e.preventDefault(),void b.getLogger(this).error("#remove()","Cannot remove last versionAdapter.")})])}load(e){return this.addResolvingPromise(this._setUpState(e)),Promise.resolve(this)}get defaultVersionIdentifier(){return this.versionManagementService.defaultVersionIdentifier}get isDefault(){return!this.currentVersion||!!this.currentVersion&&"name"in this.currentVersion&&this.currentVersion.name===this.defaultVersionIdentifier.name}get loaded(){return super.loaded}async getVersionInfos(e=!1){return e&&(this.versionInfos=await this.versionManagementService.getVersionInfos()),this.versionInfos}async alterVersion(e,i){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const t=await this.versionManagementService.alterVersion(e,i);return t&&await this.getVersionInfos(!0),t}async deleteVersion(e){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const i=await this.versionManagementService.deleteVersion(e);return i&&await this.getVersionInfos(!0),i}async getVersionInfoExtended(){return this.currentVersion&&"name"in this.currentVersion?this.versionManagementService.getVersionInfoExtended(this.currentVersion):this.versionManagementService.getVersionInfoExtended(this.defaultVersionIdentifier)}async startEditing(){if(this._isDefaultOrHistoricVersion())return{success:!1};if(!this.usePersistentReadSessions){const i=await this.versionManagementService.startReadingWithResult(this.currentVersion);if(!i.success)return i;this.state="lock-read"}const e=await this.versionManagementService.startEditingWithResult(this.currentVersion);return e.success&&(this.state="lock-write"),e}async stopEditing(e){if(this._isDefaultOrHistoricVersion())return{success:!1};const i=await this.versionManagementService.stopEditingWithResult(this.currentVersion,e);if(!i.success)return i;if(this.state="lock-read",!this.usePersistentReadSessions){const t=await this.versionManagementService.stopReadingWithResult(this.currentVersion);return t.success&&(this.state="lock-none"),t}return i}async changeVersion(e){let i=null;if(this.usePersistentReadSessions){if(this._isDefaultOrHistoricVersion(e))e&&"name"in e?(i=await this.versionManagementService.getVersionInfoExtended(e),this.state=i?.access==="public"?"lock-none":"lock-read"):this.state="lock-read";else if(!await this.versionManagementService.startReading(e))throw new h("versioning:failed-lock","Failed to acquire read lock for version: "+e);this._isDefaultOrHistoricVersion(this.currentVersion)||await this.versionManagementService.stopReading(this.currentVersion)}const t=await this.versionManagementService.changeVersionWithResult(this.versionableItems,this.currentVersion,e);let o=!1;return t.forEach((n,s)=>{o=o||n.success}),o&&(this.currentVersion=e,this.currentVersionInfo=i||await this.getVersionInfoExtended(),this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state=this.currentVersionInfo?.access==="public"?"lock-none":"lock-read":this.state="lock-read":this.state=this.versionManagementService.getLockType(this.currentVersion)!=="read"?"lock-none":"lock-read"),t}async undo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.undo(this.currentVersion),{success:!0})}async redo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.redo(this.currentVersion),{success:!0})}async _setUpState(e){await this.versionManagementService.load(e),this.state="lock-none",this.currentVersionInfo=await this.getVersionInfoExtended(),this.versionableItems.forEach(i=>{this.currentVersion?"name"in this.currentVersion?(i.gdbVersion=this.currentVersion.name,i.historicMoment=null):(i.historicMoment=this.currentVersion,i.gdbVersion=null):(i.gdbVersion=null,i.historicMoment=null)}),this.usePersistentReadSessions&&(this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state=this.currentVersionInfo?.access==="public"?"lock-none":"lock-read":this.state="lock-read":await this.versionManagementService.startReading(this.currentVersion)&&(this.state="lock-read"))}_isDefaultOrHistoricVersion(e=this.currentVersion){return!(e&&"name"in e)||e.name===this.versionManagementService.defaultVersionIdentifier.name}};l([d()],g.prototype,"versionManagementService",void 0),l([d()],g.prototype,"featureServiceUrl",void 0),l([d()],g.prototype,"url",void 0),l([d()],g.prototype,"currentVersion",void 0),l([d()],g.prototype,"currentVersionInfo",void 0),l([d()],g.prototype,"versionInfos",void 0),l([d()],g.prototype,"versionableItems",void 0),l([d()],g.prototype,"usePersistentReadSessions",void 0),l([d()],g.prototype,"state",void 0),l([d({readOnly:!0})],g.prototype,"defaultVersionIdentifier",null),l([d({readOnly:!0})],g.prototype,"isDefault",null),g=l([z("esri.versionManagement.VersioningState")],g);const F=g;async function ce(r,e){let i;if("layers"in r){const n=y(r.allTables.concat(r.allLayers).filter(s=>s.type!=="group").toArray());r.utilityNetworks&&r.utilityNetworks.forEach(s=>{const a=y([s]);n.push(...a)}),i=n}else i=new p(r);const t=new Map;for(const n of i){const s=t.get(n.featureServiceUrl);s?s.push(n):t.set(n.featureServiceUrl,new p([n]))}const o=new p;for(const[n,s]of t){const a=new $({url:n});if(await a.load(),!a.versionManagementServiceUrl)continue;const c=new A({url:a.versionManagementServiceUrl});o.push(new F({versionManagementService:c,versionableItems:s,usePersistentReadSessions:e}))}return o}const U=new Map;async function le(r,e=!1){const i=r.map;i.loaded||await i.load();const t=await ce(i,e);return G(U,r,()=>(r.addHandles(W(()=>{U.delete(r),t.forEach(o=>o.destroy())})),t.forEach(o=>o.load().catch(n=>{b.getLogger("esri.versionManagement.VersioningState").error("Failed to load Versioning State",n)})),t))}let u=class extends B{constructor(r){super(r),this._portalLookup=new Map,this._updatingHandlesLoad=new M,this._updatingHandlesExecute=new M,this.executionError=void 0,this.featureServiceLookup=new Map,this.loadError=void 0,this.serverVersionLookup=new Map,this.serviceNameLookup=new Map,this.userLookup=new Map,this.versionAdministratorLookup=new Map,this.versioningStateLookup=new Map,this.view=null,this.versioningStates=null}initialize(){this._viewChangeHandle(),this.addHandles([k(()=>this.view,()=>{this._resetAllLookupProperties(),this._viewChangeHandle()}),k(()=>this.versioningStates,()=>{this._resetVersioningLookupProperties(),this._setVersioningStatesLookups()})])}destroy(){this._updatingHandlesLoad.destroy(),this._updatingHandlesExecute.destroy()}get state(){return this._updatingHandlesLoad.updating?"loading":this.loadError?"disabled":this._updatingHandlesExecute.updating?"executing":this.executionError?"failed":"ready"}async alterVersion(r){return this._updatingHandlesExecute.addPromise(this._alterVersionInternal(r))}async changeVersion(r,e,i){return this._updatingHandlesExecute.addPromise(this._changeVersionInternal(r,e,i))}async createVersion(r){return this._updatingHandlesExecute.addPromise(this._createVersionInternal(r))}async deleteVersion(r,e,i){return this._updatingHandlesExecute.addPromise(this._deleteVersionInternal(r,e,i))}async getVersionInfos(r){return this._updatingHandlesExecute.addPromise(this._getVersionInfosInternal(r))}async _alterVersionInternal(r){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new h("version-management-view-model:load-error",this.loadError??"");this._setExecutionError();const e=this.versioningStateLookup.get(r.featureServerUrl);if(!e)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new h("version-management-view-model:execution-error",this.executionError??"");if(!this.serverVersionLookup.has(r.featureServerUrl)||this.serverVersionLookup.get(r.featureServerUrl)<=11.1)throw this._logError("version-management-view-model:execution-error","no-valid-enterprise-version"),new h("version-management-view-model:execution-error",this.executionError??"");const{featureServerUrl:i,versionIdentifier:t,...o}=r,n=await e.alterVersion(t,o).catch(s=>{throw this._logExecutionError(s),s});return await this.getVersionInfos(i),n}async _changeVersionInternal(r,e,i){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new h("version-management-view-model:load-error",this.loadError??"");this._setExecutionError();const t=this.versioningStateLookup.get(r);if(!t)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new h("version-management-view-model:execution-error",this.executionError??"");const o={name:e,guid:i};return await t.changeVersion(o).catch(n=>{throw this._logExecutionError(n),n})}_updateVersionableItems(r){this._updatingHandlesLoad.addPromise((async()=>{y(r.added).forEach(e=>{const i=e.featureServiceUrl,t=this.versioningStateLookup.get(i);t&&(t.versionableItems.find(o=>o.versionableItem===e.versionableItem)||t.versionableItems.add(e))}),y(r.removed).forEach(e=>{const{allLayers:i,allTables:t}=this.view.map,o=e.featureServiceUrl,n=this.versioningStateLookup.get(o);if(!n)return void this._logError("version-management-view-model:execution-error","no-version-management-service-found");const s=c=>(c.type==="feature"||c.type==="subtype-group")&&(c.url?.includes(o)??!1);[...i.filter(s),...t.filter(s)].length||(this.featureServiceLookup.delete(o),this.serviceNameLookup.delete(o),this.versioningStateLookup.delete(o),this.versioningStates.remove(n));const a=n.versionableItems.find(c=>c.versionableItem===e.versionableItem);a&&n.versionableItems.remove(a)})})())}async _createVersionInternal(r){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new h("version-management-view-model:load-error",this.loadError??"");this._setExecutionError();const e=r.featureServerUrl,i=this.versioningStateLookup.get(e);if(!i)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new h("version-management-view-model:execution-error",this.executionError??"");const t=this.userLookup.get(e).toUpperCase(),o=this._isEmptyString(r.ownerName)?t:r.ownerName?.trim().toUpperCase();if(o!==t&&this.serverVersionLookup.get(e)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new h("version-management-view-model:execution-error",this.executionError??"");let n=await this.versioningStateLookup.get(e)?.getVersionInfos();if(o?.toUpperCase()==="SDE"&&r.versionName.toUpperCase()==="DEFAULT"||n?.find(a=>a.versionIdentifier.name.toUpperCase()===(o+"."+r.versionName).toUpperCase()||a.versionIdentifier.name.toUpperCase()===(t+"."+r.versionName).toUpperCase()))throw this._logError("version-management-view-model:execution-error","no-valid-version-name"),new h("version-management-view-model:execution-error",this.executionError??"");const s=await i.versionManagementService.createVersion({versionName:r.versionName,access:o!==t?"public":r.access,description:r.description}).catch(a=>{throw this._logExecutionError(a),a});if(o!==t){const{guid:a,name:c}=s.versionIdentifier,v={featureServerUrl:e,versionIdentifier:{guid:a,name:c},access:r.access,ownerName:o};await this.alterVersion(v)||this.deleteVersion(e,t+"."+r.versionName,s.versionIdentifier.guid)}return await this.getVersionInfos(e),n=await this.versioningStateLookup.get(e)?.getVersionInfos(),n?.find(a=>a.versionIdentifier.guid===s.versionIdentifier.guid)}async _deleteVersionInternal(r,e,i){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new h("version-management-view-model:load-error",this.loadError??"");this._setExecutionError();const t=this.versioningStateLookup.get(r);if(!t)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new h("version-management-view-model:execution-error",this.executionError??"");if(this.serverVersionLookup.get(r)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new h("version-management-view-model:execution-error",this.executionError??"");const o={name:e,guid:i};return await t.deleteVersion(o).catch(n=>{throw this._logExecutionError(n),new h("version-management-view-model:execution-error",this.executionError??"")})}async _getVersionInfosInternal(r){if(this.state==="disabled")throw this._logError("version-management-view-model:load-error",this.loadError),new h("version-management-view-model:load-error",this.loadError??"");this._setExecutionError();const e=this.featureServiceLookup.get(r)?.featureService;if(!e)throw this._logError("version-management-view-model:execution-error","no-feature-service-found"),new h("version-management-view-model:execution-error",this.executionError??"");e.loaded||await e.load().catch(n=>{throw this._logExecutionError(n),n});const i=e.url;this.serverVersionLookup.set(i,e.sourceJSON?.currentVersion??0);const t=this.userLookup.get(r);this._portalLookup.get(r)&&t?this.versionAdministratorLookup.set(i,await te(this._portalLookup.get(r),t,"features:user:manageVersions")):this.versionAdministratorLookup.set(i,!1);const o=this.versioningStateLookup.get(r);if(!o)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new h("version-management-view-model:execution-error",this.executionError??"");return o.loaded||await o.load().catch(n=>{throw this._logExecutionError(n),n}),await o.getVersionInfos(!0).catch(n=>{throw this._logExecutionError(n),n})}_isEmptyString(r){return!r||r.trim().length===0}_logError(r,e){switch(b.getLogger(this).error(new h(r,e??"")),r){case"version-management-view-model:load-error":this._setLoadError(e);break;case"version-management-view-model:execution-error":this._setExecutionError(e)}}_logExecutionError(r){this._logError("version-management-view-model:execution-error",r.message)}async _viewChangeHandle(){this._updatingHandlesLoad.addPromise((async()=>{if(this._setLoadError(),!this.view)return void this._setLoadError("no-view-property");if(this.view&&this.view.type!=="2d")return void this._logError("version-management-view-model:load-error","sceneView-not-supported");this.removeHandles("map-change-handle"),this.addHandles([k(()=>this.view?.map,()=>{this._resetAllLookupProperties(),this._mapChangeHandle(this.versioningStates)})],"map-change-handle");const r=await this._getVersioningStates();await this._mapChangeHandle(r)})())}async _mapChangeHandle(r){this._updatingHandlesLoad.addPromise((async()=>{this._setLoadError(),this.removeHandles("map-layers-tables-change-handle"),this.addHandles([P(()=>this.view?.map.allLayers,"change",e=>{(e.added.some(({type:i})=>i==="feature")||e.removed.some(({type:i})=>i==="feature")||e.added.some(({type:i})=>i==="subtype-group")||e.removed.some(({type:i})=>i==="subtype-group"))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(e))}),P(()=>this.view?.map.allTables,"change",e=>{(e.added.some(({type:i})=>i==="feature")||e.removed.some(({type:i})=>i==="feature")||e.added.some(({type:i})=>i==="subtype-group")||e.removed.some(({type:i})=>i==="subtype-group"))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(e))})],"map-layers-tables-change-handle"),await this._propertiesChangeInternal(r)})())}async _propertiesChangeInternal(r){this._updatingHandlesLoad.addPromise((async()=>{const e=o=>o.type==="feature"||o.type==="subtype-group",{allLayers:i,allTables:t}=this.view.map;if(this._setLoadError(),this.featureServiceLookup=ne([...i.filter(e),...t.filter(e)]),this.featureServiceLookup.size){this._updateFeatureServiceLookup(r),this.serviceNameLookup=new Map;for(const o of this.featureServiceLookup.values()){const{featureService:n,featureService:{url:s}}=o;if(!this.serviceNameLookup.has(s)){if(n.loaded||await n.load().catch(m=>{b.getLogger(this).error(m)}),!n.versionManagementServiceUrl){this.featureServiceLookup.delete(s);continue}const a=await q(s),c=new Z({authMode:"immediate",url:a});await c.load().catch(m=>{b.getLogger(this).error(m)});const v=c.user?.username;if(!n.loaded||!c.loaded||!v)continue;this.serviceNameLookup.set(J(s),s.split("/").at(-2)),this.userLookup.set(s,v),this._portalLookup.set(s,c)}}r.forEach(o=>this._handleVersioningStateLookupUpdate(o)),await this._updateVersioningStates(r),this.versioningStates=r}else this._logError("version-management-view-model:load-error","no-feature-services")})())}_updateFeatureServiceLookup(r){for(const e of r){const i=e.featureServiceUrl;if(!this.featureServiceLookup.has(i)){const t=new $({url:i}),o=e.versionableItems.toArray().flatMap(n=>n.type==="network"?null:n.versionableItem).filter(n=>!!n);this.featureServiceLookup.set(i,{featureService:t,layers:o})}}}async _updateVersioningStates(r){for(const e of this.featureServiceLookup.values()){const i=e.featureService;if(i.versionManagementServiceUrl){if(!r.find(t=>t.featureServiceUrl===i.url)&&i.versionManagementServiceUrl){const t=new p(y(e.layers)),o=new F({versionManagementService:new A({url:i.versionManagementServiceUrl}),versionableItems:t});r.add(o),this._handleVersioningStateLookupUpdate(o)}await this.getVersionInfos(i.url)}}}async _getVersioningStates(){return this.versioningStates&&this.versioningStates.length?this.versioningStates:this.view?await le(this.view,!1):(this._logError("version-management-view-model:load-error","no-view-property"),new p)}_handleVersioningStateLookupUpdate(r){this.versioningStateLookup.set(r.featureServiceUrl,r)}async _setVersioningStatesLookups(){this._updatingHandlesLoad.addPromise((async()=>{this.versioningStates&&(this._updateFeatureServiceLookup(this.versioningStates),this.versioningStates.forEach(r=>this._handleVersioningStateLookupUpdate(r)),await this._updateVersioningStates(this.versioningStates))})())}_resetVersioningLookupProperties(){this.versioningStateLookup=new Map}_resetAllLookupProperties(){this._portalLookup=new Map,this.serverVersionLookup=new Map,this.userLookup=new Map,this.versioningStates=new p,this._resetVersioningLookupProperties(),this._resetServiceRelatedLookupProperties()}_resetServiceRelatedLookupProperties(){this.featureServiceLookup=new Map,this.serviceNameLookup=new Map}_setExecutionError(r){this._set("executionError",r)}_setLoadError(r){this._set("loadError",r)}};l([d()],u.prototype,"_portalLookup",void 0),l([d({readOnly:!0})],u.prototype,"executionError",void 0),l([d()],u.prototype,"featureServiceLookup",void 0),l([d({readOnly:!0})],u.prototype,"loadError",void 0),l([d()],u.prototype,"serverVersionLookup",void 0),l([d()],u.prototype,"serviceNameLookup",void 0),l([d({readOnly:!0})],u.prototype,"state",null),l([d()],u.prototype,"userLookup",void 0),l([d()],u.prototype,"versionAdministratorLookup",void 0),l([d()],u.prototype,"versioningStateLookup",void 0),l([d()],u.prototype,"view",void 0),l([d()],u.prototype,"versioningStates",void 0),u=l([z("esri.widgets.VersionManagement.VersionManagementViewModel")],u);const de=u;const he=re`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}.esri-hidden{display:none!important}[class^=esri-icon-],[class*=" esri-icon-"]{speak:none;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:var(--calcite-font-weight-normal);line-height:1;font-family:CalciteWebCoreIcons!important}.esri-icon-close:before{content:"";color:inherit}.esri-icon-drag-horizontal:before{content:"";color:inherit}.esri-icon-drag-vertical:before{content:"";color:inherit}.esri-icon-handle-horizontal:before{content:"";color:inherit}.esri-icon-handle-vertical:before{content:"";color:inherit}.esri-icon-check-mark:before{content:"";color:inherit}.esri-icon-left-triangle-arrow:before{content:"";color:inherit}.esri-icon-right-triangle-arrow:before{content:"";color:inherit}.esri-icon-down-arrow:before{content:"";color:inherit}.esri-icon-up-arrow:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-left:before{content:"";color:inherit}.esri-icon-overview-arrow-bottom-right:before{content:"";color:inherit}.esri-icon-overview-arrow-top-left:before{content:"";color:inherit}.esri-icon-overview-arrow-top-right:before{content:"";color:inherit}.esri-icon-maximize:before{content:"";color:inherit}.esri-icon-minimize:before{content:"";color:inherit}.esri-icon-checkbox-unchecked:before{content:"";color:inherit}.esri-icon-checkbox-checked:before{content:"";color:inherit}.esri-icon-radio-unchecked:before{content:"";color:inherit}.esri-icon-radio-checked:before{content:"";color:inherit}.esri-icon-up-arrow-circled:before{content:"";color:inherit}.esri-icon-down-arrow-circled:before{content:"";color:inherit}.esri-icon-left-arrow-circled:before{content:"";color:inherit}.esri-icon-right-arrow-circled:before{content:"";color:inherit}.esri-icon-zoom-out-fixed:before{content:"";color:inherit}.esri-icon-zoom-in-fixed:before{content:"";color:inherit}.esri-icon-refresh:before{content:"";color:inherit}.esri-icon-edit:before{content:"";color:inherit}.esri-icon-authorize:before{content:"";color:inherit}.esri-icon-map-pin:before{content:"";color:inherit}.esri-icon-blank-map-pin:before{content:"";color:inherit}.esri-icon-table:before{content:"";color:inherit}.esri-icon-plus:before{content:"+";color:inherit}.esri-icon-minus:before{content:"";color:inherit}.esri-icon-beginning:before{content:"";color:inherit}.esri-icon-reverse:before{content:"";color:inherit}.esri-icon-pause:before{content:"";color:inherit}.esri-icon-play:before{content:"";color:inherit}.esri-icon-forward:before{content:"";color:inherit}.esri-icon-end:before{content:"";color:inherit}.esri-icon-erase:before{content:"";color:inherit}.esri-icon-up-down-arrows:before{content:"";color:inherit}.esri-icon-left:before{content:"";color:inherit}.esri-icon-right:before{content:"";color:inherit}.esri-icon-announcement:before{content:"";color:inherit}.esri-icon-notice-round:before{content:"";color:inherit}.esri-icon-notice-triangle:before{content:"";color:inherit}.esri-icon-home:before{content:"";color:inherit}.esri-icon-locate:before{content:"";color:inherit}.esri-icon-expand:before{content:"";color:inherit}.esri-icon-collapse:before{content:"";color:inherit}.esri-icon-layer-list:before{content:"";color:inherit}.esri-icon-basemap:before{content:"";color:inherit}.esri-icon-globe:before{content:"";color:inherit}.esri-icon-applications:before{content:"";color:inherit}.esri-icon-arrow-up-circled:before{content:"";color:inherit}.esri-icon-arrow-down-circled:before{content:"";color:inherit}.esri-icon-arrow-left-circled:before{content:"";color:inherit}.esri-icon-arrow-right-circled:before{content:"";color:inherit}.esri-icon-minus-circled:before{content:"";color:inherit}.esri-icon-plus-circled:before{content:"";color:inherit}.esri-icon-add-attachment:before{content:"";color:inherit}.esri-icon-attachment:before{content:"";color:inherit}.esri-icon-calendar:before{content:"";color:inherit}.esri-icon-close-circled:before{content:"";color:inherit}.esri-icon-browser:before{content:"";color:inherit}.esri-icon-collection:before{content:"";color:inherit}.esri-icon-comment:before{content:"";color:inherit}.esri-icon-configure-popup:before{content:"";color:inherit}.esri-icon-contact:before{content:"";color:inherit}.esri-icon-dashboard:before{content:"";color:inherit}.esri-icon-deny:before{content:"";color:inherit}.esri-icon-description:before{content:"";color:inherit}.esri-icon-directions:before{content:"";color:inherit}.esri-icon-directions2:before{content:"";color:inherit}.esri-icon-documentation:before{content:"";color:inherit}.esri-icon-duplicate:before{content:"";color:inherit}.esri-icon-review:before{content:"";color:inherit}.esri-icon-environment-settings:before{content:"";color:inherit}.esri-icon-error:before{content:"";color:inherit}.esri-icon-error2:before{content:"";color:inherit}.esri-icon-experimental:before{content:"";color:inherit}.esri-icon-feature-layer:before{content:"";color:inherit}.esri-icon-filter:before{content:"";color:inherit}.esri-icon-grant:before{content:"";color:inherit}.esri-icon-group:before{content:"";color:inherit}.esri-icon-key:before{content:"";color:inherit}.esri-icon-labels:before{content:"";color:inherit}.esri-icon-tag:before{content:"";color:inherit}.esri-icon-layers:before{content:"";color:inherit}.esri-icon-left-arrow:before{content:"";color:inherit}.esri-icon-right-arrow:before{content:"";color:inherit}.esri-icon-link-external:before{content:"";color:inherit}.esri-icon-link:before{content:"";color:inherit}.esri-icon-loading-indicator:before{content:"";color:inherit}.esri-icon-maps:before{content:"";color:inherit}.esri-icon-marketplace:before{content:"";color:inherit}.esri-icon-media:before{content:"";color:inherit}.esri-icon-media2:before{content:"";color:inherit}.esri-icon-menu:before{content:"";color:inherit}.esri-icon-mobile:before{content:"";color:inherit}.esri-icon-phone:before{content:"";color:inherit}.esri-icon-navigation:before{content:"";color:inherit}.esri-icon-pan:before{content:"";color:inherit}.esri-icon-printer:before{content:"";color:inherit}.esri-icon-pie-chart:before{content:"";color:inherit}.esri-icon-chart:before{content:"";color:inherit}.esri-icon-line-chart:before{content:"";color:inherit}.esri-icon-question:before{content:"";color:inherit}.esri-icon-resend-invitation:before{content:"";color:inherit}.esri-icon-rotate:before{content:"";color:inherit}.esri-icon-save:before{content:"";color:inherit}.esri-icon-settings:before{content:"";color:inherit}.esri-icon-settings2:before{content:"";color:inherit}.esri-icon-share:before{content:"";color:inherit}.esri-icon-sign-out:before{content:"";color:inherit}.esri-icon-support:before{content:"";color:inherit}.esri-icon-user:before{content:"";color:inherit}.esri-icon-time-clock:before{content:"";color:inherit}.esri-icon-trash:before{content:"";color:inherit}.esri-icon-upload:before{content:"";color:inherit}.esri-icon-download:before{content:"";color:inherit}.esri-icon-zoom-in-magnifying-glass:before{content:"";color:inherit}.esri-icon-search:before{content:"";color:inherit}.esri-icon-zoom-out-magnifying-glass:before{content:"";color:inherit}.esri-icon-locked:before{content:"";color:inherit}.esri-icon-unlocked:before{content:"";color:inherit}.esri-icon-favorites:before{content:"";color:inherit}.esri-icon-compass:before{content:"";color:inherit}.esri-icon-down:before{content:"";color:inherit}.esri-icon-up:before{content:"";color:inherit}.esri-icon-chat:before{content:"";color:inherit}.esri-icon-dock-bottom:before{content:"";color:inherit}.esri-icon-dock-left:before{content:"";color:inherit}.esri-icon-dock-right:before{content:"";color:inherit}.esri-icon-organization:before{content:"";color:inherit}.esri-icon-north-navigation:before{content:"";color:inherit}.esri-icon-locate-circled:before{content:"";color:inherit}.esri-icon-dial:before{content:"";color:inherit}.esri-icon-polygon:before{content:"";color:inherit}.esri-icon-polyline:before{content:"";color:inherit}.esri-icon-visible:before{content:"";color:inherit}.esri-icon-non-visible:before{content:"";color:inherit}.esri-icon-link-vertical:before{content:"";color:inherit}.esri-icon-unlocked-link-vertical:before{content:"";color:inherit}.esri-icon-link-horizontal:before{content:"";color:inherit}.esri-icon-unlocked-link-horizontal:before{content:"";color:inherit}.esri-icon-swap:before{content:"";color:inherit}.esri-icon-cta-link-external:before{content:"";color:inherit}.esri-icon-reply:before{content:"";color:inherit}.esri-icon-public:before{content:"";color:inherit}.esri-icon-share2:before{content:"";color:inherit}.esri-icon-launch-link-external:before{content:"";color:inherit}.esri-icon-rotate-back:before{content:"";color:inherit}.esri-icon-pan2:before{content:"";color:inherit}.esri-icon-tracking:before{content:"";color:inherit}.esri-icon-expand2:before{content:"";color:inherit}.esri-icon-arrow-down:before{content:"";color:inherit}.esri-icon-arrow-up:before{content:"";color:inherit}.esri-icon-hollow-eye:before{content:"";color:inherit}.esri-icon-play-circled:before{content:"";color:inherit}.esri-icon-volume-off:before{content:"";color:inherit}.esri-icon-volume-on:before{content:"";color:inherit}.esri-icon-bookmark:before{content:"";color:inherit}.esri-icon-lightbulb:before{content:"";color:inherit}.esri-icon-sketch-rectangle:before{content:"";color:inherit}.esri-icon-north-navigation-filled:before{content:"";color:inherit}.esri-icon-default-action:before{content:"";color:inherit}.esri-icon-undo:before{content:"";color:inherit}.esri-icon-redo:before{content:"";color:inherit}.esri-icon-cursor:before{content:"";color:inherit}.esri-icon-cursor-filled:before{content:"";color:inherit}.esri-icon-measure:before{content:"";color:inherit}.esri-icon-measure-line:before{content:"";color:inherit}.esri-icon-measure-area:before{content:"";color:inherit}.esri-icon-legend:before{content:"";color:inherit}.esri-icon-sliders:before{content:"";color:inherit}.esri-icon-sliders-horizontal:before{content:"";color:inherit}.esri-icon-cursor-marquee:before{content:"";color:inherit}.esri-icon-lasso:before{content:"";color:inherit}.esri-icon-elevation-profile:before{content:"";color:inherit}.esri-icon-slice:before{content:"";color:inherit}.esri-icon-line-of-sight:before{content:"";color:inherit}.esri-icon-zoom-to-object:before{content:"";color:inherit}.esri-icon-urban-model:before{content:"";color:inherit}.esri-icon-measure-building-height-shadow:before{content:"";color:inherit}.esri-icon-partly-cloudy:before{content:"";color:inherit}:host{max-width:fit-content}.arcgis-version-management{.component-container-flow{width:350px}.invalid-initial-version-notice{margin-bottom:1rem}.service-items-panel{z-index:unset!important}calcite-block{margin:0}}`,ue=ae(de),N="map-components:version-management",S=class S extends K{constructor(){super(...arguments),this.flowElement=Q(),this.messages=se({blocking:!0}),this.viewModel=ue(this),this._isInitialVersionInvalid=new Map,this._initialVersionInfos=[],this._showInvalidFeatureServiceNotice=!1,this.allowEditingDisabled=!1,this.autoDestroyDisabled=!1,this.closable=!1,this.pageSize=5,this.state=this.viewModel.state,this.versioningStates=this.viewModel.versioningStates,this.view=this.viewModel.view,this.arcgisReady=C(),this.arcgisVersioningStateChanged=C()}get initialVersionInfos(){return this._initialVersionInfos}set initialVersionInfos(e){this._initialVersionInfos=e.map(i=>({...i,url:this._removeTrailingSlash(i.url)}))}async destroy(){await this.manager.destroy()}async load(){X(()=>this.viewModel.state==="ready").then(()=>{this.initialVersionInfos.forEach(e=>{try{this._changeToInitialVersion(e)}catch(i){console.error(i)}})}),this.manager.onLifecycle(()=>[k(()=>this.viewModel.state,e=>{const{flowElement:{value:i},versionList:t}=this,o=i?.getElementsByTagName("arcgis-version-management-version-properties")[0];if(e==="disabled"&&i){o&&this._removeVersionPropertiesFlowItem(i),t&&this._removeVersionListFlowItem(i);return}t&&(t.versionListElementProps={...t.versionListElementProps,executionError:this.viewModel.executionError},t.versionListElementProps={...t.versionListElementProps,state:e}),o&&(o.versionPropertiesElementProps={...o.versionPropertiesElementProps,state:e})})])}disconnectedCallback(){super.disconnectedCallback(),this.versionPropertiesContainer?.remove()}_removeTrailingSlash(e){return e.replace(/\/+$/u,"")}_createVersionPropertiesFlowItem(e,i){const{closable:t,viewModel:o,viewModel:{state:n}}=this,s={closable:t,currentUser:o.userLookup.get(e),isVersionAdministrator:o.versionAdministratorLookup.get(e),serviceUrl:e,state:n,strings:this.messages,versionInfo:i};this.versionPropertiesContainer=document.createElement("div");const a=Y(V`<arcgis-version-management-version-properties .versionPropertiesElementProps=${s} selected show-back-button></arcgis-version-management-version-properties>`,this.versionPropertiesContainer),c=Array.from(a.parentNode.childNodes).find(v=>v.nodeName.toUpperCase()==="ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES");return this.listenOn(c,"arcgisFlowItemBack",()=>{this._removeVersionPropertiesFlowItem(this.flowElement.value)}),this.listenOn(c,"calciteFlowItemBack",v=>{v.preventDefault(),this._removeVersionPropertiesFlowItem(this.flowElement.value),this.versionList&&(this.versionList.selected=!0)}),this.listenOn(c,"calciteFlowItemClose",this._handleFlowItemClose),this.listenOn(c,"arcgisCreateVersion",this._handleCreateVersion),this.listenOn(c,"arcgisAlterVersion",this._handleAlterVersion),c}_getLoadError(e){const{messages:i}=this;switch(e){case"no-feature-services":return i.loadErrors.noFeatureServices;case"no-view-property":return i.loadErrors.noViewProperty;default:return e}}async _handleAlterVersion(e){const{flowElement:{value:i},viewModel:t}=this,{alterVersionParameters:o}=e.detail;await t.alterVersion(o).then(async n=>{n&&this.arcgisVersioningStateChanged.emit({type:"version-changed",versionIdentifier:o.versionIdentifier,versioningState:t.versioningStateLookup.get(o.featureServerUrl)}),await this._refreshVersionList(o.featureServerUrl)}).finally(()=>{i&&this._removeVersionPropertiesFlowItem(i)})}_handleCreateVersion(e){const{flowElement:{value:i},viewModel:t}=this,{createVersionParameters:o,switchToVersion:n}=e.detail;t.createVersion(o).then(async s=>{s&&this.arcgisVersioningStateChanged.emit({type:"version-created",versionIdentifier:s.versionIdentifier,versioningState:t.versioningStateLookup.get(o.featureServerUrl)}),n&&await this.viewModel.changeVersion(o.featureServerUrl,s.versionIdentifier.name,s.versionIdentifier.guid).then(a=>{a&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:s.versionIdentifier,versioningState:t.versioningStateLookup.get(o.featureServerUrl)})}),await this._refreshVersionList(o.featureServerUrl)}).finally(()=>{i&&this._removeVersionPropertiesFlowItem(i)})}_changeToInitialVersion(e){const{_isInitialVersionInvalid:i,viewModel:t}=this,{url:o,name:n}=e,s=t.versioningStateLookup.get(o);if(!s)throw this._showInvalidFeatureServiceNotice=!0,new Error(`${N} - no versioning state found for feature service ${o}`);const a=s?.versionInfos.find(m=>m.versionIdentifier.name===n);if(!a)throw i.set(o,!0),new Error(`${N} - version ${n} not found in the versioning state for feature service ${o}`);const c=a.versionIdentifier,v=s?.currentVersionInfo?.versionIdentifier;c.guid!==v?.guid&&t.changeVersion(o,c.name,c.guid)}_handleFlowItemClose(){const e=document.querySelector("arcgis-version-management");e.parentElement?.removeChild(e)}async _handleNewVersionAction(e){const i=this._createVersionPropertiesFlowItem(e.detail.serviceUrl,void 0);this.flowElement.value?.appendChild(i),this.versionList&&(this.versionList.selected=!1)}async _handleManageVersionAction(e){const{actionType:i,serviceUrl:t,versionInfo:o}=e.detail,{viewModel:n,flowElement:s}=this;switch(i){case"changeVersion":{n.changeVersion(t,o.versionIdentifier.name,o.versionIdentifier.guid).then(a=>{a&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:o.versionIdentifier,versioningState:n.versioningStateLookup.get(t)});const{versionList:c}=this;c&&(c.versionListElementProps={...c.versionListElementProps,currentVersionIdentifier:n.versioningStateLookup.get(t).currentVersionInfo.versionIdentifier})});break}case"deleteVersion":{n.deleteVersion(t,o.versionIdentifier.name,o.versionIdentifier.guid).then(async a=>{a&&this.arcgisVersioningStateChanged.emit({type:"version-deleted",versionIdentifier:o.versionIdentifier,versioningState:n.versioningStateLookup.get(t)}),await this._refreshVersionList(t)});break}case"editVersion":{const a=this._createVersionPropertiesFlowItem(t,o);s.value?.appendChild(a),this.versionList&&(this.versionList.selected=!1);break}}}async _refreshVersionList(e){const{flowElement:{value:i},versionList:t,viewModel:o}=this;if(i){const n=await o.getVersionInfos(e),s=i.getElementsByTagName("arcgis-version-management-service-item");for(const a of s)a.serviceItemElementProps.serviceUrl===e&&(a.serviceItemElementProps={...a.serviceItemElementProps,versionInfos:n});t&&(t.versionListElementProps={...t.versionListElementProps,currentVersionIdentifier:o.versioningStateLookup.get(e).currentVersionInfo.versionIdentifier,versionInfos:n})}}_removeVersionListFlowItem(e){for(const i of e.childNodes)i.nodeName.toUpperCase()==="ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"&&(e.removeChild(i),this.versionList=void 0),i.nodeName.toUpperCase()==="CALCITE-FLOW-ITEM"&&(i.hidden=!1)}_removeVersionPropertiesFlowItem(e){for(const i of e.childNodes)i.nodeName.toUpperCase()==="ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES"&&e.removeChild(i)}render(){const{allowEditingDisabled:e,closable:i,flowElement:{value:t},initialVersionInfos:o,_isInitialVersionInvalid:n,label:s,messages:a,mode:c,pageSize:v,versionList:m,viewModel:w,viewModel:{loadError:L,state:_}}=this,H=Array.from(w.serviceNameLookup,([f,x])=>({url:f,name:x})),R=_!=="disabled"?H.map(f=>{const x={allowEditing:!e,closable:i,currentUser:w.userLookup.get(f.url),currentVersionIdentifier:w.versioningStateLookup.get(f.url).currentVersionInfo.versionIdentifier,executionError:void 0,flowElement:t,heading:s,initialVersionInfos:o,isInitialVersionInvalid:n,isVersionAdministrator:w.versionAdministratorLookup.get(f.url),isVersioningApiAvailable:(w.serverVersionLookup.get(f.url)??0)>=11.2,mode:c,pageSize:v,serviceName:f.name,state:_,serviceUrl:f.url,strings:a,versionInfos:w.versioningStateLookup.get(f.url)?.versionInfos??[]};return V`<arcgis-version-management-service-item .serviceItemElementProps=${x} @arcgisFlowItemBack=${()=>{t&&(this._removeVersionListFlowItem(t),this.versionList=void 0)}} @arcgisFlowItemClose=${()=>this._handleFlowItemClose()} @arcgisGetVersions=${async E=>{await this._refreshVersionList(E.detail.serviceUrl)}} @arcgisManageVersion=${this._handleManageVersionAction} @arcgisNewVersion=${this._handleNewVersionAction} @arcgisCreateVersionList=${E=>this.versionList=E.detail}></arcgis-version-management-service-item>`}):void 0,O=_==="disabled"&&L!=null?V`<calcite-notice class="notice" kind=warning open scale=s slot=footer width=full><div slot=message>${this._getLoadError(L)}</div></calcite-notice>`:void 0,D=this._showInvalidFeatureServiceNotice?V`<calcite-notice closable kind=warning open scale=s slot=content-top width=full icon @calciteNoticeClose=${()=>this._showInvalidFeatureServiceNotice=!1}><div slot=title>${a.headers.invalidInitialFeatureService}</div><div slot=message>${a.loadErrors.invalidInitialFeatureService}</div></calcite-notice>`:void 0;return V`<div class="arcgis-version-management"><calcite-flow custom-item-selectors="arcgis-version-management-version-list, arcgis-version-management-version-properties" class=${ee(this.mode==="dialog"?"":"component-container-flow")} ${ie(this.flowElement)}><calcite-flow-item .closable=${this.closable} .heading=${s??void 0} @calciteFlowItemClose=${()=>this._handleFlowItemClose()} .selected=${!m}>${D}<calcite-panel class="service-items-panel" .loading=${_==="loading"||_==="executing"}>${R}${O}</calcite-panel></calcite-flow-item></calcite-flow></div>`}};S.properties={versionList:16,_showInvalidFeatureServiceNotice:16,allowEditingDisabled:5,autoDestroyDisabled:5,closable:7,initialVersionInfos:0,icon:1,label:3,messageOverrides:0,mode:1,pageSize:9,position:1,referenceElement:1,state:3,versioningStates:0,view:0},S.styles=he;let I=S;oe("arcgis-version-management",I);export{I as ArcgisVersionManagement};
