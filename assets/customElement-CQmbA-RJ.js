import{cB as Ze,cQ as G,ki as Xe,eK as Ye,au as et,av as ge,ey as tt,a7 as j,a5 as l,x as d,cg as ie,y as A,cf as ae,dd as de,d6 as B,aX as Ce,dD as it,D$ as at,kr as rt,uw as we,uu as ot,qb as q,E0 as pe,pE as st,b5 as nt,ht as Z,at as ve,BW as lt,al as De,a4 as X,bI as C,cn as dt,CF as pt,ez as ct,co as ut,j as N,bH as ce,aV as ue,m_ as ht,i$ as yt,cR as mt,ep as ft,ch as Me,E1 as gt,b3 as wt,E2 as vt,E3 as be,aP as _e,ny as xe,E4 as Te,eX as Ie,eM as bt,lz as _t,Y as Ae,V as xt,c3 as Tt,n3 as It,L as St,b as Ot,u as kt,c as Lt,B as Se,d as Y,_ as Et,e as Oe,f as F,v as $t,i as Pt,l as Ct}from"./index-Brd6-W-v.js";import{l as Dt,S as Mt,O as At,s as Fe}from"./submitJob-D8nyJcJi.js";import{a as Ft}from"./GPMessage-CW1P0x_K.js";import"./networkEnums-DxmX55hr.js";async function Ue(e,i,t,a){return t=Dt.from(t||{}),Mt(e,"execute",t,i??{},a).then(async({data:r})=>({results:await Promise.all(r.results?.map(At)??[]),messages:r.messages?.map(o=>Ft.fromJSON(o))??[]}))}const re=Ze()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"},{ignoreUnknown:!1}),oe=new G({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),V=oe.fromJSON.bind(oe),Ut=oe.toJSON.bind(oe);function Nt(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Vt(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function ke(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function zt(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function Bt(e,i=15){const t=e.canvas.width,a=e.canvas.height,r=e.getImageData(0,0,t,a).data;let o,s,p,n,c,h;e:for(s=a;s--;)for(o=t;o--;)if(r[4*(t*s+o)+3]>i){h=s;break e}if(!h)return null;e:for(o=t;o--;)for(s=h+1;s--;)if(r[4*(t*s+o)+3]>i){c=o;break e}e:for(o=0;o<=c;++o)for(s=h+1;s--;)if(r[4*(t*s+o)+3]>i){p=o;break e}e:for(s=0;s<=h;++s)for(o=p;o<=c;++o)if(r[4*(t*s+o)+3]>i){n=s;break e}return{x:p,y:n,width:c-p,height:h-n}}function Ne(e){if(!e.attributionVisible)return;let i;return typeof e.originOf=="function"&&e.originOf("copyright")==="user"&&(i=e.copyright),i||!e.hasAttributionData?(i??=e.portalItem?.accessInformation,i??=e.copyright,i??void 0):void 0}function Rt(e,i){const t=i.color?.clone()??new Ye([0,255,255]),a=i.haloColor?.clone()??t.clone();switch(e){case"envelope":case"polygon":return t.a*=i.fillOpacity??.25,new tt({color:t,outline:new ge({color:a}),style:"solid"});case"polyline":return new ge({color:a});default:return a.a=1,new et({color:a,outline:null})}}function Jt(e,i){const t=e.allLayerViews.items;if(i===e.scale)return t.filter(r=>!r.suspended);const a=new Array;for(const r of t){const o=r.parent;o&&o!==r.view&&(Ht(o)||Gt(o))&&!a.includes(o)||r.visible&&r.visibleAtCurrentTimeExtent&&Xe(r.layer.effectiveScaleRange,i)&&a.push(r)}return a}function Wt(e){return e?.type==="bing-maps"}function Ve(e){return e&&"blendMode"in e&&"effect"in e}function Ht(e){return e.layer.type==="catalog"}function Gt(e){return e.layer.type==="group"}function jt(e){return e&&"trackInfo"in e}function qt(e){const i=e.layer;if(Ve(i)){const t=i.blendMode;if((!t||t==="normal")&&(i.effect||"featureEffect"in e&&e.featureEffect))return!0}return!(!jt(i)||!i.trackInfo?.enabled)}let S=class extends j{constructor(i){super(i),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};l([d()],S.prototype,"attributionVisible",void 0),l([d()],S.prototype,"exportOptions",void 0),l([d()],S.prototype,"forceFeatureAttributes",void 0),l([d()],S.prototype,"format",void 0),l([d()],S.prototype,"includeCharts",void 0),l([d()],S.prototype,"includeTables",void 0),l([d()],S.prototype,"label",void 0),l([d()],S.prototype,"layout",void 0),l([d({type:ie})],S.prototype,"layoutItem",void 0),l([d()],S.prototype,"layoutOptions",void 0),l([d()],S.prototype,"outScale",void 0),l([d()],S.prototype,"report",void 0),l([d({type:ie})],S.prototype,"reportItem",void 0),l([d()],S.prototype,"reportOptions",void 0),l([d()],S.prototype,"scalePreserved",void 0),l([d()],S.prototype,"showLabels",void 0),S=l([A("esri.rest.support.PrintTemplate")],S);const ze=S,se=new G({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});se.fromJSON.bind(se);const Kt=se.toJSON.bind(se),Le={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},Ee=new G({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Be=new G({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),he=new Map;async function Qt(e,i,t){const a=await fe(e,t),r=await ei(i,a);if(await Zt(e,t)==="sync"){const{results:p}=await Ue(e,r,void 0,t);return p?.[0]?.value}const o=await Fe(e,r,void 0,t);await o.waitForJobCompletion({interval:i.updateDelay});const{value:s}=await o.fetchResultData("Output_File",null,t);return s}async function fe(e,i){const t=ii(e),a=he.get(t)??{gpServerUrl:t,legendLayerNameMap:{},legendLayers:[]};return a.gpMetadata??=(await ae(t,de({f:"json"},i))).data,a.cimVersion=a.gpMetadata.cimVersion,a.webStyleCache??=new Map,he.set(t,a),a}async function Zt(e,i){return Si(await fe(e,i))}async function Xt(e,i){const t=await fe(e,i),a=t.gpMetadata.tasks,r=t.gpServerUrl;if(t.taskInfos)return t.taskInfos;const o=(await ae(e,de({f:"json"},i))).data;t.taskInfos={ExportWebMap:o};const s=a?.filter(p=>p!==o.name)??[];return await Promise.all(s.map(async p=>{const n=(await ae(`${r}/${p}`,de({f:"json"},i))).data,c=n.name.startsWith("GetLayoutTemplatesInfo")?"GetLayoutTemplatesInfo":null;c&&(t.taskInfos[c]??=n)})),t.taskInfos}async function ye(e,i,t){return(await Xt(e,t))[i]??null}async function Yt(e,i,t){const a=await ye(e,i,t);return a?.executionType?Be.fromJSON(a.executionType):"sync"}async function ei(e,i){i=i||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const t=e.template||new ze;t.showLabels==null&&(t.showLabels=!0);const a=t.exportOptions;let r;const o=Ut(t.layout);if(a&&(r={dpi:a.dpi},o?.toLowerCase()==="map_only"||o==="")){const{width:u,height:y}=a;r.outputSize=u!=null&&y!=null?[u,y]:void 0}const s=t.layoutOptions;let p;if(s){let u,y;s.scalebarUnit==="Miles"||s.scalebarUnit==="Kilometers"?(u="Kilometers",y="Miles"):s.scalebarUnit!=="Meters"&&s.scalebarUnit!=="Feet"||(u="Meters",y="Feet"),p={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,elementOverrides:s.elementOverrides,scaleBarOptions:u||y?{metricUnit:Ee.toJSON(u)??void 0,metricLabel:u?Le[u]:void 0,nonMetricUnit:Ee.toJSON(y)??void 0,nonMetricLabel:y?Le[y]:void 0}:void 0}}let n=null;s?.legendLayers&&(n=s.legendLayers.map(u=>{const y=u.layerId;i.legendLayerNameMap[y]=u.title;const b={id:y};return u.subLayerIds&&(b.subLayerIds=u.subLayerIds),b}));const c=await ti(e,t,i);if(c.operationalLayers){const u=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),y=/[\u0600-\u06FF]/,b=f=>{const x=f.text,m=f.font,g=m?.family?.toLowerCase();x&&m&&(g==="arial"||g==="arial unicode ms")&&(m.family=u.test(x)?"Arial Unicode MS":"Arial",m.style!=="normal"&&y.test(x)&&(m.family="Arial Unicode MS"))};for(const f of c.operationalLayers)if(f.featureCollection?.layers)for(const x of f.featureCollection.layers){if(x.layerDefinition?.drawingInfo?.renderer?.symbol){const m=x.layerDefinition.drawingInfo.renderer;m.symbol.type==="esriTS"&&b(m.symbol)}if(x.featureSet?.features)for(const m of x.featureSet.features)m.symbol&&m.symbol.type==="esriTS"&&b(m.symbol)}}e.outSpatialReference&&(c.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(c,{exportOptions:r,layoutOptions:p||{}}),Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:n??i.legendLayers.slice()}}),i.legendLayers.length=0,he.set(i.gpServerUrl,i);const h={Web_Map_as_JSON:JSON.stringify(c),Format:re.toJSON(t.format),Layout_Template:o,Layout_Item_ID:void 0,Report_Template:Kt(t.report),Report_Item_ID:void 0};if(t.layoutItem){delete h.Layout_Template;const u=t.layoutItem;await u.load(),u.access!=="public"&&B&&await B.getCredential(i.gpServerUrl),h.Layout_Item_ID=JSON.stringify({id:u.id})}if(t.reportItem){delete h.Report_Template;const u=t.reportItem;await u.load(),u.access!=="public"&&B&&await B.getCredential(i.gpServerUrl),h.Report_Item_ID=JSON.stringify({id:u.id})}return e.extraParameters&&Object.assign(h,e.extraParameters),h}async function ti(e,i,t){const a=e.view;let r=a.spatialReference;const o={operationalLayers:await ai(a,i,t)};i.includeTables&&(o.tables=await wi(a));let s=e.extent||t.ssExtent||a.extent;if(r?.isWrappable&&(s=s.clone()._normalize(!0),r=s.spatialReference),o.mapOptions={extent:s&&s.toJSON(),spatialReference:r&&r.toJSON(),showAttribution:i.attributionVisible},t.ssExtent=null,a.background&&(o.background=a.background.toJSON()),a.rotation&&(o.mapOptions.rotation=-a.rotation),i.scalePreserved&&(o.mapOptions.scale=i.outScale||a.scale),a.timeExtent!=null){const p=a.timeExtent.start!=null?a.timeExtent.start.getTime():null,n=a.timeExtent.end!=null?a.timeExtent.end.getTime():null;o.mapOptions.time=[p,n]}return i.reportOptions&&(o.reportOptions=i.reportOptions),o}function ii(e){let i=e;const t=i.lastIndexOf("/GPServer/");return t>0&&(i=i.slice(0,t+9)),i}async function ai(e,i,t){const a=[],r={layerView:null,printTemplate:i,view:e};let o=0;i.scalePreserved&&(o=i.outScale||e.scale);const s=Jt(e,o);for(const p of s){const n=p.layer;if(!n.loaded||"layers"in n)continue;let c;r.layerView=p,c=qt(p)?await M(n,r,t):Wt(n)?ri(n):n?.type==="csv"?await si(n,r,t):n?.type==="catalog-footprint"?await oi(n,r,t):n?.type==="feature"?await ni(n,r,t):n?.type==="geojson"?await li(n,r,t):n?.type==="graphics"?await di(n,r,t):n?.type==="imagery"?pi(n,t):n?.type==="imagery-tile"?await ci(n,r,t):n?.type==="kml"?await ui(n,r,t):n?.type==="map-image"?hi(n,r,t):n?.type==="map-notes"?await yi(r,t):n?.type==="open-street-map"?mi():n?.type==="stream"?await fi(n,r,t):n?.type==="subtype-group"?await gi(n,t):n?.type==="tile"?vi(n,t):n?.type==="vector-tile"?await bi(n,r,t):n?.type==="web-tile"?_i(n):n?.type==="wfs"?await xi(n,r,t):n?.type==="wms"?Ti(n,t):n?.type==="wmts"?Ii(n):await M(n,r,t),c&&(Array.isArray(c)?a.push(...c):(c.id=n.id,c.title=t.legendLayerNameMap[n.id]||n.title,c.opacity=p.fullOpacity,c.minScale=n.minScale||0,c.maxScale=n.maxScale||0,Ve(n)&&n.blendMode&&n.blendMode!=="normal"&&(c.blendMode=n.blendMode),a.push(c)))}if(o)for(const p of a)p.minScale=0,p.maxScale=0;if(e.graphics?.length){const p=await $(null,e.graphics,i,t);p&&a.push(p)}return a}function ri(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function oi(e,{layerView:i,printTemplate:t},a){if(parseFloat(a.cimVersion)<3.1)return $(e,await K(i),t,a);const r=e.parent,o={id:(s=L(r,"web-map")).id,url:s.url,layerType:s.layerType,customParameters:s.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:s.footprintLayer,layerDefinition:s.layerDefinition};var s;return D(o,r),o}async function si(e,i,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const a=i.layerView,r=i.printTemplate;if(!(a.filter||e.portalItem&&e.portalItem.access!=="public")){const o=L(e,"web-map");return o.type="CSV",delete o.popupInfo,delete o.layerType,o.showLabels=r.showLabels&&e.labelsVisible,o}return $(e,await K(a),r,t)}async function $(e,i,t,a){let r;const o=Vt(),s=zt(),p=ke(),n=Nt(),c=ke();if(c.layerDefinition.name="textLayer",delete c.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?o.layerDefinition.name=s.layerDefinition.name=p.layerDefinition.name=n.layerDefinition.name=a.legendLayerNameMap[e.id]||e.arcgisProps?.title||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(i=e.graphics.items),e.renderer){const m=e.renderer.toJSON(),g=o.layerDefinition.drawingInfo;g&&(g.renderer=m);const v=s.layerDefinition.drawingInfo;v&&(v.renderer=m);const _=p.layerDefinition.drawingInfo;_&&(_.renderer=m);const k=n.layerDefinition.drawingInfo;k&&(k.renderer=m)}if(t.showLabels&&e.labelsVisible&&typeof e.write=="function"){const m=L(e,"web-map"),g=m.layerDefinition?.drawingInfo?.labelingInfo;if(g){r=!0;const v=o.layerDefinition.drawingInfo;v&&(v.labelingInfo=g);const _=s.layerDefinition.drawingInfo;_&&(_.labelingInfo=g);const k=p.layerDefinition.drawingInfo;k&&(k.labelingInfo=g);const Q=n.layerDefinition.drawingInfo;Q&&(Q.labelingInfo=g)}}}let h;e?.renderer||r||(delete o.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete p.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo);const u=e?.fieldsIndex,y=e?.renderer;if(u){const m=new Set;r&&await st(m,e),y&&typeof y.collectRequiredFields=="function"&&await y.collectRequiredFields(m,u),h=Array.from(m);const g=u.fields.map(v=>v.toJSON());o.layerDefinition.fields=g,s.layerDefinition.fields=g,p.layerDefinition.fields=g,n.layerDefinition.fields=g}const b=i?.length;let f;for(let m=0;m<b;m++){const g=i[m]||i.at(m);if(g.visible!==!1&&g.geometry){if(f=g.toJSON(),f.hasOwnProperty("popupTemplate")&&delete f.popupTemplate,f.geometry?.z&&delete f.geometry.z,f.symbol&&(f.symbol.angle||delete f.symbol.angle,te(f.symbol)?f.symbol=await ee(f.symbol,a):f.symbol.text&&delete f.attributes),(!t||!t.forceFeatureAttributes)&&h?.length){const v={};for(const _ of h)f.attributes?.hasOwnProperty(_)&&(v[_]=f.attributes[_]);f.attributes=v}g.geometry.type==="polygon"?o.featureSet.features.push(f):g.geometry.type==="polyline"?s.featureSet.features.push(f):g.geometry.type==="point"?f.symbol?.text?c.featureSet.features.push(f):p.featureSet.features.push(f):g.geometry.type==="multipoint"?n.featureSet.features.push(f):g.geometry.type==="extent"&&(f.geometry=nt.fromExtent(g.geometry).toJSON(),o.featureSet.features.push(f))}}const x=[o,s,n,p,c].filter(m=>m.featureSet.features.length>0);for(const m of x){const g=m.featureSet.features.every(v=>v.symbol);if(g&&(!t||!t.forceFeatureAttributes))for(const v of m.featureSet.features)delete v.attributes;g&&delete m.layerDefinition.drawingInfo,m.layerDefinition.drawingInfo?.renderer&&(await Je(m.layerDefinition.drawingInfo.renderer,a),await Re(m.layerDefinition.drawingInfo.renderer,a))}return x.length?{featureCollection:{layers:x},showLabels:r}:null}async function ni(e,i,t){let a;const r=e.renderer,o=parseFloat(t.cimVersion);if(e.featureReduction?.type==="binning"||e.featureReduction?.type==="cluster"&&(o<2.9||e.featureReduction.renderer?.type==="pie-chart")||r?.type==="pie-chart"&&o<3.1||r?.type==="dot-density"&&o<2.6||e.geometryType==="polygon"&&r?.authoringInfo?.visualVariables?.some(u=>u.theme==="spike"))return M(e,i,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const s=i.layerView,{printTemplate:p,view:n}=i,c=e.source?.type!=="feature-layer"&&e.source?.type!=="ogc-feature";if(s.filter||c||!r||"field"in r&&r.field!=null&&!e.getField(r.field)){const u=await K(s);a=await $(e,u,p,t)}else{if(a={id:(h=L(e)).id,title:h.title,url:h.url,layerType:h.layerType,customParameters:h.customParameters,layerDefinition:h.layerDefinition,charts:p.includeCharts?h.charts:void 0},p.attributionVisible&&(a.credits=Ne(e)),a.showLabels=p.showLabels&&e.labelsVisible,D(a,e),delete a.layerDefinition?.featureReduction?.disablePopup,delete a.layerDefinition?.featureReduction?.popupInfo,s.displayFilterEnabled||delete a.layerDefinition?.displayFilterInfo,a.layerDefinition?.drawingInfo?.renderer&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await Je(a.layerDefinition.drawingInfo.renderer,t),await Re(a.layerDefinition.drawingInfo.renderer,t),"visualVariables"in r&&r.visualVariables?.[0])){const y=r.visualVariables[0];if(y.type==="size"&&y.maxSize&&typeof y.maxSize!="number"&&y.minSize&&typeof y.minSize!="number"){const b=at(y,n.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=b.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=b.maxSize}}const u=rt(s);if(u&&(a.layerDefinition??={},a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${u})`:u),e.gdbVersion&&(a.layerDefinition??={},a.layerDefinition.gdbVersion=e.gdbVersion),s.hasHighlight&&"highlightIds"in s){const y=s;a.selectionObjectIds=y.highlightIds;const b=we(y)||we(n)||new ot;a.selectionSymbol=Rt(e.geometryType,b)}}var h;return a}async function li(e,i,t){return e.featureReduction?.type==="binning"||e.featureReduction?.type==="cluster"?M(e,i,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),$(e,await K(i.layerView),i.printTemplate,t))}async function di(e,{printTemplate:i},t){return $(e,null,i,t)}function pi(e,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const t={layerType:(a=L(e)).layerType,customParameters:a.customParameters};var a;return t.bandIds=e.bandIds,t.compressionQuality=e.compressionQuality,t.format=e.format,t.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(t.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(t.layerDefinition??={},t.layerDefinition.drawingInfo??={},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),D(t,e),t}async function ci(e,i,t){if(e.renderer?.type==="flow"||!e.supportsWrite())return M(e,i,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const a={bandIds:(r=L(e)).bandIds,customParameters:r.customParameters,interpolation:r.interpolation,layerDefinition:r.layerDefinition};var r;return a.layerType="ArcGISImageServiceLayer",D(a,e),a}async function ui(e,i,t){const a=i.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const c=L(e,"web-map");return c.type="kml",delete c.layerType,c.url=q(e.url),c}const r=[],o=i.layerView,s="data:image/png;base64,";o.allVisibleMapImages.forEach((c,h)=>{const u={id:`${e.id}_image${h}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:o.fullOpacity,extent:c.extent};c.href.startsWith(s)?u.imageData=c.href.slice(s.length):u.url=c.href,r.push(u)});const p=[...o.allVisiblePoints.items,...o.allVisiblePolylines.items,...o.allVisiblePolygons.items],n={id:e.id,...await $(null,p,a,t)};return r.push(n),r}function hi(e,{printTemplate:i,view:t},a){let r;const o={id:e.id,subLayerIds:[]};let s=[];const p=t.scale,n=h=>{const u=p===0,y=h.minScale===0||p<=h.minScale,b=h.maxScale===0||p>=h.maxScale;if(h.visible&&(u||y&&b))if(h.sublayers)h.sublayers.forEach(n);else{const f=h.toExportImageJSON(),x={id:h.id,name:h.title,layerDefinition:{definitionExpression:f.definitionExpression,drawingInfo:f.drawingInfo,orderBy:f.orderBy,source:f.source}};s.unshift(x),o.subLayerIds.push(h.id)}};var c;return e.sublayers?.forEach(n),s.length&&(s=s.map(({id:h,name:u,layerDefinition:y})=>({id:h,name:u,layerDefinition:y})),r={layerType:(c=L(e)).layerType,customParameters:c.customParameters},r.layers=s,r.visibleLayers=e.capabilities?.exportMap?.supportsDynamicLayers?void 0:o.subLayerIds,i.attributionVisible&&(r.credits=Ne(e)),e.gdbVersion&&(r.gdbVersion=e.gdbVersion),D(r,e),e.legendEnabled&&a.legendLayers.push(o)),r}async function yi({layerView:e,printTemplate:i},t){const a=[],r=e.layer;if(r.featureCollections!=null)for(const o of r.featureCollections){const s=await $(o,o.source,i,t);s&&a.push(...s.featureCollection.layers)}else if(r.sublayers!=null)for(const o of r.sublayers){const s=await $(null,o.graphics,i,t);s&&a.push(...s.featureCollection.layers)}return{featureCollection:{layers:a}}}function mi(){return{type:"OpenStreetMap"}}async function M(e,{printTemplate:i,view:t},a){const r={type:"image"},o={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};t.rotation!==0&&(o.rotation=0);const s=a.ssExtent||t.state.extent.clone();let p=96,n=!0,c=!0;if(i.exportOptions){const u=i.exportOptions;u.dpi!=null&&u.dpi>0&&(p=u.dpi),u.width!=null&&u.width>0&&(n=u.width%2==t.width%2),u.height!=null&&u.height>0&&(c=u.height%2==t.height%2)}if(i.layout==="map-only"&&i.scalePreserved&&(!i.outScale||i.outScale===t.scale)&&p===96&&(!n||!c)&&t.state.extent.equals(t.extent)&&(o.area={x:0,y:0,width:t.width,height:t.height},n||(o.area.width-=1),c||(o.area.height-=1),!a.ssExtent)){const u=t.toMap(Ce(o.area.width,o.area.height));s.ymin=u.y,s.xmax=u.x,a.ssExtent=s}r.extent=s.clone()._normalize(!0).toJSON();const h=await t.takeScreenshot(o);return r.imageData=it(h.dataUrl)?.data,r}async function fi(e,{layerView:i,printTemplate:t},a){return e.legendEnabled&&a.legendLayers.push({id:e.id}),$(e,await K(i),t,a)}async function gi(e,i){if(e.legendEnabled)for(const r of e.sublayers)r.legendEnabled&&i.legendLayers.push({id:r.id});const t={customParameters:(a=L(e)).customParameters,effect:a.effect,layerDefinition:a.layerDefinition,layerType:a.layerType,layers:a.layers,url:a.url};var a;if(D(t,e),Array.isArray(t.layers)){for(const r of t.layers)delete r.popupInfo;t.token&&t.layers.length>0&&(t.layers[t.layers.length-1].token=t.token,delete t.token)}return t}async function wi(e){const i=[],t=[];for(const a of e.map.allTables)a.type!=="feature"||a.loaded||t.push(a.load());t.length&&await Promise.allSettled(t);for(const a of e.map.allTables)if(a.type==="feature"&&a.loaded&&a.isTable&&a.source?.type==="feature-layer"){const r=(o=>({id:o.id,title:o.title,customParameters:o.customParameters,layerDefinition:{definitionExpression:o.layerDefinition?.definitionExpression},url:o.url}))(L(a));D(r,a),i.push(r)}return i.length?i:void 0}function vi(e,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const t={layerType:(a=L(e)).layerType,customParameters:a.customParameters};var a;return D(t,e),t}async function bi(e,i,t){const a=i.layerView;if(e.serviceUrl&&e.styleUrl&&!a.spriteSourceChanged&&!a.styleChanged){const r=pe(e.styleUrl,e.apiKey),o=pe(e.serviceUrl,e.apiKey);if(!r&&!o||t.cimVersion!=="2.1.0"){const s={type:"VectorTileLayer"};return s.styleUrl=q(e.styleUrl),s.token=r,o!==r&&(s.additionalTokens=[{url:e.serviceUrl,token:o}]),s}}return M(e,i,t)}function _i(e){const i=e.urlTemplate?.replaceAll("${","{"),t={type:"WebTiledLayer",urlTemplate:i,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}async function xi(e,i,t){return parseFloat(t.cimVersion)<3.5?M(e,i,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),{layerType:(a=L(e,"web-map")).layerType,layerDefinition:a.layerDefinition,url:a.url,wfsInfo:a.wfsInfo});var a}function Ti(e,i){let t;const a=[],r=o=>{o.visible&&(o.sublayers?o.sublayers.forEach(r):o.name&&a.unshift(o.name))};return e.sublayers&&e.sublayers.forEach(r),a.length&&(e.legendEnabled&&i.legendLayers.push({id:e.id,subLayerIds:a}),t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:q(e.url),version:e.version}),t}function Ii(e){const i=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:i.imageFormat,layer:i.id,style:i.styleId,tileMatrixSet:i.tileMatrixSetId,url:q(e.url)}}function D(e,i){i.url&&(e.url=q(e.url||i.url),e.token=pe(e.url,i.apiKey))}async function ee(e,i){i.canvas||(i.canvas=document.createElement("canvas"));const t=1024;i.canvas.width=t,i.canvas.height=t;const a=i.canvas.getContext("2d");let r,o;if(e.path){const s=new Path2D(e.path);s.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(s);const p=Bt(a);if(!p)return null;a.clearRect(0,0,t,t);const n=Z(e.size)/Math.max(p.width,p.height);a.scale(n,n);const c=t/n,h=c/2-p.width/2-p.x,u=c/2-p.height/2-p.y;if(a.translate(h,u),Array.isArray(e.color)&&a.fill(s),e.outline?.width&&Array.isArray(e.outline.color)){const b=e.outline;a.lineWidth=Z(b.width)/n,a.lineJoin="round",a.strokeStyle=`rgba(${b.color[0]},${b.color[1]},${b.color[2]},${b.color[3]/255})`,a.stroke(s),p.width+=a.lineWidth,p.height+=a.lineWidth}p.width*=n,p.height*=n;const y=a.getImageData(t/2-p.width/2,t/2-p.height/2,Math.ceil(p.width),Math.ceil(p.height));r=y.width,o=y.height,a.canvas.width=r,a.canvas.height=o,a.putImageData(y,0,0)}else{const s=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,p=(await ae(s,{responseType:"image"})).data;r=Z(e.width),o=Z(e.height),a.canvas.width=r,a.canvas.height=o,a.drawImage(p,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:ve(o),width:ve(r),xoffset:e.xoffset,yoffset:e.yoffset}}async function Re(e,i){const t=e.type;if(t==="simple"&&te(e.symbol))e.symbol=await ee(e.symbol,i);else if(t==="uniqueValue"||t==="classBreaks"){te(e.defaultSymbol)&&(e.defaultSymbol=await ee(e.defaultSymbol,i));const a=e[t==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(a)for(const r of a)te(r.symbol)&&(r.symbol=await ee(r.symbol,i))}}async function U(e,i){if(e?.type!=="styleSymbolReference")return e;try{return(await lt.fromJSON(e).fetchSymbol({cache:i.webStyleCache}))?.toJSON()??e}catch{return e}}async function Je(e,i){if(e.type==="simple"&&e.symbol)e.symbol=await U(e.symbol,i);else if(e.type==="uniqueValue"){if(e.defaultSymbol=await U(e.defaultSymbol,i),"uniqueValueInfos"in e&&e.uniqueValueInfos)for(const t of e.uniqueValueInfos)t.symbol=await U(t.symbol,i);if("uniqueValueGroups"in e&&e.uniqueValueGroups)for(const t of e.uniqueValueGroups)for(const a of t.classes)a.symbol=await U(a.symbol,i)}else if(e.type==="classBreaks"){e.defaultSymbol=await U(e.defaultSymbol,i);for(const t of e.classBreakInfos)t.symbol=await U(t.symbol,i)}}async function K(e){return e.queryFeatures(e.createQuery()).then(i=>i.features)}function L(e,i){return e.write({},{ignorePersistenceEnabled:!0,origin:i})??{}}function Si(e){return e.gpMetadata?.executionType?Be.fromJSON(e.gpMetadata.executionType):"sync"}function te(e){return e&&(e.path||e.contentType==="image/svg+xml"||e.url?.endsWith(".svg"))}let P=class extends j{constructor(i){super(i),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};l([d()],P.prototype,"extent",void 0),l([d()],P.prototype,"extraParameters",void 0),l([d({type:De})],P.prototype,"outSpatialReference",void 0),l([d()],P.prototype,"template",void 0),l([d()],P.prototype,"updateDelay",void 0),l([d()],P.prototype,"view",void 0),P=l([A("esri.rest.support.PrintParameters")],P);const Oi=P;let I=class extends j{constructor(i){super(i),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:i,backgroundHeight:t,boxWidth:a,boxHeight:r,padding:o}=this,s=o.left,p=o.top,n=this.x??s+i/2-a/2,c=this.y??p+t/2-r/2,h=n+a,u=c+r;return X("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},X("svg",{styles:{width:"100%",height:"100%"}},X("path",{d:`M ${s} ${p} L ${i+s} ${p} L ${i+s} ${t+p} L ${s} ${t+p} Z M ${n} ${c} L ${n} ${u} L ${h} ${u} L ${h} ${c} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),X("rect",{fill:this._fillStyle,height:r,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:a,x:n,y:c})))}renderCanvas(){}};l([d()],I.prototype,"strokeDash",void 0),l([d()],I.prototype,"strokeWidth",void 0),l([d()],I.prototype,"strokeColor",void 0),l([d()],I.prototype,"strokeBackgroundColor",void 0),l([d()],I.prototype,"fillColor",void 0),l([d()],I.prototype,"backgroundFillColor",void 0),l([d()],I.prototype,"visible",void 0),l([d()],I.prototype,"isDecoration",void 0),l([d()],I.prototype,"boxWidth",void 0),l([d()],I.prototype,"boxHeight",void 0),l([d()],I.prototype,"backgroundWidth",void 0),l([d()],I.prototype,"backgroundHeight",void 0),l([d()],I.prototype,"x",void 0),l([d()],I.prototype,"y",void 0),l([d()],I.prototype,"padding",void 0),l([d({readOnly:!0})],I.prototype,"_strokeStyle",null),l([d({readOnly:!0})],I.prototype,"_strokeBackgroundStyle",null),l([d({readOnly:!0})],I.prototype,"_fillStyle",null),l([d({readOnly:!0})],I.prototype,"_backgroundFillStyle",null),I=l([A("esri.views.overlay.BoxOverlayItem")],I);const ki=I;async function We(e,i,t){if(!e)throw new C("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:e});if(await Yt(e,"GetLayoutTemplatesInfo",t)==="async"){const a=await Fe(e,i,void 0,t||void 0);return await a.waitForJobCompletion(),(await a.fetchResultData("Output_JSON")).value}return(await Ue(e,i,null,t)).results[0].value}const He=new G({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});let O=class extends dt{constructor(e){super(e),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){return this.layoutItem?.id??`${this.layout}-${pt(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){const e=this.layoutTemplateInfo?.layoutOptions?.mapSurroundInfos;if(!e)return null;const i={northArrow:[],scaleBar:[],legend:[]};for(const t of e)switch(t.type){case"CIMMarkerNorthArrow":i.northArrow.push(t);break;case"CIMScaleLine":i.scaleBar.push(t);break;case"CIMGroupElement":t.elements?.some(a=>a.type==="CIMScaleLine")&&i.scaleBar.push(t);break;case"CIMLegend":i.legend.push(t)}return i}get pageUnits(){return He.fromJSON(this.layoutTemplateInfo?.pageUnits?.toLowerCase())}_updateLayoutOptions(e){const i=this.layoutOptions?.legend??e.layoutOptions?.hasLegend,t=this.layoutOptions?.northArrow??(this.mapSurroundInfoOptions?.northArrow.length?this.mapSurroundInfoOptions?.northArrow.some(({visible:r})=>r):void 0),a=this.layoutOptions?.scaleBar??(this.mapSurroundInfoOptions?.scaleBar.length?this.mapSurroundInfoOptions?.scaleBar.some(({visible:r})=>r):void 0);this._set("layoutOptions",{legend:i,northArrow:t,scaleBar:a})}async fetchLayoutItemTemplateInfo(e){const{layoutItem:i}=this;if(i?.id&&!this.layoutTemplateInfo&&this.state!=="loaded")try{this._set("state","loading");const t=this.layoutInfoTaskUrl;if(!t)throw new C("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:t});i.access!=="public"&&B&&await B.getCredential(t);const a={Layout_Item_ID:JSON.stringify({id:i.id})},r=(await We(t,a,e))[0];this.setLayoutTemplateInfo(r)}catch(t){this._set("state",ct(t)?"not-loaded":"error")}}setLayoutTemplateInfo(e){this._set("layoutTemplateInfo",e),this._updateLayoutOptions(e),this._set("state","loaded")}};l([d({json:{write:!0}})],O.prototype,"description",void 0),l([ut(re)],O.prototype,"format",void 0),l([d({readOnly:!0})],O.prototype,"id",null),l([d({readOnly:!0})],O.prototype,"state",void 0),l([d({json:{write:!0}})],O.prototype,"label",void 0),l([d()],O.prototype,"layoutInfoTaskUrl",void 0),l([d({json:{read:V,write:!0}})],O.prototype,"layout",void 0),l([d({type:ie,json:{write:!0}})],O.prototype,"layoutItem",void 0),l([d({readOnly:!0,json:{write:!0}})],O.prototype,"layoutOptions",void 0),l([d({readOnly:!0})],O.prototype,"layoutTemplateInfo",void 0),l([d({readOnly:!0})],O.prototype,"mapSurroundInfoOptions",null),l([d({readOnly:!0})],O.prototype,"pageUnits",null),l([d()],O.prototype,"type",void 0),O=l([A("esri.widgets.Print.CustomTemplate")],O);const z=O;let E=class extends j{constructor(e){super(e),this.state="pending",this.url=""}initialize(){this.addHandles(N(()=>[this.extension,this.name],()=>this._setFormattedFileName(),ce))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count}).${this.extension}`:`${this.name}.${this.extension}`)}};l([d()],E.prototype,"count",void 0),l([d()],E.prototype,"error",void 0),l([d()],E.prototype,"extension",void 0),l([d()],E.prototype,"formattedName",void 0),l([d()],E.prototype,"name",void 0),l([d()],E.prototype,"portalItem",void 0),l([d()],E.prototype,"state",void 0),l([d()],E.prototype,"url",void 0),E=l([A("esri.widgets.Print.FileLink")],E);const Ge=E;let T=class extends j{constructor(e){super(e),this._abortController=null,this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.id=null,this.state="ready",this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=void 0,this.northArrowEnabled=void 0,this.scale=null,this.scaleBarEnabled=void 0,this.scaleEnabled=!1,this.title=null,this.width=null}async applyTemplate(e,i){if(e?.id===this.id&&e?.state!=="error"||(this._abortController&&(this._abortController.abort(),this._abortController=null),!e))return;if(this._set("state","pending"),this._resetMapSurroundInfoOptions(),this._set("id",e.id),this.set({layout:e.layout,layoutItem:e.layoutItem}),!e.layoutOptions&&e.layoutItem){const r=new AbortController;if(this._abortController=r,await e.fetchLayoutItemTemplateInfo({signal:this._abortController.signal}),e.state!=="loaded")return e.state==="error"&&this._set("state","error"),this._abortController!==r?void 0:void(this._abortController=null);this._abortController=null}const t=i?.customLayoutOptions,a=i?.customTextElements??e.layoutTemplateInfo?.layoutOptions?.customTextElements??this.customTextElements;this.set({customTextElements:a?ue(a):void 0,format:this.format??e.format,legendEnabled:t?.legend??e.layoutOptions?.legend??this.legendEnabled,northArrowEnabled:t?.northArrow??e.layoutOptions?.northArrow??this.northArrowEnabled,scaleBarEnabled:t?.scaleBar??e.layoutOptions?.scaleBar??this.scaleBarEnabled}),this._set("state","ready")}reset(){this._set("id",null),this._set("state","ready"),this.set({layout:null,layoutItem:null,customTextElements:null}),this._resetMapSurroundInfoOptions()}_resetMapSurroundInfoOptions(){this.set({legendEnabled:void 0,northArrowEnabled:void 0,scaleBarEnabled:void 0})}};l([d()],T.prototype,"attributionEnabled",void 0),l([d()],T.prototype,"author",void 0),l([d()],T.prototype,"copyright",void 0),l([d()],T.prototype,"customTextElements",void 0),l([d()],T.prototype,"dpi",void 0),l([d()],T.prototype,"fileName",void 0),l([d()],T.prototype,"forceFeatureAttributes",void 0),l([d()],T.prototype,"format",void 0),l([d()],T.prototype,"height",void 0),l([d()],T.prototype,"includeTables",void 0),l([d({readOnly:!0})],T.prototype,"id",void 0),l([d({readOnly:!0})],T.prototype,"state",void 0),l([d()],T.prototype,"layout",void 0),l([d({type:ie})],T.prototype,"layoutItem",void 0),l([d()],T.prototype,"legendEnabled",void 0),l([d()],T.prototype,"northArrowEnabled",void 0),l([d()],T.prototype,"scale",void 0),l([d()],T.prototype,"scaleBarEnabled",void 0),l([d()],T.prototype,"scaleEnabled",void 0),l([d()],T.prototype,"title",void 0),l([d()],T.prototype,"width",void 0),T=l([A("esri.widgets.Print.TemplateOptions")],T);const je=T,Li=[30,144,255,255],$e=[237,211,23,255],Ei=[216,48,32,255],$i=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),Pi=/(\/GPServer\/).+/i,Ci=96,R=Ae.ofType(z),qe=Ae.ofType(Ge);function Di(e){e.layoutOptions??={},e.layoutOptions.customTextElements??=[];const i="date";if(!e.layoutOptions.customTextElements.find(t=>i in t)){const{customTextElements:t}=e.layoutOptions;let a=xt(Date.now(),Tt("short-date"));It()==="ar"&&(a="â€"+a),t.push({date:a})}}function le(e,i,t){i&&i.visible!==t&&e.layoutOptions&&(e.layoutOptions.elementOverrides?e.layoutOptions.elementOverrides[i.name]={visible:t}:e.layoutOptions.elementOverrides={[i.name]:{visible:t}})}let w=class extends ht(yt(mt)){constructor(e){super(e),this._serviceTemplateCustomTextElements=null,this._templateIdToCustomTemplate=new ft,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this._portalLayoutInfoTaskUrl=null,this._customLayoutOptions=null,this._exportedFileNameMap={},this._layoutTemplateInfosCache=new Map,this._tasksInfoCache=new Map,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new R,this.defaultTemplates=new R,this.error=null,this.exportedLinks=new qe,this.extraParameters=null,this.includeDefaultTemplates=!0,this.outSpatialReference=null,this.portal=Me.getDefault(),this.portalTemplateIds=[],this.printServiceTemplates=new R,this.defaultTemplate=null,this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.saveExportEnabled=!1,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new je}initialize(){this.addHandles([N(()=>[this.showPrintAreaEnabled,this.view],()=>{this.showPrintAreaEnabled?this._enablePrintPreview():(this.removeHandles("overlay-handler"),this.view?.overlay?.removeItem(this._getOverlayItem()))}),N(()=>[this.templateOptions.layout,this.templateOptions.layoutItem],()=>{this.loaded&&this._processTemplateOptions()}),N(()=>[this.allowedFormats,this.allowedLayouts],()=>{this.loaded&&this._loadTemplateInfos()}),N(()=>this.exportedLinks,()=>{for(const{name:e,extension:i}of this.exportedLinks)e&&i&&this._updateExportedFileNameMap(`${e}${i}`)},ce)])}destroy(){this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&(this.view.overlay?.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=ue(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(i=>{const t=e[i];if(t){const a=this.templateCustomTextElements?.[i];t.forEach(r=>{const[o]=Object.entries(r)[0];a?.forEach(s=>{const[p,n]=Object.entries(s)[0];o===p&&(r[o]=n)})})}}),Object.freeze(e)}get state(){return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&this.view?.ready?"ready":"disabled"}async print(e){const{view:i,extraParameters:t,updateDelay:a,outSpatialReference:r}=this;if(!i)throw new C("print:view-required","view is not set");Di(e);const o=this._getOverlayItem(),s=e.scalePreserved||!this.showPrintAreaEnabled?void 0:gt(new wt,i.viewpoint,e.layout==="map-only"?[e.exportOptions.width,e.exportOptions.height]:[o.boxWidth,o.boxHeight]),p=new Oi({view:i,template:e,extent:s,extraParameters:t,updateDelay:a,outSpatialReference:r});try{const n=!!e.layoutItem?.id&&(this.portalTemplateIds.includes(e.layoutItem.id)||this.browseTemplates.some(c=>c.layoutItem?.id===e.layoutItem?.id));return await Qt(n&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,p,{timeout:this.printTimeout})}catch(n){throw new C("print:export-error","An error occurred while exporting the web map.",{error:n})}}async load(e){return this.addResolvingPromise(this._loadResources(e).catch(i=>this.error=i)),this}toPrintTemplate({attributionEnabled:e,author:i,copyright:t,customTextElements:a,dpi:r,forceFeatureAttributes:o,format:s,height:p,id:n,includeTables:c,layout:h,layoutItem:u,legendEnabled:y,northArrowEnabled:b,scale:f,scaleBarEnabled:x,scaleEnabled:m,title:g,width:v}){if(!h&&!u)throw new C("print:layout-required","layout is not set");const _=new ze({attributionVisible:e,forceFeatureAttributes:o,format:s,includeTables:c,layout:h,layoutItem:u,layoutOptions:{authorText:i||"",copyrightText:t||"",customTextElements:a,titleText:g||""},outScale:f??0,scalePreserved:m});if(v&&(_.exportOptions.width=v),p&&(_.exportOptions.height=p),r&&(_.exportOptions.dpi=r),_.layoutOptions){y||(_.layoutOptions.legendLayers=[]);const k=this.getLayoutTemplateById(n)?.mapSurroundInfoOptions;if(k){const Q=k.northArrow;for(const J of Q)le(_,J,b);const Ke=k.scaleBar;for(const J of Ke)le(_,J,x);const Qe=k.legend;for(const J of Qe)le(_,J,y)}}return _}getLayoutTemplateById(e){return e?this._templateIdToCustomTemplate.get(e):null}async addPortalTemplate(e){if(!this.portal||!e?.id)return;try{e.loaded||await e.load()}catch{return void this.applyTemplate(this.defaultTemplate)}const i=new z({type:"browse-template",layoutInfoTaskUrl:this._portalLayoutInfoTaskUrl,label:e.title,layoutItem:e});this._templateIdToCustomTemplate.set(i.id,i),this.browseTemplates.add(i)}removePortalTemplate(e){e.layoutItem&&this.templateOptions.id===e.layoutItem.id&&(this.defaultTemplate?this.applyTemplate(this.defaultTemplate):this.templateOptions.reset()),this.browseTemplates.remove(e),this._templateIdToCustomTemplate.delete(e.id)}async applyTemplate(e){if(e&&e===this.getLayoutTemplateById(this.templateOptions.id)||(this.templateOptions.reset(),!e))return;if(e==="map-only")return void(this.templateOptions.layout="map-only");!e.layout||!this.templatesInfo||this.templatesInfo.layout.choiceList.includes(e.layout)||(this.defaultTemplate?e=this.defaultTemplate:this.templateOptions.reset());const i=e.layout||e.layoutItem?.id,t=i?this.templateCustomTextElements?.[i]:void 0;if(await this.templateOptions.applyTemplate(e,{customTextElements:t,customLayoutOptions:this._customLayoutOptions}),i&&this._serviceTemplateCustomTextElements&&!this._serviceTemplateCustomTextElements[i]&&e.layoutTemplateInfo?.layoutOptions?.customTextElements){const a=ue(this._serviceTemplateCustomTextElements);a[i]=e.layoutTemplateInfo.layoutOptions.customTextElements,this._serviceTemplateCustomTextElements=Object.freeze(a)}}createExportedFileLink(e){const i=this.toPrintTemplate(this.templateOptions).format.toLowerCase(),t=i.includes("png")?"png":i,a=e+t;return this._updateExportedFileNameMap(a),new Ge({name:e,extension:t,count:this._exportedFileNameMap[a]})}export(e){const i=this.createExportedFileLink(e);this.exportedLinks.add(i);const t=this.print(this.toPrintTemplate(this.templateOptions)).then(a=>i.set({url:a?.url,state:"ready"})).catch(a=>i.set({error:a,state:"error"}));return this.emit("submit",{link:i,saveExportEnabled:this.saveExportEnabled}),t.then(a=>this.emit("complete",{link:a,saveExportEnabled:this.saveExportEnabled})),{link:i,promise:t}}async _loadResources(e){this.destroyed||(await this._loadUrls(e),await this._loadTemplateInfos(e),this._updateOverLayItem())}async _loadTemplateInfos(e){const i=[...this.defaultTemplates,...this.printServiceTemplates];for(const{id:r}of i)this._templateIdToCustomTemplate.delete(r);this.defaultTemplates.removeAll(),this.printServiceTemplates.removeAll();const[t,a]=await Promise.all([this._getLayoutToLayoutTemplateInfos(e),this._getPrintServiceTemplatesInfo(e)]);await this._loadAllTemplates(t,a,e),this._processPrintServiceTemplatesInfo(a),await this._processTemplateOptions()}_updateExportedFileNameMap(e){this._exportedFileNameMap[e]!==void 0?this._exportedFileNameMap[e]++:this._exportedFileNameMap[e]=0}async _processTemplateOptions(){const{layout:e,layoutItem:i}=this.templateOptions;if(e!=="map-only"){if(this._customLayoutOptions={legend:this.templateOptions.legendEnabled,northArrow:this.templateOptions.northArrowEnabled,scaleBar:this.templateOptions.scaleBarEnabled},i?.id){try{i.loaded||await i.load()}catch{return void this.applyTemplate(this.defaultTemplate)}let t=this._templateIdToCustomTemplate.get(i.id);t||(t=new z({label:i.title,layoutItem:i,layoutInfoTaskUrl:this._portalLayoutInfoTaskUrl}),this._templateIdToCustomTemplate.set(t.id,t)),await this.applyTemplate(t)}else if(e){const t=this.defaultTemplates.find(a=>a.layout===this.templateOptions.layout)??this.printServiceTemplates.find(a=>a.layout===this.templateOptions.layout);await this.applyTemplate(t??this.defaultTemplate)}}}async _loadPortal(e){try{await this.portal.load(e)}catch(i){throw new C("print:could-not-load-portal","Cannot load print resource information from portal",{error:i,url:this.effectivePrintServiceUrl})}}async _loadUrls(e){if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),this._layoutInfoTaskUrl=await this._getLayoutInfoTaskUrl(this.effectivePrintServiceUrl,e);else{await this._loadPortal(e);const{printTask:t,asyncPrintTask:a,layoutInfoTask:r}=this.portal?.helperServices??{};this._set("effectivePrintServiceUrl",t?.url),this._asyncPrintTaskUrl=a?.url,this._layoutInfoTaskUrl=await this._getLayoutInfoTaskUrl(this.effectivePrintServiceUrl,e),r?.url&&this.effectivePrintServiceUrl!==r.url?this._portalLayoutInfoTaskUrl=await this._getLayoutInfoTaskUrl(r.url,e):this._portalLayoutInfoTaskUrl=this._layoutInfoTaskUrl}if(!this.effectivePrintServiceUrl?.toLowerCase().split("/")?.includes("gpserver"))throw new C("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl})}async _getLayoutInfoTaskUrl(e,i){if(!e)return null;const t=await ye(e,"GetLayoutTemplatesInfo",i);return t?e.replace(Pi,`$1${encodeURI(t.displayName)}`):null}_getPortalDefaultTemplates(e,i){return this.portal?.helperServices?.printTask?.templates?.filter(t=>t.layout.toLowerCase()!=="map_only"&&(!i||i.includes(V(t.layout))))?.map(t=>{const a=z.fromJSON(t);if(a.type="default-template",a.layoutInfoTaskUrl=this._layoutInfoTaskUrl,a.layout){const r=e.get(a.layout);r&&a.setLayoutTemplateInfo(r)}return a})??[]}async _getPortalCustomTemplates(e){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:i,user:t}=this.portal,a=vt.test(this.portal.url),r=t?.userLicenseTypeId,o=r&&$i.has(r);if(!i||a&&!o)return[];const s=new be({query:i,disableExtraQuery:!0}),p=await this.portal.queryGroups(s,e);if(!p.total)return[];const n=p.results[0],c=new be({num:100,query:"type:Layout",sortField:n.sortField,sortOrder:n.sortOrder??void 0}),h=(await n.queryItems(c,e)).results;return h.length?h.map(u=>(this.portalTemplateIds.push(u.id),new z({type:"default-template",label:u.title,layoutItem:u,layoutInfoTaskUrl:this._portalLayoutInfoTaskUrl}))):[]}async _loadAllTemplates(e,i,t){let a=!1;const r=i?.layout?.choiceList;if(this.includeDefaultTemplates&&this.portal&&!this.printServiceUrl){const o=this._getPortalDefaultTemplates(e,r);a=!!o.length,this.defaultTemplates.addMany(o);const s=await this._getPortalCustomTemplates(t);this.defaultTemplates.addMany(s);for(const p of this.defaultTemplates)this._templateIdToCustomTemplate.set(p.id,p)}a||e.forEach((o,s)=>{if(!r||r.includes(s)){const p=new z({type:"print-service-template",layout:s,layoutInfoTaskUrl:this._layoutInfoTaskUrl});p.setLayoutTemplateInfo(o),this.printServiceTemplates.add(p),this._templateIdToCustomTemplate.set(p.id,p)}})}_processPrintServiceTemplatesInfo(e){this._set("templatesInfo",e);const i=e?.layout?.defaultValue;if(i&&i!=="map-only"){const t=this.defaultTemplates.find(a=>a.layout===i)??this.printServiceTemplates.find(a=>a.layout===i)??this.defaultTemplates.at(0)??this.printServiceTemplates.at(0);this._set("defaultTemplate",t)}}async _getLayoutToLayoutTemplateInfos(e){const i=this._layoutInfoTaskUrl,t=i?this._layoutTemplateInfosCache.get(i):void 0,a=t??await We(i,void 0,e);t||this._layoutTemplateInfosCache.set(i,a);const r=new Map,o={};for(const s of a){const p=V(s.layoutTemplate);r.set(p,s),o[p]=s.layoutOptions.customTextElements}return this._serviceTemplateCustomTextElements=Object.freeze(o),r}async _getPrintServiceTemplatesInfo(e){const i=this.effectivePrintServiceUrl?this._tasksInfoCache.get(this.effectivePrintServiceUrl):void 0,t=i??await ye(this.effectivePrintServiceUrl,"ExportWebMap",e);if(!t)throw new C("print:unavailable-service-info","Can't fetch templates info from service");i||this._tasksInfoCache.set(this.effectivePrintServiceUrl,t);const{parameters:a}=t,r=a.find(({name:s})=>s==="Format"),o=a.find(({name:s})=>s==="Layout_Template");return{format:this._getFormat(r),layout:this._getLayout(o)}}_getFormat(e){const i=this.allowedFormats==="all"?e.choiceList:e.choiceList.filter(o=>typeof this.allowedFormats!="string"&&this.allowedFormats.some(s=>new RegExp(`\\b${s}\\b`,"i").test(o))),t=(i.length?i:e.choiceList).map(o=>re.fromJSON(o)).filter(_e),a=re.fromJSON(e.defaultValue),r=t.some(o=>new RegExp(`\\b${a}\\b`,"i").test(o))?a:t[0];return{choiceList:t,defaultValue:r}}_getLayout(e){const i=e.choiceList.filter(s=>s.toLowerCase()!=="map_only"),t=this.allowedLayouts==="all"?i:i.filter(s=>this.allowedLayouts.includes(V(s))),a=(t.length?t:i).map(V).filter(_e),r=V(e.defaultValue),o=a.includes(r)?r:a.find(s=>/(?=.*letter)(?=.*landscape)/i.test(s))??a.find(s=>/(?=.*a4)(?=.*landscape)/i.test(s))??a[0];return{choiceList:a,defaultValue:o}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new ki({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){if(!this.view?.overlay)return;const e=this.templateOptions,i=this._getOverlayItem();this.addHandles([N(()=>[e.width,e.height,e.scaleEnabled,e.scale,e.layout,e.layoutItem,e.id,e.state,e.dpi,this.view?.scale,this.view?.size,this.view?.state.paddedViewState.size,this.view?.state.padding,this.loaded],()=>this._updateOverLayItem(),ce),this.view?.on("drag",["Shift"],t=>this._handleDrag(t),xe.WIDGET),this.view?.on("key-down",["Escape"],()=>this._resetDrag(),xe.WIDGET)],"overlay-handler"),this.view.overlay.addItem(i)}_updateOverLayItem(){if(!this.view)return;const e=this.templateOptions,i=this._getOverlayItem(),t=e.layoutItem?.id??e.layout,a=this.view,r=a.spatialReference,[o,s]=a.state.paddedViewState.size,p=a.state.padding;let n=0,c=0;if(t==="map-only")e.width!=null&&e.height!=null&&(n=e.width,c=e.height);else if(t){const f=e.id?this._templateIdToCustomTemplate.get(e.id):null,{webMapFrameSize:x,pageUnits:m}=f?.layoutTemplateInfo??{};let g=!1;if(x&&m)if(this._isFreeHand){const v=x[0]/x[1];n=this._freeHandWidth,c=this._freehandHeight,n>c?c=n/v:n=c*v}else{const v=He.fromJSON(m.toLowerCase()),_=r.unit;Te(v)===Te(_)?(n=Ie(x[0],v,_),c=Ie(x[1],v,_)):(g=!0,n=x[0],c=x[1])}if(!this._isFreeHand)if(e.scaleEnabled&&e.scale){const v=g?Math.min(o/n,s/c):bt(r)*_t*e.dpi;n*=v,c*=v}else if(n===0||c===0)n=o,c=s;else{const v=(o-.1*o)/n,_=(s-.1*s)/c,k=Math.min(v,_);n*=k,c*=k}}const{scaleEnabled:h,scale:u}=e,y=h&&u?u/this.view.scale:1,b=h&&u?Ci/e.dpi:1;if(i.boxWidth=n*y*b||o,i.boxHeight=c*y*b||s,p&&(i.padding=p),i.backgroundWidth=o??0,i.backgroundHeight=s??0,this.loadStatus==="loading")i.strokeColor=$e;else if(this.loadStatus==="loaded")switch(this.templateOptions.state){case"pending":i.strokeColor=$e;break;case"ready":i.strokeColor=Li;break;case"error":i.strokeColor=Ei}}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(e){switch(e.action){case"start":this._start();break;case"update":this._update(e);break;case"end":this._end()}e.stopPropagation()}_start(){this._isFreeHand=!0}_update(e){const i=this._getOverlayItem(),{x:t,y:a}=e,{x:r,y:o}=e.origin;t>r?(i.x=r,i.boxWidth=t-r):(i.x=t,i.boxWidth=r-t),a>o?(i.y=o,i.boxHeight=a-o):(i.y=a,i.boxHeight=o-a)}_end(){const e=this._getOverlayItem();if(!this.view||e.x==null||e.y==null)return;const i=this.view,t=i.toMap(Ce(e.x+.5*e.boxWidth,e.y+.5*e.boxHeight));e.x=null,e.y=null,i.goTo({center:t}),this._freeHandWidth=e.boxWidth,this._freehandHeight=e.boxHeight,this.templateOptions.layout==="map-only"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};l([d()],w.prototype,"_serviceTemplateCustomTextElements",void 0),l([d()],w.prototype,"_templateIdToCustomTemplate",void 0),l([d()],w.prototype,"allowedFormats",void 0),l([d()],w.prototype,"allowedLayouts",void 0),l([d({type:R})],w.prototype,"browseTemplates",void 0),l([d({type:R})],w.prototype,"defaultTemplates",void 0),l([d()],w.prototype,"error",void 0),l([d({type:qe})],w.prototype,"exportedLinks",void 0),l([d()],w.prototype,"extraParameters",void 0),l([d()],w.prototype,"includeDefaultTemplates",void 0),l([d({readOnly:!0})],w.prototype,"effectivePrintServiceUrl",null),l([d()],w.prototype,"effectiveTemplateCustomTextElements",null),l([d({type:De})],w.prototype,"outSpatialReference",void 0),l([d({type:Me})],w.prototype,"portal",void 0),l([d()],w.prototype,"portalTemplateIds",void 0),l([d({type:R})],w.prototype,"printServiceTemplates",void 0),l([d({readOnly:!0})],w.prototype,"defaultTemplate",void 0),l([d()],w.prototype,"showPrintAreaEnabled",void 0),l([d()],w.prototype,"printServiceUrl",void 0),l([d()],w.prototype,"printTimeout",void 0),l([d()],w.prototype,"saveExportEnabled",void 0),l([d({readOnly:!0})],w.prototype,"state",null),l([d({readOnly:!0})],w.prototype,"templatesInfo",void 0),l([d()],w.prototype,"updateDelay",void 0),l([d()],w.prototype,"view",void 0),l([d()],w.prototype,"templateCustomTextElements",void 0),l([d({type:je})],w.prototype,"templateOptions",void 0),w=l([A("esri.widgets.Print.PrintViewModel")],w);const Mi=w;const Ai=Pt`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}:host{--panel-min-height--large: 240px;--side-spacing: var(--calcite-spacing-lg);--cap-spacing: var(--calcite-spacing-md);overflow-y:auto}.arcgis-print{display:flex;position:relative;flex-grow:1;padding:0;min-height:var(--panel-min-height--large)!important}.arcgis-print section[aria-hidden=true]{display:none}.arcgis-print__panel-items--centered{display:flex;align-items:center}.arcgis-print__container{display:flex;flex-direction:column;flex-grow:1}.arcgis-print__header-title{margin:0 auto 0 0;padding:var(--calcite-spacing-md) var(--calcite-spacing-lg);font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-bold)}.arcgis-print__panel--error{color:var(--calcite-color-status-danger)}arcgis-print-template-selector{overflow-y:hidden;display:flex}`,W="arcgis-print",H={base:W,headerTitle:`${W}__header-title`,panelItemsCentered:`${W}__panel-items--centered`,printWidgetContainer:`${W}__container`,panelError:`${W}__panel--error`},Fi=$t(Mi),Pe=e=>{if(!e)return"all";const i=typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t):[e];return!i.length||i.includes("all")?"all":i},ne=class ne extends St{constructor(){super(...arguments),this.messages=Ot({blocking:!0}),this.viewModel=Fi(this),this._showTemplates=!1,this.error=this.viewModel.error,this.view=this.viewModel.view,this.hideHeader=!1,this.icon="print",this.allowedFormats=this.viewModel.allowedFormats,this.allowedLayouts=this.viewModel.allowedLayouts,this.exportedLinks=this.viewModel.exportedLinks,this.extraParameters=this.viewModel.extraParameters,this.headingLevel=3,this.excludeDefaultTemplates=!this.viewModel.includeDefaultTemplates,this.excludeOrganizationTemplates=!1,this.outSpatialReference=this.viewModel.outSpatialReference,this.portal=this.viewModel.portal,this.showPrintAreaEnabled=this.viewModel.showPrintAreaEnabled,this.printServiceUrl=this.viewModel.printServiceUrl,this.templateCustomTextElements=this.viewModel.templateCustomTextElements,this.templateOptions=this.viewModel.templateOptions,this.autoDestroyDisabled=!1,this.state=this.viewModel.state,this.arcgisPropertyChange=kt()("state"),this.arcgisReady=Lt(),this.arcgisComplete=Se(()=>this.viewModel,"complete"),this.arcgisSubmit=Se(()=>this.viewModel,"submit")}async destroy(){await this.manager.destroy(),this.viewModel.destroy()}loaded(){this.manager.onLifecycle(()=>[]),this.viewModel.load();const{height:i,width:t}=this.viewModel.templateOptions;this.viewModel.templateOptions.width=t||800,this.viewModel.templateOptions.height=i||1100}_showTemplateSelector(){this._showTemplates=!0}_hideTemplateSelector(){this._showTemplates=!1}render(){const i={[H.panelItemsCentered]:this.viewModel.state==="initializing"};return F`<div class=${Y(Et(H.base,Oe.widget,Oe.panel,i))}>${this._renderPanel()}</div>`}_renderPanel(){return this.viewModel.state==="initializing"?F`<calcite-loader label=loading scale=m></calcite-loader>`:F`<calcite-flow><calcite-flow-item .selected=${!this._showTemplates}><div class=${Y(H.printWidgetContainer)}>${this._renderPanelHeader()}${this._renderPanelContent()}</div></calcite-flow-item><calcite-flow-item .heading=${this.messages.chooseTemplate} .selected=${this._showTemplates} @calciteFlowItemBack=${i=>{i.preventDefault(),this._showTemplates=!1}}><arcgis-print-template-selector .messages=${this.messages} .viewModel=${this.viewModel} .browseTemplateButtonOnClick=${this.browseTemplateButtonOnClick} .hideTemplateSelector=${this._hideTemplateSelector.bind(this)} .excludeOrganizationTemplates=${this.excludeOrganizationTemplates}></arcgis-print-template-selector></calcite-flow-item></calcite-flow>`}_renderPanelHeader(){return this.hideHeader?null:F`<header class=${Y(H.headerTitle)}>${this.messages.export}</header>`}_renderPanelContent(){const i=this.viewModel.view,t=i?.type!=="2d";return this.error||t?F`<div class=${Y(H.panelError)}>${i?t?this.messages.sceneViewError:this.messages.serviceError:this.messages.noViewError}</div>`:F`<arcgis-print-main-panel .messages=${this.messages} .viewModel=${this.viewModel} .showTemplateSelector=${this._showTemplateSelector.bind(this)} .allowedFormatsForSaving=${this.allowedFormatsForSaving} .saveAsButtonCallback=${this.saveAsButtonCallback}></arcgis-print-main-panel>`}};ne.properties={_showTemplates:16,error:16,view:0,hideHeader:5,referenceElement:1,position:3,icon:1,allowedFormats:[1,{type:String,converter:Pe}],allowedLayouts:[1,{type:String,converter:Pe}],browseTemplateButtonOnClick:0,allowedFormatsForSaving:1,exportedLinks:0,extraParameters:1,headingLevel:9,excludeDefaultTemplates:5,excludeOrganizationTemplates:5,outSpatialReference:0,portal:0,showPrintAreaEnabled:5,printServiceUrl:1,saveAsButtonCallback:0,templateCustomTextElements:0,templateOptions:0,autoDestroyDisabled:5,messageOverrides:0,label:1,state:3},ne.styles=Ai;let me=ne;Ct("arcgis-print",me);export{me as ArcgisPrint};
