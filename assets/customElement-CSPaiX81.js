const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/uniqueValues-DTFrzuan.js","assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/utils-BIk8uCGl.js","assets/utils-BJ7fw6dI.js","assets/utils-DHhoJDHW.js","assets/ClassBreaksDefinition-Bdvs4GrJ.js","assets/executeQueryJSON-CQzDonsh.js","assets/query-D5mFMRFz.js","assets/pbfQueryUtils-PegbNvJC.js","assets/pbf-bO1aG1II.js","assets/PivotQuery-UUnVdhjQ.js","assets/statsWorker-_I9piX2j.js","assets/AttributeBinsQuery-86L9HIrS.js","assets/queryUtils-DtYhZp0I.js","assets/FixedIntervalBinParameters-M_noW3Bp.js","assets/viewpointUtils-CqwA4uEG.js","assets/mat2d-BbBq4Byx.js","assets/mat2df64-DJ_RMjZ3.js"])))=>i.map(i=>d[i]);
import{L as Z,b1 as R,v as W,O as D,bX as N,f,bH as z,U as G,dN as S,f5 as Q,f3 as j,d as o,b as y,k,D as U,i as X,l as J}from"./index-BrQW8HOS.js";import{d as E}from"./index-C1Nt58Wz.js";import{i as B,o as V}from"./stringUtils-BTK5CX_y.js";import{u as Y,l as ee}from"./featureUtils-B-Ma4Dx6.js";import{l as te}from"./feature-utils-BrGc70Ta.js";import{n as re}from"./FeatureViewModel-DUcUeCTn.js";import{s as ie}from"./substitute-D-eLZ17Q.js";import"./featureUtils-D2UmGJHI.js";import"./utils-BJ7fw6dI.js";import"./throttle-CTJgdIni.js";import"./AttachmentsViewModel-BorO2JWS.js";import"./AttachmentInfo-Be-qgHMP.js";import"./executeQueryJSON-CQzDonsh.js";import"./query-D5mFMRFz.js";import"./pbfQueryUtils-PegbNvJC.js";import"./pbf-bO1aG1II.js";import"./arcadeFeatureUtils-D1_gLIP2.js";import"./shared-DBXlHENV.js";import"./isImageryGraphicOrigin-Ccuhb4eK.js";import"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./FeatureRelationshipViewModel-BmyR0OK6.js";import"./featureFormUtils-NJdl1KAp.js";import"./dateUtils-DCwqoPkL.js";import"./FeatureUtilityNetworkAssociationsViewModel-bOY5P1li.js";import"./NetworkElement-te1zus-P.js";import"./getFeatureTitle-Mrr3SXNI.js";const se=X`:host{position:relative;flex:1 1 auto}.arcgis-feature-relationship__list{min-height:var(--calcite-spacing-xxxl)}.arcgis-feature-relationship__list-item--hidden{display:none}.arcgis-feature-relationship__feature-observer{position:relative;bottom:var(--calcite-spacing-xxl);z-index:2;text-align:center}.arcgis-feature-relationship__sticky-loading-container{display:flex;position:sticky;bottom:var(--calcite-spacing-sm);align-items:center;justify-content:center;z-index:2;margin:0;padding:0;height:var(--calcite-spacing-xxxl);pointer-events:none}`,ae=F=>{const e=[];if(F.formTemplate){const{description:t,title:r}=F.formTemplate;F.fields?.forEach(i=>{const s=r&&V(r,i.name),a=t&&V(t,i.name);(s||a)&&e.push(i.name)})}return e},O=100,le="arcgis-feature",c=`${le}-relationship`,h={base:c,listContainer:`${c}__list`,listItem:`${c}__list-item`,listItemHidden:`${c}__list-item--hidden`,listContainerQuerying:`${c}__list--querying`,featureObserver:`${c}__feature-observer`,stickySpinnerContainer:`${c}__sticky-loading-container`,loadingSpinnerContainer:`${c}__loading-container`},C=class C extends Z{constructor(){super(...arguments),this._increaseFeaturePage=()=>{const{state:e,showAllEnabled:t,relatedFeatures:r,featuresPerPage:i,featurePage:s}=this;e==="ready"&&t&&r.length>=i*s&&this.featurePage++},this._relatedFeatureIntersectionObserver=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._featurePage=1,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await R(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await R(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await R(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=E(this._queryController,O),this._queryFeatureCountDebounced=E(this._queryFeatureCountController,O),this._queryPageDebounced=E(this._queryPageController,O),this._query=async()=>{const{_queryAbortController:e,relatedFeatures:t}=this;!this.featureCount||this.relatedLayer?.type==="subtype-group"&&!this.activeCategory||(this.relatedFeatureViewModels.destroyAll(),this.featurePage=1,t.destroyAll(),t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e?.signal}))))},this._addFlowItem=e=>{e&&this.flowItems?.push(e)},this._relatedFeatureIntersectionObserverNode=W(),this.relatedFeatures=new D,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featureCount=0,this._loaded=!1,this.relatedFeatureViewModels=new D,this.autoDestroyDisabled=!1,this.featuresPerPage=10,this.flowType="feature-relationship",this.headingLevel=2,this.hideHeading=!1,this.hideDescription=!1,this.showAllEnabled=!1}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(r=>{const i=r.clone();return i.field=te(r.field,t),i}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get allCategoriesCount(){return this.allCategories?.length??0}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedLayer(){const{layer:e,map:t,relationship:r}=this;if(!e?.loaded||!t||!r)return null;const i=e.type==="subtype-sublayer"&&e.parent&&Y(e.parent)?e.parent:e;return ee(t,i,r)??null}get relatedLayerKeyField(){const{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&t!=null?e.relationships?.find(r=>r.id===t)?.keyField:null}get relatedLayerKeyFields(){const{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(t=>t.keyField).filter(t=>t!=null)??[]:[]}get relationship(){const{relationshipId:e,layer:t}=this;return e!=null&&t?.loaded?t.relationships?.find(({id:r})=>r===e)??null:null}get relationshipKey(){const{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){const e=this.layer?.capabilities?.queryRelated;return!!this.relatedLayer&&!!this.relationship&&this.relationshipId!=null&&this.objectId!=null&&!!e?.supportsCount&&e?.supportsPagination}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:r,state:i,allCategoriesCount:s}=this,a=!!s&&(s>r||r===0),n=!!t&&(t>r||r===0);return!e&&i==="ready"&&(a||n)}get displayListItems(){const{relatedFeatures:e,allCategoriesCount:t}=this;return this.displayShowAllButton||!!e.length||!!t}get categories(){const{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:i,_loaded:s,canLoad:a}=this;return t||a&&!s?"loading":e||r?"querying":i?"ready":"disabled"}get allItemsDescription(){const{messages:e,featureCount:t,allCategories:r,allCategoriesCount:i}=this;return ie(e?.numberRecords??"",{number:N(r?i:t)})}get featurePage(){return this._featurePage}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,i=1,s=Math.ceil(r/t)||1;this._featurePage=Math.min(Math.max(e,i),s)}get heading(){const{activeCategory:e}=this;return this._heading??e?.name}set heading(e){this._heading=e}get displayCount(){return this._displayCount??3}set displayCount(e){this._displayCount=Math.min(Math.max(e??3,0),10)}async destroy(){await this.manager.destroy()}loaded(){this.manager.onLifecycle(()=>[f(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),{initial:!0}),f(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),f(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced(),{initial:!0}),f(()=>[this.state,this.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),z(()=>this.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels())]),this.manager.onDestroy(()=>{this.relatedFeatureViewModels.destroyAll(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage(),this._unobserveRelatedFeatureObserver()})}async _queryFeatureCount(){const{layer:e,relatedLayer:t}=this;await e?.load(),await t?.load();const{_queryFeatureCountAbortController:r,activeCategory:i,canQuery:s,objectId:a,relatedLayerKeyField:n,relationshipId:l,relationshipKey:p,supportsCacheHint:v}=this;if(!s||!e||!t||a==null){this.featureCount=0,this.allCategories=void 0;return}if(t?.type==="subtype-group"&&!i){if(this.featureCount=0,this.relatedFeatureViewModels.destroyAll(),this.featurePage=1,this.relatedFeatures.destroyAll(),n&&p!=null){const{default:I}=await G(async()=>{const{default:u}=await import("./uniqueValues-DTFrzuan.js");return{default:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])),{uniqueValueInfos:A}=await I({layer:t,sqlWhere:`${n} = '${p}'`,field:t.subtypeField??void 0,signal:r?.signal}),q=A.map(({count:u,value:_})=>{const b=t.subtypes?.find(P=>P.code===_)?.name;return _!=null&&b?{count:u,value:_,name:b}:void 0}).filter(u=>u!=null);this.allCategories=q}return}const{historicMoment:m,gdbVersion:w}=e,$=new S({cacheHint:v,gdbVersion:w,historicMoment:m,relationshipId:l,returnGeometry:!1,objectIds:[a],where:this._getRelationshipWhereClause(t)}),g=await e.queryRelatedFeaturesCount($,{signal:r?.signal});this.allCategories=void 0,this.featureCount=g[a]||0}_getRelationshipWhereClause(e){const{activeCategory:t}=this,r=e.createQuery(),i="subtypeField"in e?e.subtypeField:void 0,s=t&&i?`${i} = ${t.value}`:void 0,a=r.where;return a&&s?`(${a}) AND (${s})`:a??s}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:i,featureCount:s}=this;!r||t<2||!s||this.relatedLayer?.type==="subtype-group"&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:i?.signal}))}async _queryRelatedFeatures(e){const{displayCount:t,featureCount:r,featurePage:i,featuresPerPage:s,layer:a,orderByFieldsFixedCasing:n,relatedLayer:l,relatedLayerKeyFields:p,relationshipId:v,showAllEnabled:m,supportsCacheHint:w}=this,{canQuery:$,objectId:g}=this;if(!$||!a||!l||g==null)return[];const I=m?((i-1)*s+r)%r:0,A=m?s:t,q=l.objectIdField,u="subtypeField"in l?l.subtypeField:void 0,_=[...n.map(d=>d.field),...ae(l),...p,q,u].filter(d=>d!=null),b=n.map(d=>`${d.field} ${d.order}`),{historicMoment:P,gdbVersion:H}=a,T=new S({orderByFields:b,start:I,num:A,outFields:_,cacheHint:w,historicMoment:P,gdbVersion:H,relationshipId:v,returnGeometry:!1,objectIds:[g],where:this._getRelationshipWhereClause(l)}),L=(await a.queryRelatedFeatures(T,{signal:e?.signal}))[g]?.features||[];return l.type==="subtype-group"&&u?L.forEach(d=>{const K=d.attributes[u],x=l.findSublayerForSubtypeCode?.(K);d.sourceLayer=x,d.layer=x}):L.forEach(d=>{d.sourceLayer=l,d.layer=l}),L}_selectCategory(e){const{flowItems:t}=this;t&&this._addRelationshipFlowItem({showAllEnabled:!0,activeCategory:e})}_selectRecord(e){const{flowItems:t}=this;t&&this._addFlowItem(Q(j(e,o`<arcgis-feature .flowItems=${t} .flowType=${this.flowType} .graphic=${e.graphic} .map=${this.map} show-relationship-content .spatialReference=${this.spatialReference} .timeZone=${this.timeZone} .view=${this.view}></arcgis-feature>`)))}_addRelationshipFlowItem({showAllEnabled:e=!1,activeCategory:t}){this._addFlowItem(Q(j(t,o`<arcgis-feature-relationship .messages=${this.messages} .activeCategory=${t} .displayCount=${this.displayCount} .flowItems=${this.flowItems} .flowType=${this.flowType} .graphic=${this.graphic} .heading=${this.heading} hide-description .showAllEnabled=${e} hide-heading .layer=${this.layer} .map=${this.map} .orderByFields=${this.orderByFields} .relationshipId=${this.relationshipId} .spatialReference=${this.spatialReference} .values=${this.values} .view=${this.view}></arcgis-feature-relationship>`)))}_showAllRecords(){const{flowItems:e}=this;e&&this._addRelationshipFlowItem({showAllEnabled:!0})}_handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this;this._relatedFeatureIntersectionObserverNode.value&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode.value)}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode.value&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode.value)}_matchesFeature(e,t){const r=e?.graphic?.getObjectId(),i=t?.getObjectId();return r!=null&&i!=null&&r===i}_setRelatedFeaturesViewModels(){const{relatedFeatures:e,relatedFeatureViewModels:t,map:r,view:i,spatialReference:s,timeZone:a}=this;e?.filter(Boolean).forEach(n=>{t.some(l=>this._matchesFeature(l,n))||t.add(new re({abilities:{relationshipContent:!1},map:r,view:i,spatialReference:s,timeZone:a,graphic:n}))}),t.forEach(n=>{e?.find(l=>this._matchesFeature(n,l))||t.remove(n)})}render(){const{state:e}=this;return o`<div class=${y(h.base)}><arcgis-feature-element-info .heading=${this.heading} .headingLevel=${this.headingLevel} .description=${this.description}></arcgis-feature-element-info>${e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures()}</div>`}_renderStickyLoading(){return this.state==="querying"?o`<div class=${y(h.stickySpinnerContainer)}>${this._renderLoadingIcon()}</div>`:null}_renderLoadingIcon(){return o`<calcite-loader inline label></calcite-loader>`}_renderLoading(){return o`<div class=${y(h.loadingSpinnerContainer)}>${this._renderLoadingIcon()}</div>`}_renderShowAllIconNode(){return o`<calcite-icon icon=list scale=s slot=content-end></calcite-icon>`}_renderChevronIconNode(){return o`<calcite-icon flip-rtl icon=chevron-right scale=s slot=content-end></calcite-icon>`}_renderCategory(e){const{count:t,name:r}=e,i=N(t);return o`<calcite-list-item class=${y(h.listItem)} .disabled=${!t} .label=${r} @calciteListItemSelect=${()=>this._selectCategory(e)}><calcite-chip .label=${i} scale=s slot=content-end>${i}</calcite-chip>${this._renderChevronIconNode()}</calcite-list-item>`}_renderRelatedFeature(e){const{itemDescriptionFieldName:t,values:r}=this,{formattedAttributes:i,state:s,title:a}=e,n={...i?.global,...r},l=(t&&n?.[t])??"",p=s==="loading";return o`<calcite-list-item class=${y(k(h.listItem,{[h.listItemHidden]:p}))} .description=${B(l.toString())} .label=${B(a)} @calciteListItemSelect=${()=>this._selectRecord(e)}>${this._renderChevronIconNode()}</calcite-list-item>`}_renderShowAllListItem(){return this.displayShowAllButton?o`<calcite-list-item .description=${this.allItemsDescription} .label=${this.messages?.showAll} @calciteListItemSelect=${()=>this._showAllRecords()}>${this._renderShowAllIconNode()}</calcite-list-item>`:null}_renderNoRelatedFeaturesMessage(){return o`<calcite-notice icon=information kind=brand open scale=s width=full><div slot=message>${this.messages?.noRelatedFeatures}</div></calcite-notice>`}_renderFeatureObserver(){return o`<div class=${y(h.featureObserver)} ${U(this._relatedFeatureIntersectionObserverNode)}></div>`}_renderList(){const{relatedFeatureViewModels:e,categories:t}=this;return o`<calcite-list display-mode=flat .label=${this.messages?.relatedFeaturesList??""}>${t?.map(r=>this._renderCategory(r))??e.toArray().map(r=>this._renderRelatedFeature(r))}${this._renderShowAllListItem()}</calcite-list>`}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this;return o`<div class=${y(k(h.listContainer,{[h.listContainerQuerying]:t==="querying"}))}>${e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null}${this._renderStickyLoading()}${this._renderFeatureObserver()}</div>`}_renderRelationshipNotFound(){return o`<calcite-notice icon=exclamation-mark-triangle kind=danger open scale=s width=full><div slot=message>${this.messages?.relationshipNotFound}</div></calcite-notice>`}};C.properties={allCategories:16,_queryAbortController:16,_queryPageAbortController:16,_queryFeatureCountAbortController:16,featureCount:16,_loaded:16,canLoad:16,canQuery:16,displayShowAllButton:16,displayListItems:16,categories:16,itemDescriptionFieldName:16,relatedFeatureViewModels:16,state:16,autoDestroyDisabled:5,allItemsDescription:32,featurePage:9,featuresPerPage:9,flowItems:0,flowType:1,headingLevel:9,messages:0,heading:1,description:1,values:0,activeCategory:0,hideHeading:5,hideDescription:5,displayCount:9,graphic:0,layer:0,map:0,view:0,spatialReference:0,timeZone:1,orderByFields:0,relationshipId:9,showAllEnabled:5,label:3},C.styles=se;let M=C;J("arcgis-feature-relationship",M);export{M as ArcgisFeatureRelationship};
