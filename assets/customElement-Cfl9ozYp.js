import{_ as r,e as a,g as p,Z as f,f as l,bJ as u,L as v,v as w,u as _,c,b as M,k as T,d as n,D as b,i as V,l as $}from"./index-CgzAF5Ey.js";import{d as s}from"./videoUtils-C-OaBq43.js";import{s as D}from"./useT9n-CtkFUew7.js";import{v as L}from"./useViewModel-C2OUFn4j.js";import{e as C}from"./globalCss-UPH6MMtF.js";import"./cimSymbolUtils-D8zbHeXT.js";import"./utils-BxeCvIiv.js";import"./gfxUtils-B1R76T6S.js";import"./useView-CMtXgKA0.js";function m(e,t){const o={};for(const d of t){const h=e.get(d);h&&(o[h.name]=h.value)}return o}let i=class extends f{constructor(e){super(e),this.followingMode="follow-both",this.layer=null,this.seekLength=10,this.view=null}initialize(){this.addHandles([l(()=>this.layer,(e,t)=>{t&&t.pause(),e&&e.load().then(()=>this._followTelemetry()).catch(()=>{})},u),l(()=>[this.followingMode],()=>this._followTelemetry(),u)])}get buffered(){return this.layer?.buffered||0}get currentTime(){return this.layer?.currentTime||0}get duration(){return this.layer?.duration||0}get ended(){return this.layer?.ended??!0}get metadata(){const e=this.layer?.metadata;return e?{missionInfo:m(e,[s.MissionId,s.PrecisionTimeStamp]),platformInfo:m(e,[s.PlatformTailNumber,s.PlatformTrueAirspeed,s.PlatformCallSign,s.PlatformDesignation,s.PlatformGroundRange]),frameInfo:m(e,[s.FrameCenterElevation,s.FrameCenterLatitude,s.FrameCenterLongitude])}:null}get playing(){return this.layer?.playing??!1}get state(){return this.layer?.loadError?"error":this.layer?.state??"not-ready"}play(){this.layer?.play()}pause(){this.layer?.pause()}seekBackward(){if(this.layer){const e=this.layer.currentTime-this.seekLength;e<=0?this.layer.reset():this.layer.setCurrentTime(e)}}seekForward(){if(this.layer){const e=this.layer.currentTime+this.seekLength;e>=this.layer.duration?this.layer.reset():this.layer.setCurrentTime(e)}}seekToBeginning(){this.layer?.setCurrentTime(0)}seekToEnding(){this.layer?.setCurrentTime(this.layer.duration)}seekTo(e){this.layer?.setCurrentTime(e)}toggleSensorDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.sensorLocation=!this.layer.telemetryDisplay.sensorLocation)}toggleSensorSightLineDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.lineOfSight=!this.layer.telemetryDisplay.lineOfSight)}toggleFrameDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.frame=!this.layer.telemetryDisplay.frame)}toggleSensorTrailDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.sensorTrail=!this.layer.telemetryDisplay.sensorTrail)}toggleFrameCenterDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.frameCenter=!this.layer.telemetryDisplay.frameCenter)}toggleFrameOutlineDisplay(){this.layer?.telemetryDisplay&&(this.layer.telemetryDisplay.frameOutline=!this.layer.telemetryDisplay.frameOutline)}changePlaybackSpeed(e){this.layer&&(this.layer.playbackRate=e)}changeGraphicsColor(e){e&&this.layer.updateTelemetryColor(e)}_followTelemetry(){this.removeHandles("follow"),this.view&&this.layer&&this.addHandles(l(()=>this.layer?.telemetry,()=>{const e=[],t=this.followingMode==="follow-sensor"||this.followingMode==="follow-both",o=this.followingMode==="follow-frame"||this.followingMode==="follow-both";t&&this.layer?.telemetry.sensorLocation&&e.push(this.layer.telemetry.sensorLocation),o&&this.layer?.telemetry.frameCenter&&e.push(this.layer.telemetry.frameCenter),e.length?this.view?.goTo(e).catch(()=>{}):this.layer?.initialExtent&&this.followingMode!=="none"&&this.view?.goTo(this.layer.initialExtent).catch(()=>{})},u),"follow")}};r([a({readOnly:!0})],i.prototype,"buffered",null),r([a({readOnly:!0})],i.prototype,"currentTime",null),r([a({readOnly:!0})],i.prototype,"duration",null),r([a({readOnly:!0})],i.prototype,"ended",null),r([a()],i.prototype,"followingMode",void 0),r([a()],i.prototype,"layer",void 0),r([a({readOnly:!0})],i.prototype,"metadata",null),r([a({readOnly:!0})],i.prototype,"playing",null),r([a()],i.prototype,"seekLength",void 0),r([a({readOnly:!0})],i.prototype,"state",null),r([a()],i.prototype,"view",void 0),i=r([p("esri.widgets.VideoPlayer.VideoPlayerViewModel")],i);const S=i;const k=V`:host{--arcgis-video-player-controls-spacing: 16px;width:531px;height:100%}.arcgis-video-player{height:100%}arcgis-video{display:flex;flex:1 1 auto;aspect-ratio:16 / 9;min-height:0}`,O={base:"arcgis-video-player"},P=L(S),y=class y extends v{constructor(){super(...arguments),this.messages=D({blocking:!0}),this.viewModel=P(this),this._videoViewRef=w(),this._metadataVisible=!1,this._duration=0,this._currentTime=0,this._bufferedValue=0,this._currentValue=0,this._isBuffering=!1,this._videoViewReady=!1,this.icon="video-web",this.state=this.viewModel.state,this.layer=this.viewModel.layer,this.autoDestroyDisabled=!1,this.hideHeader=!1,this.view=this.viewModel.view,this.arcgisPropertyChange=_()("state","layer"),this.arcgisReady=c(),this.arcgisVideoReady=c()}get followingMode(){return this.viewModel.followingMode}set followingMode(t){this.viewModel.followingMode=t}async destroy(){await this.manager.destroy()}loaded(){this.manager.onLifecycle(()=>[l(()=>[this.viewModel.currentTime,this.viewModel.duration,this.viewModel.duration,this.viewModel.ended],()=>{const{buffered:t,currentTime:o,duration:d,ended:h}=this.viewModel;this._duration=d,this._currentTime=o,this._bufferedValue=t/(d||1),this._currentValue=o/(d||1),this._isBuffering=!h&&this._bufferedValue<this._currentValue}),l(()=>this._videoViewRef.value?.ready,t=>{this._videoViewReady=!!t},{initial:!0}),l(()=>this.layer?.title,t=>{this._layerTitle=t??void 0},{initial:!0}),l(()=>this.layer?.isLive,t=>{this._isLive=t??void 0},{initial:!0}),l(()=>this.viewModel.view?.map,()=>this.requestUpdate())])}render(){return n`<div class=${M(T(O.base,C.widget))}><calcite-panel .heading=${this.hideHeader?void 0:this._layerTitle??this.messages.videoPlayer}>${this._renderLoadingScrim()}${this._renderBuffering()}${this._renderVideoSection()}${this._renderSlider()}${this._renderActionBar()}${this._renderMetadataSection()}</calcite-panel></div>`}_renderLoadingScrim(){return this._videoViewReady?null:n`<calcite-scrim .loading=${this.state!=="error"}>${this.state==="error"?this.messages.errorLoadingLayer:null}</calcite-scrim>`}_renderBuffering(){return this._isBuffering?n`<calcite-progress type=indeterminate></calcite-progress>`:null}_renderVideoSection(){return n`<arcgis-video .layer=${this.layer} .map=${this.viewModel.view?.map} @arcgisViewReadyChange=${()=>this.arcgisVideoReady.emit()} ${b(this._videoViewRef)}></arcgis-video>`}_renderSlider(){return this._isLive?null:n`<arcgis-video-player-slider .buffered=${this._bufferedValue} .value=${this._currentValue*100} .viewModel=${this.viewModel}></arcgis-video-player-slider>`}_renderActionBar(){return n`<arcgis-video-player-action-bar .currentTime=${this._currentTime} .duration=${this._duration} .messages=${this.messages} .toggleMetadata=${()=>this._metadataVisible=!this._metadataVisible} .viewModel=${this.viewModel}></arcgis-video-player-action-bar>`}_renderMetadataSection(){return this._metadataVisible?n`<arcgis-video-player-metadata .messages=${this.messages} .viewModel=${this.viewModel}></arcgis-video-player-metadata>`:null}};y.properties={_metadataVisible:16,_duration:16,_currentTime:16,_bufferedValue:16,_currentValue:16,_isBuffering:16,_videoViewReady:16,_layerTitle:16,_isLive:16,referenceElement:1,position:3,icon:1,state:3,followingMode:1,layer:0,autoDestroyDisabled:5,messageOverrides:0,label:3,hideHeader:5,view:0},y.styles=k;let g=y;$("arcgis-video-player",g);export{g as ArcgisVideoPlayer};
