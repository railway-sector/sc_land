const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CgzAF5Ey.js","assets/index-ni9qn0ie.css","assets/index-DkzYm1gq.js","assets/usePreventDocumentScroll-BlzufNWi.js","assets/PanoramicMeshManager-0tVIOV2Z.js","assets/Mesh-5O9j34eq.js","assets/MeshComponent-sBtq0OIs.js","assets/meshProperties-DWLWd_LJ.js","assets/MeshTransform-Dit-XLCt.js","assets/MeshVertexAttributes-COLD4CmN.js","assets/triangulationUtils-Bm38jwp7.js","assets/earcut-D9gy186-.js","assets/deduplicate-Cq87yrC4.js","assets/vertexSpaceConversion-DLHSkuCf.js","assets/vec4-DgNhZQgz.js","assets/External-CBuwVgCI.js","assets/PanoramicTilePyramid-D2GjnlOM.js","assets/RasterJobHandlerMixin-BTYQtDU0.js","assets/multidimensionalUtils-D7s9wCrf.js","assets/RasterSymbolizer-B91KBOTk.js","assets/PixelBlock-D-6P5OMc.js","assets/pixelRangeUtils-BvOub3JO.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/vectorFieldUtils-BfvwBWsN.js","assets/datasetUtils-DdDUWBI2.js","assets/utils-BxeCvIiv.js","assets/cimSymbolUtils-D8zbHeXT.js","assets/gfxUtils-B1R76T6S.js","assets/ClassBreaksDefinition-8EN4J2v2.js","assets/dataUtils-Bl6288_r.js","assets/OrientedImageryLayer-WtDfNKlU.js","assets/a11yUtils-B0k1CDxO.js","assets/projectOperator-GV0McMFO.js","assets/operatorProject-BaCyxOS9.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/ElevationLayer-BKaFw3VV.js","assets/ArcGISCachedService-DSjNkGng.js","assets/TileInfoTilemapCache-B_wenAXe.js","assets/LercDecoder-BoaSwpxn.js","assets/ImageryLayer-BvGD4I6c.js","assets/isImageryGraphicOrigin-Ccuhb4eK.js","assets/imageBitmapUtils-CXji9o1v.js","assets/rasterFieldUtils-owWC2Tqk.js","assets/RasterPresetRendererMixin-B7AjuQMT.js","assets/executeForIds-J9ecr7ox.js","assets/query-CnhzGyzp.js","assets/pbfQueryUtils-S_j2eB_b.js","assets/pbf-BEkcbkvb.js","assets/executeQueryJSON-PzPNmZ_E.js","assets/ExpandViewModel-CyOPQWzt.js","assets/widget-5CKB7XP2.js","assets/GraphicsLayer-CNIUk38A.js","assets/vmEvent-CsrnYMSK.js","assets/MediaLayer-D7zWuWat.js","assets/VideoElement-E5DMr6hw.js","assets/MediaElementView-D6UZnd3c.js","assets/normalizeUtilsSync-BwFfP_Vx.js","assets/ControlPoint-O-tXQDvT.js","assets/mediaLayerUtils-BJ-DU5EY.js","assets/ImageElement-CeMdIsZW.js","assets/BoundsStore-CymG19gy.js","assets/Circle-BiDO0Dld.js","assets/geodesicUtils-Cfv0uT1u.js","assets/deepClone-zSvyy7Jt.js","assets/languageUtils-Ci9pGmfc.js","assets/ImmutableArray-BPVd6ESQ.js","assets/shared-DpUtm4ff.js","assets/number-BNHbRH9q.js","assets/floorFilterUtils-DKzVzLpH.js","assets/MapView-CwKV528N.js","assets/View2D-Z_g1Pe0z.js","assets/clippingUtils-QppW5MR2.js","assets/viewpointUtils-BuigW1az.js","assets/mat2d-DWPHXQcf.js","assets/mat2df64-DJ_RMjZ3.js","assets/mat2df32-Dpt2CT5P.js","assets/hitTestUtils-BYtV70CA.js","assets/rbush-eDLDlHie.js","assets/Tile-B-BE-ibd.js","assets/arcadeUtils-MYBE13Eg.js","assets/Timeline-Cz5T4vl1.js","assets/utils-DN_jc3_L.js","assets/Draw-Bs7q8swp.js","assets/SnappingVisualizer2D-D_sty-M3.js","assets/euclideanLengthMeasurementUtils-CGkbgpIY.js","assets/geometry2dUtils-DamFhDZI.js","assets/geodeticLengthOperator-CCmu1UCP.js","assets/geodeticCurveType-CirnHLSB.js","assets/geodesicMeasurementUtils-CD0H_C-6.js","assets/SnappingVisualizer-CfgCZJq2.js","assets/PointSnappingHint-ByJMd16p.js","assets/coordinateHelper-BBk0eSaI.js","assets/EditGeometryOperations-CUoPE0hp.js","assets/rotate-LRLOFQu1.js","assets/curveOperationUtils-Bf-6qlka.js","assets/SnappingContext-lR2hMWGP.js","assets/SnappingOperation-BCgVE0WW.js","assets/automaticLengthMeasurementUtils-B1DzL2GL.js","assets/DrawingMode-Cvvf0VVz.js","assets/surfaceCoordinateSystems-Czhjgkml.js","assets/drawUtils-DfCzrCmO.js","assets/quantityFormatUtils-hOh9vK9C.js","assets/areaOperator-DccGwebv.js","assets/Point2D-8Py_srEd.js","assets/Envelope2D-DQ3Tn1o-.js","assets/ProjectionTransformation-D72vYhR2.js","assets/Transformation2D-Ckyhe4wc.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/jsonConverter-EjytI4Do.js","assets/apiConverter-CvNJfrRe.js","assets/geodeticAreaOperator-ncO4zfYQ.js","assets/geodeticDensifyOperator-CUM-mSy9.js","assets/operatorGeodeticDensify-D2ygatwM.js","assets/lengthOperator-CxFhBUNM.js","assets/simplifyOperator-CkrCdZRR.js","assets/operatorSimplify-CpftPpUB.js","assets/operators-BaeX3D2r.js","assets/affineTransformOperator-CBep9xo8.js","assets/operatorGeodesicBuffer-C3QQCPQh.js","assets/simplifyOGCOperator-CCJuEH9o.js","assets/OperatorSimplifyOGC-BxMfXpcX.js","assets/Transformation-CfjgNJxz.js","assets/bufferOperator-C3fOKu2I.js","assets/operatorBuffer-Ctfn1Lk3.js","assets/Bufferer-Dw9Qi4T1-DmMU98zV.js","assets/OperatorGeneralize-BF2-89dP.js","assets/centroidOperator-Cn6om9eu.js","assets/Centroid-DZi-eb9F-bsuFT5fW.js","assets/clipOperator-vUzjvvL3.js","assets/containsOperator-DH_4OVBp.js","assets/operatorConvexHull-Dtstnt_d.js","assets/OperatorCrosses-Bo35YEg8.js","assets/cutOperator-Di-dmwJV.js","assets/densifyOperator-BorquEXx.js","assets/operatorDensify-CPsyOzUu.js","assets/differenceOperator-B48dZrcZ.js","assets/distanceOperator-kpocAfUa.js","assets/Distance2DCalculator-CXhBP-8I-RGTjIsY8.js","assets/equalsOperator-BEQPwjuO.js","assets/generalizeOperator-CWNeXtMt.js","assets/operatorGeneralize-BOPizdLP.js","assets/intersectionOperator-Cv1V-QEZ.js","assets/operatorIntersection-ChMpQjPa.js","assets/intersectsOperator-RUQIyyK7.js","assets/OperatorIntersects-Q2s_ZB0E.js","assets/labelPointOperator-CF3FJ9RO.js","assets/OperatorProximity-BBNJFXrK.js","assets/OperatorOverlaps-CqeWwi8u.js","assets/proximityOperator-CJBDpiUf.js","assets/relateOperator-DrBanIAi.js","assets/symmetricDifferenceOperator-heSitsZ5.js","assets/OperatorTouches-CfSdRjLR.js","assets/unionOperator-Dj7O8xPO.js","assets/operatorUnion-ClGNRpq_.js","assets/OperatorWithin-CrxvVT6B.js","assets/offset-CBc0lznI.js","assets/unitConversion-FJJcJ7aj.js","assets/operatorOffset-D6prETIX.js","assets/ImageryTileLayer-DgPV_a3H.js","assets/isImageryTileGraphicOrigin-ZR-gBf9D.js","assets/xmlUtilities-DhOJzv6R.js","assets/QueueProcessor-DIiVPdhP.js","assets/RawBlockCache-CXmw_9Mx.js","assets/rasterProjectionHelper-FtdA54qR.js","assets/clipUtils-CpEsp-yF.js","assets/rasterFunctionHelper-CIXquxIf.js","assets/PolynomialTransform-BTUf5vGs.js","assets/SketchViewModel-DhxBVxKu.js","assets/isSupportedObject-DSxuxd5I.js","assets/layerUtils-C4kbKZbG.js","assets/SketchLabelOptions-CtWdh0ak.js","assets/SketchOptions-DsWZlvNP.js","assets/SnappingManager-C_Xw3YlC.js","assets/automaticAreaMeasurementUtils-BatsSLDN.js","assets/geodesicAreaMeasurementUtils-CadONabs.js","assets/useWidget-DdroRqZj.js","assets/useView-CMtXgKA0.js","assets/index-B4P055yQ.js","assets/NavigationManagerPanoramic-BLX9o_Ty.js","assets/NavigationManager-DCtRigBR.js","assets/DataCaptureAdapter-B6WeK1YK.js","assets/SketchHandlerMixin-CXvVK9QK.js","assets/DepthImageService-Dgl4U2mH.js","assets/MapViewAdapter-CTKZ52Vz.js","assets/SceneViewAdapter-BsseDWQ6.js","assets/MeasurementAdapter-BN2--ITA.js","assets/TriangulatedMeasurementAdapter-D-4srXQU.js","assets/index-C6Bg1Dv_.js","assets/index-wZEQ7UQo.js","assets/index-XWTXosd7.js","assets/index-BKl3hgfS.js","assets/index-DrZEMm52.js","assets/responsive-DE0RShqI.js","assets/index-Z8M091uh.js","assets/index-DJJfznxJ.js","assets/index-CpqZ5vpU.js","assets/index-BzY_GgVs.js","assets/ImageOverlays-Dk1e8o1v.js","assets/LayerList-Cd1pKfOs.js","assets/listUtils-V67Tcz5c.js","assets/actionUtils-BhEhehjO.js","assets/layerListUtils-CrO8uhQ1.js","assets/LayerListViewModel-DOIGYhGa.js","assets/utils-BQBvadb7.js","assets/ListItem-DyzSo_ob.js","assets/NavigationSettings-Bi24s5Kt.js","assets/ImageMeasurementWidget-B68ZyO9u.js","assets/UnitSelect-BKaEWZjc.js","assets/SketchTools-CVig6JFl.js"])))=>i.map(i=>d[i]);
import{fw as me,a0 as O,cv as ia,fe as te,ho as Mt,jH as jo,a5 as N,b4 as aa,hh as pr,qd as qo,pr as Wo,H3 as Uo,H4 as Zo,H5 as Qo,nF as ae,am as L,ab as W,gU as X,ac as gr,lx as ra,H6 as k,pu as Xo,by as Lt,hr as ti,cX as ka,pt as vr,gC as he,jx as ve,ot as Jo,sr as yr,et as Gi,H7 as Yo,Fo as Ko,aB as en,_ as s,e as c,a1 as ze,g as ie,T as tt,nO as tn,f as R,bJ as ht,U as Te,V as A,W as v,bK as We,aq as wr,bF as fr,ch as _r,ap as Q,Ac as oa,O as D,Ad as na,dq as P,Z as bt,ex as oe,H8 as an,$ as E,ff as rn,aX as Ye,H9 as yi,cC as sa,d4 as Mr,d6 as la,w9 as ca,Ha as br,jb as wi,Hb as xr,y as Ir,jl as ce,B as ut,fJ as on,jr as Ea,Hc as nn,dY as Ni,o8 as sn,qQ as ln,cm as le,cn as Nt,bP as cn,fn as Bi,wp as dn,eX as Tr,FV as hn,af as ue,c_ as da,b5 as Vr,m1 as un,Hd as ii,lZ as Pr,aA as mn,as as ha,Dc as Fr,p8 as za,GB as pn,em as gn,av as kt,fd as Et,jc as fi,ES as vn,ET as ua,at as Cr,He as yn,Hf as wn,mp as fn,mo as _n,df as Ar,aw as ma,aH as Ie,ae as xe,pw as Bt,Hg as jt,aW as ji,aD as Ha,bi as Mn,pd as bn,tD as $r,cG as Ee,s0 as xn,nJ as In,f6 as Tn,a_ as Ve,oA as Vn,bI as qt,d0 as Wt,s8 as Da,bC as Ut,p2 as Zt,rC as Ke,aR as xi,fp as Pn,I as qi,bG as Fn,L as Cn,u as An,c as $n,s2 as Sn,i as Rn,l as On}from"./index-CgzAF5Ey.js";import{j as zt,p as Sr,i as Ga,c as pa,D as Ln,n as kn,l as Na,a as En,K as zn,b as Rr,d as Hn,e as Or,W as Wi}from"./OrientedImageryLayer-WtDfNKlU.js";import{o as Dn}from"./a11yUtils-B0k1CDxO.js";import{load as Gn,execute as Nn}from"./projectOperator-GV0McMFO.js";import Bn from"./ElevationLayer-BKaFw3VV.js";import jn from"./ImageryLayer-BvGD4I6c.js";import{a as qn}from"./LercDecoder-BoaSwpxn.js";import{N as Lr}from"./RasterJobHandlerMixin-BTYQtDU0.js";import{r as kr}from"./ExpandViewModel-CyOPQWzt.js";import{e as Wn,o as Un}from"./widget-5CKB7XP2.js";import{n as qe}from"./GraphicsLayer-CNIUk38A.js";import{Y as Ht}from"./Mesh-5O9j34eq.js";import{n as Zn,g as Qn,h as Xn}from"./MeshComponent-sBtq0OIs.js";import{e as St}from"./vmEvent-CsrnYMSK.js";import Jn from"./MediaLayer-D7zWuWat.js";import{b as Ui}from"./Circle-BiDO0Dld.js";import{MeshVertexAttributes as ga}from"./MeshVertexAttributes-COLD4CmN.js";import{f as Yn}from"./deepClone-zSvyy7Jt.js";import{V as Kn,a as es}from"./VideoElement-E5DMr6hw.js";import{o as ts}from"./floorFilterUtils-DKzVzLpH.js";import{p as va}from"./MapView-CwKV528N.js";import{l as is}from"./Draw-Bs7q8swp.js";import{M as as}from"./drawUtils-DfCzrCmO.js";import{G as rs,k as Er}from"./quantityFormatUtils-hOh9vK9C.js";import{n as os}from"./areaOperator-DccGwebv.js";import{m as ns,l as ss}from"./geodeticAreaOperator-ncO4zfYQ.js";import{l as zr,y as Hr}from"./geodeticDensifyOperator-CUM-mSy9.js";import{m as ya,l as ai}from"./geodeticLengthOperator-CCmu1UCP.js";import{r as ri}from"./lengthOperator-CxFhBUNM.js";import{u as wa}from"./simplifyOperator-CkrCdZRR.js";import{y as Dr,R as oi,v as Ba}from"./geodesicUtils-Cfv0uT1u.js";import{rotate as Ii}from"./operators-BaeX3D2r.js";import{i as ls}from"./intersectionOperator-Cv1V-QEZ.js";import{c as cs}from"./proximityOperator-CJBDpiUf.js";import{q as ds}from"./ImageryTileLayer-DgPV_a3H.js";import{D as ja}from"./rasterFunctionHelper-CIXquxIf.js";import{c as hs}from"./viewpointUtils-BuigW1az.js";import{d as us}from"./SketchViewModel-DhxBVxKu.js";import{I as ms}from"./useWidget-DdroRqZj.js";const qa=120,G=[21,36,51,60],ps=3.5,Qt=["FAR_WEST","FAR_NORTH","FAR_EAST","FAR_SOUTH","WEST","NORTH","EAST","SOUTH","NEAR_WEST","NEAR_NORTH","NEAR_EAST","NEAR_SOUTH"],Pe=23.937554159486076,Fe=96.06244584051393,Ti={EAST:[Pe,Pe,Fe,Pe,60,Pe],NORTH:[Pe,Fe,Pe,Pe,Pe,60],SOUTH:[Fe,Pe,Fe,Fe,Fe,60],WEST:[Fe,Fe,Pe,Fe,60,Fe]},Wa=-999,gs=100,vs=()=>["after-data-capture-complete","deselect-data-capture-features","select-data-capture-features"],fa="ImageGeometry",_a="OIObjectId",Gr=[1920,1080],Nr=[{x:-2886579864025407e-30,y:1080},{x:0,y:0},{x:1920,y:54511950509095186e-30},{x:1920,y:1080},{x:-2886579864025407e-30,y:1080}],ys={xmin:-150,ymin:1,xmax:20,ymax:80,spatialReference:{wkid:4326}},Ua=5,ws=me(Math.acos(.05));function fs(t){return t?.type==="3d"}function _s(t){return t?.declaredClass==="esri.Graphic"}function Ms(t){return/(tiff|tif|mrf)$/i.test(t??"")}function Vi(t){if(!t||!URL.canParse(t))return!1;const{pathname:e}=new URL(t);return/.*\.(tiff|tif|mrf)$/i.test(e??"")}function bs(t){return Math.abs(t)>=135?"WEST":t<-45&&t>-135?"SOUTH":t<=45?"EAST":"NORTH"}function xs(t,e){const i=t/e*G[2];return i<=G[0]?"NEAR":i<=G[1]?"":"FAR"}function Is(t){return t&&t.url&&t.datasetFormat?t:null}function Ts(t){return typeof t=="string"&&t.length?t:Is(t)}const Vs=t=>e=>e.layer===t;function Za(t){return t?.name==="NoAttachmentError"}const Ma=t=>`${t}:missing-property`,ba=(t,e)=>`Property ${e} is missing in ${t}`,Rt=(t="esri.widgets.OrientedImageryViewer",e)=>{throw O.getLogger(t).error(e),e},Br=async(t,e)=>{const i=await ia(t,{...e,method:"head"}),a=i?.getHeader?.("Content-Type");if(a)return a.split("/")[1]};function Ps(t,e){e&&t.forEach(i=>{i.elevationSample=e})}async function Fs(t,e,i){if(!e.extent||!e.url)throw Rt("esri.layer.orientedImagery.transformations",new N("update-elevation:missing-property","both extent and url are required to create a sampler",e));const a=await xa(e);if(!a)throw Rt("esri.layers.orientedImagery.transformations",new N("update-elevation:elevation-source","could not create a sampler using provided elevation source",e));return jr(t,a,i)}async function jr(t,e,i){await Mt(i);const a=Ss(e,i),r=Array.isArray(t)?t:[t];return await Promise.all(r.map(a))}async function xa(t,e){let i;const{extent:a,rasterFunction:r,url:o,lod:n}=t;try{i=await $s(o)}catch(l){if(te(l))return;O.getLogger("esri.layers.orientedImagery.transformations").error("updateElevationUsingElevationSource",l)}switch(i){case 0:return await As(o,a,r,e);case 1:return await Cs(o,a,n,e);default:return}}async function Cs(t,e,i,a){const r=new Bn(t);let o;try{const{tileInfo:n}=await r.load(),l=(i&&n.lodAt(Math.min(n.lods.length-1,i))?.resolution)??"finest-contiguous";o=await r.createElevationSampler(e,{...a,demResolution:l})}catch(n){if(te(n))return;O.getLogger(r).error(n)}finally{r.destroy()}return o}async function As(t,e,i,a){const r=i?new Lr({functionName:i}):void 0,o=new jn({url:t,rasterFunction:r,format:"lerc"});await o.load(a);const n=512,l=e.center,d=Math.max(e.width,e.height);let h=new aa({xmin:l.x-d/2,ymin:l.y-d/2,xmax:l.x+d/2,ymax:l.y+d/2,spatialReference:e.spatialReference});o.spatialReference.equals(h.spatialReference)||(await Gn(),h=Nn(h,o.spatialReference));const u=await o.fetchPixels(h,n,n,a),m=pr.create({scales:[d/n],size:n,spatialReference:h.spatialReference}),g=new qo(0,0,0,Wo(h)),p=new qn(u.pixelBlock.pixels[0],n,n,0),y=[new Uo(g,p)],f=Zo.noDataValue;return new Qo({tiles:y,tileInfo:m,noDataValue:f})}async function $s(t,e){await Mt(e);const i=await jo(t),{tileInfo:a,cacheType:r}=i;if(!i.hasOwnProperty("bandCount")||!i.hasOwnProperty("pixelSizeX"))throw new N("elevation-source:invalid-service-url",`ElevationSource URL expects an elevation 3D image service but given ${t}`);return a?a?.format?.toUpperCase()!=="LERC"||r&&r.toLowerCase()!=="elevation"?2:1:0}function Ss(t,e){return async i=>{let a=i.clone();const r=i.spatialReference.equals(t.spatialReference)?a:await ae(i,t.spatialReference,e),o=t.queryElevation(r);return o&&(a=i.spatialReference.equals(t.spatialReference)?o.clone():await ae(o,i.spatialReference,e)),a.z=a.z??1,a}}async function Rs(t,e,i){return await Mt(i),t.map(a=>(a.z=e,a))}function Os(t,e){const{averageGroundElevation:i,spatialReference:a}=e,r=zt(a);return t.map(o=>{const n=o.clone();return n.z=i*r/o.spatialReference.metersPerUnit,n})}const Ia=new L({x:0,y:0,z:0,spatialReference:W.WebMercator}),mt=1e3,Zi=114,ni=120,si=50,bh=.3515625;function Ct(t,e,i){const[a,r,o,n]=e,[l,d,h,u]=i;Qa(a,r,o,n);const m=Qa(l,d,h,u),g=Xa(a,r,o,n),p=Xa(l,d,h,u),y=yr(Gi(),g),f=Yo(Gi(),y,p),[w,_,x,b]=ks(t,f);return[w/b,_/b,m?0:x/b]}function Qa(t,e,i,a){return t[2]===0&&e[2]===0&&i[2]===0&&a[2]===0&&(t[2]=e[2]=i[2]=a[2]=1,!0)}function Ls(t){return t===0?1:t}function ks(t,e){const[i,a,r]=t,o=[0,0,0,0];return o[0]=i*e[0]+a*e[1]+r*e[2]+e[3],o[1]=i*e[4]+a*e[5]+r*e[6]+e[7],o[2]=i*e[8]+a*e[9]+r*e[10]+e[11],o[3]=Ls(i*e[12]+a*e[13]+r*e[14]+e[15]),o}function Xa(t,e,i,a){const r=Es(en([...a,1]),yr(new Array(16),Ko(t[0],e[0],i[0],0,t[1],e[1],i[1],0,t[2],e[2],i[2],0,1,1,1,1))),o=r[0],n=r[1],l=r[2],d=Gi();return d[0]=o*t[0],d[1]=n*e[0],d[2]=l*i[0],d[3]=0,d[4]=o*t[1],d[5]=n*e[1],d[6]=l*i[1],d[7]=0,d[8]=o*t[2],d[9]=n*e[2],d[10]=l*i[2],d[11]=0,d[12]=o,d[13]=n,d[14]=l,d[15]=1,d}function pt(t,e,i,a,r=k()){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*(i/a),r}function ee(t,e,i){const a=k();return a[0]=t[0]*e,a[1]=t[1]*e,a[2]=t[2]*(e/i),a}function He(t,e){const[i,a,r]=t,o=k();return o[0]=i*e[0]+a*e[3]+r*e[6],o[1]=i*e[1]+a*e[4]+r*e[7],o[2]=i*e[2]+a*e[5]+r*e[8],o}function Es(t,e){const[i,a,r,o]=t,n=new Array(4);return n[0]=i*e[0]+a*e[1]+r*e[2]+o*e[3],n[1]=i*e[4]+a*e[5]+r*e[6]+o*e[7],n[2]=i*e[8]+a*e[9]+r*e[10]+o*e[11],n[3]=i*e[12]+a*e[13]+r*e[14]+o*e[15],n}function zs(t,e,i,a=!0){if(!Number.isFinite(t))throw new N("InvalidRotationAngle","Please specify a valid angle for rotation");const r=i*(a?X(t):t),o=Math.cos(r),n=Math.sin(r),l=Lt();switch(e){case 0:l[4]=o,l[5]=-n,l[7]=n,l[8]=o;break;case 1:l[0]=o,l[2]=n,l[6]=-n,l[8]=o;break;case 2:l[0]=o,l[1]=-n,l[3]=n,l[4]=o;break;default:throw new N("InvalidRotationAxis","Please specify either 0, 1 or 2 for X, Y or Z axis respectively")}return l}const qr={HPR:[[2,-1],[0,1],[2,-1]],OPK:[[0,1],[1,1],[2,1]]};function Wr(t,e,i=!0){if(t?.length!==3||e?.length!==3)throw new N("InvalidRotationAngles","Please specify three angles with config for rotation");const a=Lt();for(let r=0;r<3;r++){const[o,n]=e[r],l=zs(t[r],o,n,i);Xo(a,l,a)}return a}function Hs(t,e=!0){return Wr(t,qr.OPK,e)}function Qi(t,e=!0){return Wr(t,qr.HPR,e)}function Ur(t,e,i){const a=Math.sin(X(i)),r=Math.cos(X(i)),o=[[t,0],[t,e],[0,e]];o.forEach((l,d)=>{o[d]=[r*l[0]-a*l[1],a*l[0]+r*l[1]]});const n={xmin:Math.min(0,o[0][0],o[1][0],o[2][0]),xmax:Math.max(0,o[0][0],o[1][0],o[2][0]),ymin:Math.min(0,o[0][1],o[1][1],o[2][1]),ymax:Math.max(0,o[0][1],o[1][1],o[2][1])};return{hfov:Math.abs(n.xmax-n.xmin),vfov:Math.abs(n.ymax-n.ymin)}}function Ds(t,e){const i=Number(t[0]),a=Number(t[1]),r=Number(t[2]),[o,n,l,d]=e,h=X(o),u=X(n),m=l/Math.sqrt(1-d*Math.sin(h)**2),g=i/m,p=a/m,y=r/m,f=Math.cos(h)-Math.sin(h)*p+Math.cos(h)*y,w=Math.sin(h)+Math.cos(h)*p+Math.sin(h)*y,_=Math.sqrt(f**2+g**2),x=d*m*Math.sin(h),b=(S,U=5)=>{if(U===0)return S;const J=b(S,U-1);return Math.atan(w/_-(x-d*(l/Math.sqrt(1-d*Math.sin(J)**2))*Math.sin(J))/(m*_))},T=b(h),I=Math.atan(i/(m*f))+u,$=me(T);return[me(I),$,i/(Math.cos(T)*Math.sin(I-u))-l/Math.sqrt(1-d*Math.sin(T)**2)]}function je(t,e,i){const a=360/e,r=180/i;return{heading:(t.x-e/2)*a,pitch:90-(t.y-i/2)*r}}function _e(t,e,i,a=mt/2){const{heading:r,pitch:o}=Gs(t,a);return Zr(r,o,e,i)}function Zr(t,e,i,a){const r=t%360;return{x:i/2+(r<-180?r+360:r>180?r-360:r)/(360/i),y:a-e/(180/a),heading:t,pitch:e}}function Gs(t,e){const i=me(Math.acos(-t.z/e));return{heading:me(Math.atan2(t.x,t.y)),pitch:i}}function Qe(t,e,i=mt/2){return[i*(Math.sin(X(t))*Math.sin(X(e))),i*(Math.cos(X(t))*Math.sin(X(e))),i*Math.cos(X(180-e))]}function Xt(t,e,i,a=mt/2){const{heading:r,pitch:o}=je(t,e,i);return Qe(r,o,a)}async function Ja(t,e,i){const a=await ae(e,t.spatialReference,i);let r=me(Math.atan2(a.y-t.y,a.x-t.x));return r=r>=0&&r<=90?90-r:r>90&&r<=180?360-r+90:90+Math.abs(r),r}function Jt(t,e,i){const a=Math.cos(i),r=Math.sin(i),o=[1,0,0,1,0,0],n=o[0]*a+o[2]*r,l=o[1]*a+o[3]*r,d=-o[0]*r+o[2]*a,h=-o[1]*r+o[3]*a;return o[0]=n,o[1]=l,o[2]=d,o[3]=h,[t*o[0]+e*o[2]+o[4],t*o[1]+e*o[3]+o[5]]}const fe=t=>t.toArray(),Se=(...t)=>t.some(e=>e);function Ns(t,e){if(Se(t.length===0,t.some(({x:i,y:a})=>Se(i==null,a==null)),!e.hasZ))throw new Error("Input pixels must have x, y and camera location must have z value")}function Qr(t,e){if(t.some(i=>i.z==null)||e.z==null)throw new Error("Input points and camera location must have z value")}function Xr(t){if(t?.length!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix")}function it(t,e){return gr(e)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*t/ra.radius))):1}const Bs=t=>e=>new L(e,t),js=t=>t!=null&&"queryExtent"in t;function qs(t,e,i,a){return[[-e,-e],[+e,-e],[+e,+e],[-e,+e]].map(([r,o])=>Ct(Jo(k(),i,[r,o,0]),a,t))}function Ws({a0:t,a1:e,a2:i,b0:a,b1:r,b2:o},n,l,d){const h=[t??n/2-.5,e,i??0,a??l/2-.5,r??0,o].map(Us);return d!=null&&Zs(h)?{affines:h,focalLength:d}:{affines:[n/2-.5,1,0,l/2-.5,0,-1]}}function Us(t,e){if(t==null)return null;const i=parseFloat(`${t}`);return isNaN(i)?null:i}function Zs(t){return t[1]!=null&&t[5]!=null}function li(t,e,i){const{cameraHeight:a,cameraPitch:r,cameraRoll:o,elevation:n,farDistance:l,horizontalFieldOfView:d,location:h,verticalFieldOfView:u}=Va(t,t.location.spatialReference),m=n??(h.z??0)-a;return{...Jr(t,e,i),averageElevation:m,cameraPitch:r,cameraRoll:o??0,farDistance:l,horizontalFieldOfView:d,verticalFieldOfView:u}}function Qs(t,e,i,a){return el(a)?Hs([a.omega,a.phi,a.kappa]):tl(a)?Qi([a.heading,a.pitch,a.roll]):Qi([t,e,i??0])}function Ya(t,e,i){const{cameraHeading:a,cameraHeight:r,farDistance:o,horizontalFieldOfView:n,location:l,verticalFieldOfView:d}=Va(t,t.location.spatialReference);return{averageElevation:(l.z??0)-r,cameraLocation:l,cameraHeading:a,farDistance:o,horizontalFieldOfView:n,imageHeight:i,imageWidth:e,verticalFieldOfView:d}}function Jr(t,e,i){const{a0:a,a1:r,a2:o,b0:n,b1:l,b2:d,cameraHeading:h,cameraOrientation:u,cameraPitch:m,cameraRoll:g,focalLength:p,horizontalFieldOfView:y,location:f,matrix:w,principalX:_,principalY:x,radial:b,tangential:T,verticalFieldOfView:I}=t,{affines:$,focalLength:S}=Ws({a0:a,a1:r,a2:o,b0:n,b1:l,b2:d},e,i,p),U=w??Qs(h,m,g,u),J=_!=null&&x!=null?[_,x]:void 0;return{affineTransformations:u?.affineTransformations??$,cameraLocation:f.clone(),focalLength:u?.focalLength??S,horizontalFieldOfView:y,imageHeight:i,imageWidth:e,principalOffsetPoint:u?.principalOffsetPoint??J,radialDistortionCoefficients:u?.radialDistortionCoefficients??b,rotationMatrix:U,tangentialDistortionCoefficients:u?.tangentialDistortionCoefficients??T,verticalFieldOfView:I}}const Yr=t=>t!=null&&"elevationSample"in t&&t.elevationSample!=null,Ta=t=>pa(t?.elevationSource)&&t?.extent!=null,Xs=t=>Sr(t?.elevationSource),Tt=async(t,e,i,a,r)=>{const o=zt(t),n=e-i/o;return Xs(a)?(a.elevationSource=new Ga({constantElevation:a.elevationSource.constantElevation/o}),a):Yr(a)?a:Ta(a)?{elevationSample:await xa({...ti(a.elevationSource)?a.elevationSource.toJSON():a.elevationSource,extent:a.extent},r),elevationSource:new Ga({constantElevation:n})}:{averageGroundElevation:n,spatialReference:t}},Js=t=>ka(t?.heading)&&ka(t?.pitch),Ys=(t,e)=>[[-t,-e],[t,-e],[t,e],[-t,e]];function Ks(t){const{cameraLocation:e,farDistance:i,horizontalFieldOfView:a,rotationMatrix:r,scalingFactor:o,verticalFieldOfView:n}=t,l=Lt();vr(l,r);const d=2*Math.tan(X(n)/2)*i*o,h=2*Math.tan(X(a)/2)*i*o,u=He([0,0,-1],l),m=pt([e.x,e.y,e.z],u,t.farDistance*o,o),g=He([0,1,0],l),p=He([1,0,0],l),y=ee(g,d/2,o),f=ee(p,h/2,o),w=he(k(),y,f),_=ve(k(),y,f);return[ve(k(),m,w),ve(k(),m,_),he(k(),m,w),he(k(),m,_)]}const el=t=>t?.type===2,tl=t=>t?.type===1;function Pi(t,e,i){if(t==="panoramic"){const[a,r]=i;return _e({x:e.x,y:e.y,z:e.z},a,r)}return{x:e.x+.5,y:.5-e.y}}function Va(t,e,i=!0){const a=zt(e),r=i?t.clone():t;return r.cameraHeight/=a,r.farDistance/=a,r.nearDistance/=a,Sr(r.elevationSource)&&(r.elevationSource.constantElevation/=a),r}const Ne="esri-expand",we={base:Ne,toggle:`${Ne}__toggle`,popoverContent:`${Ne}__popover-content`,panel:`${Ne}__panel`,panelContent:`${Ne}__panel-content`,sheet:`${Ne}__sheet`,contentContainer:`${Ne}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconNumber:`${Ne}__icon-number`},Ka="chevrons-left",er="chevrons-right",Fi=Symbol("scheduleRender-override-handle");let Z=class extends tt{constructor(e,i){super(e,i),this._boundScheduledRender=this.scheduleRender.bind(this),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.focusTrapDisabled=!1,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new kr,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=a=>{a.target===this._popoverEl&&(this.viewModel.expanded=a.currentTarget.open)},this._handleSheetClose=a=>{this.viewModel.expanded=a.currentTarget.open},this._handlePanelClose=a=>{this.viewModel.expanded=!a.currentTarget.closed},this._handleKeyDown=a=>{this.viewModel.expanded&&a.key==="Escape"&&!this._willCloseOnEsc(a)&&a.preventDefault()},this._storeToggleActionEl=a=>{this._toggleActionEl=a},this._storePopoverEl=a=>{this._popoverEl=a},tn(O.getLogger(this),"Expand","arcgis-expand",{version:"4.34"})}initialize(){this.addHandles(R(()=>this.viewModel?.view?.size,()=>this._popoverEl?.reposition(),ht))}loadDependencies(){return Te({action:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MV),__vite__mapDeps([0,1])),icon:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MT),__vite__mapDeps([0,1])),panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MZ),__vite__mapDeps([0,1])),popover:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MW),__vite__mapDeps([0,1])),sheet:()=>A(()=>import("./index-DkzYm1gq.js"),__vite__mapDeps([2,0,1,3]))})}get expandTitle(){const{expanded:e,messagesCommon:i,collapseTooltip:a,expandTooltip:r}=this;return(e?a||i?.collapse:r||i?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return this.viewModel.view?.widthBreakpoint==="xsmall";default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIcon(){return er}set collapseIcon(e){this._overrideIfSome("collapseIcon",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIcon(){return typeof this.content=="object"&&"icon"in this.content&&this.content.icon?this.content.icon:Ka}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get icon(){return null}get label(){return typeof this.content=="object"&&"label"in this.content&&this.content.label?this.content.label:this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:e,_toggleActionEl:i,viewModel:{expanded:a},label:r,placement:o}=this;return v("div",{class:this.classes(we.base,We.widget)},this._renderToggle(),e?v("calcite-sheet",{class:we.sheet,heightScale:"l",label:r,onkeydown:this._handleKeyDown,open:a,position:"block-end",onCalciteSheetClose:this._handleSheetClose},v("calcite-panel",{class:we.panel,closable:!0,closed:!a,heading:r,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},v("div",{class:we.panelContent},this._renderContent()))):i?v("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,focusTrapDisabled:this.focusTrapDisabled,label:r,onkeydown:this._handleKeyDown,open:a,overlayPositioning:"fixed",placement:o??this._getPlacement(),referenceElement:i,onCalcitePopoverClose:this._handlePopoverClose},v("div",{class:we.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:e,view:i}=this,a=e&&i?i.ui.getPosition(e):null;if(!a||a==="manual")return"auto";const[r,o]=a.split("-");return`${o==="right"?"left":"right"}-${r==="bottom"?"end":"start"}`}_willCloseOnEsc(e){const{closeOnEsc:i}=this;return typeof i=="function"?i(e):i}_renderBadgeNumber(){const{expanded:e,iconNumber:i}=this;return i&&!e?v("span",{class:we.iconNumber,key:"expand__icon-number"},i):null}_renderToggleButton(){const{expanded:e,expandTitle:i,expandIcon:a,collapseIcon:r}=this,o=e?r:a,n=o===Ka||o===er;return v("calcite-action",{afterCreate:this._storeToggleActionEl,afterUpdate:this._storeToggleActionEl,class:We.widgetButton,onclick:this.toggle,scale:"s",text:i,title:i},o?v("calcite-icon",{class:this.classes(we.icon,n&&we.iconFlip),icon:o,scale:"s"}):null)}_renderToggle(){return v("div",{class:we.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:e}=this;return typeof e=="string"?v("div",{class:we.contentContainer,innerHTML:e,key:"content__string"}):Wn(e)?v("div",{afterCreate:()=>{this._overwriteChildScheduleRender(e)},afterRemoved:()=>this.removeHandles(Fi),afterUpdate:()=>{e.scheduleRender!==this._boundScheduledRender&&(this.removeHandles(Fi),this._overwriteChildScheduleRender(e))},class:we.contentContainer,key:"content__widget"},e.render()):e instanceof HTMLElement?v("div",{afterCreate:this._attachToNode,bind:e,class:we.contentContainer,key:"content__html-element"}):Un(e)?v("div",{afterCreate:this._attachToNode,bind:e.domNode,class:we.contentContainer,key:"content__node"}):null}_overwriteChildScheduleRender(e){const i=e.scheduleRender;e.scheduleRender=this._boundScheduledRender,this.addHandles(wr(()=>e.scheduleRender=i),Fi)}_attachToNode(e){const i=this;e.appendChild(i)}};s([c({readOnly:!0})],Z.prototype,"expandTitle",null),s([c()],Z.prototype,"_toggleActionEl",void 0),s([c()],Z.prototype,"_displaySheet",null),s([c()],Z.prototype,"autoCollapse",null),s([c()],Z.prototype,"closeOnEsc",void 0),s([c()],Z.prototype,"collapseIcon",null),s([c()],Z.prototype,"collapseTooltip",void 0),s([c()],Z.prototype,"content",void 0),s([c()],Z.prototype,"expanded",null),s([c()],Z.prototype,"expandIcon",null),s([c()],Z.prototype,"expandTooltip",void 0),s([c()],Z.prototype,"focusTrapDisabled",void 0),s([c()],Z.prototype,"group",null),s([c()],Z.prototype,"icon",null),s([c()],Z.prototype,"iconNumber",void 0),s([c()],Z.prototype,"label",null),s([c(),ze("esri/widgets/Expand/t9n/Expand")],Z.prototype,"messages",void 0),s([c(),ze("esri/t9n/common")],Z.prototype,"messagesCommon",void 0),s([c()],Z.prototype,"mode",void 0),s([c()],Z.prototype,"placement",void 0),s([c()],Z.prototype,"view",null),s([c({type:kr})],Z.prototype,"viewModel",void 0),Z=s([ie("esri.widgets.Expand")],Z);const il=Z;let Le=class extends fr(_r){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view?.ready&&(this.minFOV===0||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view?.ready&&(this.maxFOV===0||this.view.camera.fov<this.maxFOV)}};s([c({type:Boolean,readOnly:!0})],Le.prototype,"canZoomIn",null),s([c({type:Boolean,readOnly:!0})],Le.prototype,"canZoomOut",null),s([c({type:Number})],Le.prototype,"maxFOV",void 0),s([c({type:Number})],Le.prototype,"minFOV",void 0),s([c()],Le.prototype,"view",void 0),s([c({type:Number})],Le.prototype,"zoomFactor",void 0),Le=s([ie("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Le);const et=Le;async function al(t){return await(await A(()=>import("./PanoramicMeshManager-0tVIOV2Z.js"),__vite__mapDeps([4,0,1])).then(i=>i.default)).getInstance().load(t)}async function rl(){return xt(await A(()=>import("./Mesh-5O9j34eq.js").then(t=>t.M),__vite__mapDeps([5,0,1,6,7,8,9,10,11,12,13,14,15])))}async function ol(){return xt(await A(()=>import("./MeshComponent-sBtq0OIs.js").then(t=>t.b),__vite__mapDeps([6,0,1,7])))}async function nl(){return xt(await A(()=>import("./MeshComponent-sBtq0OIs.js").then(t=>t.a),__vite__mapDeps([6,0,1,7])))}async function sl(){return xt(await A(()=>import("./MeshComponent-sBtq0OIs.js").then(t=>t.M),__vite__mapDeps([6,0,1,7])))}async function ll(){return(await A(async()=>{const{MeshVertexAttributes:t}=await import("./MeshVertexAttributes-COLD4CmN.js");return{MeshVertexAttributes:t}},__vite__mapDeps([9,0,1,7]))).MeshVertexAttributes}function xt(t){return t.default??t}async function Th(){const[t,e,i,a,r,o]=await Promise.all([rl(),ol(),nl(),sl(),ll(),al()]);return{Mesh:t,MeshComponent:e,MeshMaterial:i,MeshTexture:a,MeshVertexAttributes:r,panoramicMeshManager:o}}async function cl(){return xt(await A(()=>import("./PanoramicTilePyramid-D2GjnlOM.js"),__vite__mapDeps([16,0,1,17,18,19,20,21,22,23,24,25,26,27,28,29,5,6,7,8,9,10,11,12,13,14,15,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])))}async function dl(){return xt(await A(()=>import("./ImageryTileLayer-DgPV_a3H.js").then(t=>t.R),__vite__mapDeps([158,0,1,159,160,18,17,19,20,21,22,23,24,25,26,27,28,29,161,162,163,164,165,43,42,166])))}function Kr(t,e=Ia,i=mt){const a=e.clone();a.z=-mt/2;const r=Ht.createSphere(a,{size:i,densificationFactor:2,vertexSpace:"georeferenced",material:new Zn({colorTexture:new Qn({data:t})})});if(r.components[0].trustSourceNormals=!0,r.vertexAttributes.uv){const o=r.vertexAttributes.uv.length??0;for(let n=0;n<o;n++)r.vertexAttributes.uv[2*n+0]=1-r.vertexAttributes.uv[2*n+0],r.vertexAttributes.uv[2*n+1]=r.vertexAttributes.uv[2*n+1]}return r.centerAt(a),r}function At(t){return new Q({geometry:t,symbol:new oa({symbolLayers:new D([new na])})})}function Je(t,e){return 2*me(Math.atan(Math.tan(X(t/2))*Math.sqrt((1/e)**2+1)))}async function hl(t,e){const i=await dl(),a=await i.open({url:t,ioConfig:{skipExtensions:["jgw","aux.xml"],skipMapInfo:!0},...e});return P(e),ul(a,{url:t})}const ul=(t,e)=>{if(!t)throw new N("panoramic-viewer:missing-raster","Raster data could not be loaded",e);return t};async function ml(t,e){const i=await cl();return P(e),new i({raster:t})}async function pl(t,e){return t?.length?await Promise.all(t.map(i=>i.loadMesh(e))):[]}let Vt=class extends bt{constructor(e){super(e),this._zoomTask=null,this.panoramicZoomViewModel=null,this._updateGraphicsFromTiles=async(i,a,r,o,n)=>{const l=await Promise.all(i.map(async h=>{const u=await h.loadMesh(n);return At(u)}));P(n);const d=o.removeAll();a.splice(0),l.forEach((h,u)=>{const m=i[u].key;h.attributes={key:m},a.push(m)}),o.addMany(l),this.viewModel?.set({imagePyramidLevel:r}),this.viewModel?.addManyGraphics(l),this.viewModel?.removeManyGraphics(d)},this._zoomIn=async i=>{if(P(i),!this.viewModel)return this.panoramicZoomViewModel.zoomInFOV();const{imagePyramid:a,yaw:r,hfov:o,vfov:n,pitch:l,tileCache:d,currentGraphics:h,imageRenderer:{size:u},imagePyramidLevel:m}=this.viewModel;if(!a)return this.panoramicZoomViewModel.zoomInFOV();const g=o/u[0],p=a.getLevelWithPixelAngle(g);if(m===0||m===p)return this.panoramicZoomViewModel.zoomInFOV();const y=a.getTiles(p,r,l,o,n);return y?(await this._updateGraphicsFromTiles(y,d,p,h,{signal:i}),this.panoramicZoomViewModel.zoomInFOV()):this.panoramicZoomViewModel.zoomInFOV()},this._zoomOut=async i=>{if(P(i),!this.viewModel)return this.panoramicZoomViewModel.zoomOutFOV();const{imagePyramid:a,yaw:r,hfov:o,vfov:n,pitch:l,tileCache:d,currentGraphics:h,imagePyramidLevel:u,imageRenderer:{size:m}}=this.viewModel;if(!a)return this.panoramicZoomViewModel.zoomOutFOV();const g=a.maximumPyramidLevel,p=o/m[0],y=a.getLevelWithPixelAngle(p);if(g===u||y===u)return this.panoramicZoomViewModel.zoomOutFOV();const f=a.getTiles(y,r,l,o,n);return f?(await this._updateGraphicsFromTiles(f,d,y,h,{signal:i}),this.panoramicZoomViewModel.zoomOutFOV()):this.panoramicZoomViewModel.zoomOutFOV()},this.zoomIn=i=>{(this._zoomTask==null||this._zoomTask.finished)&&(this._zoomTask=oe(this._zoomIn,i))},this.zoomOut=i=>{(this._zoomTask==null||this._zoomTask.finished)&&(this._zoomTask=oe(this._zoomOut,i))}}};s([c()],Vt.prototype,"viewModel",void 0),s([c()],Vt.prototype,"panoramicZoomViewModel",void 0),Vt=s([ie("esri.widgets.PanoramicViewer.PanoramicZoomManager")],Vt);let Ce=class extends an{constructor(e){super(e),this.panoramicZoomConditions=new et,this.zoomIn=()=>{this._zoomManager.zoomIn()},this.zoomInFOV=()=>{if(!this.canZoomIn)return;const i=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(i)},this.zoomOut=()=>{this._zoomManager.zoomOut()},this.zoomOutFOV=()=>{if(!this.canZoomOut)return;const i=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(i)},this.zoomTo=i=>{this.view.camera.fov=this.constrainFOV(i),this.view.camera=this.view.camera.clone()},this._zoomManager=new Vt({viewModel:e.panoramicViewerViewModel,panoramicZoomViewModel:this})}initialize(){this.addHandles([R(()=>[this.view?.ready,this.panoramicZoomConditions],()=>{this.view?.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))},E),R(()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV],([e,i])=>{e!=null&&i!=null&&this.zoomTo(this.view.camera.fov)},rn)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._set("view",e)}set panoramicViewerViewModel(e){this._zoomManager.viewModel=e}get panoramicViewerViewModel(){return this._zoomManager.viewModel}constrainFOV(e){const{maxFOV:i,minFOV:a}=this.panoramicZoomConditions;return Ye(e,a,i)}};s([c()],Ce.prototype,"_zoomManager",void 0),s([c()],Ce.prototype,"canZoomIn",null),s([c()],Ce.prototype,"canZoomOut",null),s([c({type:et})],Ce.prototype,"panoramicZoomConditions",void 0),s([c()],Ce.prototype,"state",null),s([c()],Ce.prototype,"view",null),s([c()],Ce.prototype,"panoramicViewerViewModel",null),Ce=s([ie("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ce);const Xi=Ce,at={default:"default",navigation:"navigation",fovConstraint:"fov-constraint",clickAction:"image-click-action"};let z=class extends la{constructor(e){super(e),this._startPosition=null,this._targetPosition=null,this._graphics=new qe({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new ca({ground:new br({opacity:0,navigationConstraint:null}),layers:new D([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.closestFeature=null,this.currentTime=0,this.imageSize=null,this.oiViewModel=null,this.videoSource=null,this.videoDuration=void 0,this.videoLoaded=!1,this.videoPaused=null,this.videoMuted=null,this.pitch=90,this.state="ready",this.updatingHandles=new wi,this.video=null,this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(at.navigation),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",i=>{const a=["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"],r=i.key;a.includes(r)&&i.stopPropagation()})],at.navigation)},this._addHFOVHandles=()=>{this.removeHandles(at.fovConstraint),this.addHandles(R(()=>[this.maxHFOV,this.minHFOV],()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new et({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))},E),at.fovConstraint)},this._addZoomHandles=()=>{this._zoomViewModel=new Xi({view:this.imageRenderer,panoramicZoomConditions:new et({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const i=this.imageRenderer.ui.find("zoom");i&&(i.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._handleDoubleClick=i=>{i.stopPropagation(),i.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=i=>{i.stopPropagation();const{action:a,x:r,y:o}=i;switch(a){case"start":this._startPosition=this._targetPosition={x:r,y:o};break;case"update":this._targetPosition={x:r,y:o},this._updateCameraHeadingAndTilt()}},this._handleImageClick=i=>{if(this.state==="image-loaded"&&this.imageRenderer.ready)switch(this.clickAction){case"emit":i.stopPropagation(),this.emit("click",i);break;case"hittest":i.stopPropagation(),i.defer(async()=>{const a=await this.imageRenderer.hitTest(i.screenPoint,{include:this._graphics});a.results=a.results.filter(r=>r.type==="graphic"&&r.graphic!==this._imageGraphic),this.emit("hittest-response",a)});break;case"pixel-location":{if(i.stopPropagation(),!this.imageSize||!i.mapPoint)return void this.emit("pixel-location",null);const a=_e(i.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...a,spatialReference:W.WebMercator});break}}},this._handleWheel=i=>{const a=i.deltaX??i.native.deltaX;i.stopPropagation(),a>0||i.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadVideo(this._loadController)},this._zoomIn=()=>this._zoomViewModel?.zoomIn(),this._zoomOut=()=>this._zoomViewModel?.zoomOut(),this.addGraphic=(i,a)=>this.state==="image-loaded"&&!this._graphics.graphics.includes(i)&&(this._graphics.graphics.add(i,a),!0),this.addManyGraphics=i=>{if(this.state!=="image-loaded")return!1;const a=i.filter(r=>!this._graphics.graphics.includes(r));return this._graphics.graphics.addMany(a),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.enableAudio=()=>{const{video:i}=this;i&&(i.muted=!1,this.videoMuted=!1)},this.removeGraphic=i=>!(this.state!=="image-loaded"||!this._graphics.graphics.includes(i))&&(this._graphics.remove(i),!0),this.removeManyGraphics=i=>{if(this.state!=="image-loaded")return!1;const a=i.filter(r=>this._graphics.graphics.includes(r));return this._graphics.removeMany(a),!0},this.togglePanoramicAudio=()=>{if(this.video){const i=this.video.muted;this.video.muted=!i,this.videoMuted=!i}},this._imageRenderer=new xr({map:this._map,viewingMode:"local",camera:{position:Ia},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:W.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([R(()=>this.videoSource,()=>{this.videoSource&&this.autoLoad&&this._loadWithController()},E),R(()=>this.fov,()=>{this._reloadCamera()},E),R(()=>this.yaw,e=>{this.camera&&(this.camera.heading=e,this._reloadCamera())},E),R(()=>this.pitch,e=>{this.camera&&(this.camera.tilt=e,this._reloadCamera())},E),Ir(()=>this.imageRenderer.ready,()=>{this._addNavigationHandles(),this._addZoomHandles()},E),R(()=>this.clickAction,e=>{this.removeHandles(at.clickAction),e!=="none"&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))},E),R(()=>this.video,e=>{if(e instanceof HTMLVideoElement){this._startVideo();const i=async()=>{this.currentTime=Number(e.currentTime.toFixed(2)),e.currentTime&&await this._updateVidFootprint(e.currentTime)};e.addEventListener("timeupdate",i),e.addEventListener("play",()=>this._updateVideoIcon(e.paused)),e.addEventListener("pause",()=>this._pauseVideoHandler(e))}},E)],at.default)}get camera(){return this.imageRenderer.destroying||this.imageRenderer.destroyed?null:this.imageRenderer.camera}set camera(e){!e||this.imageRenderer.destroying||this.imageRenderer.destroyed||(this.imageRenderer.camera=e.clone())}get fov(){return this.camera?.fov}set fov(e){Number.isFinite(e)&&this._zoomViewModel?.zoomTo(e)}get hfov(){if(!this.camera||!this.imageRenderer?.ready)return null;const{fov:e}=this.camera,{size:[i,a]}=this.imageRenderer,r=i/a,o=Math.atan(r);return 2*me(Math.atan(Math.tan(X(e/2))*Math.sin(o)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,i]}=this.imageRenderer;return this.imageRenderer.ready?Je(ni,e/i):ni}get minHFOV(){const{size:[e,i]}=this.imageRenderer;return this.imageRenderer.ready?Je(si,e/i):si}get updating(){return this.updatingHandles.updating}get vfov(){if(!this.camera||!this.imageRenderer?.ready)return null;const{fov:e}=this.camera,{size:[i,a]}=this.imageRenderer,r=i/a,o=Math.atan(r);return 2*me(Math.atan(Math.tan(X(e/2))*Math.cos(o)))}async _loadVideoInternal(e,i){return this.state="image-loading",this.video=document.createElement("video"),this.video.src=e,this.video.addEventListener("loadedmetadata",()=>{this._setVideoDuration(),this.videoLoaded=!0}),this._updateImageSphere(this.video,i)}_pauseVideoHandler(e){this._updateVideoIcon(e.paused)}_setVideoDuration(){const{video:e}=this;e?.duration&&(this.videoDuration=e.duration)}_startVideo(){try{this.enableAudio();const e=this.oiViewModel.currentBestFeature;e&&this.playPanoramicVideoFromSelectedLocation(e)}catch(e){O.getLogger(this).error("oriented-imagery-viewer:video-load",e)}}_reloadCamera(){this.camera=this.camera?.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=ce(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition||!this.camera)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const i=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,i)),this._startPosition=this._targetPosition}async _updateImageSphere(e,i){return await Mt(i),this._imageGraphic=At(Kr(e)),this._graphics.add(this._imageGraphic),this.state="image-loaded",ut(()=>this.imageRenderer.ready,i).then(()=>{const{size:[a,r]}=this.imageRenderer;this.fov=Je(Zi,a/r)}),this.imageSize=Gr,this._imageGraphic.geometry}async _updateVidFootprint(e){const i=this.oiViewModel?.featureCache.find(h=>h.attributes.offsetFromStart===Math.floor(e)),{yaw:a,pitch:r,vfov:o,hfov:n}=this,l=!(i?.attributes.offsetFromStart&&o&&n&&a&&r),d=i?.attributes.objectId===this.closestFeature?.attributes.objectId;l||d||(this.closestFeature=i,await this.oiViewModel.updateFootprintPanorama({yaw:a,pitch:r,verticalFieldOfView:o,horizontalFieldOfView:n,feature:i}))}_updateVideoIcon(e){this.videoPaused=!!e}async loadVideo(e){return this._removeImageSphere(),this.videoSource?this._loadVideoInternal(this.videoSource,e):Rt(this.declaredClass,new N(Ma("panoramic-viewer"),ba("PanoramicViewerViewModel","videoSource")))}playPanoramicVideoHandler(){const{video:e}=this;e&&(e.paused?e.play().catch(i=>{O.getLogger(this).error("error playing video",i)}):e.pause())}playPanoramicVideoFromSelectedLocation(e){const i=e.attributes.offsetFromStart;if(i){const a=this.video;a&&(a.currentTime=i,a.play().catch(r=>{O.getLogger(this).error("error playing video",r)}))}}rewindPanoramicVideoHandler(){const{video:e}=this;e&&(e.currentTime=0,e.play().catch(i=>{O.getLogger(this).error("error playing video",i)}))}};s([c()],z.prototype,"_graphics",void 0),s([c()],z.prototype,"_imageGraphic",void 0),s([c()],z.prototype,"_imageRenderer",void 0),s([c()],z.prototype,"_loadController",void 0),s([c()],z.prototype,"_map",void 0),s([c()],z.prototype,"_zoomViewModel",void 0),s([c({type:Boolean})],z.prototype,"autoLoad",void 0),s([c({type:yi})],z.prototype,"camera",null),s([sa(new Mr({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],z.prototype,"clickAction",void 0),s([c()],z.prototype,"closestFeature",void 0),s([c()],z.prototype,"currentTime",void 0),s([c({type:Number})],z.prototype,"fov",null),s([c({readOnly:!0})],z.prototype,"hfov",null),s([c({readOnly:!0})],z.prototype,"imageRenderer",null),s([c()],z.prototype,"imageSize",void 0),s([c()],z.prototype,"oiViewModel",void 0),s([c()],z.prototype,"videoSource",void 0),s([c()],z.prototype,"videoDuration",void 0),s([c()],z.prototype,"videoLoaded",void 0),s([c()],z.prototype,"videoPaused",void 0),s([c()],z.prototype,"videoMuted",void 0),s([c({readOnly:!0})],z.prototype,"maxHFOV",null),s([c({readOnly:!0})],z.prototype,"minHFOV",null),s([c({type:Number})],z.prototype,"pitch",void 0),s([c()],z.prototype,"state",void 0),s([c()],z.prototype,"updatingHandles",void 0),s([c()],z.prototype,"updating",null),s([c({readOnly:!0})],z.prototype,"vfov",null),s([c()],z.prototype,"video",void 0),s([c({type:Number})],z.prototype,"yaw",void 0),z=s([ie("esri.widgets.PanoramicViewer.PanoramicVideoViewerViewModel")],z);const eo=z,gl="esri-panoramic-viewer";var lt;let Y=(lt=class extends tt{constructor(e){super(e),this.messagesCommon=null,this.viewModel=new eo,this._afterContainerCreate=i=>{this.imageRenderer.container=i},this.addGraphic=(i,a)=>{this.viewModel.addGraphic(i,a)},this.addManyGraphics=i=>{this.viewModel.addManyGraphics(i)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadVideo=i=>this.viewModel.loadVideo(i),this.removeGraphic=i=>{this.viewModel.removeGraphic(i)},this.removeManyGraphics=i=>{this.viewModel.removeManyGraphics(i)}}loadDependencies(){return Te({panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MZ),__vite__mapDeps([0,1])),"action-bar":()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.Ng),__vite__mapDeps([0,1])),"action-group":()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.Nf),__vite__mapDeps([0,1])),action:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MV),__vite__mapDeps([0,1])),slider:()=>A(()=>import("./index-B4P055yQ.js"),__vite__mapDeps([177,0,1]))})}get activeAudioIcon(){const{videoMuted:e}=this.viewModel;return e?"sound-off":"sound"}get activeVideoIcon(){const{videoPaused:e,videoLoaded:i}=this.viewModel;return i&&e===!1?"pause":"play"}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera?.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get oiViewModel(){return this.viewModel.oiViewModel}set oiViewModel(e){this.viewModel.oiViewModel=e}get video(){return this.viewModel.video}get videoSource(){return this.viewModel.videoSource}set videoSource(e){this.viewModel.videoSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get ui(){return this.imageRenderer.ui}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}_handleVideoSeek(e){const i=this.viewModel?.video;i&&(i.currentTime=e.target.value,i.play())}render(){const{control:e,reset:i}=this.messagesCommon,{mute:a,unmute:r}=this.messages;return v("calcite-panel",null,v("calcite-panel",{loading:this.viewModel.updating},v("calcite-panel",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(We.widget,gl)}),v("calcite-slider",{bind:this,labelHandles:!0,labelTicks:!0,max:this.viewModel?.videoDuration,minLabel:"0",value:this.viewModel.currentTime??0,onCalciteSliderChange:this._handleVideoSeek}),v("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},v("calcite-action-group",null,v("calcite-action",{bind:this,icon:this.activeVideoIcon,onclick:()=>this.viewModel.playPanoramicVideoHandler(),text:"Play",title:this.viewModel.videoPaused?e.play:e.pause})),v("calcite-action-group",null,v("calcite-action",{bind:this,icon:"refresh",onclick:()=>this.viewModel.rewindPanoramicVideoHandler(),text:"Rewind",title:i})),v("calcite-action-group",null,v("calcite-action",{bind:this,icon:this.activeAudioIcon,onclick:()=>this.viewModel.togglePanoramicAudio(),text:"Audio",title:this.viewModel.videoMuted?a:r})))))}},lt.vnodeSelector="calcite-panel",lt);s([c()],Y.prototype,"activeAudioIcon",null),s([c()],Y.prototype,"activeVideoIcon",null),s([c({type:Boolean})],Y.prototype,"autoLoad",null),s([c({type:yi})],Y.prototype,"camera",null),s([c()],Y.prototype,"clickAction",null),s([c({type:Number})],Y.prototype,"fov",null),s([c({readOnly:!0,type:Number})],Y.prototype,"hfov",null),s([c()],Y.prototype,"icon",null),s([c({readOnly:!0})],Y.prototype,"imageRenderer",null),s([c({readOnly:!0})],Y.prototype,"imageSize",null),s([c()],Y.prototype,"oiViewModel",null),s([c(),ze("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],Y.prototype,"messages",void 0),s([c(),ze("esri/t9n/common")],Y.prototype,"messagesCommon",void 0),s([c()],Y.prototype,"video",null),s([c()],Y.prototype,"videoSource",null),s([c({type:Number})],Y.prototype,"pitch",null),s([c({readOnly:!0})],Y.prototype,"state",null),s([c()],Y.prototype,"ui",null),s([c({readOnly:!0,type:Number})],Y.prototype,"vfov",null),s([St(["click","hittest-response","pixel-location"]),c({type:eo})],Y.prototype,"viewModel",void 0),s([c({type:Number})],Y.prototype,"yaw",null),Y=s([ie("esri.widgets.PanoramicVideoViewer")],Y);const to=Y,ne="esri-oriented-imagery-viewer",Yt=`${ne}__carousel`,Ci=`${ne}__image-enhancement`,de=`${ne}__navigation`,vl="--oi-navigation-tool-rotation-from",yl="--oi-navigation-tool-rotation-to",io=`${de}-ui`,rt=`${io}__direction`,ot=`${ne}__image-overlays`,C={addCoverage:`${ne}__body-additional-coverage`,addExpPoints:`${ne}__body-additional-camera-locations`,carousel:`${ne}__carousel`,carouselContainer:`${Yt}-container`,carouselContent:`${Yt}-content`,carouselItem:`${Yt}-item`,carouselItemWrapper:`${Yt}-item-wrapper`,currentCoverage:`${ne}__body-current-coverage`,feature:`${de}-feature`,imageEnhancementToolContainer:`${Ci}-tool-container`,imageEnhancementTools:`${Ci}-tools`,imageEnhancementWrapper:`${Ci}-wrapper`,imageOverlays:ot,imageOverlaysContainer:`${ot}-container`,imageOverlaysNoResult:`${ot}-no-result`,imageOverlaysIncreasedHeight:`${ot}-increased-height`,imageOverlaysLayerList:`${ot}-layer-list`,measurementResults:`${ne}__measurement-results`,measurementsBar:`${ne}__measurements-bar`,measurementsButton:`${ne}__measurements-button`,measurementsTable:`${ne}__measurements-table`,measurementDisplay:`${ne}__measurement-display`,messageBox:`${ne}__message-box`,navigationPathOffset0:`${de}-feature-path-stop-offset-0`,navigationPathOffset1:`${de}-feature-path-stop-offset-1`,navigationWrapper:`${de}-wrapper`,navigationZoomed:`${de}-wrapper--zoomed`,north:`${de}-pointer-north`,outerSector:`${de}-sector-outer`,overlaysSwitch:`${ot}-switch`,pointer:`${de}-pointer`,rotateWithAnimation:`${de}-animate`,sector:`${de}-sector`,sectorCross:`${de}-sector-cross`,sectorDisabled:`${de}-sector-disabled`,sectorEnabled:`${de}-sector-enabled`,sectorSeparator:`${de}-sector-separator`,selectedFeaturePath:`${de}-feature-path`,sketchTools:`${ne}__sketch-tools`,viewer:`${ne}__viewer`,viewerHidden:`${ne}__viewer--hidden`,viewerContainer:`${ne}__viewer-container`,viewerContainerMeasurement:`${ne}__viewer-container-measurement`,navigationUI:io,navigationDirection:rt,navigationDirectionPad:`${rt}-pad`,navigationTop:`${rt}--top`,navigationBottom:`${rt}--bottom`,navigationLeft:`${rt}--left`,navigationRight:`${rt}--right`,navigationSettingsUI:`${de}-settings-ui`};function wl(t,e,i,a){const r=i-t,o=a-e;return me(Math.atan2(o,r))}function ye(t){let e=t%360;return e<0&&(e+=360),e}function ao(t,e){const i={towards:{distance:1/0,node:null},backwards:{distance:1/0,node:null},left:{distance:1/0,node:null},right:{distance:1/0,node:null}};e.forEach(a=>{if(t===a)return;const r=t.getDistanceTo(a),o=t.getDirectionTo(a);r>=i[o].distance||(i[o].node=a,i[o].distance=r,i[o].heading=ye(a.heading),i[o].pitch=ye(a.pitch))}),t.reset(),t.towards=i.towards.node,t.backwards=i.backwards.node,t.left=i.left.node,t.right=i.right.node}function Ai(t,e,i,a){const r={towards:{distance:1/0,node:null},backwards:{distance:1/0,node:null},left:{distance:1/0,node:null},right:{distance:1/0,node:null}};e.forEach(o=>{if(t===o)return;const n=t.getDistanceTo(o),l=t.getDirectionTo(o),d=ye(t.heading)-ye(ye(o.heading)),h=ye(t.pitch)-ye(o.pitch);n>=r[l].distance||i!=null&&!tr(d,i)||a!=null&&!tr(h,a)||(r[l].node=o,r[l].distance=n,r[l].heading=ye(o.heading),r[l].pitch=ye(o.pitch))}),t.reset(),t.towards=r.towards.node,t.backwards=r.backwards.node,t.left=r.left.node,t.right=r.right.node}function tr(t,e){return Math.abs(t)<=e}let Be=class extends bt{constructor(e){super(e),this._compileTask=null,this.currentNode=null,this.currentBestFeature=null,this.nodes=new D}initialize(){this.addHandles(R(()=>({nodes:this.nodes,currenNode:this.currentNode,length:this.nodes.length,currentHeading:this.currentNode?.currentHeading,currentPitch:this.currentNode?.currentPitch}),()=>{this._compileTask?.abort(),this._compileTask=oe(async e=>{P(e),this.compile()})},E))}get state(){const e=this._compileTask;return e?e.finished?e.error?"error":"compiled":"compiling":"ready"}compile(){const{currentNode:e,nodes:i}=this;e&&i.length&&(e.reset(),ao(e,i))}};s([c()],Be.prototype,"_compileTask",void 0),s([c()],Be.prototype,"currentNode",void 0),s([c()],Be.prototype,"currentBestFeature",void 0),s([c()],Be.prototype,"nodes",void 0),s([c()],Be.prototype,"state",null),Be=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationUIPanoramicViewModel")],Be);const ro=Be;let Ae=class extends tt{constructor(e){super(e),this.directionMode="Relative",this.navigate=null,this.viewModel=new ro,this._clickTask=null,this._handleClick=i=>{this._clickTask?.abort(),this._clickTask=oe(async a=>{const r=i.target;if(!this.navigate||!this.currentNode)return;await ut(()=>this.viewModel.state==="compiled",{signal:a});const o=r.getAttribute("data-direction");P(a),await this.navigate(this.currentNode,{direction:o,signal:a})})},this.wrapTo90=i=>{const a=90*Math.round(i/90);return new on(-90,90).normalize(i-a)}}loadDependencies(){return Te({icon:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MT),__vite__mapDeps([0,1]))})}set currentNode(e){this.viewModel.currentNode=e}get currentNode(){return this.viewModel.currentNode}set currentBestFeature(e){this.viewModel.currentBestFeature=e}get currentBestFeature(){return this.viewModel.currentBestFeature}get nodes(){return this.viewModel.nodes}set nodes(e){this.viewModel.nodes=e}render(){const{currentNode:e,currentBestFeature:i,directionMode:a}=this;if(!e||!i)return null;const r=this.wrapTo90(i.attributes.cameraHeading),{currentHeading:o}=e,n={"--rotate-transform":` rotate(${a==="Relative"?-o+r:-o}deg)`},l=g=>{const p=(g-(o??0)+360)%360;return p<45||p>=315?"towards":p>=135&&p<225?"backwards":p>=45&&p<135?"right":"left"},d=l(0),h=l(90),u=l(180),m=l(270);return v("div",{class:C.navigationUI},v("div",{class:C.navigationDirectionPad,styles:n},e[d]?v("calcite-icon",{class:this.classes(C.navigationDirection,C.navigationTop),"data-direction":d,icon:"chevron-up",key:"chevron-up",onclick:this._handleClick}):null,e[h]?v("calcite-icon",{class:this.classes(C.navigationDirection,C.navigationRight),"data-direction":h,icon:"chevron-right",key:"chevron-right",onclick:this._handleClick}):null,e[u]?v("calcite-icon",{class:this.classes(C.navigationDirection,C.navigationBottom),"data-direction":u,icon:"chevron-down",key:"chevron-down",onclick:this._handleClick}):null,e[m]?v("calcite-icon",{class:this.classes(C.navigationDirection,C.navigationLeft),"data-direction":m,icon:"chevron-left",key:"chevron-left",onclick:this._handleClick}):null))}};s([c()],Ae.prototype,"currentNode",null),s([c()],Ae.prototype,"directionMode",void 0),s([c()],Ae.prototype,"currentBestFeature",null),s([c()],Ae.prototype,"navigate",void 0),s([c({nonNullable:!0})],Ae.prototype,"nodes",null),s([c()],Ae.prototype,"viewModel",void 0),s([c()],Ae.prototype,"_clickTask",void 0),Ae=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationUI360")],Ae);const oo=Ae;function no(){return Te({action:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MV),__vite__mapDeps([0,1])),"action-bar":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Ng),__vite__mapDeps([0,1]))})}function fl(t){const{expandDisabled:e,layout:i,overlayPositioning:a,actions:r}=t;return v("calcite-action-bar",{expandDisabled:e,floating:!0,layout:i,overlayPositioning:a,slot:"fab"},r.map(o=>v("calcite-action",{icon:o.icon,key:o.title,onclick:o.onclick,scale:o.scale,text:o.text,title:o.title})))}function so(t){const{uiStrings:e,layout:i,onAction:a}=t;return v(fl,{actions:[{icon:"chevron-left",scale:"s",text:e.previous,title:e.previous,onclick:()=>{a({step:-1})}},{icon:"chevron-right",scale:"s",text:e.next,title:e.next,onclick:()=>{a({step:1})}}],expandDisabled:!0,layout:i,overlayPositioning:"fixed"})}const nt={default:"default",navigation:"navigation",fovConstraint:"fov-constraint",clickAction:"image-click-action"};let H=class extends la{constructor(e){super(e),this._panTask=null,this._startPosition=null,this._targetPosition=null,this.tileCache=[],this._graphics=new qe({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this.currentGraphics=new D,this.imagePyramid=null,this.imagePyramidLevel=-1,this._map=new ca({ground:new br({opacity:0,navigationConstraint:null}),layers:new D([this._graphics])}),this._imageRenderer=new xr({map:this._map,viewingMode:"local",camera:{position:Ia},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:W.WebMercator,ui:{components:["zoom"]}}),this._loadController=null,this.zoomViewModel=new Xi({panoramicViewerViewModel:this,view:this._imageRenderer,panoramicZoomConditions:new et({})}),this.autoLoad=!1,this.clickAction="none",this.imageMeshDistance=mt/2,this.imageSize=null,this.imageSource=null,this.navigationManager=null,this.navigationViewModel=null,this.pitch=90,this.state="ready",this.updatingHandles=new wi,this.yaw=0,this._addNavigationHandles=(i=!0)=>{this.imageRenderer.basemapTerrain.suspended=!0,this.removeHandles(nt.navigation);const a=[this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",r=>{const o=["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"],n=r.key;o.includes(n)&&r.stopPropagation()})];i&&a.push(this.imageRenderer.on("double-click",this._handleDoubleClick)),this.addHandles(a,nt.navigation)},this._addHFOVHandles=()=>{this.removeHandles(nt.fovConstraint),this.addHandles(R(()=>[this.maxHFOV,this.minHFOV],()=>{this.zoomViewModel&&(this.zoomViewModel.panoramicZoomConditions=new et({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))},E),nt.fovConstraint)},this._addZoomHandles=()=>{this.zoomViewModel=new Xi({view:this.imageRenderer,panoramicZoomConditions:new et({maxFOV:this.maxHFOV,minFOV:this.minHFOV}),panoramicViewerViewModel:this});const i=this.imageRenderer.ui.find("zoom");i&&(i.viewModel=this.zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._createPanTask=()=>{this._panTask?.abort(),this._panTask=oe(async i=>{if(!this.imagePyramid)return;const{hfov:a,vfov:r,yaw:o,pitch:n}=this,l=this.imagePyramid.getTiles(this.imagePyramidLevel,o,n,a,r).filter(u=>!this.tileCache.includes(`${u.level}/${u.row}/${u.column}`));if(!l?.length)return;const d=await Promise.all(l.map(async u=>await u.loadMesh({signal:i})));P(i);const h=d.map(At);h.forEach((u,m)=>{const g=l[m].key;u.attributes={key:g},this.tileCache.push(g)}),this.addManyGraphics(h),this.currentGraphics.addMany(h),this._panTask=null})},this._handleDoubleClick=i=>{i.stopPropagation(),i.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=i=>{i.stopPropagation();const{action:a,x:r,y:o}=i;switch(a){case"start":this._startPosition=this._targetPosition={x:r,y:o};break;case"update":this._targetPosition={x:r,y:o},this._updateCameraHeadingAndTilt()}},this._handleImageClick=i=>{if(this.state==="image-loaded"&&this.imageRenderer.ready)switch(this.clickAction){case"emit":i.stopPropagation(),this.emit("click",i);break;case"hittest":i.stopPropagation(),i.defer(async()=>{const a=await this.imageRenderer.hitTest(i.screenPoint,{include:this._graphics}),r=Array.isArray(this._imageGraphic)?this._imageGraphic:[this._imageGraphic].filter(Ea);a.results=a.results.filter(o=>o.type==="graphic"&&!r.includes(o.graphic)),this.emit("hittest-response",a)});break;case"pixel-location":{if(i.stopPropagation(),!this.imageSize||!i.mapPoint)return void this.emit("pixel-location",null);const a=_e(i.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...a,spatialReference:W.WebMercator});break}}},this._handleWheel=i=>{const a=i.deltaX??i.native.deltaX;i.stopPropagation(),a>0||i.deltaY>0?this._zoomOut():this._zoomIn()},this._loadNavigationManager=async()=>{if(!this.navigationManager||this.navigationManager?.destroyed){const i=await A(()=>import("./NavigationManagerPanoramic-BLX9o_Ty.js"),__vite__mapDeps([178,0,1,179,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])).then(a=>a.default);this.navigationManager=new i({viewModel:this.navigationViewModel})}return this.navigationManager},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>{this.zoomViewModel?.zoomIn()},this._zoomOut=()=>{this.zoomViewModel?.zoomOut()},this.addGraphic=(i,a)=>this.state==="image-loaded"&&!this._graphics.graphics.includes(i)&&(this._graphics.graphics.add(i,a),!0),this.addManyGraphics=i=>{if(this.state!=="image-loaded")return!1;const a=i.filter(r=>!this._graphics.graphics.includes(r));return this._graphics.graphics.addMany(a),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.navigate=async(i,a)=>this.updatingHandles.addPromise(this.navigateInternal(i,a)),this.navigateInternal=async(i,a)=>await(await this._loadNavigationManager()).navigate(i,a),this.removeGraphic=i=>!(this.state!=="image-loaded"||!this._graphics.graphics.includes(i))&&(this._graphics.remove(i),!0),this.removeManyGraphics=i=>{if(this.state!=="image-loaded")return!1;const a=i.filter(r=>this._graphics.graphics.includes(r));return this._graphics.removeMany(a),!0},this.restoreNavigationHandles=()=>{this._addNavigationHandles(!1)}}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([R(()=>this.imageSource,()=>{this.imageSource&&this.autoLoad&&this._loadWithController()},E),R(()=>this.fov,()=>{this._reloadCamera()},E),R(()=>this.yaw,e=>{this.camera&&(this.camera.heading=e,this._reloadCamera())},E),R(()=>this.pitch,e=>{this.camera&&(this.camera.tilt=e,this._reloadCamera())},E),Ir(()=>this.imageRenderer.ready,()=>{this._addNavigationHandles(),this._addZoomHandles()},E),R(()=>this.clickAction,e=>{this.removeHandles(nt.clickAction),e!=="none"&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))},E),R(()=>this.camera,(e,i)=>{this._panTask?.abort(),e?i?.tilt===e.tilt&&i.heading===e.heading||this._createPanTask():this._panTask=null}),this.currentGraphics.on("change",()=>{const e=Array.isArray(this._imageGraphic)?this._imageGraphic:[this._imageGraphic].filter(Ea),i=this.currentGraphics.map(a=>a.geometry.extent);e.forEach(a=>{a.visible=i.some(r=>r.intersects(a.geometry.extent))!==!0})})],nt.default)}get camera(){return this.imageRenderer.destroying||this.imageRenderer.destroyed?null:this.imageRenderer.camera}set camera(e){!e||this.imageRenderer.destroying||this.imageRenderer.destroyed||(this.imageRenderer.camera=e.clone())}get distanceFactor(){return this.fov?1-5/this.fov:null}get fov(){return this.camera?.fov}set fov(e){Number.isFinite(e)&&this.zoomViewModel?.zoomTo(e)}get hfov(){if(!this.camera||!this.imageRenderer?.ready)return 0;const{fov:e}=this.camera,{size:[i,a]}=this.imageRenderer,r=i/a;return 2*me(Math.atan(Math.tan(X(e/2))*r/Math.sqrt(1+r**2)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,i]}=this.imageRenderer;return this.imageRenderer.ready?Je(ni,e/i):ni}get minHFOV(){const{size:[e,i]}=this.imageRenderer;return this.imageRenderer.ready?Je(si,e/i):si}get updating(){return this.updatingHandles.updating}get vfov(){if(!this.camera||!this.imageRenderer?.ready)return 0;const{fov:e}=this.camera,{size:[i,a]}=this.imageRenderer,r=i/a;return 2*me(Math.atan(Math.tan(X(e/2))*(1/Math.sqrt(1+r**2))))}_clearImageSphere(){if(!this._imageGraphic)return;const e=Array.isArray(this._imageGraphic)?this._imageGraphic:[this._imageGraphic];this._graphics.removeMany(e),this._imageGraphic=null,e.forEach(i=>i.destroy()),this._graphics.removeMany(this.currentGraphics.toArray()),this.imagePyramid=null,this.imagePyramidLevel=-1,this.tileCache=[]}async _loadImageInternal(e,i){let a;this.state="image-loading";try{a=(await ia(e,{responseType:"image",...i})).data}catch(r){throw te(r)?this.state="image-load-aborted":this.state="image-load-error",r}return this._updateImageSphere(a,i)}async loadImageTiled(e,i){this._removeImageSphere(),this.state="image-loading";try{const a=await hl(e,i),r=await ml(a,i),o=r.getLowResolutionTiles(),n=await pl(o,i),{imageSize:l}=r;if(P(i),!o?.length)throw new N("panoramic-viewer:missing-tiles","No tiles were found in the pyramid",{imageSource:e});this.imagePyramid=r,this.imagePyramidLevel=r.maximumPyramidLevel;const d=n.map(At);d.forEach((h,u)=>{const m=o[u].key;h.attributes={key:m},this.tileCache.push(m)}),this._imageGraphic=d,this._graphics.addMany(this._imageGraphic),this.state="image-loaded",ut(()=>this.imageRenderer.ready,i).then(()=>{const{size:[h,u]}=this.imageRenderer;this.fov=Je(Zi,h/u)}),this.imageSize=l}catch(a){throw this.state=te(a)?"image-load-aborted":"image-load-error",a}}_reloadCamera(){this.camera=this.camera?.clone()}_removeImageSphere(){this._clearImageSphere(),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition||!this.camera)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const i=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,i)),this._startPosition=this._targetPosition}async _updateImageSphere(e,i){return await Mt(i),this._imageGraphic=At(Kr(e)),this._graphics.add(this._imageGraphic),this.state="image-loaded",ut(()=>this.imageRenderer.ready,i).then(()=>{const{size:[a,r]}=this.imageRenderer;this.fov=Je(Zi,a/r)}),this.imageSize=[e.width,e.height],this._imageGraphic.geometry}async loadImage(e){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,e):Rt(this.declaredClass,new N(Ma("panoramic-viewer"),ba("PanoramicViewerViewModel","imageSource")))}};s([c()],H.prototype,"_graphics",void 0),s([c()],H.prototype,"_imageGraphic",void 0),s([c({constructOnly:!0})],H.prototype,"currentGraphics",void 0),s([c()],H.prototype,"imagePyramid",void 0),s([c()],H.prototype,"imagePyramidLevel",void 0),s([c()],H.prototype,"_map",void 0),s([c()],H.prototype,"_imageRenderer",void 0),s([c()],H.prototype,"_loadController",void 0),s([c()],H.prototype,"zoomViewModel",void 0),s([c({type:Boolean})],H.prototype,"autoLoad",void 0),s([c({type:yi})],H.prototype,"camera",null),s([sa(new Mr({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],H.prototype,"clickAction",void 0),s([c()],H.prototype,"distanceFactor",null),s([c({type:Number})],H.prototype,"fov",null),s([c({readOnly:!0})],H.prototype,"hfov",null),s([c()],H.prototype,"imageMeshDistance",void 0),s([c({readOnly:!0})],H.prototype,"imageRenderer",null),s([c()],H.prototype,"imageSize",void 0),s([c()],H.prototype,"imageSource",void 0),s([c({readOnly:!0})],H.prototype,"maxHFOV",null),s([c({readOnly:!0})],H.prototype,"minHFOV",null),s([c()],H.prototype,"navigationViewModel",void 0),s([c({type:Number})],H.prototype,"pitch",void 0),s([c()],H.prototype,"state",void 0),s([c()],H.prototype,"updatingHandles",void 0),s([c()],H.prototype,"updating",null),s([c({readOnly:!0})],H.prototype,"vfov",null),s([c({type:Number})],H.prototype,"yaw",void 0),H=s([ie("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],H);const lo=H,_l="esri-panoramic-viewer";var ct;let B=(ct=class extends tt{constructor(e){super(e),this.directionMode="Relative",this.navigationEnabled=!1,this.uiStrings=null,this.viewModel=new lo,this._afterContainerCreate=i=>{this.imageRenderer.container=i},this.addGraphic=(i,a)=>{this.viewModel.addGraphic(i,a)},this.addManyGraphics=i=>{this.viewModel.addManyGraphics(i)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=i=>this.viewModel.loadImage(i),this.loadImageTiled=(i,a)=>this.viewModel.loadImageTiled(i,a),this.navigate=async(i,a)=>await this.viewModel.navigate(i,a),this.removeGraphic=i=>{this.viewModel.removeGraphic(i)},this.removeManyGraphics=i=>{this.viewModel.removeManyGraphics(i)}}loadDependencies(){return Promise.all([Te({panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MZ),__vite__mapDeps([0,1]))}),no()])}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get currentNode(){return this.navigationViewModel?.currentNode}get currentBestFeature(){return this.navigationViewModel?.currentBestFeature}get fov(){return this.camera?.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get navigationMode(){return this.navigationViewModel?.navigationMode}get navigationNodes(){return this.navigationViewModel?.navigationNodes}get navigationViewModel(){return this.viewModel.navigationViewModel}set navigationViewModel(e){this.viewModel.navigationViewModel=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get ui(){return this.imageRenderer.ui}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}get _navigationUI(){return v(oo,{currentBestFeature:this.currentBestFeature,currentNode:this.currentNode,directionMode:this.directionMode,navigate:this.navigate,nodes:this.navigationNodes})}get _sequentialNavigationUI(){return v(so,{layout:"horizontal",uiStrings:this.uiStrings,onAction:e=>{this.navigate(this.currentNode,e)}})}_renderNavigationUI(){switch(this.navigationMode){case"directional":return this._navigationUI;case"sequential":return this._sequentialNavigationUI;default:return null}}render(){return v("calcite-panel",{loading:this.viewModel.updating},v("calcite-panel",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(We.widget,_l)}),this.navigationEnabled?this._renderNavigationUI():null)}},ct.vnodeSelector="calcite-panel",ct);s([c({type:Boolean})],B.prototype,"autoLoad",null),s([c({type:yi})],B.prototype,"camera",null),s([c()],B.prototype,"clickAction",null),s([c()],B.prototype,"currentNode",null),s([c()],B.prototype,"currentBestFeature",null),s([c()],B.prototype,"directionMode",void 0),s([c({type:Number})],B.prototype,"fov",null),s([c({readOnly:!0,type:Number})],B.prototype,"hfov",null),s([c()],B.prototype,"icon",null),s([c({readOnly:!0})],B.prototype,"imageRenderer",null),s([c({readOnly:!0})],B.prototype,"imageSize",null),s([c()],B.prototype,"imageSource",null),s([c({type:Boolean})],B.prototype,"navigationEnabled",void 0),s([c()],B.prototype,"navigationMode",null),s([c()],B.prototype,"navigationNodes",null),s([c()],B.prototype,"navigationViewModel",null),s([c({type:Number})],B.prototype,"pitch",null),s([c({readOnly:!0})],B.prototype,"state",null),s([c()],B.prototype,"ui",null),s([c()],B.prototype,"uiStrings",void 0),s([c({readOnly:!0,type:Number})],B.prototype,"vfov",null),s([St(["click","hittest-response","pixel-location"]),c({type:lo})],B.prototype,"viewModel",void 0),s([c({type:Number})],B.prototype,"yaw",null),s([c()],B.prototype,"_navigationUI",null),s([c()],B.prototype,"_sequentialNavigationUI",null),B=s([ie("esri.widgets.PanoramicViewer")],B);const ci=B;function $i(t,e,i,a){return[[[i-t/Math.SQRT2,a-t/Math.SQRT2],[i+t/Math.SQRT2,a-t/Math.SQRT2],[i+e/Math.SQRT2,a-e/Math.SQRT2],[i-e/Math.SQRT2,a-e/Math.SQRT2]],[[i+t/Math.SQRT2,a-t/Math.SQRT2],[i+t/Math.SQRT2,a+t/Math.SQRT2],[i+e/Math.SQRT2,a+e/Math.SQRT2],[i+e/Math.SQRT2,a-e/Math.SQRT2]],[[i+t/Math.SQRT2,a+t/Math.SQRT2],[i-t/Math.SQRT2,a+t/Math.SQRT2],[i-e/Math.SQRT2,a+e/Math.SQRT2],[i+e/Math.SQRT2,a+e/Math.SQRT2]],[[i-t/Math.SQRT2,a+t/Math.SQRT2],[i-t/Math.SQRT2,a-t/Math.SQRT2],[i-e/Math.SQRT2,a-e/Math.SQRT2],[i-e/Math.SQRT2,a+e/Math.SQRT2]]]}function Si(t,e,i){const[a,r,o,n]=t;return`M ${a.join(" ")} A ${e} ${e} 0 0 1 ${r.join(" ")} L ${o.join(" ")} A ${i} ${i} 0 0 0 ${n.join(" ")} Z`}function Ml(t,e,i){const[a,r,o,n]=[...t,0];return[...$i(a,r,e,i).map(l=>Si(l,a,r)),...$i(r,o,e,i).map(l=>Si(l,r,o)),...$i(o,n,e,i).map(l=>Si(l,o,n))]}const Pt=t=>t==="FA",Ji=async(t,e,i)=>{const a=new(await A(()=>import("./index-CgzAF5Ey.js").then(l=>l.MM),__vite__mapDeps([0,1])).then(l=>l.default))({objectIds:[e]}),r=await t.queryAttachments(a,i),o=r[`${e}`]?.[0],n=o?.url;if(!n)throw new N("NoAttachmentError","no attachments found",{[t.objectIdField]:e,layer:t});return{datasetFormat:o.contentType.split("/")[1].toUpperCase(),url:n}};async function co(t,e){const i=typeof t=="string",a=i?t:t.url,{pathname:r,searchParams:o,origin:n}=new URL(a);let l=i?nn(r):t.datasetFormat;l||(l=await Br(a));const d=await A(()=>import("./ImageryTileLayer-DgPV_a3H.js").then(u=>u.R),__vite__mapDeps([158,0,1,159,160,18,17,19,20,21,22,23,24,25,26,27,28,29,161,162,163,164,165,43,42,166])).then(u=>u.default),h=await d.open({ioConfig:{customFetchParameters:Object.fromEntries(o),skipMapInfo:!0},datasetFormat:l?.toUpperCase(),url:`${n}${r}`,signal:e?.signal});return h?bl(h,{signal:e?.signal}):null}async function bl(t,e){const{level:i,offset:a,size:r}=xl(t),{pixelBlock:o}=await t.fetchRawPixels(i,a,r,e);return P(e),o}function xl(t){const{storageInfo:e,width:i,height:a}=t.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:o}=e,n=o??2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(i/n**r),height:Math.ceil(a/n**r)}}}async function Il(t,e,i){if(!t)throw new N("NoLayerError","No layer provided, cannot load image from attachment",{layer:t,objectId:e});const{datasetFormat:a,url:r}=await Ji(t,+e,i);return Ms(a)?await co({datasetFormat:a,url:r},i):(await ia(r,{...i,useRequestQueue:!0,responseType:"image",query:{w:gs}})).data}function Tl(t,e,i=0){const{height:a,width:r}=t;e.width=r,e.height=a;const o=e.getContext("2d");if(!o)return;const n=Vl(t,e,o);n.getContext("2d")&&(i>0?Pl(o,n,r,a,i):o.drawImage(n,0,0))}function Vl(t,e,i){const a=document.createElement("canvas"),r=a.getContext("2d");if(t instanceof HTMLImageElement)a.width=t.width,a.height=t.height,r?.drawImage(t,0,0);else{const o=i.createImageData(e.width,e.height);o&&(o.data.set(t.getAsRGBA()),a.width=o.width,a.height=o.height,r?.putImageData(o,0,0))}return a}function Pl(t,e,i,a,r){const o=X(r),n=[Jt(0,0,o),Jt(i,0,o),Jt(i,a,o),Jt(0,a,o)],l=Math.max(...n.map(u=>u[0]))-Math.min(...n.map(u=>u[0])),d=Math.max(...n.map(u=>u[1]))-Math.min(...n.map(u=>u[1])),h=Math.min(i/l,a/d);t.save(),t.clearRect(0,0,i,a),t.translate(i/2,a/2),t.rotate(o),t.scale(h,h),t.drawImage(e,-i/2,-a/2,i,a),t.restore()}function Fl(t){return Array.isArray(t)?t[0]?.spatialReference:t?.spatialReference}function ho(t){return t&&(Array.isArray(t)?t.map(ho):t.toJSON?t.toJSON():t)}function Cl(t){return Array.isArray(t)?t.map(e=>Ni(e)):Ni(t)}function Al(t,e){let i;return Array.isArray(t)?i=t:(i=[],i.push(t),e!=null&&i.push(e)),i}let Ri;async function $l(){return Ri||(Ri=sn("geometryEngineWorker",{strategy:"distributed"})),Ri}async function Sl(t,e){return(await $l()).invoke("executeGEOperation",{operation:t,parameters:ho(e)})}async function Rl(t,e=null){const i=Al(t,e);return Cl(await Sl("union",[Fl(i),i]))}let Yi=class{static getCameraOrientation(e){return Ln(e)}static register(e,i,a){kn.set(e,{desc:i,constructor:a})}};Yi=s([ie("esri.layers.orientedImagery.core.cameraOrientationFactory")],Yi);const Ol=Yi;function Ll(t){throw new N("exposure-point:missing-default-value",`a value for ${t} is missing in default properties`)}function kl(t,e){throw new N("exposure-point:missing-attribute-value",`a value for ${t} is missing in attribute table`,{exposurePoint:e})}const Ue=t=>({cast:e=>{const i=parseFloat(e);return Number.isFinite(i)?i:void 0},json:{name:t,write:{writer:(e,i,a)=>{i[a]=Number.isFinite(e)?e:void 0}}}}),Oi=t=>({cast:e=>typeof e=="string"?e.split(";").map(Number):e,json:{default:t,write:{writer:(e,i,a)=>{i[a]=e?.join(";")}}}}),ir="$virtualCacheDirectory:";let F=class extends fr(_r){constructor(e){super(e),this._geometry=null,this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,i){const a={},{attributes:r,geometry:o}=e,n={};for(const d in r)a[d.toLowerCase()]=r[d],n[d.toLowerCase()]=d;const l=e.layer??{};l.sequenceOrderField?.length&&(a.sequenceorder=r[l.sequenceOrderField],n.sequenceorder=l.sequenceOrderField),super.read({geometry:o,layer:l,sourceMap:n,...a},i)}write(e,i){const a=super.write(e,i),{sourceMap:r}=this;if(!r||!a)return a;const o={};for(const n in a){const l=r[n.toLowerCase()];l&&(o[l]=a[n])}return o}readCameraHeading(e,i){const{cameraheading:a,camheading:r,layer:o}=i;return a??r??o.cameraHeading}readCameraHeight(e,i){const{cameraheight:a,avghtag:r,layer:o}=i;return a??r??o.cameraHeight}readCamOffset(e,i){const{cameraoffset:a,camoffset:r}=i;return a?.split(";").map(Number)??r?.split(";").map(Number)??null}writeCameraOffset(e,i){e&&(i.cameraOffset=e.join(";"))}readCameraOrientation(e,i){const{cameraorientation:a,camori:r}=i;return a??r}readCameraPitch(e,i){const{camerapitch:a,campitch:r,layer:o}=i;return a??r??o.cameraPitch}readCameraRoll(e,i){const{cameraroll:a,camroll:r,layer:o}=i;return a??r??o.cameraRoll}readDepthImage(e,i){const{depthimage:a,depthimg:r,layer:o}=i,n=a??r??null,{depthImagePathPrefix:l,depthImagePathSuffix:d}=o??{};return Na(n,l,d)}readElevationSource(e,i){const{elevationsource:a,layer:r}=i,{demPathSuffix:o,demPathPrefix:n}=r;if(a){const l=this._parseIfJSON(a);return En(l,n,o)}return r.effectiveElevationSource}readFarDistance(e,i){const{fardistance:a,fardist:r,layer:o}=i;return a??r??o.farDistance}get geometry(){const e=this._geometry.clone();if(!e)return null;const{cameraOffset:i}=this;if(i){const[a,r,o]=i;e.x+=a,e.y+=r,e.z!=null&&o!=null&&(e.z+=o)}return e}set geometry(e){this._geometry=e}writeGeometry(e,i){i.geometry=this._geometry.toJSON()}readHFOV(e,i){const{horizontalfieldofview:a,hfov:r,layer:o}=i;return a??r??o.horizontalFieldOfView}readImageURL(e,i){const{imagepath:a,layer:r}=i;a||kl("imagePath",this);const{imagePathPrefix:o,imagePathSuffix:n}=r;return a.startsWith(ir)?`${zn(r.url)}${a.replace(ir,r.virtualCacheDirectory+"/")}`:Na(a,o,n)}readImageRotation(e,i){const{imagerotation:a,imgrot:r,layer:o}=i;return a??r??o.imageRotation}get isHorizontal(){return this.orientedImageryType==="horizontal"}get isInspection(){return this.orientedImageryType==="inspection"}get isNadir(){return this.orientedImageryType==="nadir"}get isOblique(){return this.orientedImageryType==="oblique"}get isSpherical(){return this.orientedImageryType?.includes("360")??!1}get location(){const{cameraOrientation:e,cameraHeight:i,elevation:a}=this;if(e){const{type:n,x:l,y:d,z:h,horizontalWKID:u,verticalWKID:m}=e,g=typeof u=="number"?{wkid:u}:{wkt:u};if(n===4){const{latitude:f,longitude:w,ellipsoidRadius:_,squaredEccentricity:x,properties:b}=e,{x:T,y:I,z:$}=b;return new L(Ds([T,I,$],[f,w,_,x]))}const p=new L({x:l,y:d,z:h,spatialReference:g}),y=m?ln("point",{wkid:m},g):null;return y&&y(p),p}if(typeof i!="number")throw Ll("cameraHeight");const r=this.geometry.clone(),o=(a??0)+i/zt(r.spatialReference);if(this.orientedImageryType==="360"&&r.hasZ){const n=o-r.z;return a!=null&&Math.abs(n)>.001&&(O.getLogger(this).warnOnce("The elevation value is different from the geometry's z value. The geometry's z value will be updated.",{elevation:a,geometryZ:r.z}),r.z=o),r}return r.z=r.hasZ?r.z:o,r}set matrix(e){if(e)return e.length!==9?(O.getLogger(this).warnOnce("Ignoring rotation matrix because it doesn't have 9 values",{value:e}),void this._set("matrix",null)):void this._set("matrix",e)}readNearDistance(e,i){const{neardistance:a,neardist:r,layer:o}=i;return a??r??o.nearDistance}readOffsetFromStart(e,i){return i.offsetfromstart??null}readOrientationAccuracy(e,i){const{accuracy:a,orientationaccuracy:r}=i;return r?.split(";").map(Number)??a?.split(";").map(Number)??null}writeOrientationAccuracy(e,i){e&&(i.orientationAccuracy=e.join(";"))}readOIType(e,i){const{orientedimagerytype:a,oitype:r,camerapitch:o,campitch:n,layer:l}=i,d=Rr.read(a??r??l.orientedImageryType),h=o??n??l.cameraPitch;return d==="oblique"?h<10?"nadir":"oblique":d}set radial(e){if(e){if(typeof e=="string"){const[i,a,r]=e.split(";").map(Number);return void this._set("radial",[i??0,a??0,r??0])}this._set("radial",e)}else this._set("radial",[0,0,0])}readSequenceOrder(e,i){const{layer:a}=i;return i[a.sequenceOrderField.toLowerCase()]}writeSequenceOrder(e,i){if(!e)return;const{sourceMap:a}=this;a&&(i[a.sequenceorder]=e)}set tangential(e){if(e){if(typeof e=="string"){const[i,a]=e.split(";").map(Number);return void this._set("tangential",[i??0,a??0])}this._set("tangential",e)}else this._set("tangential",[0,0])}readVFOV(e,i){const{verticalfieldofview:a,vfov:r,layer:o}=i;return a??r??o.verticalFieldOfView}_parseIfJSON(e){let i=null;try{i=JSON.parse(e)}catch(a){O.getLogger(this).error("couldn't parse the given elevation source JSON",e,a)}return i}clone(){const e=super.clone();return e._geometry=this._geometry.clone(),e}};s([c()],F.prototype,"_geometry",void 0),s([c(Ue())],F.prototype,"a0",void 0),s([c(Ue())],F.prototype,"a1",void 0),s([c(Ue())],F.prototype,"a2",void 0),s([c({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],F.prototype,"acquisitionDate",void 0),s([c(Ue())],F.prototype,"b0",void 0),s([c(Ue())],F.prototype,"b1",void 0),s([c(Ue())],F.prototype,"b2",void 0),s([c({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],F.prototype,"cameraHeading",void 0),s([le("cameraHeading")],F.prototype,"readCameraHeading",null),s([c({type:Number,json:{write:!0}})],F.prototype,"cameraHeight",void 0),s([le("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],F.prototype,"readCameraHeight",null),s([c()],F.prototype,"cameraOffset",void 0),s([le("cameraOffset",["cameraoffset","camoffset"])],F.prototype,"readCamOffset",null),s([Nt("cameraOffset")],F.prototype,"writeCameraOffset",null),s([c({json:{write:{writer:(t,e,i)=>{e[i]=t.toString()}}},type:Hn}),cn(t=>t?Ol.getCameraOrientation(t):null)],F.prototype,"cameraOrientation",void 0),s([le("cameraOrientation",["cameraorientation","camori"])],F.prototype,"readCameraOrientation",null),s([c({type:Number,json:{write:!0}})],F.prototype,"cameraPitch",void 0),s([le("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],F.prototype,"readCameraPitch",null),s([c({type:Number,json:{write:!0}})],F.prototype,"cameraRoll",void 0),s([le("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],F.prototype,"readCameraRoll",null),s([c({json:{write:!0},type:String})],F.prototype,"depthImage",void 0),s([le("depthImage",["depthimage","depthimg"])],F.prototype,"readDepthImage",null),s([c({type:Number,json:{write:!0}})],F.prototype,"elevation",void 0),s([c({json:{write:!0},clonable:"reference"})],F.prototype,"elevationSource",void 0),s([le("elevationSource",["elevationsource","layer.effectiveElevationSource"])],F.prototype,"readElevationSource",null),s([c({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],F.prototype,"exposureStationId",void 0),s([c({type:Number,json:{write:!0}})],F.prototype,"farDistance",void 0),s([le("farDistance",["fardistance","fardist","layer.farDistance"])],F.prototype,"readFarDistance",null),s([c(Ue("focallength"))],F.prototype,"focalLength",void 0),s([c({type:L,json:{name:"geometry"}})],F.prototype,"geometry",null),s([Nt("geometry")],F.prototype,"writeGeometry",null),s([c({type:Number,json:{write:!0}})],F.prototype,"horizontalFieldOfView",void 0),s([le("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],F.prototype,"readHFOV",null),s([c({json:{write:!0},type:String})],F.prototype,"imagePath",void 0),s([le("imagePath",["imagepath"])],F.prototype,"readImageURL",null),s([c({type:Number,json:{write:!0}})],F.prototype,"imageRotation",void 0),s([le("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],F.prototype,"readImageRotation",null),s([c()],F.prototype,"isHorizontal",null),s([c()],F.prototype,"isInspection",null),s([c()],F.prototype,"isNadir",null),s([c()],F.prototype,"isOblique",null),s([c()],F.prototype,"isSpherical",null),s([c()],F.prototype,"location",null),s([c(Oi())],F.prototype,"matrix",null),s([c({json:{write:!0},type:String})],F.prototype,"name",void 0),s([c({type:Number,json:{write:!0}})],F.prototype,"nearDistance",void 0),s([le("nearDistance",["neardistance","neardist","layer.nearDistance"])],F.prototype,"readNearDistance",null),s([c({json:{write:!0,name:"objectid"},type:Number})],F.prototype,"objectId",void 0),s([c({type:Number,json:{write:!0}})],F.prototype,"offsetFromStart",void 0),s([le("offsetFromStart",["offsetfromstart"])],F.prototype,"readOffsetFromStart",null),s([c()],F.prototype,"orientationAccuracy",void 0),s([le("orientationAccuracy",["accuracy","orientationaccuracy"])],F.prototype,"readOrientationAccuracy",null),s([Nt("orientationAccuracy")],F.prototype,"writeOrientationAccuracy",null),s([sa(Rr)],F.prototype,"orientedImageryType",void 0),s([le("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],F.prototype,"readOIType",null),s([c({type:Number,json:{write:!0,read:{source:"principalx"}}})],F.prototype,"principalX",void 0),s([c({type:Number,json:{write:!0,read:{source:"principaly"}}})],F.prototype,"principalY",void 0),s([c(Oi([0,0,0]))],F.prototype,"radial",null),s([c({type:String})],F.prototype,"sequenceOrder",void 0),s([le("sequenceOrder",["sequenceorder","layer.sequenceOrderField"])],F.prototype,"readSequenceOrder",null),s([Nt("sequenceOrder")],F.prototype,"writeSequenceOrder",null),s([c({type:Object})],F.prototype,"sourceMap",void 0),s([c(Oi([0,0]))],F.prototype,"tangential",null),s([c({type:Number,json:{write:!0}})],F.prototype,"verticalFieldOfView",void 0),s([le("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],F.prototype,"readVFOV",null),F=s([ie("esri.layers.orientedImagery.core.ExposurePoint")],F);const El=Object.freeze(Object.defineProperty({__proto__:null,get default(){return F}},Symbol.toStringTag,{value:"Module"}));function zl(t,e){const{x:i,y:a,spatialReference:r}=t,o=e*it(a,r)/Bi(r);return new aa({xmin:i-o,xmax:i+o,ymin:a-o,ymax:a+o,spatialReference:t.spatialReference})}const Kt={},Hl=1e3;async function di(t,e){const{point:i,queryParams:a}=t;Dl(i,a);const r=Bl(t.layerInstanceOrURL);await r.load(e);const o=Gl(r,i,a),n=await r.queryFeatures(o,e);return P(e),uo(r)(n)}function Dl(t,e){if(!dn(t)&&e?.geometry==null)throw new N("invalid-parameters","searchImages requires a point and query parameters to be provided.");return!0}function Gl(t,e,i){const a=e?Wi(e):null,r=i?.maximumDistance??t.maximumDistance??Hl,o=i?.geometry??(a?zl(a,r):null);return new Tr({outSpatialReference:i?.outSpatialReference??t.spatialReference.isGeographic?W.WebMercator:t.spatialReference,returnGeometry:i?.returnGeometry??!0,outFields:i?.outFields??["*"],geometry:o,where:i?.where??"1=1",returnZ:t.hasZ,orderByFields:i?.orderByFields,maxRecordCountFactor:i?.maxRecordCountFactor??5})}async function Nl(t,e){const i=new Tr;i.where="1=1",i.outFields=["*"],i.orderByFields=["OffsetFromStart ASC"],i.outSpatialReference=e,i.returnGeometry=!0;const a=await t.queryFeatures(i);return uo(t)(a)}function uo(t){return e=>(e.features.forEach(i=>{const a=F.fromJSON({...i.toJSON(),layer:t});a&&(i.attributes=a)}),e)}function Bl(t){return typeof t!="string"?t:(Kt.layer?.url!==t&&(Kt.layer?.destroy(),Kt.layer=new Or({url:t})),Kt.layer)}function jl(t){const{camera:e,features:i,selectedPoint:a}=t;if(!i.length)return[];t.currentImage??={attributes:{cameraHeading:0,cameraPitch:0}};const r=ql(e,a,t.currentImage);return i.map(r)}function ql(t,e,i){const a=e.clone();return a.z??=0,a.elevation=e.elevation??0,r=>{const{hfovWeight:o,vfovWeight:n,distanceWeight:l}=Wl(r.attributes,t?"3d":"2d"),d=r.attributes,{cameraHeight:h,cameraHeading:u,cameraPitch:m,farDistance:g,horizontalFieldOfView:p,verticalFieldOfView:y,isOblique:f}=d,w=d.geometry,_=180*Math.atan2(w.y-a.y,w.x-a.x)/Math.PI,x=hn(a,w);let b,T,I=p,$=y,S=!1;t?(b=t.heading,T=t.tilt,I=180,$=180,S=!0):!f||m<10?(b=u,T=m,S=!1):(b=i.attributes.cameraHeading,T=m,S=!0,I=180),b>180&&(b-=360);let U=1;w.spatialReference.isWebMercator&&(U=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*w.y/ra.radius))));const J=Math.sqrt((Math.sqrt((a.x-w.x)**2+(a.y-w.y)**2)/U)**2+((a.z??0)-(a.elevation??0)-h)**2),re=90-180*Math.atan2(a.y-w.y,a.x-w.x)/Math.PI;let Re=(Math.abs(re-b)>180?Math.abs(360-Math.abs(re-b)):Math.abs(re-b))/I;Re=4*Re+1;const Oe=180*Math.acos((d.cameraHeight-(a.z??0)+(a.elevation??0))/J)/Math.PI;let _i=Math.abs(Oe-T)/$;_i=4*_i+1;let Gt=J/Math.sqrt(g**2+h**2);Gt=4*Gt+1;const La=o*Re+n*_i+l*Gt;let Mi;if(S){const bi=u>180?u-360:u;Mi=o*((Math.abs(re-bi)>180?Math.abs(360-Math.abs(re-bi)):Math.abs(re-bi))/p*4+1)+n*(Math.abs(Oe-m)/y*4+1)+l*Gt}else Mi=La;return{suitability:La,trueSuitability:Mi,feature:r,angle:_,distance:x,verticalAngle:Math.abs(180*Math.atan(x/h)/Math.PI)}}}function Wl(t,e){const i="isOblique"in t?t:new F(t),{isOblique:a,isSpherical:r,isNadir:o}=i;return r?{hfovWeight:e==="2d"?0:1,vfovWeight:e==="2d"?0:.6,distanceWeight:e==="2d"?1:.5}:o?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:a?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}const ge=Math.PI/180;function Ft(t){const e=Va(t,t.geometry.spatialReference);return t.isSpherical?Jl(e):Ul(e)}function Ul(t){const{horizontalFieldOfView:e,verticalFieldOfView:i,geometry:a,cameraHeading:r}=t,o=it(a.y,a.spatialReference);let n=t.cameraPitch,l=t.cameraRoll??0,d=150;e>150&&(n=90,l=0,d=5);const h=Math.ceil(e/d),u=Zl(h,r,e);let m=t.farDistance?t.farDistance*o:t.cameraHeight*o/Math.cos(n*ge);t.cameraPitch+i/2>=90&&(m=(t.farDistance||20)*o);const g=new ue({spatialReference:a?.spatialReference});g.imageID=t.objectId;let p=null;for(const y of u)p=Ql(y,n,t.cameraHeight,a,m,o,i,e,h,g,l,t.nearDistance);return p.imageID=t.objectId,{polygon:g,frustum:p}}function Zl(t,e,i){const a=[];if(t%2==0)for(let r=0;r<t/2;r++)a.push(e-i/t*(r+.5),e+i/t*(r+.5));else{a.push(e);for(let r=1;r<t/2;r++)a.push(e-i/t*r,e+i/t*r)}return a.sort(),a}function Ql(t,e,i,a,r,o,n,l,d,h,u=0,m=0){const g=vr(Lt(),Qi([t,e,u??0])),p=Kl({cameraHeight:i,cameraPitch:e,farDistance:r,location:a,horizontalFieldOfView:l,nearDistance:m,verticalFieldOfView:n},g),y=He([0,0,-1],g),{x:f,y:w}=a,_=pt([f,w,i],y,r,o),x=2*Math.tan(n*ge/2)*r,b=2*Math.tan(l/d*ge/2)*r,T=He([0,1,0],g),I=He([1,0,0],g),$=ee(T,x/2,o),S=ee(I,b/2,o),U=he(k(),$,S),J=ve(k(),$,S),re=Xl([ve(k(),_,U),ve(k(),_,J),he(k(),_,U),he(k(),_,J)],i,a,o);return re.push(re[0]),h.addRing(re),p}function Xl(t,e,i,a){return t.map(r=>ec(r,e,i,a))}function Jl(t){const{geometry:e,farDistance:i,objectId:a,nearDistance:r,cameraHeight:o}=t,n=it(e.y,e.spatialReference),l=new Ui({center:e.clone(),radius:i*n});if(l.imageID=a,r){const u=new Ui({center:e.clone(),radius:r*n});l.addRing(u.rings[0])}const d=e.clone();d.z=o-i*n;const h=Ht.createSphere(d,{size:2*i*n});return h.imageID=a,{polygon:l,frustum:h}}function Yl(t,e){return t.contains(e)}function Li(t,e){return Math.sign(t)!==Math.sign(e)}function Kl(t,e,i){const{cameraHeight:a,cameraPitch:r,farDistance:o,location:n,horizontalFieldOfView:l,nearDistance:d,verticalFieldOfView:h}=t,u=mo(n),m=!(r+h/2>=90),g=2*Math.tan(h*ge/2)*d,p=2*Math.tan(l*ge/2)*d,y=2*Math.tan(h*ge/2)*o,f=2*Math.tan(l*ge/2)*o;let w,_;_=[0,0,-1],_=He(_,e),w=pt([n.x,n.y,a],_,o,u),m&&(w[2]=0);const x=pt([n.x,n.y,a],_,d,u);let b=[0,1,0];b=He(b,e);let T=[1,0,0];T=He(T,e);let I=[],$=[];d?($=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],I=I.concat(ve(k(),x,he(k(),ee(b,g/2,u),ee(T,p/2,u)))),I=I.concat(ve(k(),x,ve(k(),ee(b,g/2,u),ee(T,p/2,u)))),I=I.concat(he(k(),x,he(k(),ee(b,g/2,u),ee(T,p/2,u)))),I=I.concat(he(k(),x,ve(k(),ee(b,g/2,u),ee(T,p/2,u))))):(I=[n.x,n.y,a],$=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),I=I.concat(ve(k(),w,he(k(),ee(b,y/2,u),ee(T,f/2,u)))),I=I.concat(ve(k(),w,ve(k(),ee(b,y/2,u),ee(T,f/2,u)))),I=I.concat(he(k(),w,he(k(),ee(b,y/2,u),ee(T,f/2,u)))),I=I.concat(he(k(),w,ve(k(),ee(b,y/2,u),ee(T,f/2,u))));const S=new ga({position:Float64Array.from(I)});return new Ht({vertexAttributes:S,components:$,spatialReference:n.spatialReference})}function ec(t,e,i,a){{const r=Math.sqrt((t[2]-e)**2+(Math.sqrt((t[0]-i.x)**2+(t[1]-i.y)**2)/a)**2)*a,o=ee(he(k(),[t[0],t[1],t[2]],[i.x,i.y,e]),1/r,1/a),n=e/(e-t[2]),l={x:(1-n)*i.x+n*t[0],y:(1-n)*i.y+n*t[1],z:(1-n)*e+n*t[2]},d=Math.sqrt((l.z-e)**2+(Math.sqrt((l.x-i.x)**2+(l.y-i.y)**2)/a)**2)*a,h=ee(he(k(),[l.x,l.y,l.z],[i.x,i.y,e]),1/d,1/a);return Li(o[0],h[0])&&Li(o[1],h[1])&&Li(o[2],h[2])||t[2]>=0?[t[0],t[1],0]:[l.x,l.y,l.z]}}function tc(t){const{spatialReference:e,x:i,y:a}=t.geometry,{cameraHeading:r,cameraPitch:o,farDistance:n,nearDistance:l}=t,d=mo(t.geometry),h=new ue({spatialReference:e}),u=Math.abs(1.44*n*d);let m=Math.abs(1.44*l*d);(o<20||r==null)&&(m=u);const g=[];return g[0]={x:i+u*Math.sin((r-45)*ge),y:a+u*Math.cos((r-45)*ge)},g[1]={x:i+u*Math.sin((r+45)*ge),y:a+u*Math.cos((r+45)*ge)},g[2]={x:i+m*Math.sin((r+135)*ge),y:a+m*Math.cos((r+135)*ge)},g[3]={x:i+m*Math.sin((r+225)*ge),y:a+m*Math.cos((r+225)*ge)},h.addRing([[g[0].x,g[0].y,0],[g[1].x,g[1].y,0],[g[2].x,g[2].y,0],[g[3].x,g[3].y,0],[g[0].x,g[0].y,0]]),h}function mo(t){return t&&gr(t?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*t.y/ra.radius))):1}function ic(t,e){const i=1+e/100;if(t.declaredClass==="esri.geometry.Circle"){const{radius:a,center:r}=t,o=new Ui({radius:a*i,center:r});return t.rings.length>1&&o.addRing(t.rings[1]),o}if(t.declaredClass==="esri.geometry.Polygon"){const a=new ue({spatialReference:t.spatialReference}),r=da(t);if(r){const o=[];for(let n=0;n<t.rings[0].length;n++){const l=Math.sqrt((r.x-t.rings[0][n][0])**2+(r.y-t.rings[0][n][1])**2),d=ee(he(k(),[t.rings[0][n][0],t.rings[0][n][1],0],[r.x,r.y,0]),1/l,1),h=pt([r.x,r.y,0],d,l*i,1);o.push({x:h[0],y:h[1]})}a.addRing([[o[0].x,o[0].y,0],[o[1].x,o[1].y,0],[o[2].x,o[2].y,0],[o[3].x,o[3].y,0],[o[0].x,o[0].y,0]])}return a}return t}async function Oh(t,e,i){const{cameraHeight:a,cameraLocation:r,cameraPitch:o,frustumVertices:n,horizontalFieldOfView:l,imageHeight:d,imageWidth:h,inSRS:u,outSRS:m,verticalFieldOfView:g,cameraRoll:p,options:y}=i,f=new W(u),w=new W(m),_=Ur(l,g,p??0),x=n.length>15;return o+_.vfov/2>=90?await sc(n,t,h,d,f,w,x,y):await ac(n,t,e,r,a,x,f,w,y)}async function ac(t,e,i,a,r,o,n,l,d){const h=rc(t,e,i,a,r);if(!h)return;const{farPlane:u,nearPlane:m}=h,g=await po([...m?.vertexPositions??t.slice(0,3),...u.vertexPositions],n,l,d),p=wo(g);return new Ht({vertexAttributes:new ga({position:g}),components:yo(o?go(p,!0):vo(p,!0)),spatialReference:l})}function rc(t,e,i,a,r){const o=ar(t),n=ar(t,"near");if(!o)return;const l=e.length;for(let d=0;d<l;d++){const h=Array.from(i[d]),u=[h[0]-a[0],h[1]-a[1],h[2]-(a[2]??r)];nc(a,u,d,n),oc(a,u,d,o)}return{farPlane:o,nearPlane:n}}function oc(t,e,i,a){const{coefficients:r,vertexPositions:o}=a,n=k();Pr(r,{origin:t,direction:e},n)&&o.splice(3*i,3,...n)}function nc(t,e,i,a){if(!a)return;const r=k();Pr(a.coefficients,{origin:t,direction:e},r)&&a.vertexPositions.splice(3*i,3,...r)}async function sc(t,e,i,a,r,o,n,l){let d,h=n?new Array:[t[0],t[1],t[2]],u=new Array;for(const p of e)n?(d=Ct([p[0],p[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]],[t[9],t[10],t[11]]]),h=h.concat(...d),d=Ct([p[0],p[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[t[12],t[13],t[14]],[t[15],t[16],t[17]],[t[18],t[19],t[20]],[t[21],t[22],t[23]]]),u=u.concat(...d)):(d=Ct([p[0],p[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[t[3],t[4],t[5]],[t[6],t[7],t[8]],[t[9],t[10],t[11]],[t[12],t[13],t[14]]]),h=h.concat(...d));h=h.concat(u);const m=await po(h,r,o,l),g=wo(m);return new Ht({vertexAttributes:new ga({position:m}),components:yo(n?go(g,!0):vo(g,!0)),spatialReference:o})}async function po(t,e,i,a){if(e.equals(i))return t;const r=t.reduce((n,l,d)=>{const h=Math.floor(d/3);return n[h]||(n[h]=new Array),n[h].push(l),n},new Array),{points:o}=await ae(new Vr({points:r,spatialReference:e}),i,a);return P(a),o.flat()}function ar(t,e="far"){const i=un();let a;switch(e){case"far":if(a=Array.from(t.length===15?t.slice(3):t.slice(12)),ii(i,a,!1))return{coefficients:i,vertexPositions:a};break;case"near":return a=Array.from(t.slice(0,12)),t.length===15||!ii(i,a,!1)?void 0:{coefficients:i,vertexPositions:a}}}const go=(t,e=!1)=>{if(e&&t-2<=4||t<=4||t%2!=0)throw new Error("Invalid number of vertices");const i=[],a=t/2,r=Math.round((e?t-2:t)/2);for(let o=0;o<r;o++){const n=o+a,l=e?n+1:n,d=l%t,h=(e?n:l+1)%t;i.push({faces:new Uint32Array([o,h,d,o,o+1,d])})}return i};function vo(t,e=!1){if(t<3||e&&t-1<3)throw new Error("Invalid number of vertices");const i=[],a=e?t-2:t-1;for(let r=0;r<a;r++)i.push({faces:new Uint32Array([0,r+1,r+2])});return i}const yo=t=>t.map(e=>new Xn(e)),wo=t=>t.length/3;async function gt(t,e,i){const a=Array.isArray(t)?t:[t];let r;if(Yr(e))r=await jr(a,e.elevationSample,i);else if(Ta(e)){const{elevationSource:o,extent:n}=e,{url:l,lod:d,rasterFunction:h}=o;r=await Fs(a,{url:l,lod:d,rasterFunction:h,extent:n},i)}else r="averageGroundElevation"in e?Os(a,e):await Rs(a,e.elevationSource.constantElevation,i);return Array.isArray(t)?r:r[0]}function De(t,e){const{cameraLocation:i,pointsToTransform:a,scalingFactor:r}=cc(t,e.cameraLocation,e.rotationMatrix),o=new Array;return lc(a,o,{...e,cameraLocation:i,scalingFactor:r,...uc(e)}),Array.isArray(t)?o:o[0]}function lc(t,e,i){const{affineTransformations:a,cameraLocation:r,focalLengthX:o,focalLengthY:n,principalOffsetPoint:l,radialDistortionCoefficients:d,rotationMatrix:h,scalingFactor:u,tangentialDistortionCoefficients:m}=i;for(const g of t){const p=ha();he(p,g,r),p[0]=p[0]/u,p[1]=p[1]/u;const y=-o*((h[0]*p[0]+h[3]*p[1]+h[6]*p[2])/(h[2]*p[0]+h[5]*p[1]+h[8]*p[2])),f=-n*((h[1]*p[0]+h[4]*p[1]+h[7]*p[2])/(h[2]*p[0]+h[5]*p[1]+h[8]*p[2])),w=y*y+f*f;let _=0,x=0,b=0,T=0,I=0,$=0,S=0;d&&(_=d[0]??0,x=d[1]??0,b=d[2]??0),m&&(T=m[0],I=m[1]),l&&($=l[0]??0,S=l[1]??0);const U=1+_*w+x*w*w+b*w*w*w;let J=y*U+T*(w+2*y**2)+2*I*y*f,re=f*U+I*(w+2*f**2)+2*T*y*f;J+=$,re+=S;const Re=Number(a[0])+Number(a[1])*J+Number(a[2])*re,Oe=Number(a[3])+Number(a[4])*J+Number(a[5])*re;e.push({x:Re,y:Oe})}}function vt(t,e){const{cameraHeading:i,imageHeight:a,imageWidth:r}=e,{cameraLocation:o,pointsToTransform:n}=dc(t,e.cameraLocation),l=new Array,d=it(o[1],e.cameraLocation.spatialReference);for(const h of n){const u=mn([o[0],o[1],o[2]*d],[h[0],h[1],h[2]*d]),m=[(h[0]-o[0])/u,(h[1]-o[1])/u,(h[2]-o[2])*d/u],g=m[0]!==0&&m[1]!==0?ye(me(Math.atan2(m[0],m[1]))-i):0,p=me(Math.acos(-m[2]));l.push(Zr(g,p,r,a))}return Array.isArray(t)?l:l[0]}function cc(t,e,i){const a=Array.isArray(t)||"items"in t?t:[t];Qr(a,e),fo(a,e),Xr(i);const r=it(e.y,e.spatialReference);return{pointsToTransform:a.map(o=>o.toArray()),scalingFactor:r,cameraLocation:e.toArray()}}function dc(t,e){const i=Array.isArray(t)||"items"in t?t:[t];return Qr(i,e),fo(i,e),{pointsToTransform:i.map(a=>a.toArray()),cameraLocation:e.toArray()}}function fo(t,e){if(t.some(i=>!i.spatialReference.equals(e.spatialReference)))throw new Error("Input points and camera location must have the same spatial reference")}function hc(t){return t?.focalLength!=null}function uc(t){if(hc(t))return{focalLengthX:t.focalLength,focalLengthY:t.focalLength};const{imageWidth:e,imageHeight:i,horizontalFieldOfView:a,verticalFieldOfView:r}=t;return{focalLengthX:e/(2*Math.tan(X(a)/2)),focalLengthY:i/(2*Math.tan(X(r)/2))}}async function mc(t,e,i,a=_o){const{cameraLocation:r,farPlaneVertices:o}=i,n=fe(r),l=new Array;await bo(o,i,l);let d=za(l[0],l[1],l[2]),h=t.clone();for(let u=0;u<a;u++){const m=ha();if(!Fr(d,n,fe(t),m))break;let g=0,p=null;if({error:g,imagePoint:p,pointWithZ:h}=await gc(e,new L(m,r.spatialReference),i),g<=1)break;const[y,f]=Mo(r.spatialReference,l);if(Se(y<=1,f<=1))break;l.splice(0,l.length,...await xo(y,f,new L(m,r.spatialReference),i)),d=za(l[0],l[1],l[2])}return fe(h)}async function pc(t,e,i,a=_o){const{cameraLocation:r,farPlaneVertices:o}=i,n=fe(r),l=new Array;await bo(o,i,l);const d=[0,0,0,0];let h=ii(d,l.flat(),!1),u=t.clone();for(let m=0;m<a;m++){const g=ha();if(!Fr(d,n,fe(t),g)||!h)break;let p,y=0;if({error:y,imagePoint:p,pointWithZ:u}=await vc(e,new L(g,r.spatialReference),i),y<=1)break;const[f,w]=Mo(r.spatialReference,l);if(Se(f<=1,w<=1))break;l.splice(0,l.length,...await xo(f,w,new L(g,r.spatialReference),i)),h=ii(d,l.flat(),!1)}return fe(u)}const _o=10,rr=10;function Mo(t,e){const i=new ue({spatialReference:t});return i.addRing(e),[i.extent?.width?i.extent.width/rr:1,i.extent?.height?i.extent.height/rr:1]}async function bo(t,e,i){const a=Yn(t),r=await gt(a,e);i.push(...r.map(fe))}async function gc(t,e,i){const a=await gt(e,i),r=De(a,i);return{error:yc(r,t),imagePoint:r,pointWithZ:a}}async function vc(t,e,i){const a=await gt(e,i),r=vt(a,i),o=ye(r.heading+i.cameraHeading);return{error:Math.abs(o-t.heading)+Math.abs(r.pitch-t.pitch),imagePoint:r,pointWithZ:a}}const yc=(t,e)=>Math.abs(t.x-e.x)+Math.abs(t.y-e.y);async function xo(t,e,i,a){const r=[[-t,-e],[t,-e],[t,e],[-t,e]].map(([o,n])=>new L([i.x+o,i.y+n],i.spatialReference));return gt(r,a).then(o=>o.map(n=>n.toArray()))}async function yt(t,e,i){const{verticalFieldOfView:a,imageBoundaries:r,scalingFactor:o,farPlaneVertices:n,cameraLocation:l,pixelsToTransform:d,vecToPoint:h,pixelDepths:u}=Ic(t,e),m=new Array;return await wc(d,n,r,h,e,m,l,o,a,i,u),Array.isArray(t)?m:m[0]}async function wc(t,e,i,a,r,o,n,l,d,h,u){let m=r.averageElevation;const g=t.length;for(let p=0;p<g;p+=1){const y=t.at(p),f=_c(e,i,y,a,r),w=u?.at(p);if(typeof w=="number"){const _=Io(f,n,l),x=w*l,b=[n[0]+_[0]*x,n[1]+_[1]*x,n[2]+_[2]*w];o.push(new L(b,r.cameraLocation.spatialReference));continue}h&&Se("elevationSample"in h,Ta(h))&&(m=(await mc(a(f),{x:y[0],y:y[1]},{...r,...h,farPlaneVertices:e.map(a)}))[2]),o.push(a(To(f,n,l,m,r.cameraPitch,d)))}}function Io(t,e,i){const a=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2],n=Math.hypot(a,r)/i,l=Math.hypot(o,n)*i,d=k();return d[0]=a/l,d[1]=r/l,d[2]=o/l,d[2]=d[2]*i,d}function To(t,e,i,a,r,o){let n=gn(t);const l=Io(t,e,i);if(fc(t[2],a,r,o)){const d=Math.abs((e[2]-a)/-l[2])*i;n=pt(e,l,d,i)}else n[2]=a;return n}function fc(t,e,i,a){return t<e||i+a/2<ws}function _c(t,e,i,a,r){let o=null;const n=9;let l,d=0,h=t,u=e;for(;d<=n;){const m=bc(i,u,h,r);if(l=m.error,o=m.transformedPoint,Se(l<=1,d===n))break;h=qs(h,l,i,e),u=Mc(h,a,r),d++}return o}function Mc(t,e,i){return De(t.map(e),i).map(({x:a,y:r})=>[a,r,1])}function bc(t,e,i,a){const{cameraLocation:r}=a,o=Ct(t,e,i),{x:n,y:l}=De(new L(o,r.spatialReference),a);return{transformedPoint:o,error:xc(t,[n,l,1])}}function xc(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])}function Ic(t,e){const i=pn(t)||"items"in t?t:[t],{cameraLocation:a,rotationMatrix:r}=e;if(Ns(i,a),Xr(r),r?.length!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const o=it(a.y,a.spatialReference),n=Ks({...e,scalingFactor:o}),l=De(n.map(h=>new L(h,a.spatialReference)),e),{vfov:d}=Ur(e.horizontalFieldOfView,e.verticalFieldOfView,e.cameraRoll);return{cameraLocation:a.toArray(),imageBoundaries:l.map(({x:h,y:u})=>[h,u,1]),verticalFieldOfView:d,farPlaneVertices:n,scalingFactor:o,pixelsToTransform:i.map(h=>[h.x,h.y,1]),vecToPoint:Bs(a.spatialReference),pixelDepths:i.map(h=>Vo(h)?h.depth:void 0)}}function Vo(t){return"depth"in t&&typeof t.depth=="number"}async function wt(t,e,i){const{cameraHeading:a,cameraLocation:r,farDistance:o,imageHeight:n,imageWidth:l,verticalFieldOfView:d}=e,h=it(r.y,r.spatialReference),u=o*h,m=new Array,[g,p,y]=r.toArray(),f=Array.isArray(t)?t:[t];for(const w of f){let _,x;const b=Vo(w),T=b?w.depth*h:u;if(Js(w))_=w.heading,x=w.pitch;else{const S=je({x:w.x,y:w.y},l,n);_=S.heading,x=S.pitch}_=(_+a)%360;const I=[g+Math.sin(X(_))*Math.sin(X(x))*T,p+Math.cos(X(_))*Math.sin(X(x))*T,y+-Math.cos(X(x))*(b?w.depth:o)];if(b){m.push(new L(I,r.spatialReference));continue}let $=e.averageElevation;i&&(pa(i)||js(i.elevationSample))&&($=(await pc(new L(I,r.spatialReference),{heading:_,pitch:x},{...e,...i,farPlaneVertices:Ys(o,o).map(([S,U])=>new L([r.x+S,r.y+U],r.spatialReference))}))[2]),m.push(new L(To(I,r.toArray(),h,$,x,d),r.spatialReference))}return Array.isArray(t)?m:m[0]}const Tc=new kt({size:15,style:"circle",color:[255,102,102,.5],outline:null}),Po=new kt({size:10,style:"circle",color:[0,128,192,.5],outline:null}),Lh=new Et({style:"solid",color:[0,128,192,.5],outline:null}),kh=new Et({style:"solid",color:[255,102,102,.5],outline:null}),or=new kt({size:10,style:"diamond",color:[255,102,102],outline:null}),Vc=new fi({symbolLayers:new D([new vn({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),Pc=new fi({symbolLayers:new D([new ua({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),nr=new Cr({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),Eh=new oa({symbolLayers:new D([new na({material:{color:[255,102,102,.5]},edges:null})])}),zh=new oa({symbolLayers:new D([new na({material:{color:[0,128,192,.25]},edges:null})])}),sr=new kt({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),Fc=new fi({symbolLayers:new D([new ua({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),lr=(t,e=3.5)=>new Cr({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:e,color:_n(t).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:e,color:t.toArray()}]}}}),cr=new yn({symbolLayers:new D([new wn({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),Cc=t=>new Et({color:fn(t,.3),outline:{color:t,width:2}});function Ac(t){switch(t){case"point":return e=>new kt({size:10,style:"circle",color:e??Fo(),outline:new ma({color:[0,0,0],width:2})});case"polygon":return e=>new Et({color:null,outline:hi(e),style:"none"});case"polyline":return e=>hi(e)}}function Fo(){return new Ar([255,0,0])}function hi(t){return new ma({color:t??Fo(),width:2})}function $c(t){return new Et({color:null,outline:hi(t),style:"none"})}function Sc(t,e,i){return t===e?i:t==="polyline"?hi(i?.color):$c(i?.color)}function Rc(){return new fi({symbolLayers:new D([new ua({anchor:"center",material:{color:new Ar([0,128,192,.65])},resource:{primitive:"sphere"},width:20,height:20,depth:20})])})}function Oc(){const t=Po.clone();return t.outline=new ma({color:[0,0,0],width:1}),t}function ui(t,e,i){const a=t.toLowerCase(),r=e.toLowerCase()===a,o=i?.toLowerCase()===a;return Se(r,o)}function Lc(t){return t==="point"||t==="polygon"||t==="polyline"}function kc(t,e,i){return Lc(t.geometryType)&&t.fields.filter(({name:a,type:r,alias:o})=>ui(i?.length?i:_a,a,o)||ui(e?.length?e:fa,a,o)&&r==="blob").length===2}function Hh(t){return t.type==="feature"&&Ec(t)}function Ec(t){return t.geometryType==="point"||t.geometryType==="polygon"||t.geometryType==="polyline"}function zc(t,e,i){if(!t)return;const{renderer:a}=t,r=Ac(e),o=a?"symbol"in a?a.symbol:"defaultSymbol"in a?a.defaultSymbol:a.getSymbol():null,n=r(o?.color);i[`${e}Symbol`]=(e===t.geometryType?o:null)??n}function Hc(t,e,i){const a=t.fields.find(({name:o,alias:n,type:l})=>ui(e?.length?e:fa,o,n)&&l==="blob"),r=t.fields.find(({name:o,alias:n})=>ui(i?.length?i:_a,o,n));if(!a||!r)throw new N("orientedimageryviewer:invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:t,imageGeometryField:a,oiObjectIdField:r});return{imageGeometryField:a,oiObjectIdField:r}}function Dc(t,e,i,a,r,o,n){let l=Gc(t,e);if(!l)throw new N("orientedimageryviewer:invalid-geometry","InvalidGeometry");return l=Bc(l,o,r),new Q({attributes:t,layer:i,symbol:Sc(l.type,i.geometryType,n),geometry:l,visible:i.visible&&a})}function Gc(t,e){const{geometry:i}=JSON.parse(atob(t[e]));return Ni(i)}function Dh(t,e,i){switch(e){case"default":return Nc(t);case"panoramic":return Co(t,i)}}function Nc(t){switch(t.type){case"point":t.x+=.5,t.y=.5-t.y;break;case"polyline":t.paths=t.paths.map(e=>e.map(([i,a])=>[i+.5,.5-a]));break;case"polygon":t.rings=t.rings.map(e=>e.map(([i,a])=>[i+.5,.5-a]));break;case"multipoint":t.points=t.points.map(([e,i])=>[e+.5,.5-i]);break;case"extent":t.xmin+=.5,t.xmax+=.5,t.ymin=.5-t.ymin,t.ymax=.5-t.ymax}return t}function Co(t,e){switch(t.type){case"point":{const{x:i,y:a}=_e(t,e[0],e[1]);t.x=i,t.y=a,delete t.z;break}case"polyline":t.paths=t.paths.map(i=>i.map(a=>{const{x:r,y:o}=_e({x:a[0],y:a[1],z:a[2]},e[0],e[1]);return[r,o]}));break;case"polygon":t.rings=t.rings.map(i=>i.map(a=>{const{x:r,y:o}=_e({x:a[0],y:a[1],z:a[2]},e[0],e[1]);return[r,o]}));break;case"multipoint":t.points=t.points.map(i=>{const{x:a,y:r}=_e({x:i[0],y:i[1],z:i[2]},e[0],e[1]);return[a,r]});break;case"extent":{const{xmin:i,xmax:a,ymin:r,ymax:o}=Co(ue.fromExtent(t),e).extent;t.xmax=a,t.xmin=i,t.ymax=o,t.ymin=r;break}}return t}function Bc(t,e,i){switch(e){case"default":return jc(t);case"panoramic":return Ao(t,i)}}function jc(t){switch(t.type){case"point":t.x-=.5,t.y=.5-t.y;break;case"polyline":t.paths=t.paths.map(e=>e.map(([i,a])=>[i-.5,.5-a]));break;case"polygon":t.rings=t.rings.map(e=>e.map(([i,a])=>[i-.5,.5-a]));break;case"multipoint":t.points=t.points.map(([e,i])=>[e-.5,.5-i]);break;case"extent":t.xmin-=.5,t.xmax-=.5,t.ymin=.5-t.ymin,t.ymax=.5-t.ymax}return t}function Ao(t,e){switch(t.type){case"point":{const[i,a,r]=Xt(t,e[0],e[1]);t.x=i,t.y=a,t.z=r;break}case"polyline":t.paths=t.paths.map(i=>i.map(a=>{const[r,o,n]=Xt({x:a[0],y:a[1]},e[0],e[1]);return[r,o,n]}));break;case"polygon":t.rings=t.rings.map(i=>i.map(a=>{const[r,o,n]=Xt({x:a[0],y:a[1]},e[0],e[1]);return[r,o,n]}));break;case"multipoint":t.points=t.points.map(i=>{const[a,r,o]=Xt({x:i[0],y:i[1]},e[0],e[1]);return[a,r,o]});break;case"extent":{const{xmin:i,xmax:a,ymin:r,ymax:o}=Ao(ue.fromExtent(t),e).extent;t.xmax=a,t.xmin=i,t.ymax=o,t.ymin=r}}return t}const $o=1e5,$e="meters",Ot="square-meters";function Pa(t,e){let i=180*Math.atan2(-t.y+e.y,t.x-e.x)/Math.PI;return i<0&&(i+=180),i*Math.PI/180}function qc(t,e){let i=180*Math.atan2(-t.y+e.y,t.x-e.x)/Math.PI;return i<0&&(i+=180),i*Math.PI/180}function Fa(t,e,i){if(!t?.length||!e?.length||!i)return;const[a,r]=t,[,o]=e,n=o-r;return[a+n*Math.cos(i),r+n*Math.sin(i)]}async function Ca(t,e,i){if(await zr(),Dr(t)){const d=oi([e],$e)[0];return{area:Ba([i],Ot)[0],perimeter:d}}const a=W.WGS84,r=ji(e,a),o=ji(i,a);let n=Hr(o,$o);if(n=n?wa(n):null,!n)return null;const l=oi([r],$e)[0];return{area:Ba([n],Ot)[0],perimeter:l}}async function Wc(t,e,i,a,r=!1,o){if(e.length<2||!a||!i||!t)return null;const n=Ki(i,t);if(!n)return null;const l=e.map(p=>[p.x,p.y]),d=l.at(0),h=l.at(-1);if(!d||!h)return null;const u=n.map(p=>zo([d,h],p,t,r,!1)),m=await Promise.all(u);P(o);let g=0;for(const p of m){if(!p)return null;const y=Math.abs(p-a);g=Math.max(y,g)}return g}async function Uc(t,e,i,a,r,o=!1,n){if(e.length<2||!a||!i||!t)throw new Error("Missing parameters");const l=ea(i,t),d=e.map(y=>[y.x,y.y]),h=d.at(0),u=d.at(-1),m=l.map(y=>Ho([h,u],y,t,r,o,!1)),g=await Promise.all(m);P(n);let p=0;for(const y of g){if(!y)return 0;const f=Math.abs(y-a);p=Math.max(f,p)}return p}function Zc(t,e,i=1){const a=Ge(t,!1);if(a?.length)return 20*Ie([a[0].x,a[0].y],[a.at(-1).x,a.at(-1).y])*i/e}async function So(t){await ya();const e=t.spatialReference;if(e.isGeographic){if(Dr(e))return oi([t],$e)[0];const i=ji(t,W.WGS84);return oi([i],$e)[0]}return e.isWebMercator?ai(t,{unit:$e}):ri(t,{unit:$e})}function Qc(t){if(!t?.length)throw new Error("Invalid deviations array");const[e,i,a]=[0,1,2].map(r=>t.map(o=>o[r]).filter(o=>o!==null)).map(r=>r.length?mi(r):0);return[e,i,a]}function Aa(t,e){const i=wa(e);if(!i)return null;const a=ri(t,{unit:$e});return{area:os(i,{unit:Ot}),perimeter:a}}function dr(t,e){return[(t[1][0]-t[0][0])/e,(t[1][1]-t[0][1])/e,(t[1][2]-t[0][2])/e]}async function $a(t,e){await Promise.all([ns(),zr(),ya()]);let i=Hr(e,$o);if(i=i?wa(i):null,!i)return null;const a=ai(t,{unit:$e});return{area:ss(i,{unit:Ot}),perimeter:a}}async function Xc(t,e,i){if(!e||!t)throw new Error("Missing required parameters");const a=await yt(t,e);P(i);const r=a.clone();r.z?r.z+=20:r.z=20;const{averageElevation:o,cameraPitch:n,cameraRoll:l,farDistance:d,...h}=e;return De(r,h)}async function Jc(t,e,i,a){const{attributes:r}=i,{location:o}=r,{updateElevationProps:n,...l}=e;if(!t||!e)throw new Error("Missing parameters");let d=o.clone();d.spatialReference.isGeographic&&(d=await ae(d,W.WebMercator));const h=await wt(t,{...l,cameraLocation:d},n);P(a);const u=h.clone();return u.z?u.z+=20:u.z=20,vt(u,l)}function Ro(t,e,i,a,r=0,o=1,n){const{averageElevation:l,cameraPitch:d,cameraRoll:h,farDistance:u,...m}=a;if(r>=5||o<=.1)return{value:t*Dt(a.cameraLocation.spatialReference)};const g=new L({x:e.x,y:e.y,z:e.z?e.z+t:t,spatialReference:a.cameraLocation.spatialReference}),p=De(g,m),y=Ie([i[0].x,i[0].y],[p.x,p.y]),f=i.at(0),w=i.at(-1);if(!f||!w)return null;const _=Ie([f.x,f.y],[w.x,w.y])*t/y;return Ro(_,e,i,a,r+1,Math.abs(t-_))}function Oo(t,e,i,a,r=0,o=1,n){const{averageElevation:l,horizontalFieldOfView:d,verticalFieldOfView:h,farDistance:u,...m}=a;if(r>=5||o<=.1)return{value:t*Dt(a.cameraLocation.spatialReference)};const g=new L({x:e.x,y:e.y,z:e.z?e.z+t:t,spatialReference:a.cameraLocation.spatialReference}),p=vt(g,m),y=Ie([i[0].x,i[0].y],[p.x,p.y]),f=i.at(0),w=i.at(-1);if(!f||!w)return null;const _=Ie([f.x,f.y],[w.x,w.y])*t/y;return Oo(_,e,i,a,r+1,Math.abs(t-_))}async function ft(t,e,i){return t.spatialReference&&!e.spatialReference.equals(t.spatialReference)&&(e=await ae(e,t.spatialReference)),new xe({paths:[[[t.x,t.y,t.z??0],[e.x,e.y,e.z??0]]],spatialReference:i})}function Yc(t){return 1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*t/6378137)))}function Kc(t,e){return Math.sqrt((Math.sqrt((t[0][0]-t[1][0])**2+(t[0][1]-t[1][1])**2)/e)**2+(t[0][2]-t[1][2])**2)}function ed(t,e){return Math.sqrt((t[0][0]-t[1][0])**2+(t[0][1]-t[1][1])**2)/e}function td(t){return me(Math.atan((t[1][2]-t[0][2])/Math.sqrt((t[1][0]-t[0][0])**2+(t[1][1]-t[0][1])**2)))}function id(t){let e=90-me(Math.atan2(t[1][1]-t[0][1],t[1][0]-t[0][0]));return e<0&&(e+=360),e}function Sa(t,e){return new L({x:(t.pointOnA[0]+t.pointOnB[0])/2,y:(t.pointOnA[1]+t.pointOnB[1])/2,z:(t.pointOnA[2]+t.pointOnB[2])/2,spatialReference:e})}async function ad(t){if(t?.length===2){const e=[];let i=1;const[a,r]=t,o=a.camera.spatialReference,{measurePoints:n}=a;for(let l=0;l<n.length;l++){const d=await ft(a.camera,a.measurePoints[l],o),h=await ft(r.camera,r.measurePoints[l],o),u=await Ra(d,h);if(!u)return null;const m=Sa(u,o);m.spatialReference.isWebMercator&&(i=Yc(m.y)),e.push([m.x,m.y,m.z??0])}if(e?.length>1)return{distance:Kc(e,i),horizontalDistance:ed(e,i),verticalDistance:Math.abs(e[0][2]-e[1][2]),slope:td(e),aspect:id(e)}}return null}async function rd(t){const e=t[0].camera.spatialReference;if(t?.length!==2)return null;const[i,a]=t,{camera:r,measurePoints:o}=i,{camera:n,measurePoints:l}=a,d=await ft(r,o[0],e),h=await ft(n,l[0],e),u=await Ra(d,h);return u?Sa(u,e)??null:null}async function od(t,e){if(!t?.length)return null;const i=[],a=t[0],r=t[1],o=a.camera.spatialReference,{measurePoints:n}=a;for(let u=0;u<n.length;u++){const m=await ft(a.camera,a.measurePoints[u],o),g=await ft(r.camera,r.measurePoints[u],o),p=await Ra(m,g);if(!p)return null;const y=Sa(p,o);i.push([y.x,y.y,y.z??0])}if(i?.length<2)return null;const l=new xe({paths:[i],spatialReference:e}),d=new ue({rings:[i],spatialReference:e});return e.isGeographic?(await Ca(e,l,d))?.area??null:e.isWebMercator?(await $a(l,d))?.area??null:Aa(l,d)?.area??null}function ki(t,e){return t?{camera:e.geometry.clone(),measurePoints:Array.isArray(t)?t:[t]}:null}async function Lo(t,e){const{updateElevationProps:i,...a}=e;return await yt(t,a,i)}async function ko(t,e){const{updateElevationProps:i,...a}=e;return wt(t,a,i)}function nd(t){navigator.clipboard.writeText(t).catch(e=>{throw e})}function Eo(t){const e=t.map(a=>[a.x,a.y]),i=t[0].spatialReference;return new xe({paths:[e],spatialReference:i})}function Ge(t,e){return t.map(i=>({x:e?.5+i[0]:i[0],y:e?.5-i[1]:i[1]}))}function Gh(t,e,i,a,r){const o=t==="measurement"?e:i;if(r&&o)return Er(a,$r(o,$e),r,3)||null}function Ki(t,e){const{cameraPitch:i,cameraRoll:a,cameraLocation:r}=t,{x:o,y:n,z:l,spatialReference:d}=r;if(e.every(x=>x===0)||!e||!e.length)return null;const[h,u,,m,g]=e,p=[-m,0,m],y=[-g,0,g],f=[-h,0,h],w=[-u,0,u],_=[];for(const x of p)for(const b of y)for(const T of f)for(const I of f)for(const $ of w){const S={...t};S.cameraPitch=i+x,S.cameraRoll=a+b,S.cameraLocation=new L({x:o+T,y:n+I,z:l?l+$:0,spatialReference:{wkid:d.wkid}}),_.push(S)}return _}function ea(t,e){const{cameraHeading:i,cameraLocation:a}=t,{x:r,y:o,z:n,spatialReference:l}=a;if(e.every(f=>f===0)||!e||!e.length)throw new Error("Invalid parameters");const[d,h,u]=e,m=u>0?[-u,0,u]:[],g=d>0?[-d,0,d]:[],p=h>0?[-h,0,h]:[],y=[];for(const f of m)for(const w of g)for(const _ of g)for(const x of p){const b={...t};b.cameraHeading=i+f,b.cameraLocation=new L({x:r+w,y:o+_,z:n?n+x:0,spatialReference:{wkid:l.wkid}}),y.push(b)}return y}function Nh(t,e,i,a,r){const o=t==="measurement"?e:mi(i);if(r&&o)return Er(a,$r(o,$e),r,3)||null}function Bh(t,e,i,a,r){const o=t==="measurement"?e:i;if(r&&o)return rs(a,bn(o,Ot),r,3)||null}function mi(t){return Math.sqrt(t.reduce((e,i)=>e+i**2,0))}function hr(t,e,i){if(e==="default")return t;const a={x:t[0],y:t[1],z:t[2]},r=_e(a,i[0],i[1]);return[r.x,r.y]}function Dt(t){return t.metersPerUnit}function sd(t,e,i){let a=[];return a=e==="panoramic"?t.map(([r,o,n])=>{const{x:l,y:d}=_e({x:r,y:o,z:n},i[0],i[1]);return[l-.5,-.5-d]}):t.map(([r,o])=>[r-.5,-.5-o]),a}function jh(t,e){return t.map(i=>_e({x:i[0],y:i[1],z:i[2]},e[0],e[1]))}async function zo(t,e,i,a=!1,r=!1,o){if(!t||!e||t.length<2)return null;const n=Ge(t,a);if(!n||n.length<2)return null;const[l,d]=[n[0],n.at(-1)];if(!d)return null;const h=[l],u=await yt(l,e);P(o);const m=u.clone();m.z?m.z+=20:m.z=20;const{averageElevation:g,cameraPitch:p,cameraRoll:y,farDistance:f,...w}=e,_=De(m,w),x=Ie([l.x,l.y],[_.x,_.y]),b=Pa(l,_);if(!b)return;const T=Fa([l.x,l.y],[d.x,d.y],b);if(!T?.length)return;h.push({x:T[0],y:T[1]});const I=20*Ie([h[0].x,h[0].y],[h[1].x,h[1].y])*Dt(e.cameraLocation.spatialReference)/x;return r?Ro(I,u,h,e,0,1)?.value:I}async function Ho(t,e,i,a,r=!1,o=!1,n){const{attributes:l}=a,{location:d}=l,{updateElevationProps:h,...u}=e;if(!t||!e||t.length<2)throw new Error("Invalid parameters");const m=Ge(t,r),[g,p]=[m[0],m.at(-1)],y=[g];let f=d.clone();f.spatialReference.isGeographic&&(f=await ae(f,W.WebMercator));const w=await wt(g,{...u,cameraLocation:f},h);P(n);const _=w.clone();_.z?_.z+=20:_.z=20;const x=vt(_,u),b=Ie([g.x,g.y],[x.x,x.y]),T=Pa(g,x);if(!T)return;const I=Fa([g.x,g.y],[p.x,p.y],T);if(!I?.length)return;y.push({x:I[0],y:I[1]});const $=20*Ie([y[0].x,y[0].y],[y[1].x,y[1].y])*Dt(e.cameraLocation.spatialReference)/b;return o?Oo($,w,y,e,0,1)?.value:$}async function Ei(t,e,i=!1){if(t.length<3)return null;const a=Ge(t,i),r=await Lo(a,e),o=r.map(({x:h,y:u})=>[h,u]);t.push(t[0]),o.push(o[0]);const n=r[0].spatialReference,l=new xe({paths:[o],spatialReference:n}),d=new ue({rings:[o],spatialReference:n});return n.isGeographic?Ca(n,l,d):n.isWebMercator?$a(l,d):Aa(l,d)}async function zi(t,e,i=!1,a){if(t.length<3)return null;const r=Ge(t,i),o=await ko(r,e);P(a);const n=o.map(({x:u,y:m})=>[u,m]);t.push(t[0]),n.push(n[0]);const l=o[0].spatialReference,d=new xe({paths:[n],spatialReference:l}),h=new ue({rings:[n],spatialReference:l});return l.isGeographic?Ca(l,d,h):l.isWebMercator?$a(d,h):Aa(d,h)}async function Hi(t,e,i=!1){const a=Ge(t,i);return So(Eo(await Lo(a,e)))}async function Di(t,e,i=!1,a){const r=Ge(t,i),o=await ko(r,e);return P(a),So(Eo(o))}async function Ra(t,e){const i=Lt(),a=t.paths[0][0],r=e.paths[0][0];let o,n;t.spatialReference.isWGS84||t.spatialReference.isWebMercator?(await ya(),o=ai(t),n=ai(e)):(o=ri(t),n=ri(e));const l=dr(t.paths[0],o),d=dr(e.paths[0],n),h=ld(l,d),[u,m,g]=l,[p,y,f]=d.map(Oe=>-Oe),[w,_,x]=h,[b,T,I]=[r[0]-a[0],r[1]-a[1],r[2]-a[2]];Bt(i,u,p,w,m,y,_,g,f,x);const $=jt(i);if($===0)return null;Bt(i,b,p,w,T,y,_,I,f,x);const S=jt(i);Bt(i,u,b,w,m,T,_,g,I,x);const U=jt(i);Bt(i,u,p,b,m,y,T,g,f,I);const J=S/$,re=U/$,Re=jt(i)/$;return{distance:Math.abs(Re/Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])),pointOnA:ur(a,J,l),pointOnB:ur(r,re,d)}}function ld(t,e){const i=k(),a=Ha(k(),t[0],t[1],t[2]),r=Ha(k(),e[0],e[1],e[2]),o=Mn(i,a,r);return[o[0],o[1],o[2]]}function ur(t,e,i){return[t[0]+e*i[0],t[1]+e*i[1],t[2]+e*i[2]]}function cd(t){if(!t)throw new Error("Missing View");return t.ui.remove("zoom"),t.on(["key-down","mouse-wheel","double-click","drag"],e=>{e.stopPropagation()})}const mr={click:"click-handle",enhancements:"enhancements-handle"};let j=class extends la{constructor(t){super(t),this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new qe({blendMode:"source-atop"}),this._map=new ca,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.navigationManager=null,this.navigationViewModel=null,this.state="ready",this.updatingHandles=new wi,this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(mr.enhancements),this.addHandles(R(()=>[this.brightness,this.contrast,this.sharpness],([e,i,a])=>{this.image?.loaded&&(this.image.effect=`contrast(${10*(i+10)}%) brightness(${10*(e+10)}%)`,this.sharpenImage(this.image,a))},E))},this._createPanConstraint=()=>{const{image:e,imageRenderer:i}=this,a=r=>{if(!(e&&i&&r.targetGeometry&&e.serviceRasterInfo))return r;const{extent:o}=e.serviceRasterInfo,{constraints:n,rotation:l,width:d,height:h}=i,{extent:u}=Ii(ue.fromExtent(o),l,o.center.x,o.center.y),{width:m,height:g}=u,p=r.targetGeometry.clone(),y=n.scaleToZoom(r.scale),f=1/2**y,w=d/h;let _=f*m,x=f*g;y&&(m/d>g/h?x=_/w:_=x*w);const b=u.clone();return b.xmin+=_/2,b.xmax-=_/2,b.ymin+=x/2,b.ymax-=x/2,r.targetGeometry=cs(ue.fromExtent(b),p).coordinate,this.state="image-loaded",r};return{constrain:a,applyPanConstraint:a}},this._createResizeHandles=e=>{e.removeHandles("resize"),e.addHandles(R(()=>{if(!this.imageRenderer.ready)return;const{extent:i}=e.serviceRasterInfo,{width:a,height:r,rotation:o}=this.imageRenderer,{extent:n}=Ii(ue.fromExtent(i),o,i.center.x,i.center.y),{width:l,height:d}=n;return Math.max(l/a,d/r)},i=>{if(!this.imageRenderer||i==null)return;const{constraints:a,scale:r,spatialReference:o}=this.imageRenderer,n=a.minScale,l=hs(o),d=.25*l,h=l*i;let u=h;const m=[];for(;u>d;)m.push(u),u/=2;m.push(u);const{lods:g}=pr.create({scales:m});if(a.set({minScale:h,lods:g}),this._imageChanged)return this.imageRenderer.scale=h,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(r-n)<=1e-6?h:r},E),"resize")},this._loadImageInternal=(e,i={})=>{this.state="image-loading",this.clearImage(),this.error=null,this._imageChanged=!0;const a=typeof e=="string",r=a?void 0:e.datasetFormat,o=a?e:e.url,{customParameters:n,options:l}=i;return this._image=new ds({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:r},url:o,customParameters:n}),this._image.when(d=>{this._updatePanConstraint(),this._createResizeHandles(d),this._map.add(d),this.state="image-loaded"},d=>{te(d)?this.state="image-load-aborted":(this.state="image-load-error",this.error=d,O.getLogger(this).error(`error occurred while loading image ${a?e:JSON.stringify(e)}`,d),this.imageSource=null)}),this._image.load(l)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._loadNavigationManager=async()=>{if(!this.navigationManager||this.navigationManager?.destroyed){const e=await A(()=>import("./NavigationManager-DCtRigBR.js"),__vite__mapDeps([179,0,1,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])).then(i=>i.default);this.navigationManager=new e({viewModel:this.navigationViewModel})}return this.navigationManager},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(e,i)=>{this._overlays.graphics.add(e,i)},this.addManyGraphics=e=>{this._overlays.addMany(e)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=ce(this._image))},this.loadImage=e=>{const{customParameters:i,imageSource:a}=this;return a?this._loadImageInternal(a,{customParameters:i,options:e}):Rt(this.declaredClass,new N(Ma("image-viewer"),ba("ImageViewerViewModel","imageSource")))},this.navigate=async(e,i)=>this.updatingHandles.addPromise(this.navigateInternal(e,i)),this.navigateInternal=async(e,i)=>await(await this._loadNavigationManager()).navigate(e,i),this.removeGraphic=e=>{this._overlays.remove(e)},this.removeManyGraphics=e=>{this._overlays.removeMany(e)},this._imageRenderer=new va({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:W.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([R(()=>this.imageSource,t=>{t&&this.autoLoad&&this._loadWithController()},E),R(()=>this.image?.loaded,()=>{this._createImageHandles()}),R(()=>this.imageRotation,()=>{this._rotateImage()}),R(()=>this.imageRenderer.map,(t,e)=>{e?.layers.remove(this._overlays),t?.layers.add(this._overlays)},ht),R(()=>this.imageRenderer.map.allLayers.length,t=>{t&&this.imageRenderer.map.layers.reorder(this._overlays,t-1)},E),R(()=>this.clickAction,t=>{this.removeHandles(mr.click),t!=="none"&&this.addHandles(this.imageRenderer.on("click",e=>{if(this.image?.loaded&&this.imageRenderer.ready)switch(t){case"emit":e.stopPropagation(),this.emit("click",e);break;case"hittest":e.stopPropagation(),e.defer(async()=>{const i=await this.imageRenderer.hitTest(e.screenPoint,{include:this._overlays});i.results=i.results.filter(a=>a.type==="graphic"),this.emit("hittest-response",i)});break;case"pixel-location":{if(e.stopPropagation(),!this.image?.serviceRasterInfo||!e.mapPoint)return void this.emit("pixel-location",null);const{extent:i,pixelSize:a}=this.image.serviceRasterInfo,r=(e.mapPoint.x-i.xmin)*a.x,o=(i.ymax-e.mapPoint.y)*a.y,n=new L({x:r,y:o,spatialReference:i.spatialReference});this.emit("pixel-location",n);break}}}))},E)])}get brightness(){return this._get("brightness")??0}set brightness(t){this._set("brightness",Ye(t,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(t){this._set("contrast",Ye(t,-10,10))}get currentNode(){return this.navigationViewModel?.currentNode}get image(){return this._image}get imagePointsInView(){const{extent:t,ready:e}=this.imageRenderer,i=this.imageRotation,a=this.image?.fullExtent,r=this.image?.serviceRasterInfo,o=this._imageRenderer.allLayerViews.find(({layer:u})=>u===this.image)?.attached===!0;if(!(e&&t&&a&&r&&o))return null;const n=Ii(ue.fromExtent(t),i,t.center.x,t.center.y),l=ue.fromExtent(a),d=ls(n,l),{rings:h}=d;return h.flat().map(([u,m])=>({x:(u-r.extent.xmin)*r.pixelSize.x,y:(r.extent.ymax-m)*r.pixelSize.y}))}get imageSize(){const{image:t}=this;if(!t?.raster)return null;const{width:e,height:i}=t.raster.rasterInfo;return[e,i]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find(t=>t.layer===this.image)}get sharpness(){return this._get("sharpness")??0}set sharpness(t){this._set("sharpness",Ye(t,0,1))}get updating(){return this.updatingHandles.updating}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(t,e){if(!e)return void(t.rasterFunction=null);const i=[0,-1*e,0,-1*e,4*e+1,-1*e,0,-1*e,0],a=new Lr({functionName:"Convolution",functionArguments:{type:ja.userDefined,cols:3,rows:3,kernel:i,convolutionType:ja.userDefined}});t.rasterFunction=a}};s([c()],j.prototype,"_image",void 0),s([c()],j.prototype,"_imageRenderer",void 0),s([c()],j.prototype,"_loadController",void 0),s([c()],j.prototype,"_overlays",void 0),s([c()],j.prototype,"_map",void 0),s([c({type:Boolean})],j.prototype,"autoLoad",void 0),s([c({type:Number})],j.prototype,"brightness",null),s([c()],j.prototype,"clickAction",void 0),s([c({type:Number})],j.prototype,"contrast",null),s([c()],j.prototype,"currentNode",null),s([c({type:Object})],j.prototype,"customParameters",void 0),s([c({type:N})],j.prototype,"error",void 0),s([c({readOnly:!0})],j.prototype,"image",null),s([c({readOnly:!0})],j.prototype,"imagePointsInView",null),s([c({readOnly:!0})],j.prototype,"imageSize",null),s([c({cast:Ts})],j.prototype,"imageSource",void 0),s([c({readOnly:!0})],j.prototype,"imageRenderer",null),s([c({type:Number})],j.prototype,"imageRotation",void 0),s([c()],j.prototype,"imageView",null),s([c()],j.prototype,"navigationManager",void 0),s([c()],j.prototype,"navigationViewModel",void 0),s([c({type:Number})],j.prototype,"sharpness",null),s([c()],j.prototype,"state",void 0),s([c()],j.prototype,"updatingHandles",void 0),s([c()],j.prototype,"updating",null),j=s([ie("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],j);const Do=j;let st=class extends ro{constructor(e){super(e),this.cameraHeadingThreshold=0,this.cameraPitchThreshold=0,this.preserveAngle="none"}initialize(){this.addHandles(R(()=>({nodes:this.nodes,currenNode:this.currentNode,length:this.nodes.length,currentHeading:this.currentNode?.currentHeading,currentPitch:this.currentNode?.currentPitch,preserveAngle:this.preserveAngle,cameraHeadingThreshold:this.cameraHeadingThreshold,cameraPitchThreshold:this.cameraPitchThreshold}),()=>{this._compileTask?.abort(),this._compileTask=oe(async e=>{P(e),this.compile()})},E))}compile(){const{currentNode:e,nodes:i}=this;if(e)if(i.length)switch(this.preserveAngle){case"heading":return Ai(e,i,this.cameraHeadingThreshold,null);case"pitch":return Ai(e,i,null,this.cameraPitchThreshold);case"both":return Ai(e,i,this.cameraHeadingThreshold,this.cameraPitchThreshold);default:return ao(e,i)}else e.reset()}};s([c()],st.prototype,"cameraHeadingThreshold",void 0),s([c()],st.prototype,"cameraPitchThreshold",void 0),s([c()],st.prototype,"preserveAngle",void 0),st=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationUIViewModel")],st);const dd=st;let Xe=class extends oo{constructor(e){super(e),this.viewModel=new dd}set cameraHeadingThreshold(e){this.viewModel.cameraHeadingThreshold=e}get cameraHeadingThreshold(){return this.viewModel.cameraHeadingThreshold}set cameraPitchThreshold(e){this.viewModel.cameraPitchThreshold=e}get cameraPitchThreshold(){return this.viewModel.cameraPitchThreshold}set preserveAngle(e){this.viewModel.preserveAngle=e}get preserveAngle(){return this.viewModel.preserveAngle}};s([c()],Xe.prototype,"cameraHeadingThreshold",null),s([c()],Xe.prototype,"cameraPitchThreshold",null),s([c()],Xe.prototype,"preserveAngle",null),s([c()],Xe.prototype,"viewModel",void 0),Xe=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationUI")],Xe);const hd=Xe,ud="esri-image-viewer";var dt;let q=(dt=class extends tt{constructor(){super(...arguments),this.directionMode="Relative",this.navigationEnabled=!1,this.uiStrings=null,this.viewModel=new Do,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,i)=>{this.viewModel.addGraphic(e,i)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.navigate=async(e,i)=>await this.viewModel.navigate(e,i),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}loadDependencies(){return Promise.all([Te({panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MZ),__vite__mapDeps([0,1]))}),no()])}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get currentNode(){return this.navigationViewModel?.currentNode}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){const e=this.viewModel.image?.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get navigationNodes(){return this.navigationViewModel?.navigationNodes}get navigationMode(){return this.navigationViewModel?.navigationMode}get navigationViewModel(){return this.viewModel.navigationViewModel}set navigationViewModel(e){this.viewModel.navigationViewModel=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}get ui(){return this.imageRenderer.ui}get _navigationUI(){return v(hd,{cameraHeadingThreshold:this.navigationViewModel?.cameraHeadingThreshold,cameraPitchThreshold:this.navigationViewModel?.cameraPitchThreshold,currentBestFeature:this.navigationViewModel?.currentBestFeature,currentNode:this.currentNode,directionMode:this.directionMode,navigate:this.navigate,nodes:this.navigationNodes,preserveAngle:this.navigationViewModel?.preserveAngle??"none"})}get _sequentialNavigationUI(){return v(so,{layout:"horizontal",uiStrings:this.uiStrings,onAction:e=>{this.navigate(this.currentNode,e)}})}_renderNavigationUI(){switch(this.navigationMode){case"directional":return this._navigationUI;case"sequential":return this._sequentialNavigationUI;default:return null}}render(){return v("calcite-panel",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(We.widget,ud),loading:this.viewModel.updating},this.navigationEnabled?this._renderNavigationUI():null)}},dt.vnodeSelector="calcite-panel",dt);s([c({type:Boolean})],q.prototype,"autoLoad",null),s([c({type:Number}),c()],q.prototype,"brightness",null),s([c()],q.prototype,"clickAction",null),s([c({type:Number})],q.prototype,"contrast",null),s([c()],q.prototype,"currentNode",null),s([c({type:Object})],q.prototype,"customParameters",null),s([c()],q.prototype,"directionMode",void 0),s([c({readOnly:!0})],q.prototype,"error",null),s([c()],q.prototype,"imageSize",null),s([c({readOnly:!0})],q.prototype,"imagePointsInView",null),s([c({readOnly:!0,type:va})],q.prototype,"imageRenderer",null),s([c()],q.prototype,"imageRotation",null),s([c()],q.prototype,"imageSource",null),s([c({type:Boolean})],q.prototype,"navigationEnabled",void 0),s([c()],q.prototype,"navigationNodes",null),s([c()],q.prototype,"navigationMode",null),s([c()],q.prototype,"navigationViewModel",null),s([c({type:Number})],q.prototype,"sharpness",null),s([c({readOnly:!0})],q.prototype,"state",null),s([c()],q.prototype,"ui",null),s([c()],q.prototype,"uiStrings",void 0),s([St(["click","hittest-response","pixel-location"]),c({type:Do})],q.prototype,"viewModel",void 0),s([c()],q.prototype,"_navigationUI",null),s([c()],q.prototype,"_sequentialNavigationUI",null),q=s([ie("esri.widgets.OrientedImageryViewer.components.ImageViewer")],q);const pi=q,md=["right","towards","left","backwards"];let pe=class extends bt{constructor(e){super(e),this.attributes=null,this.backwards=null,this.geometry=null,this.left=null,this.right=null,this.towards=null}get currentHeading(){return this._get("currentHeading")??0}set currentHeading(e){const i=ye(e);this._set("currentHeading",i)}get currentPitch(){return this._get("currentPitch")??0}set currentPitch(e){const i=ye(e);this._set("currentPitch",i)}get heading(){return this.attributes.cameraHeading}get id(){return this.attributes.objectId}get pitch(){return this.attributes.cameraPitch}get roll(){return this.attributes.cameraRoll??0}getDistanceTo(e){return this.geometry.distance(e.geometry)}getDirectionTo(e){if(!e)return null;const{geometry:{x:i,y:a},currentHeading:r}=this,{geometry:{x:o,y:n}}=e,l=wl(i,a,o,n),d=ye(l+r),h=Math.floor((d+45)/90)%4;return md[h]}reset(){this.towards=null,this.backwards=null,this.left=null,this.right=null}};s([c()],pe.prototype,"attributes",void 0),s([c()],pe.prototype,"backwards",void 0),s([c()],pe.prototype,"currentHeading",null),s([c()],pe.prototype,"currentPitch",null),s([c({type:L})],pe.prototype,"geometry",void 0),s([c({readOnly:!0})],pe.prototype,"heading",null),s([c({readOnly:!0})],pe.prototype,"id",null),s([c()],pe.prototype,"left",void 0),s([c({readOnly:!0})],pe.prototype,"pitch",null),s([c()],pe.prototype,"right",void 0),s([c({readOnly:!0})],pe.prototype,"roll",null),s([c()],pe.prototype,"towards",void 0),pe=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationNode")],pe);const pd=pe;let Me=class extends bt{constructor(e){super(e),this.closestFeature=null,this.currentTime=0,this.videoBrightness=1,this.videoContrast=1,this.videoDuration=void 0,this.videoPaused=null,this.videoMuted=null,this.enableAudio=()=>{const{videoElement:i}=this.oiViewModel;i?.content&&(i.content.muted=!1,this.videoMuted=!1)},this.playVideoHandler=()=>{const i=this.oiViewModel.videoElement?.content;i&&(i.paused?i.play().catch(a=>{O.getLogger(this).error("error playing video",a)}):i.pause())},this.rewindVideoHandler=()=>{const i=this.oiViewModel.videoElement?.content;i&&(i.currentTime=0,i.play().catch(a=>{O.getLogger(this).error("error playing video",a)}))},this.resetVideoHandler=()=>{const{videoElement:i,videoMapView:a,videoLayer:r}=this.oiViewModel;i?.content&&r&&a&&(i.content.pause(),a.map.layers.remove(r),r.destroy(),this.oiViewModel.videoElement=null)},this.resetVideoEnhancementTools=()=>{this.oiViewModel?.videoLayer&&(this.videoBrightness=1,this.videoContrast=1,this.oiViewModel.videoLayer.effect=`brightness(${this.videoBrightness}) contrast(${this.videoContrast})`)},this.toggleAudio=()=>{const{videoElement:i}=this.oiViewModel;if(i?.content){const a=i.content.muted;i.content.muted=!a,this.videoMuted=!a}}}initialize(){this.addHandles([R(()=>this.oiViewModel.videoElement?.content,e=>{if(e instanceof HTMLVideoElement){this._startVideo();const i=async()=>{this.currentTime=Number(e.currentTime.toFixed(2)),e.currentTime&&await this._updateVidFootprint(e.currentTime)};e.addEventListener("timeupdate",i),e.addEventListener("play",()=>this._updateVideoIcon(e.paused)),e.addEventListener("pause",()=>this._pauseVideoHandler(e))}},E),R(()=>this.oiViewModel.layer,(e,i)=>{i&&e&&e.uid!==i.uid&&this.oiViewModel.resetVideo()},E)])}destroy(){this.resetVideoHandler()}_pauseVideoHandler(e){this._updateVideoIcon(e.paused)}_setVideoDuration(){const{videoElement:e}=this.oiViewModel;e?.content&&(this.videoDuration=e.content.duration)}_startVideo(){try{this.enableAudio(),this._setVideoDuration();const e=this.oiViewModel.currentBestFeature;e&&this.playVideoFromSelectedLocation(e)}catch(e){O.getLogger(this).error("oriented-imagery-viewer:video-load",e)}}async _updateVideoFootprintWithGivenFeature(e,i,a){const{activeViewer:r,mode:o,footprintExtent:n}=this.oiViewModel;if(i&&(o==="video"?Gr:r?.imageSize)&&n)try{await this.oiViewModel.updateFootprint(e,i,a),P(a)}catch(l){te(l)||O.getLogger(this).error("update-footprint",l)}else this.oiViewModel.updateCurrentCoveragePolygon(null)}async _updateVidFootprint(e){const i=this.oiViewModel.featureCache.find(a=>a.attributes.offsetFromStart===Math.floor(e));i?.attributes.offsetFromStart&&this.closestFeature!==i&&(this.closestFeature=i,await this._updateVideoFootprintWithGivenFeature(Nr,i))}_updateVideoIcon(e){this.videoPaused=!!e}handleVideoBrightnessChange(e){this.oiViewModel?.videoLayer&&(this.videoBrightness=e??0,this.oiViewModel.videoLayer.effect=`brightness(${this.videoBrightness}) contrast(${this.videoContrast})`)}handleVideoContrastChange(e){this.oiViewModel?.videoLayer&&(this.videoContrast=e??0,this.oiViewModel.videoLayer.effect=`brightness(${this.videoBrightness}) contrast(${this.videoContrast})`)}playVideoFromSelectedLocation(e){const i=e.attributes.offsetFromStart;if(i){const a=this.oiViewModel.videoElement?.content;a&&(a.currentTime=i,a.play().catch(r=>{O.getLogger(this).error("error playing video",r)}))}}};s([c()],Me.prototype,"closestFeature",void 0),s([c()],Me.prototype,"currentTime",void 0),s([c()],Me.prototype,"oiViewModel",void 0),s([c({type:Number})],Me.prototype,"videoBrightness",void 0),s([c({type:Number})],Me.prototype,"videoContrast",void 0),s([c()],Me.prototype,"videoDuration",void 0),s([c()],Me.prototype,"videoPaused",void 0),s([c()],Me.prototype,"videoMuted",void 0),Me=s([ie("esri.widgets.OrientedImageryViewer.components.OrientedImageryVideoViewModel")],Me);const gd=Me;let Qh=class extends N{constructor(e){super("InvalidDirectionError",`cannot navigate in direction: ${e}`)}},Jh=class extends N{constructor(e){super("FeatureSectorNotFoundError",`cannot find feature sector of node: ${e}`)}};class vd extends N{constructor(){super("NoActiveViewerError","no active viewer")}}let yd=class extends N{constructor(){super("NoImageLoadedError","no image loaded")}},wd=class extends N{constructor(e){super("NoFeatureFoundWithObjectIdError",`no feature found with objectId: ${e}`)}};async function tu(t,e,i,a){const{polygon:r}=Ft(e.attributes),o=L.fromJSON(da(r));o.z=void 0;const n=It(t.definitionExpression,i);let l,d;try{l=await di({layerInstanceOrURL:t,point:o,queryParams:{where:n}},a)}catch(h){d=h}return new Go(o,l,d)}async function iu(t,e,i,a){const r=t.sequenceOrderField??"SequenceOrder",o=It(t.definitionExpression,i,`${r} IS NOT NULL`);let n,l;try{n=await di({layerInstanceOrURL:t,point:e,queryParams:{where:o,orderByFields:[`${r}`],returnGeometry:!0,outFields:["*"]}},a)}catch(d){l=d}return new Go(e,n,l)}function au(t,e,i){const a=t.sequenceOrderField,r=It(t.definitionExpression,e,`${a} IS NOT NULL`);return t.queryFeatureCount({where:r},i)}async function ru(t,e,i,a="ASC",r,o){const n=t.sequenceOrderField??"SequenceOrder";let l=It(t.definitionExpression,r,`${n} IS NOT NULL`);const d=typeof e=="number"?e-1:void 0;e==="string"&&(l=Ee(l,`${n} = ${e}`));try{const h=await t.queryFeatures({where:l,returnGeometry:!0,orderByFields:[`${n} ${a}`],outFields:["*"],start:d,num:i},o);return await Oa(h,t),new _t(h)}catch(h){return new _t(void 0,h)}}async function ou(t,e,i=0,a=1,r,o){const n=t.sequenceOrderField??"SequenceOrder",l=Md(n,i),d=It(t.definitionExpression,r,_d(i,e,n));try{const h=await t.queryFeatures({where:d,orderByFields:l,num:a,outFields:["*"],returnGeometry:!0},o);return await Oa(h,t),new _t(h)}catch(h){return new _t(void 0,h)}}async function fd(t,e,i,a){const r=Array.isArray(e)?e:[e],o=It(t.definitionExpression,i,`${t.objectIdField} IN (${r.join(",")})`);try{const n=await t.queryFeatures({where:o,outFields:["*"],returnGeometry:!0},a);return await Oa(n,t),new _t(n)}catch(n){return new _t(void 0,n)}}class _t{constructor(e,i){this.response=e,this.error=i}}class Go{constructor(e,i,a){this.nextLocation=e,this.response=i,this.error=a}}function _d(t,e,i){return t>0?`${i} IS NOT NULL AND ${i} > ${e}`:`${i} IS NOT NULL AND ${i} < ${e}`}function Md(t,e){return e>0?[`${t}`]:[`${t} DESC`]}async function Oa(t,e){const i=await A(()=>Promise.resolve().then(()=>El),void 0).then(a=>a.default);t.features.forEach(a=>{const r=i.fromJSON({...a.toJSON(),layer:e});r&&(a.attributes=r)})}function It(...t){let e="1=1";return t.forEach(i=>{e=Ee(e,i)}),e}class bd{constructor(e){this._viewModel=e}async computeHeight(e,i,a=!0){const{currentBestFeature:r,activeViewer:o,layer:n,footprintExtent:l}=this._viewModel,d=o?.imageSize,h=r?.attributes,u=n?.orientationAccuracy;if(!h||!d||!e||e.length<2||!u)return;const m=i==="panoramic"?await this._viewModel.getMeasurementPropertiesPanoramic():li(h,d[0],d[1]),g=e.at(0),p=e.at(-1);if(!(m&&g&&p&&u&&l))return;const y=[p,g],f=Ge(y,!1),w=i==="panoramic"?await Ho(y,m,u,r,!0,!1):await zo(y,m,u,!0,a);if(!w)return;const _=i==="panoramic"?await Uc(u,f,m,w,r,!0):await Wc(u,f,m,w,!0);return _?{value:w,accuracy:_}:{value:w}}async calculateAreaMeasurement(e,i,a){if(e.length<3||!this._viewModel.currentBestFeature||!this._viewModel.activeViewer?.imageSize||this._viewModel.mode==="none")return null;const r=i==="default"?await this._viewModel.getMeasurementProperties():await this._viewModel.getMeasurementPropertiesPanoramic();return P(a),r?i==="default"?await Ei(e,r,!0):await zi(e,r,!0,a):null}async calculateDistanceMeasurement(e,i,a){const{currentBestFeature:r,activeViewer:o}=this._viewModel;if(e.length<2||!r||!o?.imageSize||i==="none")return null;const n=i==="default"?await this._viewModel.getMeasurementProperties():await this._viewModel.getMeasurementPropertiesPanoramic();return P(a),n?i==="default"?await Hi([e.at(0),e.at(-1)],n,!0):await Di([e.at(0),e.at(-1)],n,!0):null}async calculateAccuracy(e,i,a){const{layer:r,currentBestFeature:o,activeViewer:n,currentBestFeatureMeasurementImage:l,triangularMeasurementActive:d,imageMeasurementViewer:h}=this._viewModel,u=r?.orientationAccuracy,m=u?.every(T=>T===0)||!u?.length;if(i==="area"&&e.length<3||i==="distance"&&e.length<2||!o||!n?.imageSize||m)return null;let g=null;if(d&&l&&h?g=await this._viewModel.getMeasurementProperties(l,h):(g=await this._viewModel.getMeasurementProperties(),P(a)),!g)return null;const p=i==="area"?await Ei(e,g,!0):await Hi([e.at(0),e.at(-1)],g,!0);P(a);const{updateElevationProps:y,...f}=g,w=Ki(f,u);if(!w?.length)return null;const _=w.map(T=>({...T,updateElevationProps:y})).map(async T=>{const I=i==="area"?await Ei(e,T,!0):await Hi([e.at(0),e.at(-1)],T,!0);if(P(a),I&&p){if(i==="area"){const $=typeof I!="number"?I.area:null;return $?Math.abs($-p.area):null}return Math.abs(I-p)}return null}),x=await Promise.all(_);P(a);const b=x.filter(T=>T!==null);return b.length===0?null:mi(b)}async calculateLocationAccuracy(e,i,a="default",r){const{layer:o,currentBestFeature:n}=this._viewModel,l=o?.orientationAccuracy,d=this._viewModel.view?.spatialReference,h=l?.every(T=>T===0)||!l?.length;if(!n||h)return null;const u=a==="default"?await this._viewModel.getMeasurementProperties():await this._viewModel.getMeasurementPropertiesPanoramic();if(P(r),!u)return null;const{updateElevationProps:m,...g}=u,p=a==="default"?Ki(g,l):ea(g,l);if(!p?.length)return null;const y=p.map(T=>({...T,updateElevationProps:m})).map(async T=>{const{updateElevationProps:I,...$}=T;let S=a==="default"?await yt(e,$,I):await wt(e,$,I);return P(r),d&&!S.spatialReference.equals(d)&&(S=await ae(S,d),P(r)),S&&i?[Math.abs(S.x-i.x),Math.abs(S.y-i.y),S.z&&i.z?Math.abs(S.z-i.z):0]:null}),f=await Promise.all(y);if(P(r),!f?.length)return null;const w=f.map(T=>[T?.[0]??0,T?.[1]??0,T?.[2]??0]),[_,x,b]=Qc(w);return{x:_,y:x,z:b}}async calculateAccuracyPanoramic(e,i,a=!1,r){const{layer:o,currentBestFeature:n,activeViewer:l,mode:d,currentBestFeatureMeasurementImage:h,activeTriangulatedViewer:u}=this._viewModel,m=o?.orientationAccuracy,g=m?.every(I=>I===0)||!m?.length;if(i==="area"&&e.length<3||i==="distance"&&e.length<2||!n||!l?.imageSize||g||d!=="panoramic")return null;const p=a&&h&&u?await this._viewModel.getMeasurementPropertiesPanoramic(h,u):await this._viewModel.getMeasurementPropertiesPanoramic();if(P(r),!p)return null;const y=i==="area"?await zi(e,p,!0):await Di([e.at(0),e.at(-1)],p,!0);P(r);const{updateElevationProps:f,...w}=p,_=ea(w,m);if(!_?.length)return null;const x=_.map(I=>({...I,updateElevationProps:f})).map(async I=>{const $=i==="area"?await zi(e,I,!0):await Di([e.at(0),e.at(-1)],I,!0);if(P(r),$&&y){if(i==="area"){const S=typeof $!="number"?$.area:null;return S?Math.abs(S-y.area):null}return Math.abs($-y)}return null}),b=await Promise.all(x);P(r);const T=b.filter(I=>I!==null);return T.length===0?null:mi(T)}async calculateHeightMeasurementInfo(e,i,a){const{currentBestFeature:r,activeViewer:o}=this._viewModel,n=o?.imageSize;if(!r||!o||!n?.length||i==="none")return;const{attributes:l}=r,[d]=Ge([e],i!=="panoramic"),h=i==="panoramic"?await this._viewModel.getMeasurementPropertiesPanoramic():li(l,n[0],n[1]);if(i==="panoramic"){if(!h)return;const p=await Jc(d,h,r,a);if(!p)return;p?.heading>180&&(p.heading-=360);const y=qc(d,p),f=Ie([d.x,d.y],[p.x,p.y]);return!y||!f?void 0:{measurementAngle:y,tempDistance:f}}const u=await Xc(d,h,a);if(!u)return;const m=Pa(d,u),g=Ie([d.x,d.y],[u.x,u.y]);return m&&g?{measurementAngle:m,tempDistance:g}:void 0}async calculateTriangulatedMeasurements(e){if(!this._viewModel.activeTriangulatedViewer?.imageSize)return;const[i,a]=this._viewModel.activeTriangulatedViewer.imageSize;switch(this._viewModel.measureType){case"distance":{this._viewModel.triangulatedDistanceMeasurement=await ad(this._viewModel.measurementVectors);const r=e.map(([n,l,d])=>_e({x:n,y:l,z:d},i,a)).map(({x:n,y:l})=>[n,l]),o=this._viewModel.mode==="default"?await this.calculateAccuracy(e,"distance"):await this.calculateAccuracyPanoramic(r,"distance",!0);if(o&&this._viewModel.triangulatedDistanceMeasurement?.distance){const n=Math.atan(o/this._viewModel.triangulatedDistanceMeasurement.distance);this._viewModel.triangulatedDistanceAccuracy={distanceAccuracy:o,angleAccuracy:n}}break}case"area":if(this._viewModel.currentBestFeatureMeasurementImage?.geometry.spatialReference){if(this._viewModel.triangulatedAreaMeasurement=await od(this._viewModel.measurementVectors,this._viewModel.currentBestFeatureMeasurementImage.geometry.spatialReference),this._viewModel.mode==="default")this._viewModel.triangulatedAreaAccuracy=await this.calculateAccuracy(e,"area")??this._viewModel.triangulatedAreaAccuracy;else if(this._viewModel.mode==="panoramic"){const r=e.map(([o,n,l])=>_e({x:o,y:n,z:l},i,a)).map(({x:o,y:n})=>[o,n]);this._viewModel.triangulatedAreaAccuracy=await this.calculateAccuracyPanoramic(r,"area",!0)??this._viewModel.triangulatedAreaAccuracy}}}this._viewModel.mode==="panoramic"&&this._viewModel.activeTriangulatedViewer.viewModel.restoreNavigationHandles()}}const K={click:"view-click",imageClick:"image-click",triangularImageClick:"triangular-click",interactionHandles:"interaction-handles",hittestHandles:"hittest-handles",videoPlayerHandles:"video-handles",activeViewerCursorHandles:"active-viewer-cursor-handles",imageViewerCursorHandles:"image-viewer-cursor-handles"},xd=new Set(["JPG","JPEG","TIFF","TIF","MRF"]),Id=new Set(["MRF","TIFF","TIF"]),Td=/\.(\w+)$/,Ze=()=>new N("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let M=class extends xn(In){constructor(t){super(t),this.additionalFeatures=new D,this.additionalCameraLocations=new D,this.additionalFootprints=new D,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.cameraHeadingThreshold=Ua,this.cameraPitchThreshold=Ua,this.clickAction="hittest",this.videoViewModel=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new D,this.coveragePolygons=new D,this.currentBestFeature=null,this.currentBestFeatureMeasurementImage=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.depthImage=null,this.directionMode="Relative",this.featureCache=[],this.navigationNodes=new D,this.determineWorkflowForFeature=async(e,i,a)=>{const{currentBestFeature:r,selectedPoint:o,view:n}=this;if(n?.closePopup(),r&&o){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(a),await this._loadDepthImage(a),await this._loadImage(a)}catch(l){te(l)||(this.loadImageError(l),O.getLogger(this).error("#loadIImage()","error occured while loading image",l))}}},this.determineWorkflowForTriangularMeasurement=async(e,i,a)=>{if(this.view?.closePopup(),this.currentBestFeatureMeasurementImage&&this.selectedPoint)try{await this._loadMeasurementViewerImage(a)}catch(r){te(r)||(this.loadImageError(r),O.getLogger(this).error("#loadIImage()","error occured while loading image",r))}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new D,this.groundCoordinates=null,this.groundCoordinatesAccuracy=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.imageMeasurementViewer=new pi,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.measurementVectors=[],this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new D,this.overlayedMapFeatures=new Tn,this.pixelCoordinates=null,this.preserveAngle="none",this.pointSources=new D,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.sketchTriangular=null,this.sketchTriangularGraphicsLayer=null,this.draw=null,this.sketchAdapter=null,this.triangularMeasurementActive=!1,this.triangulatedDistanceMeasurement=null,this.triangulatedDistanceAccuracy=null,this.triangulatedAreaMeasurement=null,this.triangulatedAreaAccuracy=0,this.triangulatedMeasurementGraphic=null,this.triangulatedPoint=null,this.triangulatedMeasurementAdapter=null,this.updateFootprint=async(e,i,a)=>{this.mode==="default"&&this.state!=="image-loaded"||this.mode.includes("video")&&!this.videoElement?.content||await this._adapter?.updateFootprint(e,i,a)},this.updateFootprintPanorama=async(e,i)=>{await this._adapter?.updateFootprintPanorama(e,i)},this.updatingTriangularMeasurementState=!1,this.videoElement=null,this.videoLayer=null,this.videoMapView=new va({map:new Map}),this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new pi,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._measurementService=null,this._correctedLocationPointOnImage=null,this._overlays=new qe({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"},title:"OrentedImageryViewerViewModel overlays layer"}),this._panoramicVideoViewer=new to,this._panoramicViewer=new ci,this._panoramicMeasurementViewer=new ci,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._featureToSector=null,this._updatingHandles=new wi,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.addUpdatingPromise=e=>this._updatingHandles.addPromise(e),this.filterCapturedFeatures=e=>{const i=this.currentBestFeature?.attributes.objectId,a=this.layer?.imageReferenceField;if(!i||!e||!a)return;this.overlayedMapFeatures.get(e)?.forEach(o=>{const n=o.attributes??{},l=Object.keys(n).find(d=>d.toLowerCase()===a.toLowerCase());(l?n[l]:null)!==i&&(o.visible=!o.visible)})},this.hideImageGeometry=e=>{},this.highlight=e=>{if(!this._overlaysView)return;this.removeHighlight();const i=this.additionalFootprints.find(({attributes:{imageID:a}})=>a===Number(e));this._highlightedFeatureHandle=i?this._overlaysView?.highlight(i):null},this.loadDataCaptureAdapter=async e=>{await this.loadSketch(e);const i=A(()=>import("./DataCaptureAdapter-B6WeK1YK.js"),__vite__mapDeps([180,0,1,181,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])),{default:a}=await i;return P(e),this.sketchAdapter=new a({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(e,i)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(e,i)),this.storeImageMeasurementViewer=e=>{this.imageMeasurementViewer=e},this.storePanoramicMeasurementViewer=e=>{this._panoramicMeasurementViewer=e},this.loadImageViewer=e=>{this._imageViewer?.destroy(),this._imageViewer=e},this.loadPanoramicViewer=e=>{this._panoramicViewer?.destroy(),this._panoramicViewer=e},this.loadPanoramicVideoViewer=e=>{this._panoramicVideoViewer?.destroy(),this._panoramicVideoViewer=e},this.loadVideoViewer=e=>{this.videoMapView.container=e},this.showImageByObjectId=async(e,i)=>{const a=this.additionalFeatures.find(({attributes:r})=>r.objectId===e);if(a)this.currentBestFeature=a;else{const{layer:r,layerFloorFilterClause:o}=this;if(!r)return void this.setMessage("noLayerSelected","info");this.beforeLoad();const n=this._updatingHandles.addPromise(this._queryAndLoadByObjectId(r,e,o,i));try{await n,await this.selectBestFeature(e,i)}catch(l){te(l)||(O.getLogger(this).error("oriented-imagery-viewer:show-image",l),l.name==="NoFeatureFoundWithObjectIdError"?this.setMessage("noFeatureFoundWithObjectId","error","",{objectId:e}):this.setMessage("imageLoadError","error",l.message))}}},this.imageToImageTransform=async(e,i,a)=>{const{updateElevationProps:r,...o}=i,{updateElevationProps:n,...l}=a,d=await yt(e,o,r);return De(d,l)},this.imageToImageTransformPanoramic=async(e,i,a)=>{const{updateElevationProps:r,...o}=i,{updateElevationProps:n,...l}=a,d=await wt(e,o,r);return vt(d,l)},this.getSectorFeatureById=e=>this._suitabilities?.find(({feature:{attributes:{objectId:i}}})=>i===e),this.getFeatureSectorById=e=>this._featureToSector?.[`${e}`],this.navigate=async(e,i)=>{const{activeViewer:a}=this;if(!a)throw new vd;return await a.navigate(e,i)},this.removeHighlight=()=>this._highlightedFeatureHandle?.remove(),this.revealImageGeometry=e=>{},this.selectBestFeature=async(e,i)=>(P(i),this.currentBestFeature=this.features?.find(({attributes:a})=>`${a.objectId}`==`${e}`),ut(()=>this.state==="image-loaded",i)),this.toggleImageAttributes=()=>{Ve(this._openPopupTask),this._openPopupTask=oe(async e=>{const{currentBestFeature:i,popupEnabled:a,layer:r,view:o}=this;if(o?.closePopup(),!(o&&i&&a&&r))return;const{attributes:n,geometry:l}=i,d=new Q({geometry:l,attributes:n.toJSON(),layer:r,sourceLayer:r});P(e),await o.openPopup({features:[d],location:n.location.clone()})})},this.updateSuitabilities=(e,i=!0)=>{e.sort((r,o)=>r.suitability-o.suitability),this._suitabilities=e;const a=this._suitabilities.map(({feature:r})=>r);this._initialCurrentCoverageUpdate=!0,this._updateFeatures(a,i),this._groupFeaturesBySectors()},this._createViewClickHandle=()=>{if(this.removeHandles(K.click),this.disabled||this.view==null)return;const e=this.mapImageConversionToolState&&this.state==="image-loaded"?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",e,Vn.WIDGET),K.click)},this._createImageClickHandle=()=>{this.removeHandles(K.imageClick);const{mapImageConversionToolState:e,mode:i,activeViewer:a,currentBestFeature:r,footprintExtent:o}=this,n=a?.imageSize;if(!(e&&i!=="none"&&n&&o&&r))return;const l=a.clickAction;this.clickAction="pixel-location";const d=wr(()=>{this.clickAction=l});let h=null;const u=qt(()=>a,"pixel-location",m=>{this.plotReferencePointOnImage(m),h?.abort(),h=oe(async g=>{if(!m)return;const p=await this.getMapPoint(m,{feature:r,imageSize:n,mode:i}).then(y=>{const f=this.view?.spatialReference;return Se(!f,y.spatialReference.equals(f))?y:ae(y,f)});P(g),this.plotReferencePointOnGround(p)})});this.addHandles([u,d],K.imageClick)},this._createTriangularImageClickHandle=()=>{this.removeHandles(K.triangularImageClick),this.triangularMeasurementActive&&this.mode!=="none"&&this.currentBestFeature&&this.currentBestFeatureMeasurementImage&&this.activeTriangulatedViewer&&this.addHandles(this.activeTriangulatedViewer.imageRenderer.on("double-click",this._measurementImageClickHandler),K.triangularImageClick)},this._createTriangularImageLocationHandle=()=>{this.removeHandles(K.triangularImageClick);const{imageLocationToolState:e,mode:i,activeTriangulatedViewer:a}=this,r=a?.imageSize;if(!e||i==="none"||!r)return;this.clickAction="pixel-location";let o=null;const n=qt(()=>a,"pixel-location",l=>{this.measurementVectors.length===1&&(this.plotLocationPointOnImage(l,!0),o?.abort(),o=oe(async d=>{if(!l||this.triangulatedPoint||this.measurementVectors?.length===2||!this.currentBestFeatureMeasurementImage)return;let h=await this.getMapPoint(l,{feature:this.currentBestFeatureMeasurementImage,imageSize:r,mode:i});P(d);const u=this.view?.spatialReference;u&&!h.spatialReference.equals(u)&&(h=await ae(h,u),P(d)),await this._calculateTriangulatedPointFromGroundPoint(h,{signal:d}),P(d)}))});this.addHandles(n,K.triangularImageClick)},this._createImageLocationHandle=()=>{this.removeHandles(K.imageClick);const{imageLocationToolState:e,mode:i,activeViewer:a,currentBestFeature:r,footprintExtent:o}=this,n=a?.imageSize;if(!(e&&i!=="none"&&n&&o&&r))return;this.clickAction="pixel-location";let l=null;const d=qt(()=>a,"pixel-location",h=>{const{currentBestFeatureMeasurementImage:u,triangularMeasurementActive:m,activeTriangulatedViewer:g}=this;this.pixelCoordinates=h;const p=u!=null&&!g?.state.includes("loading");Se(!m,p)&&this.plotLocationPointOnImage(h),l?.abort(),l=oe(async y=>{if(!h)return;let f=await this.getMapPoint(h,{feature:r,imageSize:n,mode:i});P(y);const w=this.view?.spatialReference;w&&!f.spatialReference.equals(w)&&(f=await ae(f,w),P(y)),this.groundCoordinates=f,m&&f&&p&&await this.triangulatedLocationWorkflow(f,y);const _=await this.calculateLocationAccuracy(h,f,i,y);P(y),_&&(this.groundCoordinatesAccuracy=_)})});this.addHandles(d,K.imageClick)},this._handleImageHitTestResponse=async e=>{const{layer:i,overlayedCameraLocations:a}=this;if(!i)return;const r=e.results.find(({graphic:n,graphic:{attributes:l}})=>a.includes(n)&&l&&!l[i.imageReferenceField]&&!l[i.imageGeometryField]);if(!r)return;const o=r.graphic.attributes[i.objectIdField];await this.showImageByObjectId(o)},this._loadDepthImage=async e=>{const{currentBestFeature:i,layer:a,depthImageNotSupported:r}=this;if(this.depthImage?.destroy(),this.depthImage=null,!a||!i||r)return;const{depthImage:o}=i.attributes;if(!o)return;const n=(await A(async()=>{const{default:l}=await import("./DepthImageService-Dgl4U2mH.js");return{default:l}},__vite__mapDeps([182,0,1,17,18,19,20,21,22,23,24,25,26,27,28,29]))).default;P(e),this.depthImage=new n({url:o});try{await this.depthImage.load(e)}catch(l){te(l)||(O.getLogger(this).error("error occurred while loading depth image",l),this.depthImage?.destroy(),this.depthImage=null)}},this._loadImage=async e=>{const{currentBestFeature:i,layer:a,mode:r}=this;if(this.clearGraphics(),!a||!i||r==="none"||r==="video"||r==="panoramic-video")return;const{attributes:o}=i,{imagePath:n,imageRotation:l,cameraHeading:d,cameraRoll:h,cameraPitch:u,objectId:m,cameraOrientation:g,location:p}=o,y=(h??0)+(l??0),f=p.spatialReference.isWGS84&&g?.type!==4?Wt(p):new L(p);let w=n;if(Pt(n))try{w=await Ji(a,m,e)}catch(_){return te(_)?void 0:Za(_)?(O.getLogger(this).error(_),void this.setMessage("noAttachment","error",`${a.objectIdField}: ${m}`)):(O.getLogger(this).error(_,{[a.objectIdField]:m,layer:a}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${a.objectIdField} ${m}`))}try{await this.loadImageFromSource(w,{imageRotation:y,options:e,pitch:u,yaw:d,mode:r,cameraLocation:f}),P(e),await this.transformAndPlotSelectedLocation(e)}catch(_){te(_)||this.loadImageError(_)}},this._loadVideo=async e=>{const{currentBestFeature:i,layer:a,mode:r,selectedPoint:o}=this,n=i?.attributes.imagePath;if(!a||!i||r!=="panoramic-video"||!n)return;const{attributes:l}=i,{cameraHeading:d,cameraPitch:h,cameraOrientation:u,location:m}=l,g=m.spatialReference.isWGS84&&u?.type!==4?Wt(m):new L(m);try{this._panoramicVideoViewer.viewModel.video&&this._panoramicVideoViewer.viewModel.video.pause(),this._panoramicVideoViewer.videoSource=n;let p=d??0;g&&o&&(p=await Ja(g,o)-p),this._panoramicVideoViewer.pitch=h??0,this._panoramicVideoViewer.yaw=p,await this._panoramicVideoViewer.loadVideo(e),P(e)}catch(p){te(p)||this.loadImageError(p)}},this._loadImageFromSourceInternal=async(e,i)=>{const{mode:a,imageRotation:r,options:o}=i,n=typeof e=="string",l=n?e:e.url,{pathname:d,searchParams:h}=new URL(l);let u=n?d.match(Td)?.[1]:e.datasetFormat;if(!u)try{u=await Br(l,{...i.options})}catch(m){te(m)||O.getLogger(this).error("#getContentType()",m)}switch(u??="UNKNOWN FORMAT",a){case"default":this.triangularMeasurementActive?await this._setImageSource(this.imageMeasurementViewer,u,l,h,r,o):await this._setImageSource(this._imageViewer,u,l,h,r,o);break;case"panoramic":if(xd.has(u.toUpperCase())){const{selectedPoint:m}=this,{pitch:g,yaw:p,cameraLocation:y,viewAngle:f}=i,w=this.triangularMeasurementActive?this._panoramicMeasurementViewer:this._panoramicViewer;let _=p??0;typeof f=="number"?_=f-_:y&&m&&(_=await Ja(y,m)-_),w.imageSource=l,w.pitch=g??0,w.yaw=_,Id.has(u.toUpperCase())?await w.loadImageTiled(l,o):await w.loadImage(o)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:u});break}},this._loadMeasurementViewerImage=async e=>{const{currentBestFeatureMeasurementImage:i,layer:a,mode:r}=this;if(this.imageMeasurementViewer.clearGraphics(),this._panoramicMeasurementViewer.clearGraphics(),!a||!i||r==="none"||r==="video"||r==="panoramic-video")return;const{attributes:o}=i,{imagePath:n,imageRotation:l,cameraHeading:d,cameraRoll:h,cameraPitch:u,objectId:m,cameraOrientation:g,location:p}=o,y=(h??0)+(l??0),f=p.spatialReference.isWGS84&&g?.type!==4?Wt(p):new L(p);let w=n;if(Pt(n))try{w=await Ji(a,m,e)}catch(_){return te(_)?void 0:Za(_)?(O.getLogger(this).error(_),void this.setMessage("noAttachment","error",`${a.objectIdField}: ${m}`)):(O.getLogger(this).error(_,{[a.objectIdField]:m,layer:a}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${a.objectIdField} ${m}`))}try{await this.loadImageFromSource(w,{imageRotation:y,options:e,pitch:u,yaw:d,mode:r,cameraLocation:f}),P(e)}catch(_){te(_)||this.loadImageError(_)}},this._loadViewAdapter=async e=>{const{view:i}=this;if(i)switch(i.type){case"2d":{const{default:a}=await A(()=>import("./MapViewAdapter-CTKZ52Vz.js"),__vite__mapDeps([183,0,1,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]));P(e),this._adapter=new a(this);break}case"3d":{const{default:a}=await A(()=>import("./SceneViewAdapter-BsseDWQ6.js"),__vite__mapDeps([184,0,1,5,6,7,8,9,10,11,12,13,14,15,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]));P(e),this._adapter=new a(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=e=>{if(e.stopPropagation(),e.preventDefault(),e.mapPoint){const i=e.mapPoint;i.x=Da(i.x,i.spatialReference),this.plotMapPoint(e.mapPoint)}},this._measurementImageClickHandler=e=>{e.stopPropagation(),e.preventDefault();const{sketchTriangular:i,triangularMeasurementActive:a,currentBestFeatureMeasurementImage:r,triangulatedMeasurementGraphic:o}=this;i&&a&&r&&o&&i.state!=="active"&&(i.update([o],{tool:"reshape"}),this.updatingTriangularMeasurementState=!0)},this._viewClickHandler=e=>{this._clickTask?.abort(),this._clickTask=oe(async i=>{const{pointerType:a,button:r,mapPoint:o}=e;if((a!=="mouse"||r===0)&&o)return e.stopPropagation(),e.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(o,{signal:i}))})},this.plotSelectedPointOnImage=async(e,i)=>{if(await Mt(i),!e)return;const a=new L({...ti(e)?e.toJSON():e});if(this.mode==="default")a.x-=.5,a.y=.5-a.y,a.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new Q({geometry:a,symbol:nr}),this._imageViewer.addGraphic(this._crossSymbol,0);else if(this.mode==="panoramic"){const{imageSize:r}=this._panoramicViewer;if(!r)return;const[o,n]=r,{heading:l,pitch:d}=je(e,o,n),h=Qe(l,d);this._crossSymbol=new Q({geometry:new L(h,W.WebMercator),symbol:Vc}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this)}initialize(){this.addHandles([R(()=>this.view,()=>this.load(),E),R(()=>this.view?.map,(t,e)=>{e?.layers.remove(this._overlays),t?.layers.add(this._overlays)},ht),R(()=>this.view?.map?.allLayers?.length,t=>{t&&this.view?.map?.layers.reorder(this._overlays,t-1)},ht),R(()=>[this.state,this.mapImageConversionToolState,this.view,this.disabled],()=>{this._createViewClickHandle(),this._createImageClickHandle()},E),R(()=>[this.triangularMeasurementActive,this.currentBestFeatureMeasurementImage],()=>{this._createTriangularImageClickHandle()},E),R(()=>[this.state,this.imageLocationToolState,this.view],(t,e)=>{if(this._initializeMeasurementService(),this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();t[1]!==e?.[1]&&this._setMeasurementCursor()},E),R(()=>this.measureType,()=>{this.clearPreviousMeasurements(),this._initializeMeasurementService()},E),R(()=>this.bestFeatureAngle,(t,e)=>{this.previousFeatureAngle=e??0},E),R(()=>this.currentBestFeature,async(t,e)=>{Ve(this._featureChangedTask),this._featureChangedTask=oe(async i=>this.determineWorkflowForFeature.apply(this,[t,e,{signal:i}])),await this._featureChangedTask.promise},{sync:!0}),R(()=>this.currentBestFeatureMeasurementImage,(t,e)=>{Ve(this._featureChangedTask),e&&t!==e&&(this.measurementVectors=[],this.triangulatedPoint=null,this.sketchTriangularGraphicsLayer?.graphics.destroyAll()),this._featureChangedTask=oe(async i=>{await this.determineWorkflowForTriangularMeasurement(t,e,{signal:i}),P(i),this._reorderTriangularSketchLayer()})},E),R(()=>this.triangularMeasurementActive,(t,e)=>{e&&!t&&(this.measurementVectors=[],this.currentBestFeatureMeasurementImage=null,this.triangulatedDistanceMeasurement=null,this.triangulatedMeasurementGraphic=null,this.triangulatedPoint=null,this.updatingTriangularMeasurementState=!1,this.triangulatedAreaMeasurement=null,this.triangulatedDistanceAccuracy=null,this.triangulatedAreaAccuracy=0,this.sketchTriangularGraphicsLayer?.graphics.destroyAll(),this.clearReferencePointOnImage(),this.imageMeasurementViewer.clearImage(),this.imageMeasurementViewer.clearGraphics(),this._panoramicMeasurementViewer.clearImage(),this._panoramicMeasurementViewer.clearGraphics())}),R(()=>this.mode,t=>{switch(this.removeHandles(K.interactionHandles),t){case"default":this.addHandles(R(()=>{const{state:e}=this;return e==="image-loaded"?this._imageViewer.imagePointsInView:null},e=>{e&&(Ve(this._updateFootprintTask),this._updateFootprintTask=oe(async i=>{await this.updateFootprint(e,void 0,{signal:i})}))},{...E,equals:(e,i)=>Ut(e,i,Zt)}),K.interactionHandles);break;case"video":this.addHandles(R(()=>{const{footprintExtent:e,videoElement:i,bestFeatureFootprint:a}=this;if(e&&i?.loaded&&a)return{videoExtent:Nr,bestFeatureFootprint:a}},e=>{e?.videoExtent&&e?.bestFeatureFootprint&&(Ve(this._updateFootprintTask),this._updateFootprintTask=oe(async i=>{await this.updateFootprint(e.videoExtent,void 0,{signal:i})}))},{...E,equals:(e,i)=>Ut(e?.videoExtent,i?.videoExtent,Zt)&&e?.bestFeatureFootprint===i?.bestFeatureFootprint}),K.interactionHandles);break;case"panoramic":this.addHandles(R(()=>{const{currentBestFeature:e,state:i,_panoramicViewer:a}=this,{imageSize:r,vfov:o,hfov:n,pitch:l,yaw:d}=a;return e&&r&&!i.includes("loading")&&o!=null&&n!=null&&l!=null&&d!=null?[o,n,d,l]:null},e=>{if(!e||this.state.includes("loading"))return;const[i,a,r,o]=e;this.currentNode&&(this.currentNode.currentHeading=r+(this.currentNode.heading??0),this.currentNode.currentPitch=o+(this.currentNode.pitch??0)),Ve(this._updateFootprintTask),this._updateFootprintTask=oe(async n=>{await this.updateFootprintPanorama({verticalFieldOfView:i,horizontalFieldOfView:a,yaw:r,pitch:o},{signal:n}),this._updateFootprintTask=null})},{equals:(e,i)=>Ut(e,i,Zt)}),K.interactionHandles);break;case"panoramic-video":this.addHandles(R(()=>{const{currentBestFeature:e,state:i,_panoramicVideoViewer:a}=this,{imageSize:r,vfov:o,hfov:n,pitch:l,yaw:d,viewModel:h}=a,u=h.closestFeature??e;return u&&r&&!i.includes("loading")&&o!=null&&n!=null&&l!=null&&d!=null?[o,n,d,l,u]:null},e=>{if(!e)return;const[i,a,r,o,n]=e;Ve(this._updateFootprintTask),this._updateFootprintTask=oe(async l=>{await this.updateFootprintPanorama({verticalFieldOfView:i,horizontalFieldOfView:a,yaw:r,pitch:o,feature:n},{signal:l}),P(l),this._updateFootprintTask=null})},{equals:(e,i)=>Ut(e,i,Zt)}),K.interactionHandles)}},E),R(()=>[this.brightness,this.contrast,this.sharpness],()=>{const{_imageViewer:t,brightness:e,contrast:i,mode:a,sharpness:r}=this;a==="default"&&(t.brightness=e,t.contrast=i,t.sharpness=r)},E),R(()=>this.activeViewer?.imageRenderer,()=>{this.sketch&&(this.sketch.view=this.activeViewer?.imageRenderer)}),R(()=>this.activeViewer,t=>{this.removeHandles(K.hittestHandles),t&&this.addHandles(qt(()=>t,"hittest-response",this._handleImageHitTestResponse),K.hittestHandles)})]),this.when().finally(()=>{this.notifyChange("state")})}destroy(){this.currentBestFeature=null,this._updateFootprintTask=Ve(this._updateFootprintTask),this._clickTask=Ve(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=ce(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=ce(this.bestFeatureCurrentFootprint),this.videoViewModel=ce(this.videoViewModel),this._crossSymbol=ce(this._crossSymbol),this._referencePointOnGround=ce(this._referencePointOnGround),this._referencePointOnImage=ce(this._referencePointOnImage),this._locationPointOnImage=ce(this._locationPointOnImage),this._overlays&&this.view?.map?.remove(this._overlays),this._overlays.destroy(),this._imageViewer.destroy(),this.imageMeasurementViewer.destroy(),this._panoramicViewer.destroy(),this._panoramicMeasurementViewer.destroy()}get activeLayer(){return Ke(O.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(t){Ke(O.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=t}get activeViewer(){const{_imageViewer:t,_panoramicViewer:e,mode:i}=this;switch(i){case"default":return t;case"panoramic":return e;default:return null}}get activeTriangulatedViewer(){switch(this.mode){case"default":return this.imageMeasurementViewer;case"panoramic":return this._panoramicMeasurementViewer;default:return null}}get accuracyParametersMissing(){return this.layer?.orientationAccuracy?.every(t=>t===0)??!0}get brightness(){return this._get("brightness")??0}set brightness(t){this._set("brightness",Ye(t,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(t){this._set("contrast",Ye(t,-10,10))}get currentNode(){const{currentBestFeature:t,navigationNodes:e}=this;return e.find(i=>i.id===t?.attributes.objectId)}get depthImageNotSupported(){if(this.currentBestFeature?.attributes.depthImage)return!Vi(this.currentBestFeature.attributes.depthImage)}get featureCount(){return this.features?.length??0}get imageGalleryEnabled(){const{currentBestFeature:t}=this;if(!t)return!1;const e=t.attributes.imagePath?.trim();return Vi(e)||Pt(e)}get imageLoaded(){return Ke(O.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),this.state==="image-loaded"}get invalidCameraHeading(){return this.currentBestFeature?.attributes?.cameraHeading===Wa}get imagePointsInView(){const{mode:t,_imageViewer:e}=this;return t==="default"?e.imagePointsInView:null}get layerView(){const{layer:t,view:e}=this;if(t&&e)return e.allLayerViews.find(Vs(t))}get layerFloorFilterClause(){const{layerView:t}=this;return t?ts(t):null}get mode(){const t=this.currentBestFeature?.attributes;if(!t)return"none";const e=t.orientedImageryType;if(e?.includes("video"))return e.includes("360")?"panoramic-video":"video";const{horizontalFieldOfView:i,isSpherical:a}=t;return i===360||a?"panoramic":"default"}get panoramicVideoLoaded(){const{mode:t,_panoramicVideoViewer:e}=this,{videoLoaded:i}=e.viewModel;return(t==="panoramic-video"&&i===!0)??!1}get popupEnabled(){return this.layer?.popupEnabled===!0}get referencePoint(){return this._referencePointOnGround?.geometry}get sectorData(){const{_sectorData:t}=this;return t?Qt.map(e=>t[e]):null}get sharpness(){return this._get("sharpness")??0}set sharpness(t){this._set("sharpness",Ye(t,0,1))}get sketchGraphicsLayer(){const{sketch:t}=this;return t?.layer?.type==="graphics"?t.layer:void 0}get state(){const{mode:t,_updatingHandles:{updating:e},_featureChangedTask:i}=this;if(!this.isFulfilled()||e||i?.finished===!1)return"loading";if(this.isRejected())return"error";if(this.displayMessage?.type==="error")return"image-load-error";switch(t){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state;case"video":return this.videoElement?.loaded?"video-loaded":"video-not-loaded"}return"ready"}get thumbnails(){const{features:t}=this;return t?new D(t.map(({attributes:{imagePath:e,objectId:i,cameraRoll:a,imageRotation:r}})=>{const o=e?.trim();return Vi(o)||Pt(o)?{url:o,objectId:i,rotation:(a??0)+(r??0)}:null}).filter(xi)):null}set view(t){this._set("view",t)}get _defaultGraphicsLayer(){const t={blendMode:"source-atop"};switch(this.mode){case"panoramic":return new qe({...t,elevationInfo:{mode:"absolute-height"}});case"default":return new qe({...t});default:return}}get _overlaysView(){return this.view?.layerViews.find(({layer:t})=>t===this._overlays)}beforeLoad(t=!0){this.view?.closePopup(),t&&(this.displayMessage=null),this.clearPreviousGroundLocation(),this.triangularMeasurementActive=!1,this.currentBestFeatureMeasurementImage=null,this.measureType=null,this.imageLocationToolState=!1,this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=ce(this.bestFeatureCurrentFootprint),this._overlays?.removeAll()}async computeHeight(t,e,i=!0){return this._measurementService?.computeHeight(t,e,i)}async calculateAreaMeasurement(t,e,i){return this._measurementService?.calculateAreaMeasurement(t,e,i)}async calculateDistanceMeasurement(t,e,i){return this._measurementService?.calculateDistanceMeasurement(t,e,i)}async calculateAccuracy(t,e,i){return this._measurementService?.calculateAccuracy(t,e,i)}async calculateLocationAccuracy(t,e,i="default",a){return this._measurementService?.calculateLocationAccuracy(t,e,i,a)}async calculateAccuracyPanoramic(t,e,i=!1,a){return this._measurementService?.calculateAccuracyPanoramic(t,e,i,a)}async calculateHeightMeasurementInfo(t,e,i){return this._measurementService?.calculateHeightMeasurementInfo(t,e,i)}async calculateTriangulatedMeasurements(t){await this._measurementService?.calculateTriangulatedMeasurements(t)}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.groundCoordinatesAccuracy=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){this.measurementGraphic&&(this.activeViewer?.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&(this.activeViewer?.removeGraphic(this.heightGraphic),this.heightGraphic=null),this.triangularMeasurementActive&&this.sketchTriangularGraphicsLayer?.graphics.destroyAll()}digitizeCancel(){return this.sketch?.cancel()}digitizeCanRedo(){return this.sketch?.canRedo()??!1}digitizeCanUndo(){return this.sketch?.canUndo()??!1}digitizeComplete(){return this.sketch?.complete()}async digitizeCreate(t,e){const{sketch:i,dataCaptureLayer:a}=this;if(!i)throw Ze();zc(a,t,i),await i.create(t,{...e,defaultZ:0})}digitizeDelete(){if(!this.sketch)throw Ze();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw Ze();return this.sketch.duplicate()}digitizePlace(t,e){if(!this.sketch)throw Ze();return this.sketch.place(t,e)}digitizeRedo(){if(!this.sketch)throw Ze();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw Ze();return this.sketch.undo()}digitizeUpdate(t,e){if(!this.sketch)throw Ze();return this.sketch.update(t,e)}async displayHeightResults(){const{currentBestFeature:t,activeViewer:e,heightMeasurementPixels:i,mode:a}=this,r=e?.imageSize;if(!t?.attributes||!r)return;const n=await this.computeHeight(i,a);n?.value&&n?.accuracy&&(this.heightMeasurementResult=n.value,this.heightMeasurementAccuracy=n.accuracy)}filterByFootprints(t,e,i=!1){const a=[],r=[],o=[];return t.forEach(n=>{const{layer:{coveragePercent:l},attributes:d}=n;let h;const{polygon:u,frustum:m}=Ft(d);if(h=u.clone(),d.isInspection&&(h=tc(d)),l&&(h=ic(h,l)),i||!e||Yl(h,e)){o.push(n);const{geometry:g,objectId:p,cameraHeight:y,cameraHeading:f}=d,w=g.clone();w.z=y/zt(g.spatialReference),w.imageID=p,this.pointSources.push(w),f!==Wa&&(a.push(u),m&&r.push(m))}}),{features:o,polygons:a,frustums:r}}getMeasurementProperties(t=this.currentBestFeature,e=this.activeViewer){if(!t||!e?.imageSize)return;const{elevationSample:i,attributes:a}=t,{elevationSource:r,cameraHeight:o}=a,n=li(a,e.imageSize[0],e.imageSize[1]);let l=n.cameraLocation;return(l.spatialReference.isGeographic?ae(l,W.WebMercator):Promise.resolve(l)).then(d=>(l=d,Tt(l.spatialReference,l.z??0,o,{elevationSample:i,elevationSource:r,extent:this.footprintExtent}))).then(d=>("elevationSample"in d&&(t.elevationSample=d.elevationSample),{...n,cameraLocation:l,updateElevationProps:d}))}getMeasurementPropertiesPanoramic(t=this.currentBestFeature,e=this.activeViewer){if(!t||!e?.imageSize)return;const{elevationSample:i,attributes:a}=t,{elevationSource:r,cameraHeight:o}=a,n=Ya(a,e.imageSize[0],e.imageSize[1]);let l=n.cameraLocation;return(l.spatialReference.isGeographic?ae(l,W.WebMercator):Promise.resolve(l)).then(d=>(l=d,Tt(l.spatialReference,l.z??0,o,{elevationSample:i,elevationSource:r,extent:this.footprintExtent}))).then(d=>("elevationSample"in d&&(t.elevationSample=d.elevationSample),{...n,cameraLocation:l,updateElevationProps:d}))}async deleteDataCaptureFeatures(t){const{dataCaptureLayer:e}=this;if(!e)throw new N("orientedimageryviewer:missing-featurelayer","Data capture layer is not available");return e.queryFeatures({objectIds:t}).then(({features:i})=>e.applyEdits({deleteFeatures:i}))}handleSectorClick(t){if(isNaN(t))return;const e=this._sectorData?.[Qt[t]],i=e?.at(0);i&&(this.triangularMeasurementActive&&this.currentBestFeature?this._updateImageMeasurementBestFeature(i):this._updateCurrentBestFeature(i))}handleFeatureClick(t){const{sector:e,featureIndexInSector:i}=t;if(isNaN(i))return;const a=this._sectorData?.[e],r=a?.at(i);r&&(this.triangularMeasurementActive&&this.currentBestFeature?this._updateImageMeasurementBestFeature(r):this._updateCurrentBestFeature(r))}handleDrawCursorUpdateEvents(t){const{measurementAngle:e,tempDistance:i,heightMeasurementPixels:a,mode:r,activeViewer:o,currentBestFeature:n}=this,l=o?.imageSize;if(!t.vertices||!l||!n)return;const d=hr(t.vertices.at(-1),r,l);if(a.length<1||!d||!i||!e||r==="none")return;const h=Fa(a[0],d,e);if(!h?.length)return;this.heightMeasurementPixels.push(h),r==="panoramic"?this.createPolylineGraphicPano():this.createPolylineGraphic();const u=Dt(n.attributes.location.spatialReference),m=Zc(this.heightMeasurementPixels,i,u);m&&(this.heightMeasurementResult=m)}async handleDrawVertexAddEvents(t,e){const{currentBestFeature:i,activeViewer:a,heightMeasurementPixels:r,mode:o}=this;if(!i||!a||!t.vertices?.length||o==="none")return;const n=a?.imageSize;if(!r.length&&n){const l=hr(t.vertices.at(-1),o,n);this.heightMeasurementPixels.push(l);const d=await this.calculateHeightMeasurementInfo(l,o,e);if(!d?.measurementAngle||!d?.tempDistance)return;this.measurementAngle=d.measurementAngle,this.tempDistance=d.tempDistance}}load(t){return this.addResolvingPromise(this._loadViewAdapter(t).catch(e=>{if(!te(e))throw e})),this}async loadBestImage(t,e){return this.selectedPoint=Wi(t),this.beforeLoad(),this._fetchFeaturesWithController(t,e)}loadImageError(t){O.getLogger(this).error("oriented-imagery-viewer:load-image",t),this.setMessage("imageLoadError","error",t.message)}async loadSketch(t){if(!this.sketch){const e=A(()=>import("./SketchViewModel-DhxBVxKu.js").then(a=>a.S),__vite__mapDeps([167,0,1,51,168,169,170,171,172,84,81,62,85,86,87,88,173,174,11,97])),{default:i}=await e;P(t),this.sketch=new i({layer:this._defaultGraphicsLayer,view:this.activeViewer?.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(t){if(!this.sketchAdapter){const e=A(()=>import("./MeasurementAdapter-BN2--ITA.js"),__vite__mapDeps([185,0,1,181,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])),{default:i}=await e;if(P(t),this.sketchAdapter=new i({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async loadTriangulatedMeasurementAdapter(t){if(!this.triangulatedMeasurementAdapter){const e=A(()=>import("./TriangulatedMeasurementAdapter-D-4srXQU.js"),__vite__mapDeps([186,0,1,181,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176])),{default:i}=await e;if(P(t),this.triangulatedMeasurementAdapter=new i({viewModel:this}),!this.triangulatedMeasurementAdapter.viewModel.isResolved())return}return this.triangulatedMeasurementAdapter}async processFeatureResponse(t,e,i){const{features:a}=t;if(this._clearFeatureGeometries(),!this._checkFeatures(a))return;const{features:r,polygons:o,frustums:n}=this.filterByFootprints(a,e,i?.skipFilter);if(!this._checkFeatures(r))return;this.coveragePolygons.addMany(o),this.coverageFrustums.addMany(n);const l=await this.processElevationSample(o,r,i);P(i),await this._updateElevationOfSelectedPointAndLocations(r,e,l),P(i),Ps(r,l);const d=this._processSuitableFeatures(r,e);this.updateSuitabilities(d,i?.loadBestImage)}async processFeatureElevation(t,e,i){if(!e)return;const{features:a,polygons:r}=this.filterByFootprints(t,e,!0);if(!a?.length)return;const o=await this.processElevationSample(r,a,i);return P(i),o}async startMeasurement(t,e){this.sketch||await this.loadSketch(e),await this.loadMeasurementAdapter(e);const{sketch:i,sketchAdapter:a,activeViewer:r,mode:o}=this;if(!i||!a||!r||o==="none")return;if(this.displayNewMeasurementButton=!1,o==="panoramic"&&(i.defaultCreateOptions.defaultZ=0),await i.create(t),o==="panoramic"){const{drawOperation:l}=i.view.activeTool;l.constraintsEnabled=!1,l._set("elevationDrawSurface",null)}const n=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;n&&this.sketch&&(this.sketch.polygonSymbol=Cc(n),this.sketch.polylineSymbol=o==="panoramic"?cr:lr(n,2.5))}startHeightMeasurement(){this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??=new is({view:this.activeViewer?.imageRenderer}),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],t=>this.handleDrawEvents(t))}createPolylineGraphic(){const t=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],e=this.activeViewer?.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new xe({paths:[t],spatialReference:e});else{const i=new xe({paths:[t],spatialReference:e}),a=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new Q({geometry:i,symbol:lr(a,2.5)}),this.activeViewer?.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){const t=this.activeViewer?.imageRenderer.spatialReference,e=this.activeViewer?.imageSize;if(!e)return;const i={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},a={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:r,pitch:o}=je(i,e[0],e[1]),{heading:n,pitch:l}=je(a,e[0],e[1]),d=[[...Qe(r,o)],[...Qe(n,l)]];if(this.heightGraphic)this.heightGraphic.geometry=new xe({paths:[d],spatialReference:t});else{const h=new xe({paths:[d],spatialReference:t});this.heightGraphic=new Q({geometry:h,symbol:cr}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async editOverlayedGraphics(t){this.sketchTriangularGraphicsLayer||this._initializeSketchTriangularGraphicsLayer(),this.sketchTriangularGraphicsLayer?.destroyed&&this._handleDestroyedTriangularSketchLayer(),this.sketchTriangularGraphicsLayer.add(t),this.sketchTriangular||(this._initializeSketchTriangular(),await this.loadTriangulatedMeasurementAdapter()),this.updateOverlayedGeometry(t)}updateOverlayedGeometry(t){this.sketchTriangular?.update([t],{tool:"reshape"})}async processMeasurementVectors(t){this.triangularMeasurementActive&&this.currentBestFeature&&(this.measurementVectors?.length<2&&await this.updateMeasurementVectorsArray(t),this.measurementVectors.length===2&&await this.calculateTriangulatedMeasurements(t))}async updateMeasurementVectorsArray(t){const e=this.measurementVectors.length?this.currentBestFeatureMeasurementImage:this.currentBestFeature;if(e){const i=await this.computeMeasurementVector(t,e);i&&this.measurementVectors.push(i)}}async computeMeasurementVector(t,e){const{activeViewer:i,mode:a}=this,r=i?.imageSize;if(!t||!e||!r)return;const o=sd(t,a,r),n=this.view?.spatialReference,l=[];for(let d=0;d<o.length;d++){const h={x:o[d][0],y:o[d][1]};let u=await this.getMapPoint(h,{feature:e,imageSize:r,mode:a});n&&!u.spatialReference.equals(n)&&(u=await ae(u,n)),l.push(u)}return ki(l,e)}async handleDrawEvents(t,e){if(this.draw)switch(t.type){case"cursor-update":this.handleDrawCursorUpdateEvents(t);break;case"vertex-add":await this.handleDrawVertexAddEvents(t,e);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(t){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),t){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(t){const{activeViewer:e,currentBestFeature:i,overlayedCameraLocations:a,layer:r,mode:o,state:n,layerFloorFilterClause:l}=this,d=e?.imageSize;if(!d||!i||!r||o==="none"||n.includes("loading"))return;const{polygon:h}=Ft(i.attributes);if(e.removeManyGraphics(a.toArray()),a.removeAll(),t){const{features:u}=await r.queryFeatures({where:Ee(`${r.objectIdField} <> ${i.attributes.objectId}`,Ee(r.definitionExpression,l)),geometry:h,returnGeometry:!0,outFields:[r.objectIdField]}),m=await Promise.all(u.map(async g=>{const{attributes:p,geometry:y}=g,f=await this.getPixels(y,{feature:i,imageSize:d,mode:o}),w=o==="panoramic"?Rc():Oc();return new Q({attributes:p,symbol:w,geometry:f})}));a.addMany(m),e.addManyGraphics(a.toArray())}}overlayGraphicsOnImage(t,e){this.removeOverlayedGraphicsOnImage(t),this.overlayedMapFeatures.set(t,e),this.activeViewer?.addManyGraphics(e.toArray())}async overlayMapFeatures(t,e=!1){const{activeViewer:i,currentBestFeature:a,mode:r,state:o,layer:n}=this,l=i?.imageSize;if(!l||!a||r==="none"||r==="video"||r==="panoramic-video"||o.includes("loading")||!n)return;const{polygon:d}=Ft(a.attributes);try{const{imageGeometryField:m,oiObjectIdField:g}=Hc(t,n.imageGeometryField,n.imageReferenceField);this.imageGeometryField=m.name,this.oiObjectIdField=g.name}catch(m){O.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",m)}const{features:h}=await t.queryFeatures({geometry:d,returnGeometry:!0,outFields:["*"]}),u=new D((await Promise.all(h.map(async m=>{const g=m.symbol?.clone()??t.renderer?.getSymbol(m)?.clone(),{attributes:p,geometry:y}=m,f=y,{imageGeometryField:w,oiObjectIdField:_}=this;if(w&&_&&kc(t,w,_)&&`${p[_]}`==`${a.attributes.objectId}`)try{return Dc(p,w,t,e,l,r,g)}catch(x){O.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:x,feature:m,layer:t,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(f?.type){case"point":{const x=await this.getPixels(f,{feature:a,imageSize:l,mode:r});return new Q({attributes:p,layer:t,symbol:g,geometry:x,visible:t.visible&&e})}case"polygon":{const{rings:x,spatialReference:b}=f,T=x.map($=>$.map(([S,U,J])=>new L({x:S,y:U,z:J,spatialReference:b}))),I=await Promise.all(T.map(async $=>this.getPixels($,{feature:a,imageSize:l,mode:r}).then(S=>S.map(fe))));return new Q({attributes:p,layer:t,symbol:g,geometry:new ue({rings:I,spatialReference:W.WebMercator}),visible:t.visible&&e})}case"polyline":{const{paths:x,spatialReference:b}=f,T=x.map($=>$.map(([S,U,J])=>new L({x:S,y:U,z:J,spatialReference:b}))),I=await Promise.all(T.map(async $=>this.getPixels($,{feature:a,imageSize:l,mode:r}).then(S=>S.map(fe))));return new Q({attributes:p,layer:t,symbol:g,geometry:new xe({paths:I,spatialReference:W.WebMercator}),visible:t.visible&&e})}case"multipoint":{const{points:x,spatialReference:b}=f,T=x.map(([$,S,U])=>new L({x:$,y:S,z:U,spatialReference:b})),I=await this.getPixels(T,{feature:a,imageSize:l,mode:r}).then($=>$.map(fe));return new Q({attributes:p,layer:t,symbol:g,geometry:new Vr({points:I,spatialReference:W.WebMercator}),visible:t.visible&&e})}}return null}))).filter(xi));this.overlayGraphicsOnImage(`${t.id}`,u)}getDepthAt(t){const{activeViewer:e,currentBestFeature:i,mode:a,state:r,depthImage:o}=this,n=e?.imageSize;if(!n||!i||a==="none"||r.includes("loading"))return O.getLogger(this).warnOnce("oriented-imagery-viewer:get-depth-at","Load an image to use depth"),null;if(!o?.loaded)return O.getLogger(this).error("oriented-imagery-viewer:get-depth-at","Depth image is not loaded"),this.emit("depth-image-service:not-loaded"),null;const l=(Array.isArray(t)?t:[t]).map(d=>o.depthAt(d,{width:n[0],height:n[1]})??null);return Array.isArray(t)?l:l[0]}async getPixels(t,e){const{imageSize:i,mode:a,feature:r}=e,o=(await this.worldToImage(Array.isArray(t)?t:[t],r)).map(n=>{if(a==="default")return new L({x:n.x-.5,y:.5-n.y,spatialReference:W.WebMercator});const[l,d]=i,{heading:h,pitch:u}=je(n,l,d),m=Qe(h,u);return new L(m,W.WebMercator)});return Array.isArray(t)?o:o[0]}async getMapPoint(t,e){const{feature:i,mode:a,imageSize:r}=e,{elevationSample:o,attributes:n}=i,{elevationSource:l,location:d,cameraHeight:h}=n;let u=d.clone();u.spatialReference.isGeographic&&(u=await ae(u,W.WebMercator));const m=await Tt(d.spatialReference,d.z??0,h,{elevationSample:o,elevationSource:l,extent:this.footprintExtent});let g;"elevationSample"in m&&(i.elevationSample=m.elevationSample);const p=Array.isArray(t)?t:[t];if(this.depthImage?.loaded)for(const y of p){const f=this.getDepthAt(y);f!=null&&(y.depth=f)}if(a==="default"){const y=li(n,r[0],r[1]);g=await yt(p,{...y,cameraLocation:u},m)}else{const y=Ya(n,r[0],r[1]);g=await wt(p,{...y,cameraLocation:u},m)}return Array.isArray(t)?g:g[0]}getActiveSectors(){return Qt.filter(t=>this._sectorData?.[t]?.length)}async plotMapPoint(t){return this.plotReferencePoint(t),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:t,options:{signal:this._transformController?.signal}})}plotReferencePointOnGround(t){this._referencePointOnGround&&(this._overlays?.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),t!=null&&(this._referencePointOnGround=new Q({geometry:new L({...t.toJSON()}),symbol:or}),this.view?this._overlays?.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:this._referencePointOnGround?.geometry}}))}plotReferencePointOnImage(t){if(this.state==="image-loaded")switch(this.clearReferencePointOnImage(),this.mode){case"default":{const e=ti(t)?t.toJSON():t;e.x-=.5,e.y=.5-e.y,this._referencePointOnImage=new Q({geometry:new L({spatialReference:this._imageViewer.imageRenderer.spatialReference,...e}),symbol:or}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:e}=this._panoramicViewer;if(!e)return;const[i,a]=e,{heading:r,pitch:o}=je(t,i,a),n=Qe(r,o);this._referencePointOnImage=new Q({geometry:new L(n,W.WebMercator),symbol:Pc}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(t,e=!1){if(this.state==="image-loaded")switch(this.clearLocationPointOnImage(e),this.mode){case"default":this._plotLocationPointOnDefaultImage(t,e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(t,e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach(t=>{this._imageViewer.removeManyGraphics(t.toArray())}),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(t){const e=this.overlayedMapFeatures.get(t);e?.length&&(this.activeViewer?.removeManyGraphics(e.toArray()),this.overlayedMapFeatures.delete(t))}reset(){const{mode:t}=this;t==="default"||t==="panoramic"?this.resetImage():t==="video"?this.resetVideo():t==="panoramic-video"&&this.resetVideoPanoramic(),this.beforeLoad(!1)}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=Ve(this._clickTask)}resetVideo(){this.setMessage("onLoadMessage","info"),this.videoViewModel?.resetVideoHandler(),this._overlays?.removeAll(),this.videoViewModel=null,this.featureCache=[],this.currentBestFeature=null}resetVideoPanoramic(){this.setMessage("onLoadMessage","info"),this._overlays?.removeAll(),this.currentBestFeature=null}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.measurementVectors=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null,this.triangulatedDistanceMeasurement=null,this.triangulatedDistanceAccuracy=null,this.triangulatedAreaMeasurement=null,this.triangulatedMeasurementGraphic=null,this.updatingTriangularMeasurementState=!1,this.triangulatedAreaAccuracy=0}async saveDrawing(){const{dataCaptureLayer:t,sketchAdapter:e}=this;if(!t||e?.type!=="data-capture")return;const{pendingGraphics:i,savedGraphics:a}=e,r=i.get(t.id),o=r?.toArray();if(!r||!o?.length)return;const{addFeatureResults:n}=await this.saveDataCaptureFeatures(o),l=n.reduce((d,{objectId:h,globalId:u,error:m},g)=>{const p=o[g],{attributes:y}=p;return m?d.error.push(p):(h&&(y[t.objectIdField]=h),u&&t.globalIdField&&(y[t.globalIdField]=u),d.success.push(p)),d},{success:[],error:[]});a.addMany(l.success),r.removeAll(),r.addMany(l.error)}async saveDataCaptureFeatures(t){const{activeViewer:e,currentBestFeature:i,dataCaptureLayer:a,mode:r}=this,o=e?.imageSize;if(!o||!i||r==="none"||r==="video"||r==="panoramic-video")throw new N("orientedimageryviewer:missing-input","Image size, current best feature and mode are required to save data capture features");if(!a)throw new N("orientedimageryviewer:missing-featurelayer","Data capture layer is not available");const n=await Promise.all(t.map(async d=>{const h=d.clone(),{geometry:u}=h;if(!u)return;const m=u.type,g=a.hasZ,p=a.geometryType,y=m!==p,f=y?await A(()=>import("./transformers-2yHIGnsa.js"),[]):null,w=f?.default[p],_=y?w?.(u):u;if(_)switch(_.type){case"point":return h.geometry=await this.getMapPoint(Pi(r,_,o),{feature:i,imageSize:o,mode:r}),g||(delete h.geometry.z,h.geometry.hasZ=!1),h.geometry.hasM=!1,h;case"polygon":{const x=await Promise.all(_.rings.map(async b=>this.getMapPoint(b.map(([T,I,$])=>Pi(r,{x:T,y:I,z:$},o)),{feature:i,imageSize:o,mode:r})));return h.geometry=new ue({spatialReference:x[0][0].spatialReference,hasZ:g,hasM:!1,rings:x.map(b=>b.map(fe))}),h}case"polyline":{const x=await Promise.all(_.paths.map(async b=>this.getMapPoint(b.map(([T,I,$])=>Pi(r,{x:T,y:I,z:$},o)),{feature:i,imageSize:o,mode:r})));return h.geometry=new xe({spatialReference:x[0][0].spatialReference,hasZ:g,hasM:!1,paths:x.map(b=>b.map(fe))}),h}}})),l=n.filter(xi);return a.applyEdits({addFeatures:l}).then(d=>{const{addFeatureResults:h}=d;let u=0;const m=n.map(g=>{const p=h[u++];return g?p:{error:new N("orientedimageryviewer:save-unsucccessful","Error in saving data capture features"),objectId:null,globalId:null}});return{...d,addFeatureResults:m}})}async searchBestImage(t,e){try{const i=await di(t,e);i&&await this.processFeatureResponse(i,t.point,e)}catch(i){te(i)||(this.setMessage("imageLoadError","error",i.message),O.getLogger(this).error("error occurred while finding best image",i))}}selectTriangularMeasurementFeature(t){this.currentBestFeatureMeasurementImage=this.features?.find(({attributes:e})=>e.objectId===Number(t))}setAdditionalCameraLocationsVisibility(t){this.additionalCameraLocations.forEach(e=>{e.visible=t})}setAdditionalCoverageVisibility(t){this.additionalFootprints.forEach(e=>{e.visible=t})}setCurrentCoverageVisibility(t){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=t),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=t)}setMapImageConversionToolState(t){this.mapImageConversionToolState=t}setCurrentPanoramaView(t,e){this._panoramicViewer?.set({yaw:t,pitch:e})}async startDataCapture(t,e){const i=this.activeViewer?.imageRenderer,{oiObjectIdField:a,currentBestFeature:r}=this;if(!i||!r||!a)return;const{attributes:{objectId:o}}=r,n=this.overlayedMapFeatures.get(t.id)?.toArray()??[],l=[],d=[];for(const m of n)`${m.getAttribute(a)}`==`${o}`?l.push(m):d.push(m);this.overlayGraphicsOnImage(t.id,new D(d)),this.collectionId=t.id;const h=await this.loadSketch(e),u=await this.loadDataCaptureAdapter(e);P(e),h.addGraphics(l),u.savedGraphics.addMany(l),i.ui.find("zoom").visible=!1,i.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(t=!1){this.sketch?.cancel(),this.sketchGraphicsLayer?.removeAll(),this.sketchAdapter=ce(this.sketchAdapter),this.sketch=ce(this.sketch),this.collectionId=null;const{dataCaptureLayer:e}=this,i=this.activeViewer?.imageRenderer;if(!i||i.destroyed)return;i.map.layers.remove(this.sketchGraphicsLayer),t&&e&&await this.overlayMapFeatures(e,!0);const a=i.ui.find("zoom");a&&(a.visible=!0)}stopMeasurement(){this.heightMeasurementPixels=[],this.draw?.reset(),this.sketch?.cancel()}toggleAllOverlayMapFeatures(t){this.overlayedMapFeatures.forEach(e=>{this._toggleVisiblity(e,t)})}toggleOverlayMapFeatures(t,e,i){const a=this.overlayedMapFeatures.get(t);a&&i&&this._toggleVisiblity(a,e)}toggleSelection(t){const{sketch:e}=this;e&&(e.updateOnGraphicClick=t,e.cancel())}async transformAndPlotReferencePointOnImage(t){const{feature:e,selectedLocation:i,options:a}=t;let r=!1,o=!1;const n=this.bestFeatureFootprint?.geometry;switch(n?.type){case"polygon":{const d=i.spatialReference.equals(n.spatialReference)?i:await ae(i,n.spatialReference);r=n.contains(d);break}case"mesh":{const d=i.spatialReference.equals(n.spatialReference)?i:await ae(i,n.spatialReference);o=n.extent.contains(d);break}}if(!r&&!o)return void this.clearReferencePointOnImage();const l=await this.worldToImage(i,e,a);if(l)return P(a),this.plotReferencePointOnImage(l),{x:l.x,y:l.y};this.clearReferencePointOnImage()}async triangulatedLocationWorkflow(t,e){if(this.currentBestFeature&&t){const{currentBestFeature:i}=this;this.triangulatedPoint&&(this.measurementVectors=[],this.triangulatedPoint=null,this.clearLocationPointOnImage(!0));const a=ki(t,i);if(!a)return;this.measurementVectors.push(a),await this.plotReferenceLocationPoint(t,e),P(e),this._createTriangularImageLocationHandle()}}async updateFeatureCache(t,e){const i=await Nl(t,e);i.features?.length&&(this.featureCache=i.features)}async _calculateTriangulatedPointFromGroundPoint(t,e){if(this.currentBestFeatureMeasurementImage&&t){const{currentBestFeatureMeasurementImage:i,view:a}=this,r=ki(t,i);r&&this.measurementVectors.push(r);let o=await rd(this.measurementVectors);P(e),o?.spatialReference&&a?.spatialReference&&!o.spatialReference.equals(a.spatialReference)&&(o=await ae(o,a.spatialReference)),this.triangulatedPoint=o??this.triangulatedPoint}}async _fetchFeatures(t,e){if(!this.view)return;const i=this.layer;if(i){const a={include:i},r=this.view.toScreen(t);if(!r)return;const o=await this.view.hitTest(r,a);return this._processHitTestResults(i,o,e)}}async _fetchFeaturesWithController(t,e){try{await this._fetchFeatures(t,e)}catch(i){if(te(i))return;this.setMessage("imageLoadError","error"),O.getLogger(this).error("error occurred while fetching features",i)}}_groupFeaturesBySectors(){const{_suitabilities:t,additionalFeatures:e,features:i,invalidCameraHeading:a}=this,r=i.at(0);if(!t||!e||!r||!i||a)return void(this._sectorData=null);this._sectorData={};const o={};this._featureToSector=o;for(const h of Qt)this._sectorData[h]=new D;const n=t.map((h,u)=>({...h,featureIndex:u}));n.sort((h,u)=>h.trueSuitability-u.trueSuitability);const l=n.map(({distance:h})=>h),d=Math.max(...l);n.forEach(h=>{const{distance:u,angle:m,featureIndex:g}=h,p=u/d*G[2],y=xs(u,d),f=bs(m);if(!this._sectorData)return;const w=G[3]+p*Math.sin(m*Math.PI/180),_=G[3]+p*Math.cos(m*Math.PI/180);let x;const b=i.at(g),T=b===r,{cameraPitch:I}=b.attributes,$=I<5;if(T&&$)x=-90;else{const J=w-G[3],re=_-G[3],Re=re/Math.sqrt(J**2+re**2);let Oe=180*Math.acos(Re)/Math.PI;(J<0&&re<0||J<0&&re>0)&&(Oe*=-1),x=Oe}const S=y===""?f:`${y}_${f}`;T&&(x===this.bestFeatureAngle?this.previousFeatureAngle=x:this.bestFeatureAngle=x,this.navigatorCurrentBestFeature=$?null:{x:w,y:_,direction:f}),o[`${b.attributes.objectId}`]=S;const U=this._sectorData[S];U.add({angle:m,featureIndex:g,x:w,y:_,objectID:b.attributes.objectId,sector:S,featureIndexInSector:U.length})})}_handleDestroyedTriangularSketchLayer(){this.sketchTriangularGraphicsLayer&&this.activeTriangulatedViewer&&(this.activeTriangulatedViewer.imageRenderer.map.layers.remove(this.sketchTriangularGraphicsLayer),this.sketchTriangularGraphicsLayer=new qe,this.activeTriangulatedViewer.imageRenderer.map.layers.add(this.sketchTriangularGraphicsLayer),this.sketchTriangular&&(this.sketchTriangular.layer=this.sketchTriangularGraphicsLayer,this.sketchTriangular.view=this.activeTriangulatedViewer.imageRenderer))}_initializeMeasurementService(){this._measurementService||(this._measurementService=new bd(this))}_initializeSketchTriangular(){if(!this.activeTriangulatedViewer)return;const t=this.mode==="panoramic";this.sketchTriangular=new us({view:this.activeTriangulatedViewer.imageRenderer,layer:this.sketchTriangularGraphicsLayer,updateOnGraphicClick:!1,defaultUpdateOptions:{toggleToolOnClick:!1,enableZ:!t}}),t&&(this.sketchTriangular.defaultUpdateOptions.reshapeOptions={edgeOperation:"offset",shapeOperation:"move-xy",vertexOperation:"move-xy"})}_initializeSketchTriangularGraphicsLayer(){this.activeTriangulatedViewer&&(this.sketchTriangularGraphicsLayer=new qe,this.activeTriangulatedViewer.imageRenderer.map.layers.add(this.sketchTriangularGraphicsLayer))}_initializeVideo(){if(this.videoElement||!this.currentBestFeature)return;this.removeHandles(K.videoPlayerHandles),this.videoElement=new Kn({video:this.currentBestFeature.attributes.imagePath,georeference:new es({extent:new aa(ys)}),autoplay:!1}),this.videoElement.content?.loop&&(this.videoElement.content.loop=!1);const t=new Jn({source:this.videoElement,title:this.layer?.title,copyright:this.layer?.copyright});this.videoLayer=t,t&&this.videoMapView.map.layers.add(t),this.addHandles(cd(this.videoMapView),K.videoPlayerHandles),this.videoViewModel=new gd({oiViewModel:this})}_plotLocationPointOnDefaultImage(t,e=!1){const i=ti(t)?t.toJSON():t;i.x-=.5,i.y=.5-i.y,e?(this._correctedLocationPointOnImage=new Q({geometry:new L({spatialReference:W.WebMercator,...i}),symbol:sr}),this.imageMeasurementViewer.addGraphic(this._correctedLocationPointOnImage,0)):(this._locationPointOnImage=new Q({geometry:new L({spatialReference:W.WebMercator,...i}),symbol:sr}),this._imageViewer.addGraphic(this._locationPointOnImage,0))}_plotLocationPointOnPanoramicImage(t,e=!1){const i=e?this._panoramicMeasurementViewer:this._panoramicViewer,{imageSize:a}=i;if(!a)return;const[r,o]=a,{heading:n,pitch:l}=je(t,r,o),d=Qe(n,l),h=new Q({geometry:new L(d,W.WebMercator),symbol:Fc});e?this._correctedLocationPointOnImage=h:this._locationPointOnImage=h,i.addGraphic(h,0)}_clearFeatureGeometries(){this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll()}_checkFeatures(t){return!!t?.length||(this.setMessage("noImageError","error"),this.videoElement?.content?.pause(),this.currentBestFeature=null,!1)}async _getElevationSampleFromGround(t,e,i){if(!t[0])return;const a=await Rl(t);if(this._updateFootprintWithFeatures(e,a),this.view?.type==="3d")try{return await this.view.map.ground.createElevationSampler(this.footprintExtent,i)}catch(r){te(r)||O.getLogger(this).error(r)}}async processElevationSample(t,e,i){const{elevationSource:a}=e[0].attributes;return await this._getElevationSampleFromGround(t,e,i)||(a&&this.footprintExtent&&pa(a)?await xa({extent:this.footprintExtent,lod:a.lod,url:a.url,rasterFunction:a.rasterFunction}):void 0)}_processSuitableFeatures(t,e){return jl({features:t,selectedPoint:e,camera:fs(this.view)?this.view.camera:null,currentImage:this.currentBestFeature})}async _processHitTestResults(t,e,i){const{screenPoint:a,results:[r]}=e,o=r?.type==="graphic"&&this.shouldShowSelectedImage,n=r?.mapPoint??this.view?.toMap(a);if(!n)return;n.x=Da(n.x,n.spatialReference);const{layerFloorFilterClause:l}=this,d=t.spatialReference.equals(n.spatialReference)?n:await ae(n,t.spatialReference),h=d.spatialReference.isGeographic?Wt(d):d,u=Ee("1=1",Ee(t.definitionExpression,l)),m=h.spatialReference.isGeographic?1:Bi(h.spatialReference),g={layerInstanceOrURL:t,point:h,queryParams:{where:u,maximumDistance:t.maximumDistance?t.maximumDistance/m:void 0,objectIds:o?[r.graphic.getAttribute(t.objectIdField)]:void 0}};await this.searchBestImage(g,i)}async _queryAndLoadByObjectId(t,e,i,a){this.displayMessage=null;const{response:r}=await fd(t,e,i,a);if(P(a),!r?.features?.length)throw new wd(e);const o=Ft(r.features[0].attributes).polygon,n=L.fromJSON(da(o)),l=Wi(n),d=Bi(l.spatialReference);this.selectedPoint=l;const h={layerInstanceOrURL:t,point:l,queryParams:{where:Ee(Ee("1=1",Ee(t.definitionExpression,i)),`${t.objectIdField} <> ${e}`),maximumDistance:t.maximumDistance?t.maximumDistance/d:void 0}},u=await di(h,a);P(a);const{features:m}=u;return m.push(r.features[0]),await this.processFeatureResponse(u,l,{...a,loadBestImage:!1})}_reorderTriangularSketchLayer(){const t=this.imageMeasurementViewer.imageRenderer.map.layers?.length;this.sketchTriangularGraphicsLayer&&t&&this.imageMeasurementViewer.imageRenderer.map.layers.reorder(this.sketchTriangularGraphicsLayer,t-1)}_resetCursor(){const{activeViewer:t,imageMeasurementViewer:e}=this;t&&this.removeHandles(K.activeViewerCursorHandles),e&&this.removeHandles(K.imageViewerCursorHandles)}async _setImageSource(t,e,i,a,r,o){t.imageSource={datasetFormat:e.toUpperCase(),url:i.split("?")[0]},t.customParameters=Object.fromEntries(a),t.imageRotation=r??0,await t.loadImage(o)}_setMeasurementCursor(){const{activeViewer:t,imageMeasurementViewer:e,triangularMeasurementActive:i}=this;t&&this.addHandles(t.imageRenderer.acquireCursor("crosshair","high"),K.activeViewerCursorHandles),e&&i&&this.addHandles(e.imageRenderer.acquireCursor("crosshair","high"),K.activeViewerCursorHandles)}_toggleVisiblity(t,e){t.forEach(i=>{i.visible=e})}async _updateElevationOfSelectedPointAndLocations(t,e,i,a){const{location:r,cameraHeight:o}=t[0].attributes,n=await Tt(r.spatialReference,r.z,o,{elevationSample:i,elevationSource:i?void 0:t[0].attributes.elevationSource,extent:this.footprintExtent},a);P(a);const[l,...d]=await gt([e,...t.map(h=>h.attributes.geometry.clone())],n);P(a),e.elevation=l.z,t.forEach((h,u)=>{h.attributes.elevation=d[u].z})}_updateFeatures(t,e=!0){if(!t.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(t),this.navigationNodes.removeAll(),this.navigationNodes.addMany(t.map(i=>{const{geometry:a,attributes:r}=i,{isSpherical:o,cameraHeading:n,cameraPitch:l}=r;return new pd({geometry:a,attributes:r,currentHeading:o?0:n,currentPitch:o?0:l})})),t.length>1?this.additionalFeatures.addMany(t.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,e&&(this.currentBestFeature=t[0]),this.mode==="video"&&(this._initializeVideo(),this.videoElement?.loaded&&this.videoViewModel?.playVideoFromSelectedLocation(t[0])),this.mode==="panoramic-video"&&this._loadVideo()}_updateFootprintWithFeatures(t,e){const i=[];for(const{attributes:{geometry:a}}of t)e.contains(a)||i.push([a.x,a.y]);i.sort((a,r)=>+Pn([a,r])),e.addRing(i),this.footprintExtent=as(e.extent,2,2)}async _updatePointsAndPolygons(t){const{pointSources:e,currentBestFeature:i,currentCoverageVisible:a,isAdditionalPointSourcesVisible:r,mode:o,layer:n}=this;if(i&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await this._adapter?.createFootprints(t),P(t);for(const l of e){const d=this.view&&!this.view.spatialReference?.equals(l.spatialReference)?await ae(l.clone(),this.view?.spatialReference,t):l.clone();l.imageID===i.attributes.objectId?this.currentBestFeatureLocation=new Q({attributes:{imageID:l.imageID},geometry:d,symbol:Tc,visible:a}):this.additionalCameraLocations.push(new Q({attributes:{imageID:l.imageID},geometry:d,symbol:Po,visible:r}))}o!=="video"&&o!=="panoramic-video"||!n||this.featureCache.length||await this.updateFeatureCache(n,i.geometry.spatialReference)}}_updateCurrentBestFeature(t){if(!t)return;if(this.currentBestFeature=this.features?.at(t.featureIndex),this.mode==="video")return void(this.currentBestFeature&&this.videoViewModel?.playVideoFromSelectedLocation(this.currentBestFeature));if(this.mode==="panoramic-video")return void(this.currentBestFeature&&this._panoramicVideoViewer.viewModel.playPanoramicVideoFromSelectedLocation(this.currentBestFeature));const e=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;let i;if(e)i=-90;else{const a=t.x-G[3],r=t.y-G[3],o=r/Math.sqrt(a**2+r**2);let n=180*Math.acos(o)/Math.PI;(a<0&&r<0||a<0&&r>0)&&(n*=-1),i=n}i===this.bestFeatureAngle?this.previousFeatureAngle=i:this.bestFeatureAngle=i,this.navigatorCurrentBestFeature=e?null:{x:t.x,y:t.y,direction:t.sector.includes("_")?t.sector.split("_")[1]:t.sector}}_updateImageMeasurementBestFeature(t){t&&(this.currentBestFeatureMeasurementImage=this.features?.at(t.featureIndex))}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics(),this.imageMeasurementViewer.clearGraphics(),this._panoramicMeasurementViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=ce(this._referencePointOnImage))}clearLocationPointOnImage(t=!1){this._locationPointOnImage&&!t&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=ce(this._locationPointOnImage)),this._correctedLocationPointOnImage&&(this.imageMeasurementViewer.removeGraphic(this._correctedLocationPointOnImage),this._panoramicMeasurementViewer.removeGraphic(this._correctedLocationPointOnImage),this._correctedLocationPointOnImage=ce(this._correctedLocationPointOnImage))}plotReferencePoint(t){"mapPoint"in t?this.plotReferencePointOnGround(t.mapPoint):this.plotReferencePointOnGround(t)}async plotReferenceLocationPoint(t,e){if(this.currentBestFeatureMeasurementImage){const i=await this.worldToImage(t,this.currentBestFeatureMeasurementImage,{signal:e});P(e),i&&this.plotLocationPointOnImage(i,!0)}}setMessage(t,e,i,a){this.displayMessage={key:t,type:e,data:i,map:a}}async transformAndPlotSelectedLocation(t){const{currentBestFeature:e,invalidCameraHeading:i,selectedPoint:a,activeViewer:r}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=ce(this._crossSymbol)),!a||!e||r?.state!=="image-loaded"||i)return;let o;try{o=await this.worldToImage(a,e,t),P(t),await this.plotSelectedPointOnImage(o,t)}catch(n){te(n)||O.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:n,selectedPoint:a,feature:e})}}async worldToImage(t,e,i){const{footprintExtent:a}=this,{imageSize:r}=this.activeViewer;if(this.mode==="none"||!e||!r||!a)return;const{attributes:{location:o,elevationSource:n,cameraHeading:l,cameraHeight:d},elevationSample:h}=e;let u=o.clone();const m=await Tt(o.spatialReference,o.z??0,d,{elevationSample:h,elevationSource:n});e.elevationSample=m.elevationSample;const g=Array.isArray(t)?t:[t];let p,y=await Promise.all(g.map(f=>new Promise(w=>{if(!f.hasZ)return w(gt(f,m));w(f)})));if(o.spatialReference.isGeographic&&(u=await ae(u,W.WebMercator,i)),y=await Promise.all(y.map(async f=>u.spatialReference.equals(f.spatialReference)?f:await ae(f,u.spatialReference,i))),P(i),this.mode==="panoramic")p=vt(y,{imageHeight:r[1],imageWidth:r[0],cameraHeading:l,cameraLocation:u});else{const f=Jr(e.attributes,r[0],r[1]);p=De(y,{...f,cameraLocation:u})}return Array.isArray(t)?p:p[0]}updateCurrentCoveragePolygon(t){const{additionalFootprints:e,additionalCameraLocations:i,currentBestFeature:a,currentBestFeatureLocation:r,currentCoverageVisible:o,selectedPoint:n,view:l,_adapter:d,mode:h}=this;if(!a)return;const{attributes:{objectId:u},elevationSample:m}=a;if(this._initialCurrentCoverageUpdate){if(this._overlays?.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=ce(this.bestFeatureCurrentFootprint),t&&!this.invalidCameraHeading&&(t.visible=o,this.bestFeatureCurrentFootprint=t),l){const g=[...e,...i,r].filter(_s);l?.type==="3d"&&m&&d?.updateGroundElevation&&(this._updateGroundElevation&&d.updateGroundElevation(g),h==="panoramic"&&d.updateGroundElevation([this.bestFeatureCurrentFootprint])),this._updateGroundElevation=!1,n&&(g.splice(-2,0,this.bestFeatureCurrentFootprint),g.push(new Q({geometry:n.clone(),symbol:nr.clone(),attributes:{imageID:u}}))),this._overlays.graphics.addMany(g)}}else if(l){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&(this._overlays?.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=ce(this.bestFeatureCurrentFootprint));const g=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;t&&(this.bestFeatureCurrentFootprint=t,l?.type==="3d"&&m&&d?.updateGroundElevation&&h==="panoramic"&&d.updateGroundElevation([t]),t.visible=this.currentCoverageVisible,this._overlays?.graphics.add(this.bestFeatureCurrentFootprint,g>=0?g:this._overlays.graphics.length-1))}}};s([c()],M.prototype,"activeLayer",null),s([c({readOnly:!0})],M.prototype,"activeViewer",null),s([c()],M.prototype,"activeTriangulatedViewer",null),s([c()],M.prototype,"accuracyParametersMissing",null),s([c()],M.prototype,"additionalFeatures",void 0),s([c({type:D.ofType(Q)})],M.prototype,"additionalCameraLocations",void 0),s([c({type:D.ofType(Q)})],M.prototype,"additionalFootprints",void 0),s([c()],M.prototype,"areaMeasurementResult",void 0),s([c()],M.prototype,"areaMeasurementAccuracy",void 0),s([c()],M.prototype,"bestFeatureAngle",void 0),s([c()],M.prototype,"bestFeatureCurrentFootprint",void 0),s([c({type:Q})],M.prototype,"bestFeatureFootprint",void 0),s([c({type:Number})],M.prototype,"brightness",null),s([c()],M.prototype,"cameraHeadingThreshold",void 0),s([c()],M.prototype,"cameraPitchThreshold",void 0),s([c()],M.prototype,"clickAction",void 0),s([c()],M.prototype,"videoViewModel",void 0),s([c()],M.prototype,"collectionId",void 0),s([c({type:Number})],M.prototype,"contrast",null),s([c()],M.prototype,"conversionProps",void 0),s([c()],M.prototype,"coverageFrustums",void 0),s([c()],M.prototype,"coveragePolygons",void 0),s([c()],M.prototype,"currentBestFeature",void 0),s([c()],M.prototype,"currentBestFeatureMeasurementImage",void 0),s([c()],M.prototype,"currentBestFeatureLocation",void 0),s([c()],M.prototype,"currentCoverageVisible",void 0),s([c()],M.prototype,"currentNode",null),s([c()],M.prototype,"depthImage",void 0),s([c()],M.prototype,"depthImageNotSupported",null),s([c()],M.prototype,"directionMode",void 0),s([c()],M.prototype,"featureCache",void 0),s([c()],M.prototype,"navigationNodes",void 0),s([c({json:{write:!1}})],M.prototype,"determineWorkflowForFeature",void 0),s([c({json:{write:!1}})],M.prototype,"determineWorkflowForTriangularMeasurement",void 0),s([c()],M.prototype,"disabled",void 0),s([c()],M.prototype,"displayMessage",void 0),s([c()],M.prototype,"displayNewMeasurementButton",void 0),s([c()],M.prototype,"distanceMeasurementResult",void 0),s([c()],M.prototype,"distanceAccuracyArray",void 0),s([c()],M.prototype,"dataCaptureLayer",void 0),s([c({readOnly:!0})],M.prototype,"featureCount",null),s([c()],M.prototype,"features",void 0),s([c()],M.prototype,"groundCoordinates",void 0),s([c()],M.prototype,"groundCoordinatesAccuracy",void 0),s([c()],M.prototype,"heightMeasurementPixels",void 0),s([c()],M.prototype,"heightGraphic",void 0),s([c()],M.prototype,"heightMeasurementResult",void 0),s([c()],M.prototype,"heightMeasurementAccuracy",void 0),s([c()],M.prototype,"measurementAngle",void 0),s([c()],M.prototype,"tempDistance",void 0),s([c({readOnly:!0})],M.prototype,"imageGalleryEnabled",null),s([c()],M.prototype,"imageGeometryField",void 0),s([c({readOnly:!0})],M.prototype,"imageLoaded",null),s([c()],M.prototype,"imageLocationToolState",void 0),s([c({readOnly:!0})],M.prototype,"invalidCameraHeading",null),s([c()],M.prototype,"imagePointsInView",null),s([c()],M.prototype,"imageMeasurementViewer",void 0),s([c()],M.prototype,"isAdditionalCoverageVisible",void 0),s([c()],M.prototype,"isAdditionalPointSourcesVisible",void 0),s([c()],M.prototype,"measurementVectors",void 0),s([c()],M.prototype,"layer",void 0),s([c()],M.prototype,"layerView",null),s([c({readOnly:!0})],M.prototype,"layerFloorFilterClause",null),s([c({type:Number})],M.prototype,"localPort",void 0),s([c()],M.prototype,"mapImageConversionToolState",void 0),s([c()],M.prototype,"measureType",void 0),s([c()],M.prototype,"measurementGraphic",void 0),s([c({readOnly:!0,value:"none"})],M.prototype,"mode",null),s([c()],M.prototype,"navigationMode",void 0),s([c()],M.prototype,"navigatorCurrentBestFeature",void 0),s([c()],M.prototype,"oiObjectIdField",void 0),s([c({type:D.ofType(Q)})],M.prototype,"overlayedCameraLocations",void 0),s([c()],M.prototype,"overlayedMapFeatures",void 0),s([c()],M.prototype,"panoramicVideoLoaded",null),s([c()],M.prototype,"pixelCoordinates",void 0),s([c()],M.prototype,"preserveAngle",void 0),s([c()],M.prototype,"pointSources",void 0),s([c({readOnly:!0})],M.prototype,"popupEnabled",null),s([c()],M.prototype,"previousFeatureAngle",void 0),s([c()],M.prototype,"referencePoint",null),s([c({readOnly:!0})],M.prototype,"sectorData",null),s([c()],M.prototype,"selectedPoint",void 0),s([c({type:Number})],M.prototype,"sharpness",null),s([c()],M.prototype,"shouldShowSelectedImage",void 0),s([c()],M.prototype,"sketch",void 0),s([c()],M.prototype,"sketchTriangular",void 0),s([c()],M.prototype,"sketchTriangularGraphicsLayer",void 0),s([c()],M.prototype,"draw",void 0),s([c()],M.prototype,"sketchAdapter",void 0),s([c({readOnly:!0})],M.prototype,"sketchGraphicsLayer",null),s([c({readOnly:!0})],M.prototype,"state",null),s([c({readOnly:!0})],M.prototype,"thumbnails",null),s([c()],M.prototype,"triangularMeasurementActive",void 0),s([c()],M.prototype,"triangulatedDistanceMeasurement",void 0),s([c()],M.prototype,"triangulatedDistanceAccuracy",void 0),s([c()],M.prototype,"triangulatedAreaMeasurement",void 0),s([c()],M.prototype,"triangulatedAreaAccuracy",void 0),s([c()],M.prototype,"triangulatedMeasurementGraphic",void 0),s([c()],M.prototype,"triangulatedPoint",void 0),s([c()],M.prototype,"triangulatedMeasurementAdapter",void 0),s([c()],M.prototype,"updateFootprint",void 0),s([c()],M.prototype,"updateFootprintPanorama",void 0),s([c()],M.prototype,"updatingTriangularMeasurementState",void 0),s([c({value:null})],M.prototype,"view",null),s([c()],M.prototype,"videoElement",void 0),s([c()],M.prototype,"videoLayer",void 0),s([c()],M.prototype,"videoMapView",void 0),s([c()],M.prototype,"_adapter",void 0),s([c()],M.prototype,"_defaultGraphicsLayer",null),s([c()],M.prototype,"_highlightedFeatureHandle",void 0),s([c()],M.prototype,"_imageViewer",void 0),s([c()],M.prototype,"_initialCurrentCoverageUpdate",void 0),s([c()],M.prototype,"_locationPointOnImage",void 0),s([c()],M.prototype,"_measurementService",void 0),s([c()],M.prototype,"_correctedLocationPointOnImage",void 0),s([c()],M.prototype,"_overlays",void 0),s([c({readOnly:!0})],M.prototype,"_overlaysView",null),s([c()],M.prototype,"_panoramicVideoViewer",void 0),s([c()],M.prototype,"_panoramicViewer",void 0),s([c()],M.prototype,"_panoramicMeasurementViewer",void 0),s([c()],M.prototype,"_referencePointOnGround",void 0),s([c()],M.prototype,"_referencePointOnImage",void 0),s([c()],M.prototype,"_sectorData",void 0),s([c()],M.prototype,"_featureToSector",void 0),s([c({readOnly:!0})],M.prototype,"_updatingHandles",void 0),s([c()],M.prototype,"footprintExtent",void 0),s([c()],M.prototype,"_featureChangedTask",void 0),M=s([ie("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],M);const No=M;let se=class extends bt{constructor(){super(...arguments),this.additionalFootprintToggle=!0,this.additionalCameraLocationsToggle=!0,this.currentFootprintToggle=!0,this.imageEnhancement=!0,this.imageGallery=!0,this.imageOverlays=!0,this.measurementTools=!0,this.mapImageConversionTool=!0,this.menu=!0,this.navigationTool=!0,this.digitization=!0,this.title=!0,this.showPopupsAction=!0,this.directionalNavigation=!0,this.sequentialNavigation=!0}get coverageMenu(){return Ke(O.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu}set coverageMenu(e){Ke(O.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu=e}};s([c({type:Boolean,nonNullable:!0})],se.prototype,"additionalFootprintToggle",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"additionalCameraLocationsToggle",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"currentFootprintToggle",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"coverageMenu",null),s([c({type:Boolean,nonNullable:!0})],se.prototype,"imageEnhancement",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"imageGallery",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"imageOverlays",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"measurementTools",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"mapImageConversionTool",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"menu",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"navigationTool",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"digitization",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"title",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"showPopupsAction",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"directionalNavigation",void 0),s([c({type:Boolean,nonNullable:!0})],se.prototype,"sequentialNavigation",void 0),se=s([ie("esri.widgets.OrientedImageryViewer.OrientedImageryViewerVisibleElements")],se);const Bo=se,Vd=()=>Te({alert:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.M$),__vite__mapDeps([0,1]))});function Pd({autoCloseDuration:t,bind:e,icon:i,kind:a,message:r,onClose:o,open:n,title:l,tooltip:d}){return v("calcite-alert",{autoClose:!!t,autoCloseDuration:t??"medium",bind:e,icon:i,kind:a,label:l,open:n,slot:"alerts",onCalciteAlertClose:o},v("div",{slot:"title",title:d},l),r?v("div",{slot:"message"},r):null)}let be=class extends tt{constructor(e){super(e),this.messages=null,this.messagesCommon=null,this.accuracy=null,this._selectedSystem="Basemap",this._handleSystemSelection=i=>{this._selectedSystem=i.target.value}}loadDependencies(){return Te({action:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MV),__vite__mapDeps([0,1])),block:()=>A(()=>import("./index-C6Bg1Dv_.js"),__vite__mapDeps([187,0,1])),panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(e=>e.MZ),__vite__mapDeps([0,1])),select:()=>A(()=>import("./index-wZEQ7UQo.js"),__vite__mapDeps([188,0,1])),option:()=>A(()=>import("./index-XWTXosd7.js"),__vite__mapDeps([189,0,1])),table:()=>A(()=>import("./index-BKl3hgfS.js"),__vite__mapDeps([190,0,1,191,192])),"table-row":()=>A(()=>import("./index-Z8M091uh.js"),__vite__mapDeps([193,0,1,194,195])),"table-header":()=>A(()=>import("./index-DJJfznxJ.js"),__vite__mapDeps([194,0,1])),"table-cell":()=>A(()=>import("./index-CpqZ5vpU.js"),__vite__mapDeps([195,0,1]))})}get _renderLocationBlock(){const{groundCoordinates:e,_selectedSystem:i}=this;return e&&i==="XY"?v("calcite-block",{heading:this.getLocation(),headingLevel:6}):null}get _renderLocationTable(){const{groundCoordinates:e,messages:i,_selectedSystem:a,accuracy:r}=this,o={groundX:e.x.toFixed(3),accuracyX:r?.x!=null?r.x.toFixed(3):"",groundY:e.y.toFixed(3),accuracyY:r?.y!=null?r.y.toFixed(3):"",groundZ:e.z?e.z.toFixed(3):"",accuracyZ:r?.z!=null?r.z.toFixed(3):""};return e&&a==="Basemap"?v("calcite-table",{bordered:!0,caption:i.measurementTable,class:C.measurementsTable,scale:"s"},v("calcite-table-row",{slot:"table-header"},v("calcite-table-header",{alignment:"center",heading:i.type}),v("calcite-table-header",{alignment:"center",heading:i.value}),v("calcite-table-header",{alignment:"center",heading:i.accuracy})),v("calcite-table-row",null,v("calcite-table-cell",{alignment:"center"},i.x),v("calcite-table-cell",{alignment:"center"},o.groundX),v("calcite-table-cell",{alignment:"center"},o.accuracyX)),v("calcite-table-row",null,v("calcite-table-cell",{alignment:"center"},i.y),v("calcite-table-cell",{alignment:"center"},o.groundY),v("calcite-table-cell",{alignment:"center"},o.accuracyY)),v("calcite-table-row",null,v("calcite-table-cell",{alignment:"center"},i.z),v("calcite-table-cell",{alignment:"center"},o.groundZ),v("calcite-table-cell",{alignment:"center"},o.accuracyZ))):null}get _renderSystemSelect(){const{messages:e,messagesCommon:i,groundCoordinates:a}=this,r=a.spatialReference.unit==="feet"?e.xyzFeet:e.xyz;return v("div",{class:C.measurementsBar},v("calcite-select",{bind:this,label:e.selectUnitSystem,scale:"m",width:"full",onCalciteSelectChange:this._handleSystemSelection},v("calcite-option",{value:"Basemap"},r),v("calcite-option",{value:"XY"},e.decimalDegrees)),v("calcite-action",{icon:"copy-to-clipboard",onclick:()=>this.copyLocation(),scale:"s",slot:"control",text:"Copy",title:i.copy}))}copyLocation(){const{groundCoordinates:e}=this;if(!e)return;const i=this.getLocation();i&&nd(i)}getLocation(){const{_selectedSystem:e,groundCoordinates:i,accuracy:a}=this;return e==="Basemap"?this.getBasemapLocation(i,a):this.getXYLocation(i)}getXYLocation(e){if(e?.longitude==null||e?.latitude==null)return"";const i={groundX:e.longitude.toFixed(6),groundY:e.latitude.toFixed(6)};return qi("{groundX} , {groundY}",i)}getBasemapLocation(e,i){if(e?.x==null||e?.y==null)return"";const a={groundX:e.x.toFixed(3),accuracyX:i?.x?i.x.toFixed(3):0,groundY:e.y.toFixed(3),accuracyY:i?.y?i.y.toFixed(3):0,groundZ:e.z?e.z.toFixed(3):0,accuracyZ:i?.z?i.z.toFixed(3):0};return qi("{groundX}  {accuracyX},  {groundY}  {accuracyY}, {groundZ}  {accuracyZ}",a)}render(){return v("calcite-panel",{class:C.measurementResults,key:"ground-location-container"},this._renderSystemSelect,this._renderLocationBlock,this._renderLocationTable)}};s([c()],be.prototype,"messages",void 0),s([c(),ze("esri/t9n/common")],be.prototype,"messagesCommon",void 0),s([c()],be.prototype,"groundCoordinates",void 0),s([c()],be.prototype,"accuracy",void 0),s([c()],be.prototype,"_selectedSystem",void 0),s([c()],be.prototype,"_renderLocationBlock",null),s([c()],be.prototype,"_renderLocationTable",null),s([c()],be.prototype,"_renderSystemSelect",null),be=s([ie("esri.widgets.OrientedImageryViewer.components.ImageLocationWidget")],be);const Fd=be;let ke=class extends Fn(bt){constructor(t){super(t),this.active=!1,this.disabled=!1,this.text=null,this.icon=null,this.title=null}};s([c()],ke.prototype,"active",void 0),s([c()],ke.prototype,"disabled",void 0),s([c()],ke.prototype,"text",void 0),s([c()],ke.prototype,"icon",void 0),s([c()],ke.prototype,"title",void 0),s([c()],ke.prototype,"onclick",void 0),ke=s([ie("esri.widgets.OrientedImageryViewer.components.NavigationAction")],ke);const ta=ke;function Cd(){return Te({"action-menu":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MX),__vite__mapDeps([0,1])),action:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MV),__vite__mapDeps([0,1]))})}const Ad=D.ofType(ta);function $d(t){const{activeAction:e,actions:i}=t,a=i.length;return a===0?v("div",{"data-testid":"no-actions",hidden:!0}):a>1?v("calcite-action-menu",{"data-testid":"action-menu",label:t.label,scale:t.scale},v("calcite-action",{active:!!e,"data-testid":"action-menu-trigger",icon:e?.icon??t.icon,slot:"trigger",text:e?.text??t.label,title:e?.title??t.title}),i.items.map(r=>v("calcite-action",{active:r.active,"data-testid":r.uid,disabled:r.disabled,icon:r.icon,key:r.uid,onclick:r.onclick,text:r.text,textEnabled:!0,title:r.title}))):v("calcite-action",{active:i.items[0].active,"data-testid":"action",disabled:i.items[0].disabled,icon:i.items[0].icon,onclick:i.items[0].onclick,text:i.items[0].text,title:i.items[0].title})}function Sd(){return Te({panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MZ),__vite__mapDeps([0,1])),action:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MV),__vite__mapDeps([0,1])),label:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.N6),__vite__mapDeps([0,1])),slider:()=>A(()=>import("./index-B4P055yQ.js"),__vite__mapDeps([177,0,1]))})}function Rd(t){const{uiStrings:e,videoEnhancementToolActive:i,resetTools:a,onClose:r,brightness:o,constrast:n,handleBrightnessChange:l,handleContrastChange:d}=t,{reset:h,videoEnhancement:u}=e;return v("calcite-panel",{class:C.imageEnhancementWrapper,closable:!0,closed:!i,heading:u,key:u,onCalcitePanelClose:r},v("div",{class:C.imageEnhancementTools},$t({title:e.brightness,value:o,handleChange:l}),$t({title:e.contrast,value:n,handleChange:d})),v("calcite-action",{icon:"reset",onclick:a,slot:"header-actions-end",text:h}))}function $t({title:t,value:e,handleChange:i,max:a=10,min:r=0,ticks:o=2,step:n=1}){return v("div",{class:C.imageEnhancementToolContainer},v("calcite-label",null,t,v("calcite-slider",{labelTicks:!0,max:a,min:r,step:n,ticks:o,value:e,onCalciteSliderInput:i})))}const ei={overlayed:"overlayed"};let V=class extends tt{constructor(t,e){super(t,e),this.dataCaptureEnabled=!1,this.galleryOpened=!1,this.imageEnhancementToolActive=!1,this.videoEnhancementToolActive=!1,this.imageOverlaysOpened=!1,this.navigationToolActive=!1,this.viewModel=new No,this.messagesCommon=null,this.messagesSketch=null,this.pixelMeasurementUnit="meters",this.pixelAreaMeasurementUnit="square-meters",this.showCameraLocations=!1,this.showMapFeatures=!1,this.visibleElements=new Bo,this._imageOverlaysLoaderTask=null,this._imageMeasurementToolsLoaderTask=null,this._navigationSettingsLoaderTask=null,this._clearMeasurements=()=>{this.viewModel.measureType=null,this.viewModel.triangularMeasurementActive=!1,this.viewModel.clearPreviousMeasurements()},this._clearImageLocation=()=>{this.imageLocationToolActive=!1,this.triangularMeasurementActive=!1},this._navigationToolExpanded=!1,this._navigationTool=null,this._galleryController=new AbortController,this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this)),this._overlayedLayers=new D,this._previousAction=null,this._handleDataCaptureLayerChange=async i=>{if(this.dataCaptureLayer&&await this.stopDataCapture(!0),this.dataCaptureLayer=this.dataCaptureLayer===i?null:i,this.dataCaptureLayer)return this.startDataCapture(this.dataCaptureLayer)},this._handleNavigationSettingsInputChange=(i,a)=>{this.set(`${i}Threshold`,a)},this._handleNavigationSettingsToggle=i=>{this.viewModel.preserveAngle=i},this._handleOverlayLayerDeselect=i=>{const a=i.layer;a===this.dataCaptureLayer&&(this.stopDataCapture(),this.dataCaptureLayer=null),this.removeOverlayedGraphicsOnImage(`${a.id}`)},this._handleOverlayLayerSelect=i=>{const a=i.layer;this.viewModel.overlayMapFeatures(a,this.showMapFeatures),this.addHandles(R(()=>a.visible,()=>{this.viewModel.toggleOverlayMapFeatures(a.id,a.visible,this.showMapFeatures)}),`${ei.overlayed}-${a.id}`)},this._highlight=i=>{const a=i.target?.dataset.objectid;a&&this.viewModel.highlight(a)},this._onAction=i=>{const{target:a}=i,{dataset:{action:r}}=a,{_previousAction:o}=this,n=o?.dataset.action,l=n?.includes("draw")??!1,d=n==="select-feature",h=n!==r;switch(r){case"draw-point":case"draw-polygon":case"draw-polyline":{o&&Se(d,l&&h)&&(o.active=!1),a.active=!a.active;const u=r.replace("draw-","");this.viewModel.digitizeCreate(u),this._previousAction=a.active?a:null;break}case"save":this.viewModel.saveDrawing();break;case"select-feature":l&&(this._previousAction.active=!1),a.active=!a.active,this.viewModel.toggleSelection(a.active),this._previousAction=a.active?a:null;break;case"delete-feature":this.viewModel.digitizeDelete()}},this._onImageOverlayClosed=()=>{this.imageOverlaysOpened=!1},this._onShowCameraLocationsChanged=i=>{this.showCameraLocations=i},this._onShowMapFeaturesChanged=i=>{this.showMapFeatures=i},this._removeHighlight=()=>this.viewModel.removeHighlight(),this._restoreOverlays=async()=>Promise.all(this._overlayedLayers.map(i=>this.viewModel.overlayMapFeatures(i,this.showMapFeatures))),this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded},this._sketchLoaderTask=null,this._settingsToggle=null,this._toggleImageNavigation=async i=>{const a=this.navigationMode;this._closeAllImageTools(),this.navigationMode=a!==i?i:null;const{activeViewer:r}=this.viewModel;if(!r)return;const{mode:o,preserveAngle:n}=this.viewModel;if(o==="default")if(this.navigationMode==="directional"){const l=await this._loadNavigationSettings(),d=n==="heading"||n==="both",h=n==="pitch"||n==="both",{messages:u,messagesCommon:m}=this,g=new l({cameraHeadingThreshold:this.cameraHeadingThreshold,cameraPitchThreshold:this.cameraPitchThreshold,uiStrings:{configureNavigation:u.configureNavigation,preserveHeading:u.preserveHeading,preserveHeadingDescription:u.preserveHeadingDescription,preservePitch:u.preservePitch,preservePitchDescription:u.preservePitchDescription,settings:m.settings,thresholdLabel:u.thresholdLabel},onInputChange:this._handleNavigationSettingsInputChange,onToggle:this._handleNavigationSettingsToggle,preserveHeading:d,preservePitch:h});this._settingsToggle=new il({content:g,expandIcon:"configure"}),this.viewModel.activeViewer?.ui.add(this._settingsToggle,{position:"top-left"})}else this._settingsToggle&&(this._settingsToggle.expanded=!1,this.viewModel.activeViewer?.ui.remove(this._settingsToggle))},this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()},this.navigate=async i=>{let a=null;try{const{currentNode:r}=this.viewModel;if(!r)throw new yd;a=await this.viewModel.navigate(r,i)}catch(r){te(r)||O.getLogger(this).error("Error occurred while navigating",r)}return a},this.reset=()=>{this._closeAllImageTools(),this.viewModel.reset()},this._loadImageFromGallery=this._loadImageFromGallery.bind(this),this._registerGalleryItem=this._registerGalleryItem.bind(this),this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this),this.loadImageFromSource=this.loadImageFromSource.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this._handleVideoBrightnessChange=this._handleVideoBrightnessChange.bind(this),this._handleVideoContrastChange=this._handleVideoContrastChange.bind(this),this._handleBrightnessChange=this._handleBrightnessChange.bind(this),this._handleContrastChange=this._handleContrastChange.bind(this),this._handleSharpnessChange=this._handleSharpnessChange.bind(this),this._resetVideoTools=this._resetVideoTools.bind(this),this._toggleEnhancementToolState=this._toggleEnhancementToolState.bind(this)}initialize(){this.addHandles([R(()=>[this.viewModel?.bestFeatureAngle,this._navigationTool],([t,e])=>{e&&this._updateNavigationTool(e)},ht),R(()=>this.currentCoverageVisible,t=>this._onCurrentCoverageVisibilityChange(t)),R(()=>this.isAdditionalCoverageVisible,t=>this._onAdditionalCoverageVisibilityChange(t)),R(()=>this.isAdditionalPointSourcesVisible,t=>this._onAdditionalCameraLocationsVisibility(t)),R(()=>({features:this.currentBestFeature,showCameraLocations:this.showCameraLocations,state:this.viewModel.state}),({showCameraLocations:t,state:e})=>{e==="image-loaded"&&this.viewModel.overlayCameraLocations(t)},E),R(()=>({feature:this.currentBestFeature,showMapFeatures:this.showMapFeatures,state:this.viewModel.state}),async(t,e)=>{if(t.showMapFeatures!==e?.showMapFeatures&&this.viewModel.toggleAllOverlayMapFeatures(t.showMapFeatures),t.feature!=null&&t.feature!==e?.feature){if(this.viewModel.removeAllOverlayMapFeatures(),await ut(()=>this.viewModel.state==="image-loaded"),this.dataCaptureLayer&&this.stopDataCapture(),await this._restoreOverlays(),!this.dataCaptureLayer)return;await this.startDataCapture(this.dataCaptureLayer),this._previousAction?.active&&(this._previousAction.active=!1,this._previousAction=null)}},ht)])}loadDependencies(){return Promise.all([Cd(),Sd(),Te({"action-bar":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Ng),__vite__mapDeps([0,1])),"action-group":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Nf),__vite__mapDeps([0,1])),action:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MV),__vite__mapDeps([0,1])),panel:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.MZ),__vite__mapDeps([0,1])),shell:()=>A(()=>import("./languageUtils-Ci9pGmfc.js").then(t=>t.ad),__vite__mapDeps([64,0,1,65,66,67])),dialog:()=>A(()=>import("./index-BzY_GgVs.js"),__vite__mapDeps([196,0,1,3])),dropdown:()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Nb),__vite__mapDeps([0,1])),"dropdown-group":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Nd),__vite__mapDeps([0,1])),"dropdown-item":()=>A(()=>import("./index-CgzAF5Ey.js").then(t=>t.Nc),__vite__mapDeps([0,1])),slider:()=>A(()=>import("./index-B4P055yQ.js"),__vite__mapDeps([177,0,1]))}),Vd()])}destroy(){this._galleryController.abort(),this._galleryObserver.disconnect(),this.currentBestFeature=null}get accuracyParametersMissing(){return this.viewModel.accuracyParametersMissing}get activeLayer(){return Ke(O.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(t){Ke(O.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=t}get activeVideoIcon(){const{videoElement:t,videoViewModel:e}=this.viewModel;return t?.loaded&&e?e.videoPaused?"play":"pause":"play"}get activeAudioIcon(){const{videoElement:t,videoViewModel:e}=this.viewModel;return t?.loaded&&e?.videoMuted?"sound-off":"sound"}get cameraHeadingThreshold(){return this.viewModel.cameraHeadingThreshold}set cameraHeadingThreshold(t){this.viewModel.cameraHeadingThreshold=t}get cameraPitchThreshold(){return this.viewModel.cameraPitchThreshold}set cameraPitchThreshold(t){this.viewModel.cameraPitchThreshold=t}get canNavigateSequentially(){const{layer:t}=this;if(!t)return!1;const{fields:e,sequenceOrderField:i}=t;return e.some(({name:a})=>a.toLowerCase()===`${i??"sequenceorder"}`.toLowerCase())}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(t){this.viewModel.currentBestFeature=t}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(t){this.viewModel.currentCoverageVisible=t}get dataCaptureLayer(){return this.viewModel.dataCaptureLayer}set dataCaptureLayer(t){this.viewModel.dataCaptureLayer=t}get depthImageNotSupported(){return this.viewModel.depthImageNotSupported}get disabled(){return this.viewModel.disabled}set disabled(t){this.viewModel.disabled=t}get displayMessage(){return this.viewModel.displayMessage}get enhancementToolActive(){return this.viewModel.mode==="video"?this.videoEnhancementToolActive:this.imageEnhancementToolActive}set enhancementToolActive(t){this.viewModel.mode==="video"?this.videoEnhancementToolActive=t:this.imageEnhancementToolActive=t}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(t){this._overrideIfSome("icon",t)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get imageLocationToolActive(){return this.viewModel.imageLocationToolState}set imageLocationToolActive(t){this.viewModel.imageLocationToolState=t}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(t){this.viewModel.isAdditionalCoverageVisible=t}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(t){this.viewModel.isAdditionalPointSourcesVisible=t}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(t){this.viewModel.mapImageConversionToolState=t}get measureType(){return this.viewModel.measureType}set measureType(t){this.viewModel.measureType=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get navigationMode(){return this.viewModel.navigationMode}set navigationMode(t){this.viewModel.navigationMode=t}get popupEnabled(){const{popupEnabled:t,state:e}=this.viewModel;return(e==="image-loaded"||this.videoLoaded)&&t}get referencePoint(){return this.viewModel.referencePoint??null}get sketchViewModel(){return this.viewModel.sketch}get triangularMeasurementActive(){return this.viewModel.triangularMeasurementActive}set triangularMeasurementActive(t){this.viewModel.triangularMeasurementActive=t}get videoLoaded(){const{mode:t,videoElement:e,panoramicVideoLoaded:i}=this.viewModel;return(t==="video"&&e?.loaded===!0||i)??!1}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}set determineWorkflowForFeature(t){this.viewModel.determineWorkflowForFeature=t}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(t){this.viewModel.updateFootprint=t}get updateFootprint(){return this.viewModel.updateFootprint}_renderActionBar(){return v("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},v("calcite-action-group",null,this._currentFootprintToggle(),this._additionalFootprintToggle(),this._additionalPointSourcesToggle()),v("calcite-action-group",null,this._directionToolToggle(),this._mapImageConversionToggle(),this._navigationToolToggle(),this._imageEnhancementsToggle(),this._videoEnhancementsToggle()),v("calcite-action-group",null,this._measurementToolsToggle(),this._imageGalleryToggle(),this._imageOverlaysToggle(),this._openPopupAction()))}get _activeMeasurementIcon(){const{measureType:t,imageLocationToolActive:e,triangularMeasurementActive:i}=this;if(e)return i?"dual-image-location":"pin-tear";if(i)return t==="area"?"dual-image-area":"dual-image-distance";switch(t){case"area":return"measure-area";case"height":return"measure-building-height-top-base";default:return"measure-line"}}get _activeMeasurementHeading(){const{measureType:t,messages:e,triangularMeasurementActive:i}=this,{groundArea:a,heightAboveGround:r,groundDistance:o,triangulatedAreaHeading:n,triangulatedDistanceHeading:l}=e;if(i)return t==="area"?n:l;switch(t){case"area":return a;case"height":return r;default:return o}}_additionalFootprintToggle(){const{isAdditionalCoverageVisible:t,invalidCameraHeading:e,visibleElements:{additionalFootprintToggle:i}}=this;return i?v("calcite-action",{active:t,bind:this,class:C.addCoverage,disabled:e,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints,title:this.messages.additionalFootprints}):null}_additionalPointSourcesToggle(){const{isAdditionalPointSourcesVisible:t,invalidCameraHeading:e,visibleElements:{additionalCameraLocationsToggle:i}}=this;return i?v("calcite-action",{active:t,bind:this,class:C.addExpPoints,disabled:e,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations,title:this.messages.additionalCameraLocations}):null}get _measurementToggle(){const{viewModel:{state:t,measureType:e,currentBestFeatureMeasurementImage:i},triangularMeasurementActive:a,id:r}=this;if(t!=="image-loaded"||!e||a&&!i)return;this._imageMeasurementToolsLoaderTask||this._loadImageMeasurementResources();const o=this._imageMeasurementToolsLoaderTask?.value;return o?v("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:this._activeMeasurementHeading,id:`${r}-${e}-measurement`,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearMeasurements},v(o,{measurementType:e,measurementUnitMessages:this.measurementUnitMessages,messages:this.messages,oiViewModel:this.viewModel})):null}get _renderRoot(){const{viewModel:{state:t},triangularMeasurementActive:e}=this;return v("calcite-panel",{bind:this,class:e?C.viewerContainerMeasurement:C.viewerContainer,heading:this.visibleElements.title?this.messages.title:void 0,loading:t.includes("loading")&&!e},this.visibleElements.menu?this._renderActionBar():null,v("calcite-shell",null,v("calcite-panel",null,this._imageViewer,this._panoramicViewer,this._panoramicVideoViewer,this._videoViewer,this._messageBox,this.invalidCameraHeading?null:[this._imageGalleryPanel,this._renderNavigation,this._imageOverlaysPanel()],this._imageEnhancementTools,this._videoEnhancementTools,this._renderSketch()),this._imageViewerTriangular,this._measurementToggle,this._locationToggle,this.invalidCameraHeading?this._renderWarning(this.messages.invalidCameraHeadingWarningTitle,this.messages.invalidCameraHeadingWarningDescription):null,this.depthImageNotSupported?this._renderWarning(this.messages.depthImageNotSupportedTitle,this.messages.depthImageNotSupportedDescription):null))}_currentFootprintToggle(){const{currentCoverageVisible:t,invalidCameraHeading:e}=this,{currentFootprintToggle:i}=this.visibleElements;return i?v("calcite-action",{active:t,bind:this,class:C.currentCoverage,disabled:e,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint,title:this.messages.currentFootprint}):null}get _imageEnhancementTools(){const{enhancementToolActive:t,viewModel:{brightness:e,contrast:i,sharpness:a,state:r}}=this;return t&&r==="image-loaded"?v("calcite-panel",{bind:this,class:C.imageEnhancementWrapper,closable:!0,closed:!t,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleEnhancementToolState},v("div",{class:C.imageEnhancementTools},$t({title:this.messages.brightness,value:e,max:10,min:-10,ticks:5,handleChange:this._handleBrightnessChange}),$t({title:this.messages.contrast,value:i,max:10,min:-10,ticks:5,handleChange:this._handleContrastChange}),$t({title:this.messages.sharpness,value:a,max:1,min:0,ticks:.5,step:.1,handleChange:this._handleSharpnessChange})),v("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset,title:this.messagesCommon.reset})):null}get _videoEnhancementTools(){const{enhancementToolActive:t,viewModel:{videoViewModel:e,mode:i},messages:{videoEnhancement:a,brightness:r,contrast:o},messagesCommon:{reset:n}}=this;return t&&i==="video"&&e?v(Rd,{brightness:e.videoBrightness,constrast:e.videoContrast,handleBrightnessChange:this._handleVideoBrightnessChange,handleContrastChange:this._handleVideoContrastChange,resetTools:this._resetVideoTools,uiStrings:{videoEnhancement:a,brightness:r,contrast:o,reset:n},videoEnhancementToolActive:t,onClose:this._toggleEnhancementToolState}):null}_imageEnhancementsToggle(){const{state:t,mode:e}=this.viewModel,{imageEnhancement:i}=this.visibleElements;return i&&e!=="video"?v("calcite-action",{active:this.enhancementToolActive,bind:this,disabled:e!=="default"||t!=="image-loaded",icon:"sliders-horizontal",onclick:this._toggleEnhancementToolState,text:this.messages.imageEnhancement,title:this.messages.imageEnhancement}):null}_videoEnhancementsToggle(){const{mode:t}=this.viewModel,{videoEnhancement:e}=this.messages;return t==="video"?v("calcite-action",{active:this.enhancementToolActive,bind:this,disabled:t!=="video",icon:"sliders-horizontal",onclick:this._toggleEnhancementToolState,text:e,title:e}):null}get _imageGalleryPanel(){const{container:t,galleryOpened:e,imageGalleryEnabled:i}=this;return i&&e&&t?this._imageGalleryContext:null}get _imageGalleryContext(){const{galleryOpened:t,invalidCameraHeading:e}=this;return v("calcite-panel",{bind:this,class:C.carousel,closable:!0,closed:!t,disabled:e,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},v("div",{class:C.carouselContainer},this._renderThumbnails))}_imageGalleryToggle(){const{imageGalleryEnabled:t,invalidCameraHeading:e,visibleElements:{imageGallery:i}}=this;return i?v("calcite-action",{active:this.galleryOpened,bind:this,disabled:!t||e,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery,title:this.messages.imageGallery}):null}get _imageOverlaysComponent(){const{_imageOverlayMessages:t,_imageOverlaysLoaderTask:e,_overlayedLayers:i,dataCaptureEnabled:a,dataCaptureLayer:r,imageOverlaysOpened:o,showCameraLocations:n,showMapFeatures:l,view:d,layer:h}=this;if(!h)return null;const u=h.imageGeometryField?.length?h.imageGeometryField:fa,m=h.imageReferenceField?.length?h.imageReferenceField:_a;e||(this._imageOverlaysLoaderTask=oe(async()=>(await A(async()=>{const{default:p}=await import("./ImageOverlays-Dk1e8o1v.js");return{default:p}},__vite__mapDeps([197,0,1,198,199,200,201,202,203,204,50,52,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,51,5,6,7,8,9,10,11,12,13,14,15,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]))).default));const g=this._imageOverlaysLoaderTask?.value;return g?v(g,{closed:!o,dataCaptureEnabled:a,dataCaptureLayer:r,imageGeometryField:u,imageReferenceField:m,messages:t,overlayedLayers:i,showCameraLocations:n,showMapFeatures:l,view:d,onDataCaptureLayerChanged:this._handleDataCaptureLayerChange,onFilterCapturedFeatures:this.viewModel.filterCapturedFeatures,onImageOverlaysClosed:this._onImageOverlayClosed,onLayerDeselected:this._handleOverlayLayerDeselect,onLayerSelected:this._handleOverlayLayerSelect,onShowCameraLocationsChanged:this._onShowCameraLocationsChanged,onShowMapFeaturesChanged:this._onShowMapFeaturesChanged}):null}get _imageOverlayMessages(){return{...this.messages,...this.messagesSketch}}get _imageSketchToolsMessages(){return{...this.messagesSketch,...this.messagesCommon}}_imageOverlaysPanel(){const{imageOverlaysOpened:t,viewModel:{state:e}}=this,i=this.classes({[C.imageOverlaysContainer]:!0,[We.hidden]:!t||e!=="image-loaded"});return v("div",{class:i,key:this.messages.imageOverlays},this._imageOverlaysComponent)}_imageOverlaysToggle(){const{viewModel:{state:t},imageOverlaysOpened:e,invalidCameraHeading:i,visibleElements:{imageOverlays:a}}=this;return a?v("calcite-action",{active:e,bind:this,disabled:t!=="image-loaded"||i,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays,title:this.messages.imageOverlays}):null}get _imageViewer(){const{displayMessage:t,loadImageViewer:e,mode:i,clickAction:a,state:r}=this.viewModel,o=t!=null||i!=="default"||r.includes("loading"),{messages:{end:n,next:l,previous:d,start:h}}=this;return v(pi,{afterCreate:e,clickAction:a,navigationEnabled:!o&&this.navigationMode!==null,navigationViewModel:this.viewModel,uiStrings:{end:n,next:l,previous:d,start:h},visible:!o})}get _imageViewerTriangular(){const{messages:t,triangularMeasurementActive:e}=this,{displayMessage:i,storeImageMeasurementViewer:a,storePanoramicMeasurementViewer:r,mode:o,state:n,clickAction:l}=this.viewModel,d=i!=null||o==="none"||o==="video",h=this.classes({[C.viewer]:!d,[C.viewerHidden]:d});return e?v("calcite-panel",{class:C.viewerContainerMeasurement,heading:t.measurementViewerHeading,loading:n.includes("loading")},v("calcite-panel",{bind:this,class:h},o==="default"?v(pi,{afterCreate:a,clickAction:l,uiStrings:t}):v(ci,{afterCreate:r,clickAction:l,uiStrings:t}))):null}get _videoViewer(){const{mode:t,loadVideoViewer:e,videoViewModel:i}=this.viewModel,{control:a,reset:r}=this.messagesCommon,{mute:o,unmute:n}=this.messages,l=t!=="video",d=this.classes({[C.viewer]:!l,[C.viewerHidden]:l});return v("calcite-panel",{bind:this,class:d},v("calcite-panel",{afterCreate:e,class:this.classes(We.widget,"esri-image-viewer")}),v("calcite-slider",{bind:this,labelHandles:!0,labelTicks:!0,max:i?.videoDuration,minLabel:"0",value:i?.currentTime??0,onCalciteSliderChange:this._handleVideoSeek}),v("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},v("calcite-action-group",null,v("calcite-action",{bind:this,icon:this.activeVideoIcon,onclick:()=>i?.playVideoHandler(),text:"Play",title:i?.videoPaused?a.play:a.pause})),v("calcite-action-group",null,v("calcite-action",{bind:this,icon:"refresh",onclick:()=>i?.rewindVideoHandler(),text:"Rewind",title:r})),v("calcite-action-group",null,v("calcite-action",{bind:this,icon:this.activeAudioIcon,onclick:()=>i?.toggleAudio(),text:"Audio",title:i?.videoMuted?o:n}))))}get _locationToggle(){const{viewModel:{state:t,groundCoordinates:e,groundCoordinatesAccuracy:i,triangulatedPoint:a},imageLocationToolActive:r,triangularMeasurementActive:o,messages:{groundLocation:n,triangulatedLocationHeading:l}}=this;if(t!=="image-loaded"||!e||!r)return;let d=e;if(o){if(!a)return;d=a}return v("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:o?l:n,id:n,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearImageLocation},v(Fd,{accuracy:i,groundCoordinates:d,messages:this.messages}))}_mapImageConversionToggle(){const{mapImageConversionToolState:t,viewModel:{state:e,disabled:i},invalidCameraHeading:a,visibleElements:{mapImageConversionTool:r}}=this;return r?v("calcite-action",{active:t,bind:this,disabled:e!=="image-loaded"||a||i,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool,title:this.messages.mapImageConversionTool}):null}_measurementToolsToggle(){const{_activeMeasurementIcon:t,measureType:e,viewModel:i,accuracyParametersMissing:a,messages:r,triangularMeasurementActive:o,visibleElements:{measurementTools:n}}=this,{state:l}=i,{measurementTools:d,groundDistance:h,groundArea:u,heightAboveGround:m,groundLocation:g,triangulatedDistanceHeading:p,triangulatedAreaHeading:y,triangulatedLocationHeading:f}=r;return n?v("calcite-dropdown",{disabled:a,key:"measurement-tools",maxItems:5,title:d,width:"m"},v("calcite-action",{bind:this,disabled:l!=="image-loaded"||a,icon:t,slot:"trigger",text:d}),v("calcite-dropdown-group",null,v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"measure-line",key:"distance-measurement",onclick:w=>this._toggleMeasurementSketch(w,"distance"),selected:e==="distance"&&!o},h),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"measure-area",key:"area-measurement",onclick:w=>this._toggleMeasurementSketch(w,"area"),selected:e==="area"&&!o},u),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"measure-building-height-top-base",key:"height-dropdown",onclick:w=>this._toggleMeasurementSketch(w,"height"),selected:e==="height"},m),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"pin-tear",key:"surface-location",onclick:this._toggleLocationTool,selected:!!this.imageLocationToolActive&&!o},g),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"dual-image-location",key:"triangular-location",selected:!!o&&this.imageLocationToolActive,onCalciteDropdownItemSelect:this._toggleTriangularLocation},f),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"dual-image-distance",key:"triangular-measurement-distance",selected:!!o&&this.measureType==="distance",onCalciteDropdownItemSelect:this._toggleTriangularDistanceMeasurements},p),v("calcite-dropdown-item",{bind:this,disabled:l!=="image-loaded",iconStart:"dual-image-area",key:"triangular-measurement-area",selected:!!o&&this.measureType==="area",onCalciteDropdownItemSelect:this._toggleTriangularAreaMeasurements},y))):null}get _messageBox(){const{messages:t,viewModel:{displayMessage:e,mode:i}}=this;if(!e||i==="video")return null;const{data:a,key:r,map:o}=e,n=`${o?qi(t[r],o):t[r]}`;return v("span",{class:C.messageBox},a?`${n} ${a}`:n)}async _loadNavigationSettings(){return this._navigationSettingsLoaderTask||(this._navigationSettingsLoaderTask=oe(async()=>(await A(async()=>{const{default:t}=await import("./NavigationSettings-Bi24s5Kt.js");return{default:t}},__vite__mapDeps([205,0,1,30,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]))).default)),await this._navigationSettingsLoaderTask.promise}_navigationToolToggle(){const{state:t}=this.viewModel,{visibleElements:{navigationTool:e},videoLoaded:i}=this;return e?v("calcite-action",{active:this.navigationToolActive,bind:this,disabled:t!=="image-loaded"&&!i||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool,title:this.messages.navigationTool}):null}_directionToolToggle(){const{state:t}=this.viewModel,{visibleElements:{directionalNavigation:e,sequentialNavigation:i}}=this,a=new Ad;return e&&a.push(new ta({active:this.navigationMode==="directional",disabled:t!=="image-loaded"||this.invalidCameraHeading,icon:"directional-navigation",onclick:()=>{this._toggleImageNavigation("directional")},text:this.messages.directionalNavigation,title:this.messages.directionalNavigationDescription})),i&&a.push(new ta({active:this.navigationMode==="sequential",disabled:t!=="image-loaded"||this.invalidCameraHeading||!this.canNavigateSequentially,icon:"sequential-navigation",onclick:()=>{this._toggleImageNavigation("sequential")},text:this.messages.sequentialNavigation,title:this.messages.sequentialNavigationDescription})),e||i?v($d,{actions:a,activeAction:a.items.find(r=>r.active),icon:"absolute-direction",label:this.messages.imageNavigation,scale:"m",title:this.messages.imageNavigation}):null}_openPopupAction(){const{showPopupsAction:t}=this.visibleElements;return t?v("calcite-action",{bind:this,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups,title:this.messages.showPopups}):null}get _panoramicVideoViewer(){const{displayMessage:t,loadPanoramicVideoViewer:e,mode:i,clickAction:a,state:r,currentBestFeature:o}=this.viewModel,n=o?.attributes.imagePath,l=t!=null||i!=="panoramic-video"||r.includes("loading")||!n;return v(to,{afterCreate:e,clickAction:a,oiViewModel:this.viewModel,videoSource:n,visible:!l})}get _panoramicViewer(){const{displayMessage:t,loadPanoramicViewer:e,mode:i,clickAction:a,state:r}=this.viewModel,{messages:{end:o,next:n,previous:l,start:d}}=this,h=t!=null||i!=="panoramic"||r.includes("loading");return v(ci,{afterCreate:e,clickAction:a,navigationEnabled:!h&&this.navigationMode!==null,navigationViewModel:this.viewModel,uiStrings:{end:o,next:n,previous:l,start:d},visible:!h})}_activateTriangulatedImageLocationTool(){this.navigationToolActive=!0,this.imageLocationToolActive=!0}_activateTriangulatedImageLocationWorkflow(t,e){this._closeAllImageTools(),this.imageLocationToolActive=!0,this.triangularMeasurementActive=!t,this.navigationToolActive=!!e||!e}_closeImageToolsAndToggleNavigation(t,e){this._closeAllImageTools(),this.triangularMeasurementActive=!t,this.navigationToolActive=!e}_resetMeasureTypeAndActivateImageLocationTool(){this.measureType=null,this.imageLocationToolActive=!0}_closeAllImageTools(){this.enhancementToolActive=!1,this.navigationToolActive=!1,this.imageOverlaysOpened=!1,this.galleryOpened=!1,this.measureType=null,this.imageLocationToolActive=!1,this.navigationMode=null,this.triangularMeasurementActive=!1,this._settingsToggle&&(this._settingsToggle.expanded=!1,this.viewModel.activeViewer?.ui.remove(this._settingsToggle))}_handleBrightnessChange(t){this.viewModel.brightness=t.currentTarget.value??0}_handleVideoBrightnessChange(t){this.viewModel.videoViewModel?.handleVideoBrightnessChange(t.target.value)}_handleContrastChange(t){this.viewModel.contrast=t.currentTarget.value??0}_handleVideoContrastChange(t){this.viewModel.videoViewModel?.handleVideoContrastChange(t.target.value)}_handleVideoSeek(t){const e=this.viewModel?.videoElement?.content;e&&(e.currentTime=t.target.value,e.play())}_handleSharpnessChange(t){this.viewModel.sharpness=t.currentTarget.value??0}_lazyLoadImage(t,e){t.forEach(async i=>{if(i.isIntersecting){const a=i.target,r=a.getAttribute("data-src"),o=a.getAttribute("data-rotation"),n=a.getAttribute("data-objectid"),l=o?parseFloat(o)%360:0,{layer:d,_galleryController:{signal:h}}=this;if(!r||!n)return;let u;try{u=Pt(r)?await Il(d,n,{signal:h}):await co(r,{signal:h})}catch(m){te(m)||O.getLogger("esri.widgets.OrientedImageryViewer").error("#lazyLoadImage()",m)}finally{e.unobserve(a)}if(!u)return;Tl(u,a,l)}})}_loadImageFromGallery(t){const{target:e}=t;if(!e)return;const i=e.getAttribute("data-objectid");i&&this.viewModel.currentBestFeature?.attributes.objectId!==Number(i)&&this.viewModel.selectBestFeature(i)}_loadImageMeasurementResources(){this._imageMeasurementToolsLoaderTask=oe(async()=>{const{default:t}=await A(()=>import("./ImageMeasurementWidget-B68ZyO9u.js"),__vite__mapDeps([206,0,1,101,30,207,31,32,33,34,35,36,37,38,39,40,18,17,19,20,21,22,23,24,25,26,27,28,29,41,42,43,44,45,46,47,48,49,50,51,5,6,7,8,9,10,11,12,13,14,15,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176]));return t})}_loadSketchResources(){this._sketchLoaderTask=oe(async()=>(await A(async()=>{const{default:t}=await import("./SketchTools-CVig6JFl.js");return{default:t}},__vite__mapDeps([208,0,1]))).default)}_onAdditionalCoverageVisibilityChange(t){this.viewModel.setAdditionalCoverageVisibility(t)}_onAdditionalCameraLocationsVisibility(t){this.viewModel.setAdditionalCameraLocationsVisibility(t)}_onCurrentCoverageVisibilityChange(t){this.viewModel.setCurrentCoverageVisibility(t)}_registerGalleryItem(t){this._galleryObserver.observe(t)}_renderWarning(t,e){const{viewModel:{state:i}}=this;return i==="image-loaded"?v(Pd,{icon:"exclamation-mark-triangle-f",kind:"warning",message:e,open:!0,title:t,tooltip:e}):null}get _renderNavigation(){const{viewModel:{sectorData:t,navigatorCurrentBestFeature:e,currentBestFeature:i,state:a}}=this;if(!this.container||!i)return null;let r,o,n,l,d;if(e){const{x:w,y:_,direction:x}=e,[b,T,I,$]=Ti[x];r=`M ${w} ${_} L ${b} ${T} A ${G[2]} ${G[2]} 0 0 1 ${I} ${$} Z`,o=w,l=_,n=Ti[x][4],d=Ti[x][5]}const h=w=>{const _=w.target.dataset?.sector;_&&this.viewModel.handleSectorClick(+_)},u=w=>{const _=w.target.dataset;if(!_)return;const{featureIndexInSector:x,sector:b}=_;x&&b&&this.viewModel.handleFeatureClick({sector:b,featureIndexInSector:+x})},m=w=>{w.removeEventListener("click",u)},g=i.attributes.objectId,p=t?.map(w=>w?.items).filter(Boolean).flatMap(w=>w?.map(({x:_,y:x,objectID:b,featureIndexInSector:T,sector:I})=>v("circle",{afterRemoved:m,class:this.classes(C.feature,{selected:g===b}),cx:_,cy:x,"data-feature-index-in-sector":T,"data-sector":I,key:`${C.feature}-${b}`,onclick:u,r:ps}))),y=w=>{w.removeEventListener("click",h)},f=this.classes({[C.navigationWrapper]:!0,[C.navigationZoomed]:this._navigationToolExpanded});return this.navigationToolActive&&(a==="image-loaded"||this.videoLoaded)?v("div",{bind:this,class:f,key:this.messages.navigationTool},v("svg",{afterCreate:w=>this._storeNavigationToolReference(w),class:Dn()?de:C.rotateWithAnimation,focusable:"false",height:qa,role:"img",width:qa,xmlns:"http://www.w3.org/2000/svg"},v("defs",null,v("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:o,x2:n,y1:l,y2:d},v("stop",{class:C.navigationPathOffset0,offset:0}),v("stop",{class:C.navigationPathOffset1,offset:1}))),v("g",null,v("circle",{class:this.classes(C.sector,C.outerSector),cx:G[3],cy:G[3],onclick:this._scaleNavigationTool,r:G[3]}),v("circle",{class:C.sector,cx:G[3],cy:G[3],r:G[2]}),v("circle",{class:C.sector,cx:G[3],cy:G[3],r:G[1]}),v("circle",{class:C.sector,cx:G[3],cy:G[3],r:G[0]}),v("path",{class:C.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${C.pointer}-west`}),v("path",{class:this.classes(C.pointer,C.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${C.pointer}-north`}),v("path",{class:C.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${C.pointer}-east`}),v("path",{class:C.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${C.pointer}-south`}),v("path",{class:this.classes(C.sector,C.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:C.sectorSeparator}),Ml([G[2],G[1],G[0]],G[3],G[3]).map((w,_)=>v("path",{afterRemoved:y,class:this.classes(C.sector,t?.[_]?.length?C.sectorEnabled:C.sectorDisabled),d:w,"data-sector":`${_}`,key:`${C.sector}-${_}`,onclick:h})),v("path",{class:this.classes(C.sector,C.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:C.sectorCross}),p,i.attributes.cameraPitch>=5&&r?v("path",{class:C.selectedFeaturePath,d:r,fill:`url(#${this.id}-coverage-fill)`,key:C.selectedFeaturePath}):null))):null}_renderSketch(){const{dataCaptureLayer:t,imageOverlaysOpened:e}=this;if(!t||e||(this._sketchLoaderTask||this._loadSketchResources(),!this._sketchLoaderTask?.value))return null;const{geometryType:i}=t,a=i==="point"?"pin":i==="polyline"?"line":"polygon",r=this._sketchLoaderTask.value;return v("div",{class:C.sketchTools},v(r,{icon:a,messages:this._imageSketchToolsMessages,type:i,onAction:this._onAction}))}get _renderThumbnails(){const{currentBestFeature:t,thumbnails:e}=this.viewModel;return t?v("div",{class:C.carouselContent},e?.items.map(({url:i,objectId:a,rotation:r},o)=>v("div",{class:`${C.carouselItemWrapper}${t.attributes.objectId===a?"--selected":""}`,key:`${C.carouselItemWrapper}-${o}`},v("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${a}`,class:C.carouselItem,"data-objectid":`${a}`,"data-rotation":`${r}`,"data-src":i,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight})))):null}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}_resetVideoTools(){this.viewModel.videoViewModel?.resetVideoEnhancementTools()}_storeNavigationToolReference(t){this._navigationTool=t}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleEnhancementToolState(t){t.stopPropagation();const e=this.enhancementToolActive;this._closeAllImageTools(),this.enhancementToolActive=!e}_toggleImageOverlays(t){t.stopPropagation();const e=this.imageOverlaysOpened;this._closeAllImageTools(),this.imageOverlaysOpened=!e}_toggleImageGallery(t){t.stopPropagation();const e=this.galleryOpened;this._closeAllImageTools(),this.galleryOpened=!!this.imageGalleryEnabled&&!e}_toggleLocationTool(t){const e=this.imageLocationToolActive,i=this.triangularMeasurementActive&&e;this._closeAllImageTools(),this.imageLocationToolActive=i||!e,t.stopPropagation()}_toggleMeasurementSketch(t,e){t.stopPropagation();const i=this.measureType,a=this.triangularMeasurementActive;this._closeAllImageTools(),this.measureType=i!==e||a?e:null,this.measureType===e&&(this.viewModel.displayNewMeasurementButton=!0)}_toggleNavigationTool(){const t=this.navigationToolActive;this._closeAllImageTools(),this.navigationToolActive=!t}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=!this.mapImageConversionToolState}_toggleTriangularAreaMeasurements(){this._toggleTriangularMeasurements("area")}_toggleTriangularDistanceMeasurements(){this._toggleTriangularMeasurements("distance")}_toggleTriangularLocation(){const t=this.triangularMeasurementActive,e=this.navigationToolActive;t?this.measureType===null?this.imageLocationToolActive?this._closeImageToolsAndToggleNavigation(t,e):this._activateTriangulatedImageLocationTool():this._resetMeasureTypeAndActivateImageLocationTool():this._activateTriangulatedImageLocationWorkflow(t,e)}_toggleTriangularMeasurements(t){const e=this.triangularMeasurementActive,i=this.viewModel.measureType,a=this.navigationToolActive;e?t===i?(this._closeAllImageTools(),this.triangularMeasurementActive=!e,this.navigationToolActive=!a):(this.imageLocationToolActive=!1,this.measureType=t):(this._closeAllImageTools(),this.measureType=t,this.triangularMeasurementActive=!e,this.navigationToolActive=!!a||!a)}_unregisterGalleryItem(t){this._galleryObserver.unobserve(t)}_updateNavigationTool(t){const{previousFeatureAngle:e,bestFeatureAngle:i}=this.viewModel,a=(i-e+540)%360-180;t.style.setProperty(vl,`${e}deg`),t.style.setProperty(yl,`${e+a}deg`)}async loadBestImage(t){return this.viewModel.loadBestImage(t)}loadImageFromSource(t,e){return this.viewModel.loadImageFromSource(t,e)}async overlayMapFeatures(t,e){return this.removeHandles(`${ei.overlayed}-${t.id}`),this.addHandles(R(()=>t.visible,()=>{this.viewModel.toggleOverlayMapFeatures(t.id,t.visible,this.showMapFeatures)}),`${ei.overlayed}-${t.id}`),this._overlayedLayers.add(t),this.viewModel.overlayMapFeatures(t,e&&this.showMapFeatures)}async plotMapPoint(t){return this.viewModel.plotMapPoint(t)}plotReferencePointOnGround(t){this.viewModel.plotReferencePointOnGround(t)}plotReferencePointOnImage(t){this.viewModel.plotReferencePointOnImage(t)}removeOverlayedGraphicsOnImage(t){this.removeHandles(`${ei.overlayed}-${t}`),this._overlayedLayers.remove(this._overlayedLayers.find(e=>e.id===t)),this.viewModel.removeOverlayedGraphicsOnImage(t)}resetImage(){this.viewModel.resetImage()}render(){return v("div",{class:this.classes(We.widget,ne)},this._renderRoot)}async showImageByObjectId(t,e){return this.viewModel.showImageByObjectId(t,e)}async startDataCapture(t){return this.viewModel.startDataCapture(t)}async stopDataCapture(t){return this.viewModel.stopDataCapture(t)}updateSuitabilities(t){this.viewModel.updateSuitabilities(t)}};s([c({readOnly:!0})],V.prototype,"accuracyParametersMissing",null),s([c()],V.prototype,"activeLayer",null),s([c()],V.prototype,"activeVideoIcon",null),s([c()],V.prototype,"activeAudioIcon",null),s([c()],V.prototype,"cameraHeadingThreshold",null),s([c()],V.prototype,"cameraPitchThreshold",null),s([c()],V.prototype,"canNavigateSequentially",null),s([c()],V.prototype,"currentBestFeature",null),s([c()],V.prototype,"currentCoverageVisible",null),s([c()],V.prototype,"dataCaptureEnabled",void 0),s([c()],V.prototype,"dataCaptureLayer",null),s([c()],V.prototype,"depthImageNotSupported",null),s([c()],V.prototype,"disabled",null),s([c()],V.prototype,"enhancementToolActive",null),s([c()],V.prototype,"features",null),s([c()],V.prototype,"imagePointsInView",null),s([c()],V.prototype,"galleryOpened",void 0),s([c()],V.prototype,"icon",null),s([c()],V.prototype,"imageEnhancementToolActive",void 0),s([c()],V.prototype,"videoEnhancementToolActive",void 0),s([c({readOnly:!0})],V.prototype,"imageGalleryEnabled",null),s([c()],V.prototype,"imageLocationToolActive",null),s([c()],V.prototype,"imageOverlaysOpened",void 0),s([c({readOnly:!0})],V.prototype,"invalidCameraHeading",null),s([c()],V.prototype,"isAdditionalCoverageVisible",null),s([c()],V.prototype,"isAdditionalPointSourcesVisible",null),s([c()],V.prototype,"mapImageConversionToolState",null),s([c()],V.prototype,"measureType",null),s([c()],V.prototype,"layer",null),s([c()],V.prototype,"navigationToolActive",void 0),s([c()],V.prototype,"navigationMode",null),s([St(vs()),c({type:No})],V.prototype,"viewModel",void 0),s([c(),ze("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],V.prototype,"messages",void 0),s([c(),ze("esri/core/t9n/Units")],V.prototype,"measurementUnitMessages",void 0),s([c(),ze("esri/t9n/common")],V.prototype,"messagesCommon",void 0),s([c(),ze("esri/widgets/Sketch/t9n/Sketch")],V.prototype,"messagesSketch",void 0),s([c()],V.prototype,"pixelMeasurementUnit",void 0),s([c()],V.prototype,"pixelAreaMeasurementUnit",void 0),s([c({readOnly:!0})],V.prototype,"popupEnabled",null),s([c()],V.prototype,"referencePoint",null),s([c()],V.prototype,"showCameraLocations",void 0),s([c()],V.prototype,"showMapFeatures",void 0),s([St(["create","delete","redo","undo","update"]),c({readOnly:!0})],V.prototype,"sketchViewModel",null),s([c()],V.prototype,"triangularMeasurementActive",null),s([c()],V.prototype,"videoLoaded",null),s([c()],V.prototype,"view",null),s([c({type:Bo,nonNullable:!0})],V.prototype,"visibleElements",void 0),s([c()],V.prototype,"determineWorkflowForFeature",null),s([c()],V.prototype,"updateFootprint",null),s([c()],V.prototype,"_activeMeasurementIcon",null),s([c()],V.prototype,"_activeMeasurementHeading",null),s([c()],V.prototype,"_imageOverlaysLoaderTask",void 0),s([c()],V.prototype,"_imageMeasurementToolsLoaderTask",void 0),s([c()],V.prototype,"_navigationSettingsLoaderTask",void 0),s([c()],V.prototype,"_measurementToggle",null),s([c()],V.prototype,"_renderRoot",null),s([c()],V.prototype,"_imageEnhancementTools",null),s([c()],V.prototype,"_videoEnhancementTools",null),s([c()],V.prototype,"_imageGalleryPanel",null),s([c()],V.prototype,"_imageGalleryContext",null),s([c()],V.prototype,"_imageOverlaysComponent",null),s([c()],V.prototype,"_imageOverlayMessages",null),s([c()],V.prototype,"_imageSketchToolsMessages",null),s([c()],V.prototype,"_imageViewer",null),s([c()],V.prototype,"_imageViewerTriangular",null),s([c()],V.prototype,"_videoViewer",null),s([c()],V.prototype,"_locationToggle",null),s([c()],V.prototype,"_messageBox",null),s([c()],V.prototype,"_navigationToolExpanded",void 0),s([c()],V.prototype,"_navigationTool",void 0),s([c()],V.prototype,"_panoramicVideoViewer",null),s([c()],V.prototype,"_panoramicViewer",null),s([c()],V.prototype,"_renderNavigation",null),s([c()],V.prototype,"_renderThumbnails",null),s([c()],V.prototype,"_sketchLoaderTask",void 0),V=s([ie("esri.widgets.OrientedImageryViewer")],V);const Od=V;const Ld=Rn`.esri-imagery-viewer{width:100%;height:100%}.esri-oriented-imagery-viewer{--esri-oriented-imagery-viewer-action-icon-size: 8px;--esri-oriented-imagery-viewer-min-width: 288px;--esri-oriented-imagery-viewer-min-height: 348px;--calcite-dialog-size-x: 210px;--calcite-dialog-min-size-y: 90px;--calcite-icon-size: var(--esri-oriented-imagery-viewer-action-icon-size);box-sizing:border-box;z-index:1;width:100%;min-width:var(--esri-oriented-imagery-viewer-min-width);height:100%;min-height:var(--esri-oriented-imagery-viewer-min-height);flex-direction:column;align-items:flex-start;display:flex;overflow:hidden}.esri-oriented-imagery-viewer:has(.esri-widget .esri-oriented-imagery-viewer__image-overlays-no-result){--esri-oriented-imagery-viewer-min-height: 420px}.esri-oriented-imagery-viewer__body{flex-direction:column;flex:1 0 auto;order:1;align-self:stretch;height:100%;display:flex}.esri-oriented-imagery-viewer__body-current-coverage{--calcite-icon-color: var(--calcite-color-status-danger)}.esri-oriented-imagery-viewer__body-additional-camera-locations{--calcite-icon-color: var(--calcite-color-brand)}.esri-oriented-imagery-viewer__body-additional-coverage{--calcite-icon-color: var(--calcite-color-status-info)}.esri-oriented-imagery-viewer__body-footprint{--calcite-icon-color: var(--calcite-color-status-success)}.esri-oriented-imagery-viewer__carousel{z-index:1;border:1px solid var(--calcite-color-border-2);align-items:center;width:98%;height:140px;margin:auto 1% 0;position:absolute;bottom:0;box-shadow:0 0 1px #0000004d}.esri-oriented-imagery-viewer__carousel-container{height:auto;display:inline-block;overflow:auto hidden}.esri-oriented-imagery-viewer__carousel header{--calcite-font-weight-medium: $font-weight--light;--calcite-font-size-0: $font-size--tiny}.esri-oriented-imagery-viewer__carousel-item{width:100px;height:70px}.esri-oriented-imagery-viewer__carousel-item-wrapper{box-sizing:border-box;justify-content:center;align-items:center;width:106px;height:78px;margin:auto 10px;display:flex;box-shadow:0 1px 2px #0000004d}.esri-oriented-imagery-viewer__carousel-item-wrapper--selected{box-sizing:border-box;border:2px solid var(--calcite-color-brand);justify-content:center;align-items:center;width:106px;height:78px;margin:auto 10px;display:flex;box-shadow:0 1px 2px #0000004d}.esri-oriented-imagery-viewer__carousel-content{display:flex}.esri-oriented-imagery-viewer__close{background:var(--calcite-color-foreground-1);flex-direction:row;flex-grow:0;order:7;justify-content:center;align-items:center;width:48px;height:59px;display:flex}.esri-oriented-imagery-viewer__image-enhancement-wrapper{z-index:1;border:1px solid var(--calcite-color-border-2);align-items:center;width:98%;height:140px;margin:auto 1% 0;position:absolute;bottom:0;box-shadow:0 0 1px #0000004d}.esri-oriented-imagery-viewer__image-enhancement-tools{display:flex}.esri-oriented-imagery-viewer__image-enhancement-tool-container{width:50%;margin-block:2px;padding-inline:.75rem}.esri-oriented-imagery-viewer__image-overlays{z-index:1;margin:auto;border:1px solid var(--calcite-color-border-2);align-items:center;width:100%;position:absolute;bottom:0;overflow-y:auto;box-shadow:0 0 1px #0000004d}.esri-oriented-imagery-viewer__image-overlays-layer-list,.esri-oriented-imagery-viewer__image-overlays-switch{padding:0 var(--calcite-spacing-md)}.esri-oriented-imagery-viewer__image-overlays-container{height:auto;display:flex}.esri-oriented-imagery-viewer__image-overlays-no-result{z-index:1;border:1px solid var(--calcite-color-border-2);align-items:center;width:98%;height:auto;margin:auto 1% 0;position:absolute;bottom:0;overflow-y:auto;box-shadow:0 0 1px #0000004d}.esri-oriented-imagery-viewer__image-overlays-no-result-layer-list,.esri-oriented-imagery-viewer__image-overlays-no-result-switch{padding:0 var(--calcite-spacing-md)}.esri-oriented-imagery-viewer__image-overlays-increased-height{z-index:1;border:1px solid var(--calcite-color-border-2);align-items:center;width:98%;height:200px;margin:auto 1% 0;position:absolute;bottom:0;overflow-y:auto;box-shadow:0 0 1px #0000004d}.esri-oriented-imagery-viewer__image-overlays-increased-height-layer-list,.esri-oriented-imagery-viewer__image-overlays-increased-height-switch{padding:0 var(--calcite-spacing-md)}.esri-oriented-imagery-viewer__measurement-results{width:auto;height:fit-content}.esri-oriented-imagery-viewer__measurements-table{margin-block-start:var(--calcite-spacing-sm)}.esri-oriented-imagery-viewer__measurements-bar{flex-wrap:nowrap;display:flex}.esri-oriented-imagery-viewer__measurements-button{display:flex}.esri-oriented-imagery-viewer__measurement-display{text-align:center;margin-block-end:var(--calcite-spacing-xxs)}.esri-oriented-imagery-viewer__viewer{cursor:url(data:text/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2226%22%20width%3D%2226%22%3E%0A%3Cpath%20stroke%3D%22%23000%22%20stroke-width%3D%221px%22%20fill%3D%22%23fff%22%20d%3D%22m15.3%2020.5s6.38-6.73%204.64-8.24-3.47%201.01-3.47%201.01%203.61-5.72%201.41-6.49c-2.2-0.769-3.33%204.36-3.33%204.36s0.873-5.76-1.06-5.76-1.58%205.39-1.58%205.39-0.574-4.59-2.18-4.12c-1.61%200.468-0.572%205.51-0.572%205.51s-1.58-4.89-2.93-3.79c-1.35%201.11%200.258%205.25%200.572%206.62%200.836%202.43%202.03%202.94%202.17%205.55%22%2F%3E%0A%3C%2Fsvg%3E%0A);flex-grow:1;width:100%;margin:0;display:flex}.esri-oriented-imagery-viewer__viewer--hidden{display:none}.esri-oriented-imagery-viewer__viewer-container{border-top:1px solid var(--calcite-color-border-3);background:var(--calcite-color-foreground-1);border-radius:0 0 3px 3px;flex:1 0 auto;order:1;align-self:stretch;width:100%;height:100%;display:flex}.esri-oriented-imagery-viewer__alert{inset-block-end:var(--calcite-spacing-md);inset-inline:var(--calcite-spacing-md);position:absolute}@keyframes rotateOrientedImageryNavigationTool{0%{transform:rotate(var(--oi-navigation-tool-rotation-from, 0deg))}to{transform:rotate(var(--oi-navigation-tool-rotation-to, 0deg))}}.esri-oriented-imagery-viewer__message-box{text-align:center;word-break:break-word;justify-content:center;align-items:center;width:100%;height:100%;padding:0 25%;font-size:var(--calcite-font-size-sm);display:flex;position:relative}.esri-oriented-imagery-viewer__navigation{transform:rotate(var(--oi-navigation-tool-rotation-to, 0deg))}.esri-oriented-imagery-viewer__navigation-animate{animation:.7s linear forwards rotateOrientedImageryNavigationTool}.esri-oriented-imagery-viewer__navigation-feature{fill:var(--calcite-color-brand);stroke:var(--calcite-color-foreground-1);stroke-width:1px}.esri-oriented-imagery-viewer__navigation-feature.selected{fill:var(--calcite-color-status-danger)}.esri-oriented-imagery-viewer__navigation-feature-path{pointer-events:none}.esri-oriented-imagery-viewer__navigation-feature-path-stop-offset-0{stop-color:var(--calcite-color-status-danger);stop-opacity:.4}.esri-oriented-imagery-viewer__navigation-feature-path-stop-offset-1{stop-color:var(--calcite-color-status-danger);stop-opacity:.2}.esri-oriented-imagery-viewer__navigation-pointer{fill:var(--calcite-color-foreground-1);fill-rule:evenodd;stroke:#0000;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-width:0}.esri-oriented-imagery-viewer__navigation-pointer-north{fill:var(--calcite-color-status-danger)}.esri-oriented-imagery-viewer__navigation-wrapper{z-index:1;position:absolute;bottom:0;right:0;overflow:hidden}.esri-oriented-imagery-viewer__navigation-wrapper--zoomed{transform-origin:100% 100%;transform:scale(1.5)}.esri-oriented-imagery-viewer__navigation-wrapper-boundary{fill:var(--calcite-color-foreground-1);fill-opacity:.25;stroke:var(--calcite-color-border-2)}.esri-oriented-imagery-viewer__navigation-sector{fill:none}.esri-oriented-imagery-viewer__navigation-sector-separator{stroke:var(--calcite-color-border-2);stroke-width:1px}.esri-oriented-imagery-viewer__navigation-sector-cross{stroke:var(--calcite-color-status-danger);stroke-width:1px}.esri-oriented-imagery-viewer__navigation-sector-enabled{fill:var(--calcite-color-foreground-1);stroke:var(--calcite-color-border-2);stroke-width:1px}.esri-oriented-imagery-viewer__navigation-sector-disabled{fill:var(--calcite-color-foreground-3);stroke:var(--calcite-color-border-2);stroke-width:1px}.esri-oriented-imagery-viewer__navigation-sector-outer{fill:var(--calcite-color-foreground-1);fill-opacity:.4;stroke:none}.esri-oriented-imagery-viewer__pro .esri-oriented-imagery-viewer{width:100%;max-width:unset;height:100%;max-height:unset;position:static}.esri-oriented-imagery-viewer__sketch-tools{justify-content:center;align-items:center;width:100%;display:flex;position:absolute;bottom:0}.esri-oriented-imagery-viewer__navigation-ui{box-sizing:border-box;inset-block-end:var(--calcite-spacing-md);inset-inline:var(--calcite-spacing-md);transform-style:preserve-3d;z-index:var(--calcite-z-index-overlay);pointer-events:none;flex-direction:column;align-items:center;display:flex;position:absolute;overflow:hidden}.esri-oriented-imagery-viewer__navigation-ui__direction{--esri-oriented-imagery-viewer__navigation-ui-direction-color: wheat;--calcite-icon-color: var(--esri-oriented-imagery-viewer__navigation-ui-direction-color);cursor:not-allowed;width:160px;height:160px;position:absolute}.esri-oriented-imagery-viewer__navigation-ui__direction:not([disabled]){cursor:pointer;pointer-events:auto}.esri-oriented-imagery-viewer__navigation-ui__direction:not([disabled]):hover{--calcite-icon-color: var(--calcite-color-brand);background-color:rgba(var(--calcite-color-brand),var(--calcite-opacity-half));border-radius:50%}.esri-oriented-imagery-viewer__navigation-ui__direction-pad{box-sizing:border-box;transform:perspective(400px) rotateX(60deg) var(--rotate-transform);filter:drop-shadow(0 2px 1px #00000080);width:330px;height:330px}.esri-oriented-imagery-viewer__navigation-ui__direction--top{transform-style:preserve-3d;top:0;left:50%;transform:translate(-50%)}.esri-oriented-imagery-viewer__navigation-ui__direction--bottom{transform-style:preserve-3d;bottom:0;left:50%;transform:translate(-50%)}.esri-oriented-imagery-viewer__navigation-ui__direction--left{transform-style:preserve-3d;top:50%;left:0;transform:translateY(-50%)}.esri-oriented-imagery-viewer__navigation-ui__direction--right{transform-style:preserve-3d;top:50%;right:0;transform:translateY(-50%)}.esri-panoramic-viewer{z-index:1;position:relative;width:100%;height:100%}`,kd=ms(Od),vi=class vi extends Cn{constructor(){super(...arguments),this.widget=kd(this),this._hasOrientedImageryLayerToAdd=!1,this.viewModel=this.widget.viewModel,this.view=this.widget.view,this.autoDestroyDisabled=!1,this.currentCoverageVisible=this.widget.currentCoverageVisible,this.dataCaptureEnabled=this.widget.dataCaptureEnabled,this.disabled=this.widget.disabled,this.galleryOpened=this.widget.galleryOpened,this.icon=this.widget.icon,this.imageEnhancementToolActive=this.widget.imageEnhancementToolActive,this.imageGalleryEnabled=this.widget.imageGalleryEnabled,this.imageOverlaysOpened=this.widget.imageOverlaysOpened,this.isAdditionalCoverageVisible=this.widget.isAdditionalCoverageVisible,this.isAdditionalPointSourcesVisible=this.widget.isAdditionalPointSourcesVisible,this.label=this.widget.label,this.layer=this.widget.layer,this.mapImageConversionToolState=this.widget.mapImageConversionToolState,this.navigationToolActive=this.widget.navigationToolActive,this.referencePoint=this.widget.referencePoint,this.arcgisPropertyChange=An()("imageGalleryEnabled","layer"),this.arcgisReady=$n()}async destroy(){await this.manager.destroy()}willUpdate(e){if(e.has("orientedImageryLayerItemId")){const i=this.orientedImageryLayerItemId;i&&this.widget&&(this.layer=new Or({portalItem:{id:i}}),this.widget.view?this.widget.view.map?.add(this.layer):this._hasOrientedImageryLayerToAdd=!0)}}loaded(){this._hasOrientedImageryLayerToAdd&&(this.widget.view?this._onReady():this.el.addEventListener("arcgisReady",()=>{this._onReady()},{once:!0}))}_onReady(){const{layer:e}=this;e&&(this.widget.view?.map?.add(e),this._hasOrientedImageryLayerToAdd=!1)}};vi.properties={view:0,autoDestroyDisabled:5,currentCoverageVisible:5,dataCaptureEnabled:5,disabled:5,galleryOpened:5,icon:1,imageEnhancementToolActive:5,imageGalleryEnabled:4,imageOverlaysOpened:5,isAdditionalCoverageVisible:5,isAdditionalPointSourcesVisible:5,label:1,layer:0,mapImageConversionToolState:5,navigationToolActive:5,orientedImageryLayerItemId:1,position:1,referenceElement:1,referencePoint:0},vi.styles=[Sn,Ld];let gi=vi;On("arcgis-oriented-imagery-viewer",gi);const lu=Object.freeze(Object.defineProperty({__proto__:null,ArcgisOrientedImageryViewer:gi},Symbol.toStringTag,{value:"Module"}));export{Oh as B,Eh as C,sd as E,F,zh as I,jh as L,Gh as M,Nh as P,Ge as R,kh as S,po as T,_e as W,Zr as X,Qe as Z,je as a,iu as b,au as c,ru as d,Qh as e,ki as f,ad as g,Lh as h,tu as i,kc as j,Dh as k,Th as l,C as m,bh as n,Jh as o,od as p,lu as q,Gr as s,mt as t,ou as u,Bh as v,nd as w,Hh as x,Ft as z};
