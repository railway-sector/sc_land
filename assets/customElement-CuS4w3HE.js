const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/index-CccD-otN.js","assets/index-CwsCBFm3.js","assets/index-B0EAL2pn.js","assets/index-CDlvyoWU.js","assets/index-DUm9Q5-H.js","assets/index-COPtOuRR.js","assets/index-6CXt9X2P.js","assets/index-CXTe3vZB.js","assets/index-BOdF8fLv.js","assets/index-D6Hs6QxG.js","assets/utils4-DBgJPJ1M.js","assets/text-CU-NFKp_.js","assets/index-D8LU2ZlT.js","assets/index-3ZhkCLKv.js","assets/index-Cc9HItg-.js","assets/index-BIJAvlEw.js","assets/index-DxNcZFhg.js","assets/geodeticLengthOperator-DifrZujk.js","assets/geodeticCurveType-CirnHLSB.js"])))=>i.map(i=>d[i]);
import{_ as n,e as c,a0 as I,g as z,S as re,ey as q,T as ae,U as p,V as o,nS as Ce,O as oe,f as b,r7 as H,dd as ee,Ax as Me,bJ as M,aa as V,aV as Y,gS as Ne,ad as Ee,d0 as Le,al as Oe,fd as te,av as Pe,au as le,ao as ve,f1 as Ge,nm as Be,d8 as $e,$ as De,a4 as ne,B as He,ht as Ve,hu as We,cD as Ue,tZ as je,dM as ze,du as qe,a2 as Ze,Ay as be,iW as Ye,bI as Je,bH as W,p7 as Qe,eX as Ke,bL as Xe,y as et,L as tt,r as N,u as it,c as st,i as rt,l as at}from"./index-BrQW8HOS.js";import{e as Ae}from"./vmEvent-CsrnYMSK.js";import{l as ot}from"./throttle-CTJgdIni.js";import{s as lt,c as nt}from"./actionUtils-CgMB-iLm.js";import{n as T,a as ct,F as dt,t as ut}from"./css-BW2-ztHV.js";import{c as ht}from"./Spinner-Csmzl8Du.js";import{z as ke}from"./FeaturesViewModel-KWIn8HXK.js";import{n as pt,i as Te,f as gt}from"./actionUtils-8wl7T0BJ.js";import{s as mt}from"./Heading-Bx03M7LB.js";import{s as D}from"./substitute-D-eLZ17Q.js";import{n as Fe}from"./GraphicsLayer-CtVknZ1a.js";import{N as _t,k as ft,p as J}from"./UtilityNetwork-BLUMdklD.js";import{s as yt}from"./utils-D5_eym7P.js";import{trace as wt}from"./trace-BOaTdmtt.js";import vt from"./TraceParameters-CloPnVkP.js";import{t as bt}from"./layerUtils-CdCZXuDJ.js";import{geodesicBuffer as ce,buffer as de,convexHull as Q,geodesicArea as At,planarArea as kt,cut as ue,planarLength as E}from"./geometryEngine-BAynHaVi.js";import{e as Tt,u as Ft}from"./euclideanLengthMeasurementUtils-B8AL_WaV.js";import{d as St}from"./SketchViewModel-NRhuw9HA.js";import{I as xt}from"./useWidget-CYtf2hFT.js";import"./Attachments-_aarC56Q.js";import"./AttachmentsViewModel-BorO2JWS.js";import"./AttachmentInfo-Be-qgHMP.js";import"./featureUtils-D2UmGJHI.js";import"./utils-BJ7fw6dI.js";import"./attachmentUtils-CREavg3W.js";import"./legacyIcon-BpbXCnGp.js";import"./FeatureViewModel-DUcUeCTn.js";import"./executeQueryJSON-CQzDonsh.js";import"./query-D5mFMRFz.js";import"./pbfQueryUtils-PegbNvJC.js";import"./pbf-bO1aG1II.js";import"./arcadeFeatureUtils-D1_gLIP2.js";import"./shared-DBXlHENV.js";import"./isImageryGraphicOrigin-Ccuhb4eK.js";import"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./FeatureRelationshipViewModel-BmyR0OK6.js";import"./featureFormUtils-NJdl1KAp.js";import"./dateUtils-DCwqoPkL.js";import"./FeatureUtilityNetworkAssociationsViewModel-bOY5P1li.js";import"./NetworkElement-te1zus-P.js";import"./getFeatureTitle-Mrr3SXNI.js";import"./FeatureUtilityNetworkAssociations-ChFrHaHO.js";import"./widget-lSGAz9tN.js";import"./uriUtils-bGTzqau3.js";import"./a11yUtils-BrnjXW_g.js";import"./utils-jHLUFzoE.js";import"./utils-6_NAbAK3.js";import"./cimSymbolUtils-CmFYUdpV.js";import"./gfxUtils-DDSu4Luj.js";import"./AnchorElementViewModel-Djy63Zpd.js";import"./geometryUtils-DV6xDwql.js";import"./symbolUtils-C3MaPSzp.js";import"./svgUtils-BB2umWtg.js";import"./mat2df32-Dpt2CT5P.js";import"./mat2d-BbBq4Byx.js";import"./typeUtils-Dszw1S4V.js";import"./networkFieldUtils-CaYZrGFV.js";import"./TelecomNetworkElement-CwMWpoWJ.js";import"./geometryEngineBase-BQTefT4Y.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./utils-D_VO_1nP.js";import"./geodesicUtils-BJZXB7Hp.js";import"./geometry2dUtils-kADrF-iP.js";import"./geodeticLengthOperator-DifrZujk.js";import"./geodeticCurveType-CirnHLSB.js";import"./geodesicMeasurementUtils-CQw8IWGR.js";import"./isSupportedObject-DknMXN_6.js";import"./SketchLabelOptions-BPF5xZLI.js";import"./SketchOptions-CHLlByzL.js";import"./SnappingManager-BWOfKl0d.js";import"./automaticAreaMeasurementUtils-dI3X5owW.js";import"./geodesicAreaMeasurementUtils-CPlOyDe5.js";import"./earcut-D9gy186-.js";import"./automaticLengthMeasurementUtils-Cr-y0OEN.js";import"./useView-Cya0Zpns.js";const x=pt.clone(),Rt={featureContent:"esri-utility-network-trace__feature-content"};let S=class extends re{constructor(t,i){super(t,i),this._utilityNetworkTraceMessages=null,this.closed=!1,this.closable=!0,this.messages=null,this.messagesCommon=null,this._handleAddNonspatialTraceLocation=s=>{this.emit("add-nso-trace-location",{featureWidget:s})},this._handleOpenFeature=s=>{this.emit("open-feature",{feature:s})},this._handleZoomToFeature=s=>{this.emit("zoom-to-feature",{featureWidget:s})}}initialize(){(async()=>this._utilityNetworkTraceMessages=await q("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"))()}loadDependencies(){return ae({action:()=>p(()=>import("./index-BrQW8HOS.js").then(t=>t.MM),__vite__mapDeps([0,1])),"action-bar":()=>p(()=>import("./index-BrQW8HOS.js").then(t=>t.MS),__vite__mapDeps([0,1])),"action-group":()=>p(()=>import("./index-BrQW8HOS.js").then(t=>t.MR),__vite__mapDeps([0,1])),"flow-item":()=>p(()=>import("./index-CccD-otN.js"),__vite__mapDeps([2,0,1]))})}get mode(){return this._get("mode")||"show-feature-info"}set mode(t){this._set("mode",t)}render(){const{flowItems:t}=this,i=t?.toArray();return o(Ce,null,i?.map((s,r)=>this._renderFlowItem(s,r===t.length-1)))}_renderAddNonspatialTraceLocationAction(t){const{_utilityNetworkTraceMessages:i}=this;return o("calcite-action",{appearance:"solid",bind:this,icon:"utility-network-trace",onclick:()=>this._handleAddNonspatialTraceLocation(t),scale:"s",text:i.inputsStrings.addNonspatialOption,textEnabled:!0,title:i.inputsStrings.addNonspatialOption})}_renderFlowItem(t,i){const{messages:s,closable:r,closed:a}=this,l="graphic"in t&&!t.isTable,d=t.flowType==="feature-association",u=this._getExitMessage(t),m=s.selectFeature,g=t,A=g?g.graphic?.sourceLayer:null,F=!(A&&A.geometryType);return o("calcite-flow-item",{bind:this,closable:r,closed:a,description:this._getDrillInFlowItemDescription(t),heading:t.title??"",key:`flow-item-${t.viewModel.uid}`,selected:i,onCalciteFlowItemBack:y=>{y.preventDefault(),this._handleDrillInBackClick()}},o("calcite-action",{appearance:"transparent",bind:this,class:T.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:u,title:u}),l?o("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(t),slot:"header-actions-end",text:m,title:m}):null,this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,d&&this.mode==="add-nso"?o("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},o("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},F?this._renderAddNonspatialTraceLocationAction(t):this._renderZoomToFeatureAction(t))):null,o("div",{class:this.classes(T.container,Rt.featureContent)},t.render()))}_renderZoomToFeatureAction(t){const i=this._getActionTitle(x);return o("calcite-action",{active:x.active,appearance:"solid",bind:this,"data-action-uid":x.uid,disabled:x.disabled,icon:x.icon??"question",indicator:x.indicator,key:`action-${x.uid}`,loading:x.active,onclick:()=>this._handleZoomToFeature(t),scale:"s",text:i,textEnabled:!0,title:i})}_getActionTitle(t){const{messages:i}=this,{id:s}=t,r=t.title??"";return s==="zoom-to-feature"?D(r,{messages:i}):r}_getDrillInFlowItemDescription(t){switch(t.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return t.viewModel.description??"";case"feature-relationship":return t.allItemsDescription;case"feature-utility-network-association-type":return t.description??""}}_getExitMessage(t){switch(t.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_handleDrillInBackClick(){const t=this.flowItems?.pop();t&&("showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}_handleExitClick(){this.emit("exit")}};n([c()],S.prototype,"closed",void 0),n([c()],S.prototype,"closable",void 0),n([c()],S.prototype,"flowItems",void 0),n([c(),I("esri/widgets/Features/t9n/Features")],S.prototype,"messages",void 0),n([c(),I("esri/t9n/common")],S.prototype,"messagesCommon",void 0),n([c()],S.prototype,"mode",null),S=n([z("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeaturesDrillIn")],S);const It=S,Ct="selected-index",Mt=0,he="features-spinner",L="esri-utility-network-trace",O={blockContainer:`${L}__block-container`,blockContent:`${L}__block-content`,featureContent:`${L}__feature-content`,paddingBottom:`${L}__pad-bottom`,paddingTop:`${L}__pad-top`};let _=class extends ct(re){constructor(e,t){super(e,t),this._actionBarMenuNode=null,this._drillInFlowItems=new oe,this._drillInWidget=new It({flowItems:this._drillInFlowItems}),this._feature=null,this._featureMenuViewportNode=null,this._spinner=null,this._utilityNetworkTraceMessages=null,this.featureNavigationTop=!1,this.headerActions=new Te,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new ke,this._renderAction=(i,s)=>{const r=this._getActionTitle(i),{type:a,active:l,uid:d,disabled:u,indicator:m}=i;return i.visible?o("calcite-action",{active:a==="toggle"&&i.value,appearance:"solid",bind:this,"data-action-uid":d,disabled:i.id==="zoom-to-feature"?!this.feature.geometry:u,icon:this._getActionIcon(i),indicator:m,key:`action-${s}`,loading:l,onclick:this._triggerAction,scale:"s",text:r,title:this._hideActionText?r:void 0},this._renderFallbackIcon(i)):null},this._renderAddNsoBlock=()=>{const{_utilityNetworkTraceMessages:i,messagesCommon:s}=this;return o("calcite-block",{class:O.blockContent,expanded:!this.feature,heading:i?.inputsStrings.addNonspatialOption},o("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:s.close}),o("calcite-notice",{icon:"information",kind:"info",open:!this.feature},o("div",{slot:"message"},i?.inputsStrings.addNonspatialHint)))},this._renderNoPopupErrorBlock=()=>{const{_utilityNetworkTraceMessages:i,messagesCommon:s}=this;return o("calcite-block",{description:void 0,expanded:!0,heading:this.mode==="show-feature-info"?s.warning:void 0},o("calcite-notice",{class:this.classes(O.paddingBottom,O.paddingTop),icon:"exclamation-mark-triangle",kind:"danger",open:!0},o("div",{slot:"message"},i.alertsStrings.noPopupConfigured)),this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:s.close}):void 0)},this._displaySpinnerThrottled=ot(()=>this._displaySpinner(),Mt),this.addHandles([this._displaySpinnerThrottled,b(()=>this.viewModel?.active,i=>this._drillInWidget.closed=!i),b(()=>this.viewModel?.view,(i,s)=>this._viewChange(i,s)),b(()=>this.viewModel?.view?.ready,(i,s)=>this._viewReadyChange(i??!1,s??!1)),b(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),b(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),b(()=>this.selectedFeatureWidget,()=>this._destroyDrillInFlowItemWidgets()),b(()=>{const i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),b(()=>{const i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),b(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._drillInWidget.on("close",()=>{this.emit("close")}),this._drillInWidget.on("exit",()=>this._destroyDrillInFlowItemWidgets()),this._drillInWidget.on("open-feature",({feature:i})=>this._openRelatedFeature(i)),this._drillInWidget.on("zoom-to-feature",({featureWidget:i})=>gt(this.viewModel,i)),this._drillInWidget.on("add-nso-trace-location",({featureWidget:i})=>this.emit("add-nso-trace-location",{featureWidget:i}))])}initialize(){(async()=>this._utilityNetworkTraceMessages=await q("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"))(),this._drillInWidget.mode=this.mode,this._drillInWidget.closable=!1}loadDependencies(){return ae({action:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MM),__vite__mapDeps([0,1])),"action-bar":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MS),__vite__mapDeps([0,1])),"action-group":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MR),__vite__mapDeps([0,1])),block:()=>p(()=>import("./index-CwsCBFm3.js"),__vite__mapDeps([3,0,1])),flow:()=>p(()=>import("./index-B0EAL2pn.js"),__vite__mapDeps([4,0,1])),"flow-item":()=>p(()=>import("./index-CccD-otN.js"),__vite__mapDeps([2,0,1])),notice:()=>p(()=>import("./index-CDlvyoWU.js"),__vite__mapDeps([5,0,1]))})}destroy(){this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._drillInWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get feature(){return this.viewModel.features.length?this.viewModel.features[0]:null}set feature(e){this.viewModel.features=e?[e]:[]}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get hasAssociationsPopupElement(){const e=H(this.feature?.sourceLayer)?this.feature?.sourceLayer:void 0,t=ee(this.feature?.sourceLayer)?this.feature?.sourceLayer:void 0,i=e?.popupTemplate||t?.popupTemplate||null,s=i?.content;return!(Array.isArray(s)&&!s.some(r=>r instanceof Me))}get hasPopupInfo(){const e=H(this.feature?.sourceLayer)?this.feature?.sourceLayer:void 0,t=ee(this.feature?.sourceLayer)?this.feature?.sourceLayer:void 0;return!(!e?.popupTemplate&&!t?.popupTemplate)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get mode(){return this._get("mode")||"add-nso"}set mode(e){this._set("mode",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){const e=Array.from(this._drillInFlowItems).at(-1);if(!e)return null;const{flowType:t}=e;return t==="feature-association"||t==="feature-relationship"?e.graphic??null:null}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_drillInFlowItems:i,timeZone:s}=this,{selectedFeatureViewModel:r}=this.viewModel,a={title:!1};return r?(e?(e.viewModel=r,e.visibleElements=a):this._feature=new dt({flowItems:i,headingLevel:t+1,timeZone:s,viewModel:r,visibleElements:a}),this._feature):null}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}open(e){this.removeHandles(Ct),this.viewModel.open({features:[e]})}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return o("div",{bind:this,class:this.classes(T.base,M.widget,M.panel,O.blockContainer)},this.mode==="add-nso"?this._renderAddNsoBlock():void 0,this.feature?this.hasPopupInfo?this._renderContentContainer():this._renderNoPopupErrorBlock():void 0)}_renderActionBar(){return this.viewModel.allActions?.length?o("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},o("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const e=this.viewModel?.content;return e?typeof e=="string"?o("div",{class:ut.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._drillInWidget.render()];return o("calcite-flow",{key:"content-container"},e)}_renderContentFeature(){const{_drillInFlowItems:e,headingLevel:t,featureNavigationTop:i}=this,{title:s,active:r}=this.viewModel,a=s||"";return o("calcite-flow-item",{bind:this,class:this.classes({[T.contentFeature]:!0}),closed:!r,collapseDirection:i?"down":"up",headingLevel:t,key:"root-flow-item",loading:this.viewModel.waitingForContents,selected:e.length===0},this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,a?o(mt,{class:this.classes(T.featuresHeading,M.heading),innerHTML:a,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),o("div",{class:this.mode==="add-nso"?this.classes(T.container,T.contentContainer):this.classes(T.container,T.contentContainer,O.featureContent)},this._renderContent()))}_renderFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const s=lt({action:e,feature:this.selectedFeature}),r={[T.icon]:!!t,[T.actionImage]:!!s};return t&&(r[t]=!0),s||t?o("span",{"aria-hidden":"true",class:this.classes(T.icon,r),key:"icon",styles:nt(s)}):null}_renderHeaderAction(e,t){const i=e.title||"";return e.visible?o("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled||!this.feature.geometry,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_createSpinner(e){e&&(this._spinner=new ht({view:e}),e.ui.add(this._spinner,{key:he,position:"manual",internal:!0}))}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,he),e.destroy(),this._spinner=null)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_featureMenuViewportScrollTop(){this._featureMenuViewportNode?.scrollContentTo({top:0})}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:s}=this,{id:r}=e,a=i?.attributes,l=e.title??"",d=r==="zoom-to-feature"?D(l,{messages:t}):r==="remove-selected-feature"?D(l,{messages:s}):r==="zoom-to-clustered-features"||r==="browse-clustered-features"?D(l,{messages:t}):e.title;return d&&a?D(d,a):d??""}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=t?.geometry;i!=null&&t!=null&&(this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:i}),this.open(t))}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:s}=this.viewModel,r=s.findIndex(l=>l.uid===i),a=s.at(r);a&&a.type==="toggle"&&(a.value=!a.value),this.viewModel.triggerAction(r)}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,s=this.headerActions.find(({uid:r})=>r===i);s&&!s.disabled&&(s?.type==="toggle"&&(s.value=!s.value),this.emit("trigger-header-action",{action:s}))}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_wireUpView(e){this._destroySpinner(),e&&this._createSpinner(e)}};n([c()],_.prototype,"_drillInFlowItems",void 0),n([c()],_.prototype,"_hideActionText",null),n([c({readOnly:!0})],_.prototype,"active",null),n([c()],_.prototype,"content",null),n([c()],_.prototype,"feature",null),n([c()],_.prototype,"featureNavigationTop",void 0),n([c()],_.prototype,"goToOverride",null),n([c()],_.prototype,"hasAssociationsPopupElement",null),n([c()],_.prototype,"hasPopupInfo",null),n([c({type:Te})],_.prototype,"headerActions",void 0),n([c()],_.prototype,"headingLevel",void 0),n([c()],_.prototype,"location",null),n([c(),I("esri/widgets/Features/t9n/Features")],_.prototype,"messages",void 0),n([c(),I("esri/t9n/common")],_.prototype,"messagesCommon",void 0),n([c()],_.prototype,"mode",null),n([c()],_.prototype,"promises",null),n([c()],_.prototype,"responsiveActionsEnabled",void 0),n([c({readOnly:!0})],_.prototype,"selectedFeature",null),n([c({readOnly:!0})],_.prototype,"selectedDrillInFeature",null),n([c({readOnly:!0})],_.prototype,"selectedFeatureWidget",null),n([c()],_.prototype,"timeZone",null),n([c()],_.prototype,"view",null),n([c({type:ke}),Ae(["triggerAction","trigger-action"])],_.prototype,"viewModel",void 0),_=n([z("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeature")],_);const pe=_;function K(e){return e.type==="polygon"||e.type==="polyline"}function Nt(e){return e.hasOwnProperty("points")}function Et(e){return Nt(e)&&e.points.length===2}class Se{createBuffer(t,i,s,r){if(Array.isArray(t)){if(t.length>0){const l=V.fromJSON(t[0].spatialReference);return l.isWGS84||l.isWebMercator?ce(t,i,s,r):de(t,i,s,r)}return}const a=V.fromJSON(t.spatialReference);return a.isWGS84||a.isWebMercator?ce(t,i[0],s):de(t,i[0],s)}createConvexHull(t){if(Array.isArray(t)){if(t.length===1&&Et(t[0])){const s=Q(t[0]);if(K(s))return s}return Q(t,!0).filter(K)}const i=Q(t);if(K(i))return i}calculateArea(t,i){const s=new V({wkid:t.spatialReference.wkid});return s.isWGS84||s.isWebMercator?parseFloat(At(t,i).toFixed(2)):parseFloat(kt(t,i).toFixed(2))}mergeAggregatedToGeometries(t){const i=[],{line:s,multipoint:r,polygon:a}=t;return s&&i.push(s),r&&i.push(r),a&&i.push(a),i}getPercentageAlong(t,i,s){let r=t;const a=this._createPolyline(t.paths,s.wkid);if(i.type==="point"){const d=i.x-.5,u=i.x+.5,m=[[[d,i.y-.5],[u,i.y+.5]]];r=this._createPolyline(m,i.spatialReference.wkid),r=Y(r,s);const g=ue(a,r);if(g.length>0){const A=E(a,"feet");let F;return F=g[0].paths[0][0][0]===a.paths[0][0][0]?E(g[0],"feet"):E(g[1],"feet"),[F/A]}return[.5]}r=Y(i,s);const l=ue(a,r);if(l.length>0){const d=E(a,"feet");return[E(l[0],"feet")/d]}return[.5]}async projectGeometry(t,i){return await Ne(),Y(t,i)}_createPolyline(t,i){return new Ee({hasZ:!1,hasM:!0,paths:t,spatialReference:new V({wkid:i})})}}const xe=[227,27,21,.6],Re=[21,244,21,.6],U=12,ie=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class Lt{constructor(){this.highlightColor=[...ie]}addCustomColor(t){this.highlightColor=[...ie],this.highlightColor.some(i=>i.hex.toLowerCase()===t.hex.toLowerCase())||this.highlightColor.push(t)}getFlagGraphic(t,i,s,r){const a=i==="starting-point"?Re:xe;if(t.type==="polygon"){const l=Le(t);t=l?Oe.fromJSON(l):null}return r?this.makeGraphic(t,a,s?.attributes,null,r):this.makeGraphic(t,a,s?.attributes)}initializeSketch(t,i,s){const r=new oe;return s.forEach(a=>r.add(new Tt({layer:a,enabled:!0}))),new St({layer:i,view:t,snappingOptions:new Ft({enabled:!0,featureEnabled:!0,featureSources:r})})}makeGraphic(t,i,s,r,a){let l,d=t;switch(t.type){case"multipoint":l=new le({color:i,size:U,outline:{color:i,width:0}}),r&&(d=t);break;case"point":l=a||new le({color:i,size:U,outline:{color:i,width:0}}),r&&(d=t);break;case"polyline":l=new Pe({color:i,width:U}),r&&(d=t);break;case"polygon":l=new te({color:i,outline:{color:i,width:U}}),r&&(d=t)}return new ve({geometry:d,symbol:l,attributes:s??null})}}const C=`utility-network-trace-result-area-${Date.now()}`;function P(e){return e.type==="graphics"}class Ot{constructor(){this.traceInformation={},this._geometryHandler=new Se}addResultAreaToMap(t,i){const s=this.createGraphicLayer(i);s&&P(s)&&s.add(t)}changeResultAreaColor(t,i,s){const r=new te({color:i.color,style:"solid",outline:{color:i.color,width:1}}),a=this._findGraphicsByTraceId(t,s);return a&&a.forEach(l=>{l.symbol=r}),r}createBuffer(t,i,s,r){return this._geometryHandler.createBuffer(t,i,s,r)}createConvexHull(t,i,s){const r=this._geometryHandler.createConvexHull(t);return i>0&&r?this.createBuffer(r,[i],s,!1):r}createResultAreaGraphic(t,i,s,r,a,l){const d=new te({color:l.color,style:"solid",outline:{color:l.color,width:1}}),u=[];for(const m in i)u.push(new Ge({fieldName:m,label:m==="areaStatistic"?r.attributeStrings[m]+" ("+a.units[s]?.abbr+")":r.attributeStrings[m]}));return new ve({geometry:t,symbol:d,attributes:i,popupTemplate:new Be({title:i.traceName,content:[{type:"fields",fieldInfos:u}]})})}removeResultArea(t,i){const s=i.findLayerById(C);if(s&&P(s)){const r=this._findGraphicsByTraceId(t,i);return r&&s.removeMany(r),r}return null}removeAllResultAreaGraphics(t){if(t){const i=t.findLayerById(C);i&&P(i)&&i.removeAll()}}createGraphicLayer(t,i){const s=t.findLayerById(C);if(s&&P(s))return s;const r=new Fe({title:i??C,listMode:"hide",id:C});return t.add(r),r}_findGraphicsByTraceId(t,i){const s=i.findLayerById(C);if(s&&P(s)){const r=s.graphics.filter(a=>a.attributes.traceId===t);return r.length>0?r.toArray():null}return null}}function ge(e){return e.type==="feature"}function X(e,t){return e.url.includes(t)}function me(e,t){return(e.dataElement?.domainNetworks||[]).some(i=>i.subnetworkLayerId===t.layerId)}class Pt{getValidUtilityNetworkLayers(t,i){const s=[];return t?.allLayers.forEach(r=>{r.type==="group"?s.push(...r.layers.filter(H).filter(a=>ge(a)&&i.isUtilityLayer(a)&&!me(i,a)).filter(a=>X(a,i.featureServiceUrl)).toArray()):r.type==="subtype-group"?s.push(...r.sublayers.filter(a=>X(a,i.featureServiceUrl)).toArray()):H(r)&&ge(r)&&i.isUtilityLayer(r)&&!me(i,r)&&X(r,i.featureServiceUrl)&&s.push(r)}),s}}const Gt=()=>q("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),Bt=()=>q("esri/core/t9n/Units"),G=`utility-network-trace-flags-${Date.now()}`,B=`utility-network-trace-results-${Date.now()}`,$=`utility-network-trace-sketch-${Date.now()}`;function $t(e){return e instanceof be}function Dt(e){return e.layer.type==="feature"||e.layer.type==="subtype-group"}function Ht(e){return"layer"in e}function _e(e){return e.layerViews!==void 0}function Vt(e){return e.type==="graphics"}function fe(e){return e.type==="feature"||e.type==="subtype-group"||e.type==="group"}async function Wt(e){const t=new ze({url:e.networkSystemLayers.dirtyAreasLayerUrl});await t.load();const i=t.version;if(Number(i)<=11.1){const s=await qe(e.layerUrl),r=new Ze({url:s});await r.load();const a=r?.user?.username;return!!a&&yt(r,a,"utilityNetwork")}return!0}let w=class extends $e{constructor(e){super(e),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._flagId=0,this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._sketchViewModel=null,this._traceTimeout=6e5,this._utilityHelper=new Pt,this._validUNLayers=[],this._watchHandler=null,this.traces=[],this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){this._geometryHandler=new Se,this.graphicHandler=new Lt,this._resultAreaHandler=new Ot,(async()=>{const[e,t]=await Promise.all([Gt(),Bt()]);this.set({messages:e,messagesUnits:t})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(e){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...e}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach(t=>{const i=t.resultArea?.show;t.resultArea={...this.defaultResultAreaProperties,...e},this.removeResultAreaFromMap(t),this.enableResultArea&&this.createResultAreaGraphic(t).then(s=>{if(s){t.resultAreaGraphic=s;const r=e?.show??i;t.resultArea&&(t.resultArea.show=r),r&&this.addResultAreaToMap(t,s)}})})}get state(){return this.view?.ready?"ready":"loading"}get view(){return this._get("view")}set view(e){e&&e.type!=="2d"&&De.getLogger(this).error(new ne("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e),this.utilityNetwork&&this.reset(),this.utilityNetwork=null,this.loadUtilityNetwork().then(t=>{t&&this.selectTracesOnLoad()})}addFlagByHit(e,t){const i=!!this.view&&this.view.popupEnabled,s=r=>{this.view?.popup&&(this.view.popupEnabled=r)};return new Promise((r,a)=>{i&&s(!1),this._clickHandler?.remove(),this._clickHandler=this._sketchViewModel.on("create",l=>{if(l.state==="complete"){const d=this._getGraphicLayer($);d&&l.graphic&&d.remove(l.graphic),this.queryFlagByHitTest(l,e,t).then(u=>{this.emit("add-flag-complete",{type:e,symbol:t}),r(u)}).catch(u=>{this.emit("add-flag-error",{type:e,symbol:t}),a(u)}).finally(()=>{i&&s(!0),this._clickHandler?.remove()})}}),this._sketchViewModel.create("point"),this.emit("add-flag",{type:e})})}addNonspatialTraceLocation(e,t){const i=this._getDisplayField(e),s=this.utilityNetwork?.getTerminalConfiguration(e),r={terminalId:null,isFilterBarrier:!1,allTerminals:s,selectedTerminals:[s?s.terminals[0].id||null:1],displayValue:i};e.attributes={...e.attributes,...r};const a=e.attributes.hasOwnProperty("GLOBALID")?e.attributes.GLOBALID:e.attributes.globalid;if(!this._flags.some(l=>l.globalId===a&&l.type===t)){const l=this._createFlagProperty(e,t,null);this._flags.push(l),this.emit("add-flag-complete",{type:t})}this.emit("add-flag",{type:t})}async addFlagsOnLoad(){return this._flags.length>0?[]:(await He(()=>this.view!=null&&!this.view.updating),(await Promise.all(this.flags.map(async e=>{if(!e.mapPoint)return null;const{type:t}=e,i=e.mapPoint.clone(),s=t==="barrier"?xe:Re,r={graphic:this.graphicHandler.makeGraphic(i,s),state:"complete",tool:"point",toolEventInfo:null,type:"create"};try{return await this.queryFlagByHitTest(r,e.type,null),this.emit("add-flag-complete",{type:t}),null}catch{return this.emit("add-flag-error",{type:t}),t==="barrier"?"barrier":"starting-point"}}))).filter(e=>!e))}async addResultAreaToMap(e,t){if(this.view){if(e.resultArea.show=!0,t)this._resultAreaHandler?.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t});else if(e.results){const i=await this.createResultAreaGraphic(e);i&&(e.resultAreaGraphic=i,this._resultAreaHandler?.addResultAreaToMap(i,this.view.map),this.emit("add-result-area",{graphic:i}))}}}async addResultGraphicToView(e,t){const{view:i}=this,{results:s}=e;if(i&&s&&this.utilityNetwork){for(const r in s.aggregatedGeometry)if("line,multipoint,polygon".includes(r)){const a=r,l=s.aggregatedGeometry[a];if(l!=null){l.spatialReference=this.utilityNetwork.spatialReference,e.graphicEnabled=!0;const d=await this._geometryHandler.projectGeometry(l,i.spatialReference),u={globalid:e.trace.globalId};if(d!==null){const m=this.graphicHandler.makeGraphic(d,t.color,u,i.spatialReference);this._getGraphicLayer(B)?.add(m)}}}}}addTerminal(e,t){const i=[...this._flags];i.forEach(s=>{s.globalId===t.globalId&&(t.selectedTerminals?.includes(parseInt(e,10))||s.selectedTerminals?.push(parseInt(e,10)))}),this._flags=i}async callTrace(){const e=this.traces.filter(t=>t.selected);return!!e.length&&(this.traceResults.length>0&&this.traceResults.forEach(t=>{this.removeResultGraphicFromView(t)}),this.traceResults=[],this.removeSelection(),await Promise.all(e.map(async(t,i)=>{const s=t,r=new vt({gdbVersion:this.utilityNetwork?.gdbVersion,moment:this.utilityNetwork?.historicMoment,namedTraceConfigurationGlobalId:s.globalId,outSpatialReference:null,resultTypes:null,traceType:s.traceType,traceLocations:this._flags,traceConfiguration:null});await this.executeTrace(s,this.utilityNetwork?.networkServiceUrl,r).then(async a=>{if(a.hasOwnProperty("results")){const l={...a};if(l.results!==null){l.resultArea={...this.resultAreaProperties};const d=[...l.results.elements];l.results.elements.length=0;const u=new Map;for(const g of d)u.has(g.globalId)||(u.set(g.globalId,!0),l.results.elements.push(g));const m=[...this.traceResults];if(m.splice(i,0,l),this.traceResults=m,l.results!==null&&(this.selectOnComplete&&this.mergeSelection(!0,l.trace),this.showGraphicsOnComplete&&await this.addResultGraphicToView(l,l.graphicColor),this.enableResultArea)){const g=await this.createResultAreaGraphic(l);g&&(l.resultAreaGraphic=g,l.resultArea?.show&&await this.addResultAreaToMap(l,l.resultAreaGraphic))}}else{const d=[...this.traceResults];d.splice(i,0,a),this.traceResults=d}this._activeProgress=!1}else{this._activeProgress=!1;const l=[...this.traceResults];l.splice(i,0,a),this.traceResults=l}}).catch(a=>{throw this._activeProgress=!1,a})})),!0)}cancelAddFlagByHit(){this._sketchViewModel.cancel()}changeResultAreaColor(e,t){if(!e.resultArea)return;e.resultArea.color=t;const i=this._resultAreaHandler?.changeResultAreaColor(e.trace.globalId,t,this.view.map);e.resultAreaGraphic&&(e.resultAreaGraphic.symbol=i)}changeResultGraphicColor(e,t){const i=[...this.traceResults];i.length>0&&i.forEach(s=>{s.trace.globalId===t.trace.globalId&&(s.graphicColor=e,s.graphicEnabled=!0)}),this.traceResults=i,this.removeResultGraphicFromView(t),this.addResultGraphicToView(t,e)}changeFlagSymbol(e,t){this._flags.length>0&&this._flags.forEach(i=>{i.type===e&&t&&i.mapGraphic&&(i.mapGraphic.symbol=t)})}checkCanTrace(){const e={status:!0,issues:[]};return this.traces.filter(i=>i.selected).length||(e.status=!1,e.issues.push("noTracesSelected")),this._flags.some(i=>i.type==="starting-point")||(e.status=!1,e.issues.push("noStartingPoints")),this._flags.filter(i=>i.allTerminals!==null).some(i=>!i.selectedTerminals.length)&&(e.status=!1,e.issues.push("noTerminalSelected")),e}checkSelectionExist(){return this._highlightHandler.some(e=>e)}clearResult(e){if(!this.view)return;let t=this.traceResults;if(t.length>0){const i=t.filter(s=>s.trace.globalId===e.globalId);i.length>0&&(this.removeResultGraphicFromView(i[0]),this.removeResultAreaFromMap(i[0])),t=t.filter(s=>s.trace.globalId!==e.globalId)}this.traceResults=t,t.length===0?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,e)}createResultAreaGeometries(e,t,i){if(!this.view||!this.resultAreaProperties)return;let s;if(s=this.resultAreaProperties?.type==="convexhull"?t.length===1&&(Ve(t[0])||We(t[0])&&t[0].points.length===1)?this._resultAreaHandler?.createBuffer(t,i,e.resultArea?.unit,!0):this._resultAreaHandler?.createConvexHull(t,e.resultArea?.distance,e.resultArea?.unit):this._resultAreaHandler?.createBuffer(t,i,e.resultArea?.unit,!0),!s)return;if(Array.isArray(s)){for(const a of s){const l=this.getResultAreaAttributes(e,a),d=this._resultAreaHandler?.createResultAreaGraphic(a,l,e.resultArea?.areaUnit,this.messages,this.messagesUnits,e.resultArea?.color);if(d)return d}return}const r=this.getResultAreaAttributes(e,s);return this._resultAreaHandler?.createResultAreaGraphic(s,r,e.resultArea?.areaUnit,this.messages,this.messagesUnits,e.resultArea?.color)}async createResultAreaGraphic(e){if(e.results){const t=await this._createResultAreaInputGeometry(e.results);if(t.length>0){const i=Array(t.length).fill(e.resultArea?.distance),s=this.createResultAreaGeometries(e,t,i);return this.emit("create-result-area",{graphic:s}),s}}}executeTrace(e,t,i){const s=this._processFlags(i.traceLocations);return i.traceLocations=s,wt(t,i,{timeout:this._traceTimeout}).then(r=>({trace:e,results:r,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date})).catch(r=>({trace:e,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:r.message,date:new Date}))}async getNonspatialTraceLocationInitialFeature(){return new Promise((e,t)=>{this._clickHandler?.remove(),this._clickHandler=this._sketchViewModel.on("create",async i=>{if(i.state!=="complete")return;const s=this._getGraphicLayer($);s&&i.graphic&&s.remove(i.graphic);const r=this.view?.toScreen(i.graphic?.geometry);if(!r)return;const a=await this.view?.hitTest(r);if(a?.results.length){const l=a.results.find(d=>d.type==="graphic"&&this.utilityNetwork?.isUtilityLayer(d.layer));l?e(l):t(null)}}),this._sketchViewModel.create("point")})}getResultAreaAttributes(e,t){const{messages:i}=this,s=[],r=[];this._flags.forEach(l=>{const d=l.displayValue?.field+":"+l.displayValue?.value+";"+i.attributeStrings.globalid+":"+l.globalId+";"+i.attributeStrings.terminalid+":"+l.terminalId+";"+i.attributeStrings.x+":"+l.mapPoint?.x+";"+i.attributeStrings.y+":"+l.mapPoint?.y;l.type==="starting-point"?s.push(d):r.push(d)});const a=this.utilityNetwork?.gdbVersion;return{traceId:e.trace.globalId,traceName:e.trace.title,traceDescription:e.trace.description??"",startingPoints:s.toString(),barriers:r.toString(),version:a??void 0,username:Ue.credentials[0].userId,date:e.date,elementCount:e.results?.elements.length,functionResult:JSON.stringify(e.results?.globalFunctionResults),areaStatistic:t?this._geometryHandler.calculateArea(t,e.resultArea?.areaUnit):0}}getValidSources(){let e=[];const t=this.utilityNetwork?.dataElement?.domainNetworks??[];for(const i of t)e=e.concat(i.junctionSources),e=e.concat(i.edgeSources);return e}groupResultsByNetworkSource(e){return e.length===0?[]:this._groupBy(e,"networkSourceId")}async loadUtilityNetwork(){const{view:e}=this;if(!e)return null;if(await e.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof _t){try{await e.map.loadAll()}catch(s){if(s.name!=="layer:unsupported-layer-type"&&s.name!=="subtype-grouplayer:missing-subtypes")throw s;console.error(s)}finally{this._loadUNSupportItems()}return this.utilityNetwork}return null}const t=e.map,i=t.utilityNetworks?.at(0);if(i){if(await i.load(),this.utilityNetwork=i,!await Wt(i))throw new ne("utility-network:no-user-type-extension","User type extension not found");try{await t.loadAll()}catch(s){if(s.name!=="layer:unsupported-layer-type"&&s.name!=="subtype-grouplayer:missing-subtypes")throw s;console.error(s)}finally{this._loadUNSupportItems()}return i}return null}manageFilterBarrier(e,t){const i=[...this._flags];i.forEach(s=>{s.globalId===t.globalId&&t.type==="barrier"&&s.id===t.id&&(s.isFilterBarrier=e)}),this._flags=i}mergeSelection(e,t){let i=[];const s=[...this.traceResults],r=t.globalId;s.forEach(a=>{r===a.trace.globalId&&(a.selectionEnabled=e),a.selectionEnabled&&a.results?.elements!==null&&(i=[...i,...a.results?.elements??[]])}),this.selectResults([...new Set(i)])}async queryFeaturesById(e){const{view:t}=this;if(!t||!this.utilityNetwork)return null;const i=this.utilityNetwork.getObjectIdsFromElements(e),s={layerUrl:i[0].layerUrl,objectIds:i[0].objectIds,outFields:["*"]},r=t.map?.allTables.toArray().filter(l=>l?.parsedUrl?.path===i[0].layerUrl).filter(H)??[];this._getUniqueMapLayerViews(t).filter(({layer:l})=>l?.parsedUrl?.path===i[0].layerUrl).forEach(({layer:l})=>{l.type!=="feature"&&l.type!=="subtype-group"||r.push(l)});const a=(await Promise.all(r.map(async l=>{const d={layers:new oe([l]),layerInfos:[s],returnGeometry:!0,outSpatialReference:t.spatialReference},[u]=await ft(d);return u}))).filter(({featureSet:l})=>l.features.length>0);return a.length>0?a:null}queryFlagByHitTest(e,t,i){return this._lookupFlagByHit(e).then(s=>{const{view:r}=this;if(!r)return!1;if(s.length>0){const a=[...this._flags],l=i;return s.forEach(d=>{const u=d.graphic,m=u.attributes.hasOwnProperty("GLOBALID")?u.attributes.GLOBALID:u.attributes.globalid;if(a.filter(g=>g.globalId===m).length<=0){const g=this.graphicHandler.getFlagGraphic(u.attributes.mapPoint,t,u,l);this._getGraphicLayer(G)?.add(g);const A=this._createFlagProperty(u,t,g);a.push(A)}else if(u.attributes.percentAlong!==null){const g=this.graphicHandler.getFlagGraphic(u.attributes.mapPoint,t,u,l);this._getGraphicLayer(G)?.add(g);const A=this._createFlagProperty(u,t,g);a.push(A)}}),this._flags=a,!0}return!1})}removeResultGraphicFromView(e){const{view:t}=this;if(!t)return;const i=this._getGraphicLayer(B)?.graphics;e.graphicEnabled=!1,i?.filter(r=>r.attributes[r.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===e.trace.globalId)?.forEach(r=>{this._getGraphicLayer(B)?.remove(r)})}removeFlag(e){const t=this._flags.filter(i=>{if(i.id!==e.id)return i});this._removeGraphic(e),this._flags=t}removeAllResultAreaGraphics(){this._resultAreaHandler?.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(e){if(e.resultArea){e.resultArea.show=!1;const t=this._resultAreaHandler?.removeResultArea(e.trace.globalId,this.view?.map);t&&this.emit("remove-result-area",{graphic:t})}}removeSelection(){this._highlightHandler.forEach(e=>{e&&e.remove()}),this._highlightHandler=[]}removeTerminal(e,t){const i=[...this._flags];i.forEach(s=>{if(s.globalId===t.globalId&&t.selectedTerminals?.includes(parseInt(e,10))){const r=t.selectedTerminals.indexOf(parseInt(e,10));s.selectedTerminals?.splice(r,1)}}),this._flags=i}removeFlagsOnLoadWatcher(){this._watchHandler&&this._watchHandler!==null&&this._watchHandler.remove()}removeClickHandler(){this._clickHandler&&(this._sketchViewModel.cancel(),this._clickHandler.remove())}reset(){this._flags=[],this.traceResults=[];const e=[...this.traces];e.forEach(t=>{t.selected=!1}),this.traces=e,this.view&&(this._getGraphicLayer($)?.removeAll(),this._getGraphicLayer(G)?.removeAll(),this._getGraphicLayer(B)?.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}),this.emit("reset"))}selectFeaturesById(e){const{view:t}=this;if(!t||!this.utilityNetwork)return;const i=this.utilityNetwork.getObjectIdsFromElements(e);this._getUniqueMapLayerViews(t).forEach(s=>{Ht(s)&&s.layer?.parsedUrl?.path===i[0].layerUrl&&Dt(s)&&this._highlightHandler.push(s.highlight(i[0].objectIds))})}selectResults(e){if(e.length>0){this.removeSelection();const t=this.groupResultsByNetworkSource(e),i=[];for(const s in t)this.selectFeaturesById(t[s]),i.push(this.queryFeaturesById(t[s]));Promise.all(i).then(s=>{this.emit("select-features",{resultSet:s})})}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(e,t){const i=[...this.traces];i.forEach(s=>{t===s.globalId&&(s.selected=e)}),this.traces=i}selectTracesOnLoad(){this.utilityNetwork?.hasOwnProperty("sharedNamedTraceConfigurations")&&(this.traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this.traces.forEach(e=>{e.selected=!1,this.selectedTraces.includes(e.globalId)&&(e.selected=!0)}))}zoomToAsset(e){this.view?.goTo(e).catch(t=>console.error(t))}async _createResultAreaInputGeometry(e){if(e.aggregatedGeometry!=null)return this._geometryHandler.mergeAggregatedToGeometries(e.aggregatedGeometry);const t=this.groupResultsByNetworkSource(e.elements),i=[];for(const s in t)i.push(this.queryFeaturesById(t[s]));try{const s=await Promise.all(i),r=[];for(const a of s)if(a)for(const l of a)for(const d of l.featureSet.features)d.geometry&&r.push(d.geometry);return r}catch{return[]}}_loadUNSupportItems(){if(!this.utilityNetwork)return;const{map:e}=this.view,{messages:t}=this;this._populateOutfields(),this._createGraphicLayer($),this._createGraphicLayer(G),this._createGraphicLayer(B),this._resultAreaHandler?.createGraphicLayer(e,t?.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(e,this.utilityNetwork),this._sketchViewModel=this.graphicHandler.initializeSketch(this.view,this._getGraphicLayer($),this._validUNLayers)}_getUniqueMapLayerViews(e){const t=[],i=e.layerViews.filter(({layer:{type:r}})=>r==="feature"||r==="group"||r==="subtype-group").toArray(),s=r=>{for(const a of r.layerViews)_e(a)?s(a):t.push(a)};return i.forEach(r=>{switch(r.layer.type){case"group":_e(r)&&s(r);break;case"subtype-group":t.push(r);break;default:t.some(a=>a.layer.id===r.layer.id)||t.push(r)}}),t}_processFlags(e){const t=[];return e.forEach(i=>{if(i.selectedTerminals!==null&&i.selectedTerminals.length>0)i.selectedTerminals.forEach(s=>{const r=new J({globalId:i.globalId,percentAlong:i.percentAlong,terminalId:s,type:i.type,isFilterBarrier:i.isFilterBarrier});t.push(r)});else{const s=new J({globalId:i.globalId,percentAlong:i.percentAlong,type:i.type,isFilterBarrier:i.isFilterBarrier});t.push(s)}}),t}_getDisplayField(e){return ee(e?.sourceLayer)?this._getDisplayFieldBySublayer(e):this._getDisplayFieldByFeatureLayer(e)}_getDisplayFieldBySublayer(e){let t="",i="";const s=e.sourceLayer;t=this._checkParentForData(s,"displayField");for(const r in e.attributes){const a=r.toLowerCase();a===t?.toLowerCase()?(i=e.attributes[r],a==="assetgroup"||a==="assettype"?i=this._checkSubtype(s,s.subtypeCode):(i=this._checkDomain(s.fields,r,i),typeof i=="string"&&(i=this._defaultDisplayField(i,s)))):(i=this._checkDomain(s.fields,r,i),typeof i=="string"&&(i=this._defaultDisplayField(i,s)))}return{field:t,value:i?.toString()??s.title}}_getDisplayFieldByFeatureLayer(e){const t=e.sourceLayer;let i=t.displayField,s="";for(const r in e.attributes){const a=r.toLowerCase();if(a===i?.toLowerCase())if(s=e.attributes[r],a==="assetgroup"||a==="assettype"){let l=e.attributes[t.typeIdField.toUpperCase()];l||(l=e.attributes[t.typeIdField.toLowerCase()]),i=t.typeIdField,s=this._checkSubtype(t,l),i===""&&(t.templates&&t.templates.length>0?(i=t.templates[0]?.name,s=t.templates[0]?.name):(i=t.displayField,s=e.attributes[r]))}else s=this._checkDomain(t.fields,r,s),typeof s=="string"&&(s=this._defaultDisplayField(s,t));else s=this._checkDomain(t.fields,r,s),typeof s=="string"&&(s=this._defaultDisplayField(s,t))}return{field:i,value:s?s.toString():""}}_checkSubtype(e,t){let i=t;if(e.type==="subtype-sublayer"){const s=this._checkParentForData(e,"subtypes");s?.length>0&&s.forEach(r=>{r.code===t&&(i=r.name)})}else if(e.types!=null&&e.types.length>0){const s=e.types.filter(r=>r.id===t);s.length>0&&(i=s[0].name)}return i}_checkDomain(e,t,i){let s=i;const r=e.filter(a=>a.name.toLowerCase()===t.toLowerCase());if(r.length>0&&$t(r[0].domain)&&r[0].domain?.codedValues){const a=r[0].domain.codedValues.filter(({code:l})=>l===i);a.length>0&&(s=a[0].name)}return s}_checkParentForData(e,t){return e.parent?.[t]??null}_defaultDisplayField(e,t){return e.trim()?e:t.templates&&t.templates?.length>0?t.templates[0].name:t.title}get _uniqueFlagId(){return this._flagId++}_groupBy(e,t){return e.reduce((i,s)=>((i[s[t]]=i[s[t]]||[]).push(s),i),{})}async _lookupFlagByHit(e){const t=[];let i={};const s=e.graphic?.geometry,r=this.view?.toScreen(s),a=await this.view?.hitTest(r,{include:this._validUNLayers});if(!a?.results.length)return[];const l=a?.results.find(v=>v.layer!==null),d=l,u=d.graphic.geometry?.type,m=l?.layer,g=m.globalIdField??"globalid",A=m.objectIdField??"objectid";if(g&&d.graphic.attributes[g])i=d.graphic.attributes;else{const v=await this.view?.whenLayerView(m),Z=v.createQuery();Z.outFields=["assetgroup","assettype","globalid","objectid"],Z.where=`${A} = ${d.graphic.attributes[A]}`,await je(()=>!v?.updating&&!v?.dataUpdating),i=(await v?.queryFeatures(Z))?.features[0]?.attributes}const F=this._getDisplayField(d.graphic),y=d.mapPoint;let R={};if(u==="point"||u==="polygon"){if(this.utilityNetwork){const v=this.utilityNetwork.getTerminalConfiguration(d.graphic);R={terminalId:v?v.terminals[0].id||null:1,isFilterBarrier:!1,allTerminals:v??null,selectedTerminals:[v?v.terminals[0].id||null:1],percentAlong:null,displayValue:F,mapPoint:y}}}else if(u==="polyline"){const v=d.graphic.geometry;R={terminalId:null,isFilterBarrier:!1,allTerminals:null,selectedTerminals:null,percentAlong:this._geometryHandler.getPercentageAlong(v,e.graphic?.geometry,v.spatialReference),displayValue:F,mapPoint:y}}return d.graphic.attributes={...i,...R},t.push(d),t}_createFlagProperty(e,t,i){const s=new J;s.terminalId=e.attributes.terminalId,s.isFilterBarrier=e.attributes.isFilterBarrier,s.percentAlong=e.attributes.percentAlong,s.globalId=e.attributes.globalid||e.attributes.GLOBALID,s.type=t;const r=s;return r.details=e,r.mapGraphic=i,r.id=this._uniqueFlagId,r.allTerminals=e.attributes.allTerminals,r.selectedTerminals=e.attributes.selectedTerminals,r.displayValue=e.attributes.displayValue,r.mapPoint=e.attributes.mapPoint,r}_populateOutfields(){if(!this.view)return;const{map:e}=this.view,t=this.getValidSources(),i=s=>{s.type==="group"?s.layers.forEach(r=>{fe(r)&&i(r)}):t.some(r=>r.layerId===s.layerId)&&s.fields.some(r=>r.name.toLowerCase()==="assetgroup")&&(s.outFields=["assetgroup","assettype","globalid","objectid"])};for(const s of e.layers)fe(s)&&i(s)}_removeGraphic(e){this._getGraphicLayer(G)?.remove(e.mapGraphic)}_createGraphicLayer(e){const{map:t}=this.view;if(!t.findLayerById(e)){const i=new Fe({id:e,internal:!0,listMode:"hide",title:e});bt(this.view,i)}}_getGraphicLayer(e){const{map:t}=this.view;if(t){const i=t.findLayerById(e);if(i&&Vt(i))return i}return null}};n([c()],w.prototype,"_activeProgress",void 0),n([c()],w.prototype,"_flags",void 0),n([c()],w.prototype,"traces",void 0),n([c()],w.prototype,"defaultGraphicColor",void 0),n([c()],w.prototype,"enableResultArea",void 0),n([c()],w.prototype,"flags",void 0),n([c()],w.prototype,"messages",void 0),n([c()],w.prototype,"messagesUnits",void 0),n([c()],w.prototype,"resultAreaProperties",null),n([c()],w.prototype,"selectedTraces",void 0),n([c()],w.prototype,"selectOnComplete",void 0),n([c()],w.prototype,"showGraphicsOnComplete",void 0),n([c()],w.prototype,"showSelectionAttributes",void 0),n([c({readOnly:!0})],w.prototype,"state",null),n([c()],w.prototype,"traceResults",void 0),n([c()],w.prototype,"utilityNetwork",void 0),n([c({value:null})],w.prototype,"view",null),w=n([z("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],w);const Ie=w,k="esri-utility-network-trace",f={base:k,addButtonContainer:`${k}__add-button-container`,blockContainer:`${k}__block-container`,blockContent:`${k}__block-content`,clearPrompt:`${k}__reset-prompt`,clearResultsBlock:`${k}__clear-results-block`,doublePaddingTop:`${k}__double-pad-top`,flow:`${k}__flow`,listContainer:`${k}__list-container`,noticeContainer:`${k}__notice-container`,numberInput:`${k}__number-input`,promptDivider:`${k}__divider`,tabs:`${k}__tabs`};function Ut(e){return{height:e+"px"}}function jt(e){return{width:e+"px"}}function zt(){return{width:"75%"}}function qt(e){return{width:"100%",height:window.getComputedStyle(e).getPropertyValue("max-height")}}function ye(e){return{display:"flex",flexDirection:e}}function Zt(e){return e instanceof be}const Yt={noExtension:-2147208474},we=Symbol();let h=class extends re{constructor(e,t){super(e,t),this._activeTab="input",this._activeTrace=null,this._activeSwatch="",this._addNonspatialObjectActive=!1,this._alertRemoveModal=!1,this._assetGroupHeader="",this._assetTypeHeader="",this._confirmReset=!1,this._errorMessage="",this._swatchNode=null,this._selectToolActive=!1,this._showFeatureInfoActive=!1,this._traceHeaderForFlow="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._traceResultsState="result",this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._findNonspatialFeatureWidget=new pe({mode:"add-nso"}),this._individualResultNode=null,this._loadUnError=!0,this._resultDisplayField="objectid",this._resultFeatureWidget=new pe({mode:"show-feature-info"}),this._resultObjectIdField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._showResultOptions=!1,this._symbolStartFlag=null,this._symbolBarrier=null,this._traceLocationType="starting-point",this._updatingHandles=new Ye,this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1,this._warningNoTerminal=!1,this._wasPopupEnabled=!1,this._watchHandler=null,this.disabled=!0,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new Ie,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles([b(()=>this.view,()=>this._viewChangeHandle(),Je),b(()=>this.viewModel?.resultAreaProperties,()=>this.scheduleRender()),b(()=>this._addNonspatialObjectActive,e=>{this._findNonspatialFeatureWidget.feature=null,e?this._changeCursor("crosshair"):this.view.popupEnabled=this._wasPopupEnabled}),b(()=>this._showFeatureInfoActive,e=>{e||(this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled)}),W(()=>this._findNonspatialFeatureWidget,"add-nso-trace-location",({featureWidget:e})=>{this.viewModel.addNonspatialTraceLocation(e.graphic,this._traceLocationType),this._warningNoFlag=!1,this._addNonspatialObjectActive=!1}),W(()=>this._findNonspatialFeatureWidget,"close-un-trace-feature-block",()=>{this._changeCursor("default"),this._addNonspatialObjectActive=!1,this.viewModel.cancelAddFlagByHit()}),W(()=>this._resultFeatureWidget,"close-un-trace-feature-block",()=>{this._showFeatureInfoActive=!1}),W(()=>this._resultFeatureWidget,"close",()=>{this._resetResultFeatureWidget()})])}destroy(){this._findNonspatialFeatureWidget?.destroy(),this._resultFeatureWidget?.destroy()}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get icon(){return"utility-network-trace"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get traceResults(){return this.viewModel.traceResults}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1,this._resetResultFeatureWidget();const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._traceResultsState="result",this.switchTab("results"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach(t=>{switch(t){case"noStartingPoints":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}})}confirmReset(){this._confirmReset=!0}render(){return this._mixCustomStrings(),this._overrideFlagSymbol(),o("div",{class:this.classes(f.base,M.widget,M.panel,{[M.widgetDisabled]:this.disabled})},this._renderUtilityNetworkTrace())}loadDependencies(){return ae({action:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MM),__vite__mapDeps([0,1])),"action-group":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MR),__vite__mapDeps([0,1])),"action-pad":()=>p(()=>import("./index-DUm9Q5-H.js"),__vite__mapDeps([6,0,1])),block:()=>p(()=>import("./index-CwsCBFm3.js"),__vite__mapDeps([3,0,1])),"block-section":()=>p(()=>import("./index-COPtOuRR.js"),__vite__mapDeps([7,0,1,8])),button:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MZ),__vite__mapDeps([0,1])),checkbox:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.M$),__vite__mapDeps([0,1])),"color-picker-swatch":()=>p(()=>import("./index-CXTe3vZB.js"),__vite__mapDeps([9,0,1])),combobox:()=>p(()=>import("./index-BOdF8fLv.js"),__vite__mapDeps([10,0,1,11,12,13])),"combobox-item":()=>p(()=>import("./index-D6Hs6QxG.js"),__vite__mapDeps([11,0,1,12,13])),"dropdown-group":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.N6),__vite__mapDeps([0,1])),"dropdown-item":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.N5),__vite__mapDeps([0,1])),fab:()=>p(()=>import("./index-D8LU2ZlT.js"),__vite__mapDeps([14,0,1])),flow:()=>p(()=>import("./index-B0EAL2pn.js"),__vite__mapDeps([4,0,1])),"flow-item":()=>p(()=>import("./index-CccD-otN.js"),__vite__mapDeps([2,0,1])),icon:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MK),__vite__mapDeps([0,1])),"input-number":()=>p(()=>import("./index-3ZhkCLKv.js"),__vite__mapDeps([15,0,1])),label:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.M_),__vite__mapDeps([0,1])),list:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.N3),__vite__mapDeps([0,1])),"list-item":()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.N7),__vite__mapDeps([0,1])),loader:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.ML),__vite__mapDeps([0,1])),notice:()=>p(()=>import("./index-CDlvyoWU.js"),__vite__mapDeps([5,0,1])),option:()=>p(()=>import("./index-Cc9HItg-.js"),__vite__mapDeps([16,0,1])),panel:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MQ),__vite__mapDeps([0,1])),popover:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MN),__vite__mapDeps([0,1])),scrim:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MP),__vite__mapDeps([0,1])),select:()=>p(()=>import("./index-BIJAvlEw.js"),__vite__mapDeps([17,0,1])),"split-button":()=>p(()=>import("./index-DxNcZFhg.js"),__vite__mapDeps([18,0,1])),tab:()=>p(()=>import("./index-BrQW8HOS.js").then(e=>e.MY),__vite__mapDeps([0,1])),"tab-nav":()=>p(()=>import("./geodeticLengthOperator-DifrZujk.js").then(e=>e.a),__vite__mapDeps([19,0,1,20])),"tab-title":()=>p(()=>import("./geodeticLengthOperator-DifrZujk.js").then(e=>e.b),__vite__mapDeps([19,0,1,20])),tabs:()=>p(()=>import("./geodeticLengthOperator-DifrZujk.js").then(e=>e.i),__vite__mapDeps([19,0,1,20]))})}switchTab(e){this._activeTab=e}switchToFromAssetGroup(e,t,i){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._traceResultsState=i}switchToFromAssetType(e,t,i){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._traceResultsState=i}switchToFromFunctions(e,t){this._traceResultsFunctions=e,this._traceResultsState=t}switchToFromIndividualRecords(e,t,i){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._traceResultsState=i}_renderAddNonspatialLocationBlock(){const{messages:e}=this;return o("calcite-block",{expanded:!0,key:`${this.id}__add-spatial-location-block`,label:e.inputsStrings.addNonspatialOption},this._findNonspatialFeatureWidget.render())}_renderAddSpatialLocationBlock(){const{messages:e,messagesCommon:t}=this;return o("calcite-block",{class:f.blockContent,expanded:!0,heading:this._traceLocationType==="starting-point"?e.inputsStrings.headerStartingPoint:e.inputsStrings.headerBarrier,key:`${this.id}__add-nonspatial-location-block`,label:this._traceLocationType==="starting-point"?e.inputsStrings.headerStartingPoint:e.inputsStrings.headerBarrier},o("calcite-action",{icon:"x",onclick:()=>{this.viewModel.removeClickHandler(),this.view?.popup&&(this.view.popupEnabled=this._wasPopupEnabled),this._changeCursor("default"),this._selectToolActive=!1},slot:"control",text:t.close}),o("calcite-notice",{icon:this._traceLocationType==="starting-point"?"pin-plus":"x-circle-f",kind:"info",open:!0},o("div",{slot:"message"},e.inputsStrings.addPointHint)))}_renderClearTraceResultsBlock(){const{messages:e,messagesCommon:t}=this;return o("calcite-scrim",{key:`${this.id}__clear-results-block`},o("calcite-block",{class:f.clearResultsBlock,expanded:!0},o("h3",null,e.resultsStrings.startOverButton),o("div",null,e.resultsStrings.startOverValidation),o("div",{class:f.promptDivider}),o("div",{styles:ye("row")},o("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),o("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok))))}_renderExecutingTraceBlock(){const{messages:e}=this;return o("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"})}_renderInputBlock(){const{messages:e}=this;return o("calcite-block",{class:f.blockContainer,expanded:!0,key:`${this.id}__inputs-block`,label:e.inputsStrings.headerTabInputs},o("calcite-flow",{class:f.flow},o("calcite-flow-item",{key:`${this.id}__inputs-flow-item`,selected:!this._selectToolActive&&!this._addNonspatialObjectActive},this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?o("div",{styles:Ut(10)}):null,o("calcite-fab",{appearance:"solid",icon:"utility-network-trace",kind:"brand",onclick:()=>{this.checkCanTrace()},slot:"fab",text:e.tracingStrings.runTrace,textEnabled:!0,title:e.tracingStrings.runTrace,type:"button"}))))}_renderInputsTab(){const{messagesCommon:e}=this;let t="input";return this._selectToolActive&&!this._addNonspatialObjectActive&&(t="add-spatial-location"),!this._selectToolActive&&this._addNonspatialObjectActive&&(t="add-nso-location"),this.disabled&&(t="loading"),o("calcite-tab",{key:`${this.id}__inputs-tab-item`,selected:this._activeTab==="input"},t==="loading"?o("calcite-loader",{label:e.loading,type:"indeterminate"}):null,t==="input"?this._renderInputBlock():null,t==="add-spatial-location"?this._renderAddSpatialLocationBlock():null,t==="add-nso-location"?this._renderAddNonspatialLocationBlock():null)}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter(r=>r.type==="barrier"),i.forEach(r=>{r.displayValue&&t.push(this._renderFlagRow(r,"barrier"))});let s=null;return this._symbolBarrier&&(s=this._getSymbolIcon(this._symbolBarrier)),o("calcite-block",{class:f.blockContent,collapsible:!0,expanded:!0,heading:e.inputsStrings.headerBarrier+" ("+i.length+")",overlayPositioning:"fixed"},o("div",{slot:"icon"},s||o("calcite-icon",{icon:"x-circle-f",scale:"s"})),o("div",null,e.inputsStrings.barrierPointHint),o("div",{class:f.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,this._warningNoBarrierAssetNsoFound?this._renderWarningMessage("noBarrierAssetNso",!0):null,o("div",{class:f.addButtonContainer},o("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:e.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("barrier")}},o("calcite-dropdown-group",{selectionMode:"none"},o("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("barrier")}},e.inputsStrings.addNonspatialOption)))))}_renderFlagRow(e,t){const{messages:i,messagesCommon:s}=this,r=[];let a=!1;return e.allTerminals!=null&&e.allTerminals.terminals.length>0&&(a=!0,e.allTerminals.terminals.forEach(l=>{let d=!1;e?.selectedTerminals?.includes(l.id)&&(d=!0),r.push(o("calcite-combobox-item",{key:l.name,selected:d,textLabel:l.name,value:l.id}))})),o("calcite-block",{collapsible:e.allTerminals!==null||e.type==="barrier",heading:e.displayValue?.value??"",key:"pop"+e.globalId+e.type+e.id+t,overlayPositioning:"fixed"},o("calcite-action",{icon:"trash",label:s.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:s.remove,textEnabled:!0}),e.mapGraphic&&e.mapPoint?o("calcite-action",{icon:"zoom-to-object",label:i.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:i.globalStrings.zoomToFeature,textEnabled:!0}):null,e.type==="barrier"?o("calcite-label",{layout:"inline",scale:"s"},o("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),i.inputsStrings.barrierFilter):null,a?o("calcite-combobox",{label:i.globalStrings.selectTerminalPlaceholder,maxItems:0,overlayPositioning:"fixed",placeholder:i.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:l=>{l.currentTarget.selectedItems.length>0?(e.selectedTerminals=[],l.currentTarget.selectedItems.forEach(d=>{this.viewModel.addTerminal(d.value,e)})):e.selectedTerminals=[]},onCalciteComboboxChipClose:l=>{l.preventDefault(),this.viewModel.removeTerminal(l.currentTarget.value,e)}},r):null)}_renderHighlightColorPicker(e,t,i){const{messages:s}=this,{graphicHandler:r}=this.viewModel,a=[],l=new RegExp(`^${e.hex}$`,"i"),d=r.highlightColor.length>ie.length?5:4;for(const u of r.highlightColor)a.push(o("calcite-action",{active:l.test(u.hex),key:u.hex,label:s.resultsStrings.graphicColor,onclick:()=>{i==="aggregate"?this.viewModel.changeResultGraphicColor(u,t):this.viewModel.changeResultAreaColor(t,u)},scale:"s",text:s.resultsStrings.graphicColor},o("calcite-color-picker-swatch",{active:l.test(u.hex),color:u.hex,scale:"s"})));return o("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},o("calcite-action-group",{columns:d},a))}_renderRemoveTraceContainer(e){const{messages:t}=this;return o("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderResultsTab(){let e="results";return this._showFeatureInfoActive&&(e="show-feature-info"),this.viewModel._activeProgress&&(e="executing"),this._confirmReset&&(e="clear-trace-results"),o("calcite-tab",{key:`${this.id}__results-tab-item`},e==="executing"?this._renderExecutingTraceBlock():null,e==="results"?this.viewModel.traceResults.length?this._renderResultsPanel():this._renderWarningMessage("noTraceExecuted",!1):null,e==="show-feature-info"?this._renderShowFeatureInfoBlock():null,e==="clear-trace-results"?this._renderClearTraceResultsBlock():null)}_renderResultsPanel(){const{messages:e}=this;return o("calcite-block",{class:f.blockContainer,expanded:!0,key:`${this.id}__results-block`,label:e.resultsStrings.headerTabResults},o("calcite-flow",{class:f.flow},this._renderTraceResults(),this._renderTraceResultFunctions(),this._renderTraceResultByAssetGroup(),this._renderTraceResultByAssetType(),this._renderTraceResultIndividual()))}_renderResultRowFunctions(e){return o("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return o("calcite-list-item",{key:`${t}-${e.assetGroupCode}`,label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")","assetType")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return o("calcite-list-item",{key:`${t}-${e.assetTypeCode}`,label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this._updatingHandles.addPromise(this.viewModel.queryFeaturesById(e).then(i=>{if(i?.length){this._resultObjectIdField=i[0].layer.objectIdField,this._resultDisplayField==="objectid"&&(this._resultDisplayField=i[0].layer.objectIdField),this._resultSortField==="objectid"&&(this._resultSortField=i[0].layer.objectIdField);const s=this._appendAttributes(e,i,"objectId");this.switchToFromIndividualRecords(s,t+" ("+e.length+")","records")}else this.switchToFromIndividualRecords(e,t+" ("+e.length+")","records")}))}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){const{messages:t}=this;let i,s=null;return s=e?.details?.fields.find(({name:r})=>r===this._resultDisplayField),s?.type==="date"?i=new Date(e.details.attributes[this._resultDisplayField]).toDateString():this._resultDisplayField.toLowerCase()==="assetgroup"?i=this._getAssetGroupName(e):this._resultDisplayField.toLowerCase()==="assettype"?i=this._getAssetTypeName(e):s?.domain&&Zt(s.domain)?i=s.domain.codedValues.find(({code:a})=>a===e.details.attributes[this._resultDisplayField])?.name:i=e.details?.attributes[this._resultDisplayField]??e.objectId,i&&i!==""&&i!==null?typeof i=="string"&&(i.trim()||(i=t.resultsStrings.noValue)):i=t.resultsStrings.noValue,o("calcite-list-item",{key:e.details.uid,label:i,onCalciteListItemSelect:async()=>{this._disablePopup(),this._showFeatureInfoActive=!0;const r=Qe(e.details?.layer)?e.details?.layer:null;if(r){const a=Object.keys(e.details.attributes).find(g=>g.toLowerCase()===r.subtypeField.toLowerCase())??"assetgroup",l=r.sublayers.find(g=>g.subtypeCode===e.details.attributes[a]),d=Object.keys(e.details.attributes).find(g=>g.toLowerCase()===r.objectIdField.toLowerCase())??"objectid",u=new Ke;u.outFields=["*"],u.returnGeometry=!0,u.where=d+" = "+e.details.attributes[d];const m=await l?.queryFeatures(u);m&&this._resultFeatureWidget.open(m.features[0])}else this._resultFeatureWidget.open(e.details)}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderShowFeatureInfoBlock(){const{messages:e}=this;return o("calcite-block",{class:f.blockContainer,expanded:!0,key:`${this.id}__show-feature-info-block`,label:e.resultsStrings.headerFeatureInfo},this._resultFeatureWidget.render())}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter(r=>r.type==="starting-point"),i.forEach(r=>{r.displayValue&&t.push(this._renderFlagRow(r,"start"))});let s=null;return this._symbolStartFlag&&(s=this._getSymbolIcon(this._symbolStartFlag)),o("calcite-block",{class:f.blockContent,collapsible:!0,expanded:!0,heading:e.inputsStrings.headerStartingPoint+" ("+i.length+")",overlayPositioning:"fixed"},o("div",{slot:"icon"},s||o("calcite-icon",{icon:"pin",scale:"s"})),o("div",null,e.inputsStrings.startingPointHint),o("div",{class:f.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,this._warningNoStartAssetNsoFound?this._renderWarningMessage("noStartAssetNso",!0):null,o("div",{class:f.addButtonContainer},o("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:e.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("starting-point")}},o("calcite-dropdown-group",{selectionMode:"none"},o("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("starting-point")}},e.inputsStrings.addNonspatialOption)))))}_renderStartOverContainer(){const{messages:e}=this;return o("calcite-fab",{appearance:"solid",icon:"trash",kind:"brand",onclick:()=>{this.confirmReset()},slot:"fab",text:e.resultsStrings.startOverButton,textEnabled:!0,title:e.resultsStrings.startOverButton,type:"button"})}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const i in e){const s=e[i];for(const r in s)t.push(this._renderResultRowAssetGroup(s[r]))}return o("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",selected:this._traceResultsState==="assetGroup",onCalciteFlowItemBack:()=>{this.switchToFromAssetGroup([],"","result")}},o("calcite-list",{label:""},t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const i in e)e[i].length>0&&t.push(this._renderResultRowAssetType(e[i]));return o("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",loading:this._updatingHandles.updating,selected:this._traceResultsState==="assetType",onCalciteFlowItemBack:()=>{this.switchToFromAssetType([],"","assetGroup")}},o("calcite-list",{label:"",selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultFunctions(){if(this._traceResultsState!=="functions")return null;const{messages:e}=this,t=this._traceResultsFunctions,i=[];return t.forEach(s=>{i.push(this._renderResultRowFunctions(s))}),o("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",selected:this._traceResultsState==="functions",onCalciteFlowItemBack:()=>{this.switchToFromFunctions([],"result")}},i,this._renderStartOverContainer())}_renderTraceResultIndividual(){const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const i=[];return t.length>0&&((t[0].details?.fields.some(({name:s})=>s.toLowerCase()===this._resultDisplayField.toLocaleLowerCase())??!1)||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach(s=>{s?.details&&i.push(this._renderResultRowIndividual(s))}),i.length===0&&i.push(o("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap}))),o("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",selected:this._traceResultsState==="records",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToFromIndividualRecords([],"","assetType")}},o("calcite-action",{afterCreate:Xe,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),this._renderTraceResultIndividualPopover(),o("calcite-list",{label:"",selectionMode:"none"},i),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,i=[],s=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach(({name:r,alias:a})=>{i.push(o("calcite-option",{key:`display-${r}`,label:a??r,selected:r===this._resultDisplayField,value:r})),s.push(o("calcite-option",{key:`sort-${r}`,label:a??r,selected:r===this._resultSortField,value:r}))}):(i.push(o("calcite-option",{key:`display-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})),s.push(o("calcite-option",{key:`sort-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})))),o("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:this.domNode!==null?jt(.75*this.domNode.clientWidth):zt()},o("calcite-block",{expanded:!0,label:e.resultsStrings.displayAttribute,overlayPositioning:"fixed"},o("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,o("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:r=>{const a=r.currentTarget;this._resultDisplayField=a.selectedOption.value,this._showResultOptions=!1}},i)),o("calcite-label",{scale:"s"},e.resultsStrings.sortBy,o("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:r=>{const a=r.currentTarget;this._resultSortField=a.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},s))))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:i}=e.resultsStrings,s=this.viewModel.traceResults,r=[];return s.forEach((a,l)=>{let d=[],u=[],m=!1,g=!1,A=!1,F="";a.results!==null&&a.results.hasOwnProperty("elements")?(a.results.aggregatedGeometry!==null&&(g=!0),a.results.globalFunctionResults!==null&&a.results.globalFunctionResults.length>0&&(u=a.results.globalFunctionResults,u.length>0&&(A=!0)),a.results.elements&&a.results.elements.length>0&&(d=a.results.elements,d.length>0&&(m=!0)),(g||m)&&(F=this.messagesUnits.units[a.resultArea?.unit]?.abbr),r.push(o("calcite-block",{class:f.blockContent,collapsible:!0,description:a.trace.description??"",expanded:!0,heading:a.trace.title,key:`${a.trace.title}${l}`,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(a),o("calcite-list",{label:""},A?o("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+u.length+")",onCalciteListItemSelect:()=>{this.switchToFromFunctions(u,"functions")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,m&&this.viewModel.showSelectionAttributes?o("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+d.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetGroup(this._groupResultsByAssetGroup(a),a.trace.title+" ("+d.length+")","assetGroup")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?o("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),m?o("div",{class:f.doublePaddingTop},o("calcite-label",{layout:"inline",onclick:y=>{y.preventDefault(),y.stopPropagation(),this.viewModel.mergeSelection(!a.selectionEnabled,a.trace)},scale:"s"},o("calcite-checkbox",{checked:a.selectionEnabled,onclick:y=>{y.preventDefault(),y.stopPropagation(),this.viewModel.mergeSelection(!a.selectionEnabled,a.trace)}}),this.viewModel.showSelectionAttributes?i:`${i} (${d.length})`)):null,g?o("calcite-block-section",{expanded:a.graphicEnabled,key:`aggregate-${a.trace.title}-${l}`,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:y=>{y.currentTarget.expanded?this.viewModel.changeResultGraphicColor(a.graphicColor,a):this.viewModel.removeResultGraphicFromView(a)}},o("calcite-list",{label:e.resultsStrings.graphicColor,selectionMode:"none"},o("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:y=>{this._swatchNode=y.currentTarget,this._activeSwatch="aggGeom_"+l}},o("calcite-color-picker-swatch",{color:a.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(g||m)?o("calcite-block-section",{expanded:a.resultArea?.show,key:`area-${a.trace.title}-${l}`,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:y=>{y.currentTarget.expanded?a.resultAreaGraphic?this.viewModel.addResultAreaToMap(a,a.resultAreaGraphic):this.viewModel.addResultAreaToMap(a):this.viewModel.removeResultAreaFromMap(a)}},o("calcite-list",{label:"",selectionMode:"none"},o("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:y=>{const R=y.currentTarget;this._swatchNode=R,this._activeSwatch="resultArea_"+l}},o("calcite-color-picker-swatch",{color:a.resultArea?.color.hex,scale:"s",slot:"actions-end"}))),o("calcite-list",{label:"",selectionMode:"none"},o("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},o("calcite-input-number",{afterCreate:this._afterComponentCreate,class:f.numberInput,max:999999,min:0,scale:"s",slot:"actions-end",suffixText:F,value:a.resultArea?.distance.toString(),onCalciteInputNumberChange:y=>{if(!this.view?.popup)return;this.view.popup.visible&&this.view.closePopup();const R=y.currentTarget;a.resultArea.distance>=0?(a.resultArea.distance=parseInt(R.value,10),this.viewModel.removeResultAreaFromMap(a),this.viewModel.addResultAreaToMap(a)):(a.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(a),this.viewModel.addResultAreaToMap(a))}})))):null,o("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+l||this._activeSwatch==="resultArea_"+l,overlayPositioning:"fixed",placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+l?a.resultArea?.color:a.graphicColor,a,this._activeSwatch==="resultArea_"+l?"resultArea":"aggregate"))))):r.push(o("calcite-block",{collapsible:!1,expanded:!0,heading:a.trace.title,key:"error-"+l,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(a),this._renderWarningMessage("noController",!1,a.status)))}),o("calcite-flow-item",{key:"traceResults",selected:this._traceResultsState==="result"},r,this._renderStartOverContainer(),this._alertRemoveModal?o("calcite-scrim",{key:"prompt"},o("div",{class:f.clearPrompt},o("h3",{slot:"header"},e.globalStrings.clearResults),o("div",{slot:"content"},e.alertsStrings.clearResultsAlert),o("div",{class:f.promptDivider}),o("div",{styles:ye("row")},o("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),o("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,this.viewModel.traceResults.length===0?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._traceResultsState="result")},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceSelectorContainer(){const{messages:e}=this,t=this.viewModel.traces.map(r=>this._renderComboboxItem({value:r.globalId,text:r.title,selected:r.selected??!1})),i=this.viewModel.traces.filter(r=>r.selected),s=e.tracingStrings.traceOperation+` (${i.length})`;return o("calcite-block",{class:f.blockContent,collapsible:!0,expanded:!0,heading:s,overlayPositioning:"fixed"},o("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),o("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:r=>{this.viewModel.traces.forEach(a=>{a.selected=r.currentTarget.selectedItems.some(l=>l.value===a.globalId)}),r.currentTarget.selectedItems.length&&(this._warningNoTraceSelected=!1)}},t))}_renderUtilityNetworkTrace(){const{viewModel:e,viewModel:{utilityNetwork:t}}=this,i=e.view?.map,{messages:s}=this;let r=o("calcite-tabs",{class:f.tabs,layout:"center",position:"top",styles:qt(this.container)},o("calcite-tab-nav",{slot:"title-group"},o("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:this._activeTab==="input"},s.inputsStrings.headerTabInputs),o("calcite-tab-title",{onclick:()=>{this.switchTab("results")},selected:this._activeTab==="results"},s.resultsStrings.headerTabResults)),this._renderInputsTab(),this._renderResultsTab());return(!i.utilityNetworks?.length&&!t||t&&!t.sharedNamedTraceConfigurations.length)&&(r=o("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUnError||(r=o("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),r}_renderWarningMessage(e,t,i){const{messages:s}=this;let r=s.alertsStrings.NoRunAlertHeader,a=s.alertsStrings.noResultsInfo;switch(e){case"flag":r=s.alertsStrings.startingPointAlertHeader,a=s.alertsStrings.startingPointAlert;break;case"noTerminal":r=s.alertsStrings.noTerminalDefinedHeader,a=s.alertsStrings.noTerminalDefined;break;case"trace":r=s.alertsStrings.selectTraceAlertHeader,a=s.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":r=s.alertsStrings.NoRunAlertHeader,a=s.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":r=s.alertsStrings.noAssetsFoundHeader,a=s.alertsStrings.noAssetFound;break;case"noBarrierAssetNso":case"noStartAssetNso":r="",a=s.alertsStrings.noAssetFound;break;case"noTraceConfig":r="",a=s.alertsStrings.noTraceSupported;break;default:r=s.alertsStrings.genericErrorHeader,a=i||""}return o("div",{class:f.noticeContainer,key:e},o("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>this._handleWarningNoticeClose(e)},o("div",{slot:"title"},r),o("div",{slot:"message"},a)))}_afterComponentCreate(e){"value"in e&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_appendAttributes(e,t,i){const s=[];return e.forEach(r=>{t.forEach(a=>{a.featureSet.features.forEach(l=>{r[i]===l.attributes[this._resultObjectIdField]&&(r.details=l,r.details.fields=a.featureSet.fields,s.push(r))})})}),s}_changeCursor(e="default"){this.removeHandles(we),this.view&&e!=="default"&&this.addHandles(this.view.acquireCursor(e),we)}_disablePopup(){const{view:e}=this;e.popupEnabled=!1,e.closePopup()}_compare(e,t){return(i,s)=>{let r=0,a=i.details?.attributes[e]??i.objectId,l=s.details?.attributes[e]??s.objectId;return isNaN(a)&&(a=a.toLowerCase()),isNaN(l)&&(l=l.toLowerCase()),t==="desc"?a>l?r=1:a<l&&(r=-1):a<l?r=1:a>l&&(r=-1),r}}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find(r=>r.sourceId===e.networkSourceId);if(s){const r=s.assetGroups.find(a=>a.assetGroupCode===i);r&&(t=r.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find(r=>r.sourceId===e.networkSourceId);if(s){const r=s.assetGroups.find(a=>a.assetGroupCode===i);if(r){const a=r.assetTypes.find(l=>l.assetTypeCode===e.assetTypeCode);a&&(t=a.assetTypeName)}}return t}_getSymbolIcon(e){return e.type==="picture-marker"?o("img",{height:e.height,src:e.url??void 0,width:e.width}):null}_groupBy(e,t){return e.reduce((i,s)=>((i[s[t]]=i[s[t]]||[]).push(s),i),{})}_groupResultsByAssetGroup(e){const t=[],i=e.results?.elements,s=this._groupBy(i??[],"networkSourceId");for(const r in s)t.push(this._groupBy(s[r],"assetGroupCode"));return t}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_handleWarningNoticeClose(e){switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noStartAssetNso":this._warningNoStartAssetNsoFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1;break;case"noBarrierAssetNso":this._warningNoBarrierAssetNsoFound=!1}}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach(t=>{t.type==="starting-point"&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),t.type==="barrier"&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)})}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach(e=>{e.type==="starting-point"?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)})}_processFlagOnLoad(){return this.view?.when().then(()=>{this._watchHandler=et(()=>!this.view?.updating,async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const e=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),e.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),e.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()})})}_registerWatchers(){this.addHandles([b(()=>this.selectedTraces,()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()}),b(()=>this.defaultGraphicColor,()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach(e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)}),this.scheduleRender()})])}_renderComboboxItem({text:e,value:t,selected:i}){return o("calcite-combobox-item",{key:t,selected:i,textLabel:e,value:t})}_resetResultFeatureWidget(){this._showFeatureInfoActive=!1,this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled}_resetTraceLocationWarnings(){this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1}_setupAddNonspatialObject(e){this._disablePopup(),this._traceLocationType=e,this._addNonspatialObjectActive=!0,this._resetTraceLocationWarnings(),this.viewModel.getNonspatialTraceLocationInitialFeature().then(t=>{this._findNonspatialFeatureWidget.feature=null;const i=t.graphic;this._findNonspatialFeatureWidget.open(i)}).catch(()=>{this._warningNoStartAssetNsoFound=e==="starting-point",this._warningNoBarrierAssetNsoFound=e==="barrier",this._addNonspatialObjectActive=!1}).finally(()=>this._changeCursor("default"))}_setupAddTraceLocation(e){this._traceLocationType=e,this._changeCursor("crosshair"),this._selectToolActive=!0,this._addNonspatialObjectActive=!1,this._resetTraceLocationWarnings(),this.viewModel.addFlagByHit(this._traceLocationType,this._symbolStartFlag).then(t=>{this._changeCursor("default"),t?this._warningNoFlag=!1:(this._warningNoStartAssetFound=this._traceLocationType==="starting-point",this._warningNoBarrierAssetFound=this._traceLocationType==="barrier"),this._selectToolActive=!1})}_utilityNetworkTraceInitialized(){this.viewModel.loadUtilityNetwork().then(async e=>{e&&(this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&await this._processFlagOnLoad()),this.disabled=!1}).catch(e=>{const{messages:t}=this;this._loadUnError=!1,e.name==="utility-network:no-user-type-extension"||e.details?.raw?.extendedCode===Yt.noExtension?this._errorMessage=t.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1})}_viewChangeHandle(){this._wasPopupEnabled=this.view?.popupEnabled??!1,this._findNonspatialFeatureWidget.view=this.view,this._resultFeatureWidget.view=this.view}};n([c()],h.prototype,"_activeTab",void 0),n([c()],h.prototype,"_activeTrace",void 0),n([c()],h.prototype,"_activeSwatch",void 0),n([c()],h.prototype,"_addNonspatialObjectActive",void 0),n([c()],h.prototype,"_alertRemoveModal",void 0),n([c()],h.prototype,"_assetGroupHeader",void 0),n([c()],h.prototype,"_assetTypeHeader",void 0),n([c()],h.prototype,"_confirmReset",void 0),n([c()],h.prototype,"_errorMessage",void 0),n([c()],h.prototype,"_swatchNode",void 0),n([c()],h.prototype,"_selectToolActive",void 0),n([c()],h.prototype,"_showFeatureInfoActive",void 0),n([c()],h.prototype,"_traceHeaderForFlow",void 0),n([c()],h.prototype,"_traceResultsFunctions",void 0),n([c()],h.prototype,"_traceResultsAssetGroup",void 0),n([c()],h.prototype,"_traceResultsAssetType",void 0),n([c()],h.prototype,"_traceResultsIndividual",void 0),n([c()],h.prototype,"_traceResultsState",void 0),n([c()],h.prototype,"_warningNoFlag",void 0),n([c()],h.prototype,"_warningNoTraceSelected",void 0),n([c()],h.prototype,"_updatingHandles",void 0),n([c()],h.prototype,"defaultGraphicColor",null),n([c()],h.prototype,"disabled",void 0),n([c()],h.prototype,"enableResultArea",null),n([c()],h.prototype,"flags",null),n([c()],h.prototype,"icon",null),n([c()],h.prototype,"inputSettings",void 0),n([c()],h.prototype,"label",null),n([c(),I("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],h.prototype,"messages",void 0),n([c(),I("esri/t9n/common")],h.prototype,"messagesCommon",void 0),n([c(),I("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0),n([c()],h.prototype,"resultAreaProperties",null),n([c()],h.prototype,"selectedTraces",null),n([c()],h.prototype,"selectOnComplete",null),n([c()],h.prototype,"showGraphicsOnComplete",null),n([c()],h.prototype,"showSelectionAttributes",null),n([c({readOnly:!0})],h.prototype,"traceResults",null),n([c()],h.prototype,"utilityNetwork",null),n([c()],h.prototype,"view",null),n([Ae(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area","reset"]),c({type:Ie})],h.prototype,"viewModel",void 0),h=n([z("esri.widgets.UtilityNetworkTrace")],h);const Jt=h;const Qt=rt`@keyframes esri-basemap-slide{0%{opacity:0;margin-top:0;margin-left:0}75%{opacity:0;margin-top:0;margin-left:0}to{opacity:1;margin-top:5px;margin-left:5px}}@keyframes esri-docking-animation{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes popup-intro-animation-down{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes popup-intro-animation-up{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@supports (-ms-ime-align: auto){.esri-slider__anchor:focus{outline:1px dotted #000}}@keyframes esri-spinner--start-animation{0%{opacity:0;transform:scale(0)}to{opacity:1;transform:scale(1)}}@keyframes esri-spinner--finish-animation{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(0)}}@keyframes esri-spinner--rotate-animation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (prefers-reduced-motion){.esri-utility-network-trace__reset-prompt{animation:none!important}}@media (prefers-reduced-motion){.esri-popup--aligned-top-center,.esri-popup--aligned-top-left,.esri-popup--aligned-top-right,.esri-popup--aligned-bottom-center,.esri-popup--aligned-bottom-left,.esri-popup--aligned-bottom-right,.esri-popup--is-docked{animation:none!important}}@media (prefers-reduced-motion: reduce){.esri-fov-overlay{animation:none!important}}@keyframes esri-fade-in-down{0%{opacity:0;transform:translateY(-5px)}25%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in-up{0%{opacity:0;transform:translateY(5px)}25%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translate(0)}}@keyframes esri-fade-in{0%{opacity:0}25%{opacity:0}to{opacity:1}}@keyframes esri-fade-in-scale{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes looping-progresss-bar-ani{0%{width:0;left:0}20%{width:20%;left:0}80%{width:20%;left:80%}to{width:0;left:100%}}@keyframes esri-rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes panel-advance{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-advance--rtl{0%{opacity:0;transform:translate(-50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}@keyframes panel-retreat--rtl{0%{opacity:0;transform:translate(50px) scale(.99)}to{opacity:1;transform:translate(0) scale(1)}}.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}:host{min-width:300px}.esri-utility-network-trace{flex:auto;width:300px}.esri-utility-network-trace calcite-icon{box-sizing:initial}.esri-utility-network-trace calcite-tab{background-color:var(--calcite-color-foreground-2);padding-top:0;padding-bottom:0}.esri-utility-network-trace calcite-tab:not([selected]){flex:0}.esri-utility-network-trace.esri-component.esri-widget--panel{min-height:120px;width:300px}.esri-utility-network-trace__add-button-container{justify-content:center;margin:18px 0 var(--calcite-spacing-md);display:grid}.esri-utility-network-trace__block-container{margin-top:0;height:95%}.esri-utility-network-trace__block-content{border-bottom:none;margin:0}.esri-utility-network-trace__clear-results-block{position:absolute;bottom:0;left:0;margin:0;border-top:3px solid #6e6e6e26;background-color:#f3f3f3}.esri-utility-network-trace__divider{color:inherit;border-color:var(--calcite-color-border-input);border-bottom-style:solid;border-bottom-width:1px;flex:none;margin:0 0 var(--calcite-spacing-md)}.esri-utility-network-trace__double-pad-top{padding-top:10px}.esri-utility-network-trace__feature-content{height:300px}.esri-utility-network-trace__flow{height:100%}.esri-utility-network-trace__list-container{background-color:var(--calcite-color-foreground-1);padding:3px}.esri-utility-network-trace__notice-container{padding:var(--calcite-spacing-xs)}.esri-utility-network-trace__number-input{width:150px}.esri-utility-network-trace__pad-bottom{padding-bottom:5px}.esri-utility-network-trace__pad-top{padding-top:5px}.esri-utility-network-trace__reset-prompt{background-color:var(--calcite-color-background);color:var(--calcite-color-text-2);border-top:3px solid var(--calcite-color-border-input);flex-flow:column;max-height:85%;padding:var(--calcite-spacing-md) 15px;animation:.1s ease-in-out esri-fade-in-up;display:flex;position:absolute;bottom:0;left:0;right:0;box-shadow:0 1px 2px #0000004d}.esri-utility-network-trace__results-container{height:100%}.esri-utility-network-trace__tabs{min-height:250px;position:relative}`,Kt=xt(Jt),j=class j extends tt{constructor(){super(...arguments),this.widget=Kt(this),this.viewModel=this.widget.viewModel,this.view=this.widget.view,this.autoDestroyDisabled=!1,this.defaultGraphicColor=this.widget.defaultGraphicColor,this.disabled=this.widget.disabled,this.enableResultArea=this.widget.enableResultArea,this.flags=this.widget.flags,this.icon=this.widget.icon,this.inputSettings=this.widget.inputSettings,this.label=this.widget.label,this.resultAreaProperties=this.widget.resultAreaProperties,this.selectOnCompleteDisabled=this.widget.selectOnComplete,this.selectedTraces=this.widget.selectedTraces,this.showGraphicsOnCompleteDisabled=this.widget.showGraphicsOnComplete,this.showSelectionAttributesDisabled=this.widget.showSelectionAttributes,this.state=this.viewModel.state,this.traceResults=this.widget.traceResults,this.arcgisAddFlag=N(()=>this.widget,"add-flag"),this.arcgisAddFlagComplete=N(()=>this.widget,"add-flag-complete"),this.arcgisAddFlagError=N(()=>this.widget,"add-flag-error"),this.arcgisAddResultArea=N(()=>this.widget,"add-result-area"),this.arcgisPropertyChange=it()("state"),this.arcgisReady=st(),this.arcgisRemoveResultArea=N(()=>this.widget,"remove-result-area")}async checkCanTrace(){await this.widget?.checkCanTrace()}async confirmReset(){this.widget?.confirmReset()}async destroy(){await this.manager.destroy()}};j.properties={view:0,autoDestroyDisabled:5,defaultGraphicColor:0,disabled:7,enableResultArea:5,flags:0,icon:1,inputSettings:0,label:1,position:1,referenceElement:1,resultAreaProperties:0,selectOnCompleteDisabled:5,selectedTraces:0,showGraphicsOnCompleteDisabled:5,showSelectionAttributesDisabled:5,state:3,traceResults:32},j.styles=Qt;let se=j;at("arcgis-utility-network-trace",se);export{se as ArcgisUtilityNetworkTrace};
