const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/webglDeps-CYzwT90y.js","assets/index-aRi8Xk-b.js","assets/index-ni9qn0ie.css","assets/ShaderCompiler-G2XYGDs6.js","assets/programUtils-CwiKxPbA.js","assets/ProgramTemplate-Bk_wp2ZV.js","assets/mapViewDeps-DKdpVw2M.js","assets/FeatureCommandQueue-C6Ec3PWP.js","assets/GraphShaderModule-B8YWxOlg.js","assets/UpdateTracking2D-Be5nPTfX.js","assets/utils-BCggJqx3.js","assets/constants-BBnGEY1d.js","assets/heatmapTextureUtils-DQa9l15G.js","assets/WGLContainer-VQ2nIsVJ.js","assets/Utils-BPTYZR54.js","assets/WGLBrushVTLSymbol-D7V9Y8WI.js","assets/Container-C-ZwQjfx.js","assets/earcut-D9gy186-.js","assets/streamLayerUtils-DFlbJ4P1.js","assets/QueueProcessor-BBZoq4x6.js","assets/SDFHelper-640PN5AT.js","assets/TexturedLineMeshWriter-CUS8-bnH.js","assets/TurboLine-BGDqjgTT.js","assets/VTLMaterialManager-Diyp9F_8.js","assets/GridShader-DUujwOxo.js","assets/CircularArray-CujHzHWW.js","assets/SymbolFader-DhRqzlcF.js","assets/VertexStream-BbTKeq_J.js","assets/pbf-D2pQhulj.js","assets/AttributeStore-34alAX1t.js","assets/FeatureStoreQueryAdapter-Bhdet8CN.js","assets/queryUtils-DR5Kw9rC.js","assets/timeSupport-CA3_L9h8.js","assets/utils-C0q9vcU-.js","assets/grouping-gYjPzycx.js","assets/utils-DDjZAYSk.js","assets/MeshWriterRegistry-BLUxtc2V.js","assets/projectOperator-pbpmSpqo.js","assets/operatorProject-Bp6D6u9T.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/GraphicsView2D-D2tz3UjE.js","assets/FeatureMetadata-Bf-1f7cv.js","assets/normalizeUtilsSync-DladfY4H.js","assets/densifyCurvedGeometry-CEs-ZAqO.js","assets/GraphicContainer-BjnFOwwN.js","assets/AGraphicContainer-CipCUkQ8.js","assets/TechniqueInstance-DDDMeiIO.js","assets/TileContainer-Dg6XEH5R.js","assets/gridUtils-Bl6T9-nG.js","assets/VideoOperationalDataView-DZ4QUzST.js"])))=>i.map(i=>d[i]);
import{rp as M,a5 as o,x as r,y as b,rq as A,ni as H,rr as L,rs as I,i$ as G,a7 as Z,rt as D,al as j,ru as N,rv as W,j as h,bH as q,N as f,a8 as p,hQ as U,eK as B,rw as F,ns as Q,nr as J,ai as V,b3 as C,a3 as _,fR as K,bO as X,ak as Y,L as tt,C as x,eg as et,c as it,rx as at,ry as st,d as R,rz as S,Q as $,f as z,rA as ot,rB as rt,i as nt,l as ht}from"./index-aRi8Xk-b.js";import{load as lt,execute as dt}from"./projectOperator-pbpmSpqo.js";import{V as pt,a as ct}from"./VideoElement-B-R-4fHC.js";import{i as mt}from"./perspectiveUtils-DkWurYV9.js";import{n as yt}from"./Container-C-ZwQjfx.js";import"./WGLContainer-VQ2nIsVJ.js";import"./Utils-BPTYZR54.js";import{y as ut}from"./GridShader-DUujwOxo.js";import"./pbf-D2pQhulj.js";import"./FeatureCommandQueue-C6Ec3PWP.js";import"./UpdateTracking2D-Be5nPTfX.js";import"./TexturedLineMeshWriter-CUS8-bnH.js";import"./GraphicsView2D-D2tz3UjE.js";import"./earcut-D9gy186-.js";import{R as vt}from"./Overlay-BRvlvNPg.js";import{f as ft}from"./OverlayContainer-CwPv1Pym.js";import"./operatorProject-Bp6D6u9T.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./ControlPoint-roJedap0.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./normalizeUtilsSync-DladfY4H.js";import"./WGLBrushVTLSymbol-D7V9Y8WI.js";import"./ShaderCompiler-G2XYGDs6.js";import"./ProgramTemplate-Bk_wp2ZV.js";import"./GraphShaderModule-B8YWxOlg.js";import"./utils-BCggJqx3.js";import"./constants-BBnGEY1d.js";import"./CircularArray-CujHzHWW.js";import"./SymbolFader-DhRqzlcF.js";import"./heatmapTextureUtils-DQa9l15G.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./QueueProcessor-BBZoq4x6.js";import"./TurboLine-BGDqjgTT.js";import"./AttributeStore-34alAX1t.js";import"./FeatureStoreQueryAdapter-Bhdet8CN.js";import"./queryUtils-DR5Kw9rC.js";import"./timeSupport-CA3_L9h8.js";import"./FeatureMetadata-Bf-1f7cv.js";import"./densifyCurvedGeometry-CEs-ZAqO.js";import"./utils-C0q9vcU-.js";import"./grouping-gYjPzycx.js";import"./utils-DDjZAYSk.js";let m=class extends M{constructor(t){super(t),this.components=["zoom"]}};o([r()],m.prototype,"components",void 0),m=o([b("esri.views.ui.video.DefaultUIVideo")],m);const E=m,gt=new B("#000");let P;async function _t(){const[,{ParentStage:t}]=await Promise.all([_(()=>import("./webglDeps-CYzwT90y.js"),__vite__mapDeps([0,1,2,3,4,5])),_(()=>import("./mapViewDeps-DKdpVw2M.js"),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,3,5,16,17,18,19,20,21,22,23,4,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))]);P=t}const g=.01,wt=["feature","geojson","csv","stream","ogc-feature","catalog","wfs","parquet","graphics","group"];let s=class extends A(H(L(I(G(Z))))){constructor(t){super(t),this._isValid=!1,this._prevZoomEnabled=!1,this._prevRotationEnabled=!1,this.stage=null,this.childStage=null,this._operationalDataView=null,this.operationalDataVisible=!1,this.layer=null,this.map=null,this.navigation=new D,this.ready=!1,this.spatialReference=new j({wkid:0}),this.stateManager=new N({constraints:new W({view:this,minScale:1,maxScale:g})}),this.type="2d",this.ui=new E,this.view2dType="video",this.addHandles([h(()=>this.preconditionsReady,e=>e?this._startup():this._teardown()),h(()=>this.layer,(e,i)=>{i&&(this._teardown(),this._startup()),this.addResolvingPromise(f(()=>this.ready))},q),h(()=>this.videoSize,([e,i])=>{this._extent&&e&&i&&(this._extent.xmax=e,this._extent.ymax=i)}),h(()=>this.size,e=>{this._operationalDataView&&this._operationalDataView.stateManager.resize(e[0],e[1])}),h(()=>[this.layer?.frameEffect,this._effectsContainer],()=>{this._effectsContainer&&(this._effectsContainer.effect=this.layer?.frameEffect??null)},p)])}initialize(){this._prevZoomEnabled=this.navigation.actionMap.mouseWheel==="zoom"&&this.ui.components.includes("zoom"),this._prevRotationEnabled=this.navigation.actionMap.dragSecondary==="rotate"&&this.ui.components.includes("compass"),this.addHandles([h(()=>[this.operationalDataVisible,this.childStage],()=>{this.childStage&&(this.childStage.videoScreenRenderer.visible=this.operationalDataVisible),this.operationalDataVisible&&(this.scale=1,this.rotation=0),this.navigation&&(this._prevZoomEnabled&&(this.navigation.actionMap.mouseWheel=this.operationalDataVisible?"none":"zoom",this.navigation.actionMap.dragPrimary=this.operationalDataVisible?"none":"pan",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="zoom"):[...new Set([...this.ui.components,"zoom"])])),this._prevRotationEnabled&&(this.navigation.actionMap.dragSecondary=this.operationalDataVisible?"none":"rotate",this.ui.components&&(this.ui.components=this.operationalDataVisible?this.ui.components.filter(t=>t!=="compass"):[...new Set([...this.ui.components,"compass"])])))},p)]),this.addResolvingPromise(_t().then(()=>(this._isValid=!0,f(()=>this.ready))))}destroy(){this._teardown(),this.removeAllHandles(),this._set("preconditionsReady",!1),this.frameTask=U(this.frameTask),this.goToManager.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get constraintsInfo(){return{lods:null,spatialReference:this.spatialReference}}get preconditionsReady(){return!(!this._isValid||this.width===0||this.height===0||this.videoSize[0]===0||this.videoSize[1]===0)}get rendering(){return this.stage?.renderRequested??!1}get scale(){return this.stateManager?.scale??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get videoSize(){if(!this.layer?.videoWidth||!this.layer?.videoHeight)return[0,0];const[t,e]=this.size,i=(this.layer?.videoWidth||0)/(this.layer?.videoHeight||0),a=e*i,n=t/i;return t/e>=1?i>=1?a<=t?[a,e]:[t,n]:n<=e?[t,n]:[a,e]:i>=1?n<=e?[t,n]:[a,e]:a<=t?[a,e]:[t,n]}async hitTest(t,e){return this._operationalDataView&&this._operationalDataView.ready?this._operationalDataView.hitTest(t,e):{screenPoint:t,results:[]}}_startup(){if(!this.layer)return;const t=this._getViewpoint();this.stateManager.startup(t,this.size,t.targetGeometry.spatialReference);const e={renderingOptions:this.renderingOptions,backgroundColor:gt,groundControlPoints:()=>this.layer?.groundControlPoints,getSize:()=>this.videoSize},i=new P(this.surface,e,new F(this.surface));this.stage=i,this._prepareStage(this.stage),this.childStage=i.childStage,this._prepareChildStage(this.childStage);const a=new Q({view:this});this._set("animationManager",a);const n=new ut({view:this,animationManager:a});this._set("mapViewNavigation",n),this._updateConstraints(),this.frameTask.start(),this._set("ready",!0)}_teardown(){this.stage.destroy(),this.stage=null,this._videoElementView=null,this._overlayContainer.removeAllChildren(),this._overlayContainer=null,this.removeHandles("video-view"),this._set("ready",!1),this.stateManager.teardown(),this.frameTask.stop(),this.stationaryManager.clear()}_getViewpoint(){return new J({targetGeometry:new V({x:this.videoSize[0]/2,y:this.videoSize[1]/2,spatialReference:this.spatialReference}),scale:1})}_prepareStage(t){this.addHandles([h(()=>this.stationary,a=>t.stationary=a,p),h(()=>this.state.id,()=>t.state=this.state,p),h(()=>this.renderingOptions,a=>t.renderingOptions=a,p)],"video-view"),this._extent=new C({xmin:0,ymin:0,xmax:this.videoSize[0],ymax:this.videoSize[1],spatialReference:{wkid:0}}),this._videoElementView=new mt({element:new pt({video:this.layer?.videoElement,georeference:new ct({extent:this._extent}),autoplay:!1}),spatialReference:this.spatialReference});const e=new vt(this._videoElementView);this._overlayContainer=new ft,this._overlayContainer.addChild(e),this._effectsContainer=new yt,this._effectsContainer.addChild(this._overlayContainer),this.stage.addChild(this._effectsContainer);const i=document.createElement("div");i.classList.add("esri-video-poster"),this.container?.classList.add("esri-video-view"),this.container?.appendChild(i)}_prepareChildStage(t){this.addHandles([h(()=>this.map,async e=>{if(!e)return;const{default:i}=await _(()=>import("./VideoOperationalDataView-DZ4QUzST.js"),__vite__mapDeps([49,1,2]));this._operationalDataView=new i({stage:t,layerViewFilter:a=>new Set(wt).has(a.type),width:this.size[0],height:this.size[1],map:e}),f(()=>this._operationalDataView?.ready).then(()=>{t.videoScreenRenderer.visible=this.operationalDataVisible})},p),h(()=>this.layer?.groundControlPoints,async()=>{if(!this.layer?.groundControlPoints||!t.state)return;const e=this.layer.groundControlPoints,i=e?.length;if(!i)return;await lt();const a=new Array(i),n=t.state.spatialReference;for(let d=0;d<i;d++){const{lat:T,lon:k}=e[d];a[d]=dt(new V(k,T),n)}let c=1/0,l=1/0,u=-1/0,v=-1/0;for(const d of a)c=Math.min(c,d.x),l=Math.min(l,d.y),u=Math.max(u,d.x),v=Math.max(v,d.y);const O=C.fromJSON({xmin:c,ymin:l,xmax:u,ymax:v,spatialReference:n});await this._operationalDataView?.goTo(O,{animate:!1}).catch(()=>{})},p)])}_updateConstraints(){this._updateZoomConstraints(),this._updatePanConstraints()}_updateZoomConstraints(){const t=this.videoSize,e=Math.max(t[0]/this.size[0],t[1]/this.size[1]),i=[];for(let n=e;n>g;n/=2)i.push(n);i.push(g);const{lods:a}=K.create({scales:i});this.constraints.set({lods:a,minScale:e})}_updatePanConstraints(){const t=e=>{if(!e.targetGeometry)return e;const[i,a]=this.videoSize,n=i*e.scale/2,c=a*e.scale/2,l=e.targetGeometry.clone();return l.x=Math.max(n,Math.min(i-n,l.x)),l.y=Math.max(c,Math.min(a-c,l.y)),e.targetGeometry=l,e};this.constraints.customConstraints.add({constrain:t,applyPanConstraint:t})}};o([r()],s.prototype,"_overlayContainer",void 0),o([r()],s.prototype,"_isValid",void 0),o([r()],s.prototype,"_effectsContainer",void 0),o([r()],s.prototype,"constraintsInfo",null),o([r()],s.prototype,"operationalDataVisible",void 0),o([r()],s.prototype,"layer",void 0),o([r()],s.prototype,"map",void 0),o([r({type:D,nonNullable:!0})],s.prototype,"navigation",void 0),o([r({readOnly:!0})],s.prototype,"preconditionsReady",null),o([r({readOnly:!0})],s.prototype,"ready",void 0),o([r({readOnly:!0})],s.prototype,"rendering",null),o([r()],s.prototype,"scale",null),o([r()],s.prototype,"spatialReference",void 0),o([r()],s.prototype,"stateManager",void 0),o([r()],s.prototype,"type",void 0),o([r(),X(t=>t instanceof M?t:Y(E,t))],s.prototype,"ui",void 0),o([r({readOnly:!0})],s.prototype,"videoSize",null),o([r({readOnly:!0})],s.prototype,"view2dType",void 0),s=o([b("esri.views.VideoView")],s);const Vt=s;const Ct=nt`:host{width:100%;height:100%}`,xt=rt(Vt),y=class y extends tt{constructor(){super(),this._containerRef=x(),this._direction=et(),this._mapRef=x(),this.autoDestroyDisabled=!1,this.view=xt(this),this.aria=this.view.aria,this.ready=this.view.ready,this.layer=this.view.layer,this.map=this.view.map,this.arcgisViewReadyChange=it()}async destroy(){await this.manager.destroy()}loaded(){const e=this;e.el.childElem=this._mapRef.value,this.view.container??=e.el.childElem,this.manager.onLifecycle(()=>[h(()=>this.layer,()=>{this.layer&&this.view&&(this.view.layer=this.layer,this.layer.loaded||this.layer.load())},{initial:!0}),h(()=>this.view.ready,()=>{this.view.ready&&this.arcgisViewReadyChange.emit()},{initial:this.view.ready})])}renderMain(){return z`<div class=${R(S.base)} ${$(this._mapRef)}></div>`}render(){return z`<section class=${R(S.containerUI)} ${$(this._containerRef)}>${ot(this._direction)}</section>${this.renderMain()}`}};y.properties={autoDestroyDisabled:5,view:32,aria:0,ready:4,layer:0,map:0},y.styles=[at,st,Ct];let w=y;ht("arcgis-video",w);export{w as ArcgisVideo};
