import{gc as O,gd as L,ge as R}from"./index-Brd6-W-v.js";function E(f,n,g){const e=Array.isArray(f),r=e?f.length/n:f.byteLength/(4*n),y=e?f:new Uint32Array(f,0,r*n),h=g?.minReduction??0,c=g?.originalIndices||null,q=c?c.length:0,i=g?.componentOffsets||null;let b=0;if(i)for(let t=0;t<i.length-1;t++){const u=i[t+1]-i[t];u>b&&(b=u)}else b=r;const w=Math.floor(1.1*b)+1;(a==null||a.length<2*w)&&(a=new Uint32Array(R(2*w)));for(let t=0;t<2*w;t++)a[t]=0;let o=0;const U=!!i&&!!c,d=U?q:r;let s=O(r);const m=new Uint32Array(q),k=1.96;let I=h!==0?Math.ceil(4*k*k/(h*h)*h*(1-h)):d,p=1,$=i?i[1]:d;for(let t=0;t<d;t++){if(t===I){const l=1-o/t;if(l+k*Math.sqrt(l*(1-l)/t)<h)return null;I*=2}if(t===$){for(let l=0;l<2*w;l++)a[l]=0;if(c)for(let l=i[p-1];l<i[p];l++)m[l]=s[c[l]];$=i[++p]}const u=U?c[t]:t,j=u*n,x=B(y,j,n);let A=x%w,C=o;for(;a[2*A+1]!==0;){if(a[2*A]===x){const l=a[2*A+1]-1;if(v(y,j,l*n,n)){C=s[l];break}}A++,A>=w&&(A-=w)}C===o&&(a[2*A]=x,a[2*A+1]=u+1,o++),s[u]=C}if(h!==0&&1-o/r<h)return null;if(U){for(let t=i[p-1];t<m.length;t++)m[t]=s[c[t]];s=L(m)}const M=e?new Array(o):new Uint32Array(o*n);o=0;for(let t=0;t<d;t++)s[t]===o&&(z(y,(U?c[t]:t)*n,M,o*n,n),o++);if(c&&!U){const t=new Uint32Array(q);for(let u=0;u<t.length;u++)t[u]=s[c[u]];s=L(t)}return{buffer:Array.isArray(M)?M:M.buffer,indices:s,uniqueCount:o}}function v(f,n,g,e){for(let r=0;r<e;r++)if(f[n+r]!==f[g+r])return!1;return!0}function z(f,n,g,e,r){for(let y=0;y<r;y++)g[e+y]=f[n+y]}function B(f,n,g){let e=0;for(let r=0;r<g;r++)e=f[n+r]+e|0,e=e+(e<<11)+(e>>>2)|0;return e>>>0}let a=null;export{E as e};
