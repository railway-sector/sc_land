import{aK as v,aL as x,aM as R,aN as M,aO as w,aP as f,aQ as $,aR as E,aS as D}from"./index-CVzGOCNQ.js";import{g as S}from"./EditGeometryOperations-C4oxgkhN.js";function q(e,a){let t=null,n=null;return r=>{if(r.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),t=null,n=null));const l={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};r.action==="start"&&t==null&&(t=new m,n=new m,a(e,t,n,r.pointerType,l)),t?.execute(l),r.action==="end"&&t!=null&&(t=null,n=null)}}function j(e,a){return e.events.on("drag",q(e,a))}function k(e,a){const t=[e.x,e.y,e.z??0],n=a,r=[Math.cos(n),Math.sin(n)],l=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(l===0)return null;r[0]/=l,r[1]/=l;const o=c=>{const u=(c.x-t[0])*r[0]+(c.y-t[1])*r[1];c.x=t[0]+u*r[0],c.y=t[1]+u*r[1]};return c=>(o(c.mapStart),o(c.mapEnd),{...c,axis:r})}function P(e){let a=null;const t=z();return n=>{if(n.action==="start"&&(a=G(e,n.mapStart.spatialReference)),a==null)return null;const r=t(n);if(!r)return null;const{translationX:l,translationY:o,translationZ:c}=r;return a.move(l,o,c,n.action),r}}function h(e,a){return e==null?null:e.spatialReference.equals(a)?e.clone():f(e,a)}function G(e,a){const t=e.operations;if(!t)return null;const n=t.data.geometry,r=M(a);if(n.spatialReference.equals(r))return d(e,t,()=>{});if(n.type!=="mesh"){const l=h(n,r);if(l==null)return null;const o=n.spatialReference,c=S.fromGeometry(l,t.viewingMode);return d(e,c,()=>{const u=c.data.geometry,s=f(u,o);t.trySetGeometry(s)})}if(w(n)){const l=h(n.origin,r);if(!l)return null;const o=n.spatialReference,c=S.fromGeometry(l,t.viewingMode);return d(e,t,()=>{const u=f(c.data.geometry,o),s=u.x-n.origin.x,i=u.y-n.origin.y,p=(u.z??0)-(n.origin.z??0);t.move(s,i,p)})}return null}function d(e,a,t){let n=0,r=0,l=0;return{move:(o,c,u,s)=>{s==="start"&&(n=0,r=0,l=0);const i=o-n,p=c-r,y=u-l;a.move(i,p,y),n+=i,r+=p,l+=y,t(),s==="end"&&e.endInteraction?.()}}}function I(e,a=null,t){let n=null;const r=a==null||e.spatialReference?.equals(a)?o=>o:o=>o!=null?f(o,a):o,l={exclude:[],...t};return o=>{if(o.action==="start"&&(n=r(e.toMap(o.screenStart,l))),n==null)return null;const c=r(e.toMap(o.screenEnd,l));return c!=null?{...o,mapStart:n,mapEnd:c}:null}}function K(e){const a=e.map(n=>P(n)).filter(v),t=z();return n=>{const r=t(n);return a.forEach(l=>l(n)),r}}function L(e,a){const t=new Map;for(const n of a)t.set(n,$(e[n]));return n=>(t.forEach((r,l)=>{e[l]=r}),n)}function X(e){const a=e.operations?.createResetState();return t=>(a?.remove(),t)}function O(e){const a=e.map(t=>X(t)).filter(t=>t!=null);return t=>(a.forEach(n=>n(t)),t)}function Q(){let e=0,a=0,t=0;return n=>{n.action==="start"&&(e=n.mapStart.x,a=n.mapStart.y,t=n.mapStart.z??0);const r=n.mapEnd.x-e,l=n.mapEnd.y-a,o=(n.mapEnd.z??0)-t;return e=n.mapEnd.x,a=n.mapEnd.y,t=n.mapEnd.z,{...n,mapDeltaX:r,mapDeltaY:l,mapDeltaZ:o,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function z(){let e=0,a=0,t=0;return n=>{n.action==="start"&&(e=n.mapStart.x,a=n.mapStart.y,t=n.mapStart.z??0);const r=n.mapEnd.x-e,l=n.mapEnd.y-a,o=(n.mapEnd.z??0)-t;return{...n,translationX:r,translationY:l,translationZ:o}}}function T(){let e=0,a=0;return t=>{t.action==="start"&&(e=t.screenStart.x,a=t.screenStart.y);const n=t.screenEnd.x-e,r=t.screenEnd.y-a;return e=t.screenEnd.x,a=t.screenEnd.y,{...t,screenDeltaX:n,screenDeltaY:r}}}function U(e,a){let t=null,n=0,r=0;return l=>{if(l.action==="start"&&(t=e.toScreen?.(a),t!=null&&(t.x<0||t.x>e.width||t.y<0||t.y>e.height?t=null:(n=l.screenStart.x-t.x,r=l.screenStart.y-t.y))),t==null)return null;const o=E(l.screenEnd.x-n,0,e.width),c=E(l.screenEnd.y-r,0,e.height),u=D(o,c);return l.screenStart=t,l.screenEnd=u,l}}const Y=()=>{};class m{constructor(){this.execute=Y}next(a,t=new m){return a!=null&&(this.execute=n=>{const r=a(n);r!=null&&t.execute(r)}),t}}function W(e,a,t=[]){if(e.type==="2d")return r=>r;let n=null;return r=>{r.action==="start"&&(n=e.toMap(r.screenStart,{exclude:t}),n!=null&&(n.z=x(n,e,a)));const l=e.toMap(r.screenEnd,{exclude:t});l!=null&&(l.z=x(l,e,a));const o=n!=null&&l!=null?{sceneStart:n,sceneEnd:l}:null;return{...r,scenePoints:o}}}function g(e,a,t){const n=a.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,r=R(e);return r.z=n,r.hasZ=!0,r.z=x(r,a,t),r}function b(e,a){if(e.type==="2d")return n=>n;let t=null;return n=>{n.action==="start"&&(t=g(n.mapStart,e,a));const r=g(n.mapEnd,e,a),l=t!=null&&r!=null?{sceneStart:t,sceneEnd:r}:null;return{...n,scenePoints:l}}}export{m as D,I as E,T as M,U as R,K as S,W as U,P as f,X as g,L as h,z as j,k as m,j as p,b as q,O as v,Q as z};
