import{Z as xt,O as J,jb as $t,B as Q,_ as n,e as s,g as _,yE as E,h0 as x,tU as bt,fE as ut,aZ as Ut,tW as Tt,tD as Vt,Cf as Mt,cj as It,am as Pt,ex as Ct,f as Gt,$ as St,Cg as X,ff as Rt,jl as A,ap as Et,aq as z,xu as Dt,gM as I,lX as P,bp as K,Ch as Ft,Ci as zt,an as Ht,bn as Lt,br as tt,aD as At,jx as j,Cj as H,aF as Nt,mP as et,sS as it,be as ot,Ck as nt}from"./index-CgzAF5Ey.js";import{E as jt}from"./coordinateFormatter-4c6X-xJV.js";import{n as Zt}from"./GraphicsLayer-CNIUk38A.js";import{a as Bt}from"./dehydratedFeatureComparison-GEO06dBy.js";import{k as st,v as Yt,b as rt,U as Wt,T as qt,j as at,R as Jt}from"./createUtils-IRSfXt-_.js";import{W as Qt}from"./surfaceCoordinateSystems-Czhjgkml.js";import{e as T}from"./helpMessageUtils-2XpUG8Xk.js";import{getDrawMeshHelpMessage as Xt}from"./helpMessageUtils3d-Btb32ZF_.js";import{b as Kt}from"./drawSurfaces-CQjcevUo.js";import{r as $,V as te,R as ee,c as ie,H as oe}from"./SketchTooltipInfo-ipmEcjXX.js";import{h as D,M as ne,j as se,I as ht,w as mt,Q as re,U as ae}from"./TooltipInfoWithCoordinates-Ctjrbg45.js";import{x as le}from"./angularMeasurementUtils-DWPIAu_Z.js";import{T as ce,K as pe}from"./euclideanLengthMeasurementUtils-CGkbgpIY.js";import{r as de}from"./InteractiveToolBase-CODufc4B.js";import{l as yt}from"./SketchOptions-DsWZlvNP.js";import{t as ue,a as he,o as me,l as ye}from"./EditGeometryOperations-CUoPE0hp.js";const Z={UndoRedoUpdating:"Cannot perform operation whilst undo redo is updating",UndoInvalidError:"There are no items to Undo",RedoInvalidError:"There are no items to Redo"};class C extends Error{constructor(){super(Z.UndoRedoUpdating),this.type="undo-redo-updating-error"}}class ge extends Error{constructor(){super(Z.UndoInvalidError),this.type="undo-redo-undo-error"}}class lt extends Error{constructor(){super(Z.RedoInvalidError),this.type="undo-redo-redo-error"}}let f=class extends xt{constructor(){super(...arguments),this._stack=new J,this._stackPosition=-1,this._updatingHandles=new $t}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new ge;if(this.updating)throw new C;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new lt;if(this.updating)throw new C;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new lt;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new C;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(i=>i.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new C;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,i=!1){if(this.updating&&!i)return;await Q(()=>!this.updating);const o=new J;for(let r=0;r<this._stack.length;r++){const a=this._stack.getItemAt(r);a&&(a.tag===e?(a.destroy(),r===this._stackPosition&&(this._stackPosition=o.length-1)):o.push(a))}this._stack=o,this._stackPosition>o.length-1&&(this._stackPosition=o.length-1)}async clear(e=!1){if(this.updating&&!e)throw new C;await Q(()=>!this.updating),this._drainStack()}};n([s()],f.prototype,"_stack",void 0),n([s()],f.prototype,"_stackPosition",void 0),n([s()],f.prototype,"updating",null),n([s({readOnly:!0})],f.prototype,"canUndo",null),n([s({readOnly:!0})],f.prototype,"hasUndo",null),n([s({readOnly:!0})],f.prototype,"canRedo",null),n([s({readOnly:!0})],f.prototype,"hasRedo",null),f=n([_("esri.UndoRedo")],f);let fe=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}},v=class extends ${constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=E}get allFields(){return[]}};n([s()],v.prototype,"type",void 0),n([s()],v.prototype,"radius",void 0),n([s()],v.prototype,"xSize",void 0),n([s()],v.prototype,"ySize",void 0),n([s()],v.prototype,"area",void 0),n([s()],v.prototype,"helpMessage",void 0),n([s()],v.prototype,"allFields",null),v=n([_("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],v);let G=class extends D($){constructor(e){super(e),this.type="draw-mesh",this.orientation=ne({lockable:!1}),this.scale=se({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([s()],G.prototype,"helpMessage",void 0),n([s()],G.prototype,"allFields",null),G=n([_("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],G);let S=class extends D($){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([s()],S.prototype,"helpMessage",void 0),n([s()],S.prototype,"allFields",null),S=n([_("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],S);let R=class extends D($){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([s()],R.prototype,"helpMessage",void 0),n([s()],R.prototype,"allFields",null),R=n([_("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],R);let b=class extends D($){constructor(t){super(t),this.type="draw-polygon",this.direction=ht(),this.distance=mt(),this.area=re(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([s()],b.prototype,"xyMode",void 0),n([s()],b.prototype,"helpMessage",void 0),n([s()],b.prototype,"allFields",null),b=n([_("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],b);let U=class extends D($){constructor(t){super(t),this.type="draw-polyline",this.direction=ht(),this.distance=mt(),this.totalLength=ae(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([s()],U.prototype,"helpMessage",void 0),n([s()],U.prototype,"xyMode",void 0),n([s()],U.prototype,"allFields",null),U=n([_("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],U);let w=class extends ${constructor(t){super(t),this.type="draw-rectangle",this.xSize=x,this.ySize=x,this.area=E}get allFields(){return[]}};n([s()],w.prototype,"type",void 0),n([s()],w.prototype,"xSize",void 0),n([s()],w.prototype,"ySize",void 0),n([s()],w.prototype,"area",void 0),n([s()],w.prototype,"helpMessage",void 0),n([s()],w.prototype,"allFields",null),w=n([_("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],w);function ve(t,e){return{point:new R({sketchOptions:e,viewType:t}),multipoint:new S({sketchOptions:e,viewType:t}),polyline:new U({sketchOptions:e,viewType:t}),polygon:new b({sketchOptions:e,viewType:t}),mesh:new G({sketchOptions:e,viewType:t}),rectangle:new w({sketchOptions:e}),circle:new v({sketchOptions:e})}}function ct(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:r}=t,a=p=>{const l=L(t).mode,h=r[p].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?h.lock(W(t)):h.unlock()},c=p=>{if(e){const l=r[p].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":a(i),c(i);break;case"point":case"mesh":a(i)}}function we(t,e){const{drawOperation:i,view:o}=e,r=B(e),a=L(e);if(o.type==="2d"||!t||a.mode!=="absolute-height"||i?.numCommittedVertices!==1||!r||r.type!=="draw-polyline"&&r.type!=="draw-polygon"||r.elevation.locked)return;const[c,p,l]=t,h=Ce(c,p,l,a,e);h!=null&&r.elevation.lock(h)}function pt(t){B(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function B({geometryType:t,graphic:e,tooltipInfos:i}){return e?.geometry?.type!==_e[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const _e={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline",text:"point"};function Oe(t,e){switch(t?.type){case"draw-point":ke(t,e);break;case"draw-multipoint":xe(t,e);break;case"draw-polyline":be(t,e);break;case"draw-polygon":Ue(t,e);break;case"draw-rectangle":Ve(t,e);break;case"draw-circle":Me(t,e);break;case"draw-mesh":$e(t,e)}}function ke(t,e){const i=e.graphic?.geometry;i?.type==="point"&&(Y(t,i,e),t.helpMessage=T("point",i,e.drawOperation.drawingMode))}function xe(t,e){const i=e.graphic?.geometry;i?.type==="multipoint"&&(Y(t,i,e),t.helpMessage=T("multipoint",i,e.drawOperation.drawingMode))}function $e(t,e){const{graphic:i,view:o}=e,r=i?.geometry;o.type!=="3d"||r&&r.type!=="mesh"||(Y(t,r?.origin,e),r&&te(t,r),t.helpMessage=Xt(i,o))}function Y(t,e,i){const{drawOperation:o,view:r,sketchOptions:a}=i,{cursorVertex:c}=o;t.sketchOptions=a,t.viewType=r.type;const p=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(p,V(i)),ft(t.elevation,i),!c)return void(o.constraints=void 0);const l=c;o.constraints={context:Ot(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function be(t,e){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:r}=e,a=i!=null?i.full:null;a&&a.type!=="polyline"||(gt(t,e),t.totalLength.actual=o.lastVertex?(a?r.autoLength2D(a):null)??x:null,t.helpMessage=T("polyline",a,e.drawOperation.drawingMode))}function Ue(t,e){const{createOperationGeometry:i,drawOperation:o}=e,r=i!=null?i.full:null;r&&r.type!=="polygon"||(gt(t,e),t.area.actual=o.lastVertex?(r?e.automaticAreaMeasurementUtils.autoArea2D(r):null)??E:null,t.helpMessage=T("polygon",r,e.drawOperation.drawingMode))}const dt=It(Pt);function gt(t,e){const{drawOperation:i,sketchOptions:o,view:r,automaticLengthMeasurementUtils:a}=e,{cursorVertex:c,lastVertex:p,secondToLastVertex:l}=i,h=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=r.type;const g=p&&c?a.autoDistanceBetweenPoints2D(dt(p),dt(c))??x:null;if(t.distance.actual=g,t.distance.readOnly=p==null,t.direction.actual=null,t.direction.readOnly=!0,p&&c&&(h==="absolute"||l)){const u=le(l,p,c,h);t.direction.actual=u??Mt,t.direction.readOnly=!1}t.setLocationFromPoint(c,V(e)),ft(t.elevation,e);const m=Te(p,e);t.xyMode=m,t.direction.visible=m==="direction-distance",t.distance.visible=m==="direction-distance",t.effectiveX.visible=m==="coordinates",t.effectiveY.visible=m==="coordinates";const O=c??p;i.constraints=O?{context:Ot(O,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Te(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Ve(t,e){t.sketchOptions=e.sketchOptions,t.xSize=wt(e),t.ySize=_t(e),t.area=vt(e),t.helpMessage=T("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Me(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Ie(e):null,t.xSize=i?null:wt(e),t.ySize=i?null:_t(e),t.area=vt(e),t.helpMessage=T("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function ft(t,e){const{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=pe(o)??W(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function vt(t){const e=t.createOperationGeometry?.full;return e?.type!=="polygon"?E:t.automaticAreaMeasurementUtils.autoArea2D(e)??E}function wt({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.left,i.right):null)??x}function _t({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??x}function Ie({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){return(t?.circle?.center!=null&&t.circle.edge!=null?e.autoDistanceBetweenPoints2D(t.circle.center,t.circle.edge):null)??x}function Pe(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?bt(o,"meters")/ut(V(t)):void 0}default:return}}function Ce(t,e,i,o,r){const{view:a,drawOperation:c}=r;if(a.type!=="3d"||!c)return;i??=0;const p=V(r),l=L(r),h=Tt(a,t,e,i,p,l,o);return ce(h,p)??W(r)}function L(t){return t.drawOperation.elevationInfo??Ut}function V(t){return t.drawOperation.coordinateHelper.spatialReference}function W(t){const e=ut(V(t));return Vt(t.defaultZ*e,"meters")}function Ot(t,e){return Kt(t,e.view,V(e),L(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let d=class extends de{constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new yt}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Zt({listMode:"hide",internal:!0,title:"DrawGraphicTool layer"}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=ve(t.type,this.sketchOptions);const i=ee(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,ct(this._tooltipsContext),this._coordinateFormatterLoadTask=Ct(()=>jt()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>ie(o,this.activeTooltipInfo)),Gt(()=>this.cursor,o=>{e.cursor=o},St),X(()=>{const{activeTooltipInfo:o,sketchOptions:r}=this;Oe(o,this._tooltipsContext),i.info=r.tooltips.effectiveEnabled?o:null}),X(()=>{e.constraintZ=Pe(this._tooltipsContext)},Rt)]),this.finishToolCreation(),e.initializePointer()}destroy(){this.drawOperation=A(this.drawOperation),this.tooltip=A(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=A(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:r,graphic:a,sketchOptions:c,tooltipInfos:p,view:l,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:g}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:r,graphic:a,sketchOptions:c,tooltipInfos:p,view:l,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:g}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof f?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||oe(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&ct(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(y.outline),this.removeHandles(y.regularVertices),this.removeHandles(y.activeVertex),this.removeHandles(y.activeEdge),this.removeHandles(N)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Et({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),N),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:r,committedVertices:a,geometryIncludingUncommittedVertices:c,numCommittedVertices:p}=this.drawOperation;if(!(p>0||o!=null))return;const l=t.operationComplete?a:c,h=l.length,g=o!=null?e.pointToArray(o):null,m=this._drawSpatialReference,O=i.type==="3d"&&i.viewingMode==="global",u=new fe;u.committedVertices=a,u.cursorVertex=g;const{geometryType:M}=this;switch(M){case"point":case"mesh":u.full=e.arrayToPoint(l[0]);break;case"multipoint":u.full=h>0?Jt(l,m):null;break;case"polyline":case"polygon":h>0&&(u.full=M==="polygon"?qt([l],m,O,!0):at([l],m,O),u.cursorEdge=g!=null&&r&&!Bt(o,r)?at([[g,e.pointToArray(r)]],m,O):null,u.outline=h>1?u.full:null);break;case"circle":case"rectangle":{if(u.committedVertices=u.cursorVertex=null,!h)break;const k=Qt(i,l[0]),F=l[0],q=k.makeMapPoint(F[0]+Ge*i.resolution,F[1]);M==="circle"?h===1&&t.operationComplete?u.circle=st([F,q],k,!0):h===2&&(this.forceUniformSize?u.circle=st(l,k,this.centered):u.rectangle=Yt(l,k,this.centered)):h===1&&t.operationComplete?u.rectangle=rt([F,q],k,!0):h===2&&(u.rectangle=this.forceUniformSize?rt(l,k,this.centered):Wt(l,k,this.centered)),u.full=u.circle!=null?u.circle.geometry:u.rectangle?.geometry,u.outline=u.full?.type==="polygon"?u.full:null;break}default:return null}return u}initializeGraphic(t){return z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return z()}onCursorEdgeChanged(t){return z()}onVertexAdd(t){pt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||we(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){pt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),y.activeEdge):this.removeHandles(y.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),y.outline):this.removeHandles(y.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),y.regularVertices):this.removeHandles(y.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),y.activeVertex):this.removeHandles(y.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(N)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?B(this._tooltipsContext):null}};n([s()],d.prototype,"_coordinateFormatterLoadTask",void 0),n([s()],d.prototype,"_createOperationGeometry",void 0),n([s()],d.prototype,"_tooltipsContext",null),n([s({value:!0})],d.prototype,"centered",null),n([s()],d.prototype,"cursor",null),n([s({nonNullable:!0})],d.prototype,"defaultZ",void 0),n([s({constructOnly:!0})],d.prototype,"directionOptions",void 0),n([s()],d.prototype,"drawOperation",void 0),n([s()],d.prototype,"elevationLockOnVertexAddDisabled",void 0),n([s({value:!0})],d.prototype,"enabled",null),n([s({value:!0})],d.prototype,"forceUniformSize",null),n([s({constructOnly:!0})],d.prototype,"geometryType",void 0),n([s()],d.prototype,"graphic",null),n([s({constructOnly:!0})],d.prototype,"graphicProperties",void 0),n([s()],d.prototype,"graphicSymbol",null),n([s({constructOnly:!0})],d.prototype,"hasZ",void 0),n([s({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),n([s()],d.prototype,"mode",null),n([s()],d.prototype,"snappingManager",void 0),n([s()],d.prototype,"snapToScene",void 0),n([s()],d.prototype,"tooltip",void 0),n([s()],d.prototype,"tooltipInfos",void 0),n([s({constructOnly:!0,type:yt})],d.prototype,"sketchOptions",void 0),n([s()],d.prototype,"updating",null),n([s({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),n([s({constructOnly:!0})],d.prototype,"automaticAreaMeasurementUtils",void 0),n([s({constructOnly:!0})],d.prototype,"automaticLengthMeasurementUtils",void 0),n([s({constructOnly:!0})],d.prototype,"undoRedo",null),n([s()],d.prototype,"activeTooltipInfo",null),d=n([_("esri.views.draw.DrawGraphicTool")],d);const N=Symbol("create-operation-graphic"),y={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function oi(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Ge=48;function ni(t,e){return kt(t,e,!1)}function si(t,e){return kt(t,e,!0)}function kt(t,e,i){if(t instanceof ue){if(t.operation instanceof he)return Se(t.operation,e,i),!0;if(t.operation instanceof me)return Re(t.operation,e,i),!0;if(t.operation instanceof ye)return Ee(t.operation,e,i),!0}return!1}function Se(t,e,i=!1){const o=i?-1:1,r=Nt(o*t.dx,o*t.dy,o*t.dz);j(e.origin,e.origin,r),H(e)}function Re(t,e,i=!1){const o=i?-t.angle:t.angle;et(e.basis1,e.basis1,it,o),et(e.basis2,e.basis2,it,o),H(e)}function Ee(t,e,i=!1){const o=i?1/t.factor1:t.factor1,r=i?1/t.factor2:t.factor2;ot(e.basis1,e.basis1,o),ot(e.basis2,e.basis2,r),nt(e.origin,e.origin,t.origin,t.axis1,o),nt(e.origin,e.origin,t.origin,t.axis2,r),H(e)}function ri(t,e,i,o,r=!1){o||(o=Dt());const a=I(P.get(),t[1],-t[0]),c=I(P.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=I(P.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=P.get(),h=e.allVerticesUnordered;h.forEach(({pos:u})=>{I(l,K(t,u),K(a,u)),Ft(c,c,l),zt(p,p,l)});const g=1e-6,m=I(P.get(),p[0]-c[0]<g?i/2:0,p[1]-c[1]<g?i/2:0);Ht(c,c,m),Lt(p,p,m);const O=r?h.reduce((u,M)=>u+(M.pos[2]??0),0)/h.length:0;return tt(o.basis1,t,(p[0]-c[0])/2),tt(o.basis2,a,(p[1]-c[1])/2),At(o.origin,c[0]*t[0]+c[1]*a[0],c[0]*t[1]+c[1]*a[1],O),j(o.origin,o.origin,o.basis1),j(o.origin,o.origin,o.basis2),H(o),o}export{d as A,oi as M,ri as S,si as T,ni as V};
