import{tW as Bt,Cq as Yt,DH as dt,hY as Se,aE as $e,tV as Xt,aY as Fe,cn as yt,eK as be,a5 as c,x as f,y as Le,a7 as gt,Y as ee,a9 as Qt,ix as en,j as tn,a8 as nn,DI as st,ny as rn,ku as Oe,tP as sn,ec as an,cs as on,DJ as un,xH as ln,bb as cn,qK as ne,am as Y,br as fn,bp as ye,ar as h,fp as T,bi as M,fr as L,aC as G,aq as B,bl as me,DK as He,dZ as J,DL as pn,bs as _e,bj as We,bt as ve,kH as Me,DM as Ze,DN as $t,aI as bt,DO as mt,az as te,aK as ge,aL as hn,kF as k,gM as vt,j3 as dn,DP as yn,bc as w,om as gn,aJ as $n,aP as bn,DQ as mn,uf as vn,DR as xt,kG as wt,n$ as St,bD as xn,DS as wn,oo as Sn,qi as Ln,DT as _n,DU as Mn,DV as Tn,DW as zn,bk as Nn,aw as Dn,DX as kn,DY as it,f2 as Ae,fc as Ce,fd as Ge,DZ as En,os as Lt,ba as re,tq as D,oB as jn,aj as Rn,p2 as qn,p3 as Pn,dH as On,dI as Hn,oV as Zn,D_ as An,p4 as In,tS as _t,fb as je,tU as Vn}from"./index-aRi8Xk-b.js";import{g as Fn}from"./geometry2dUtils-CgYtdIFN.js";import{m as Wn,l as Mt}from"./geodeticLengthOperator-BPMj1oiZ.js";function Tt(t,e,n){return z(t,e,n)}function z(t=0,e=0,n=0){return $e(t,e,n)}function Yr(t){return t}function Xr(t){return t}function K(t,e,n){return $e(t,e,n)}function X(t){const[e,n,r]=t;return t.length>3?[e,n,r,t[3]]:[e,n,r]}function Qr(t){return t[3]=1|((t.length>3?t[3]:void 0)??0),t}function es(t){return!!(1&((t.length>3?t[3]:void 0)??0))}function at(t,e,{coordinateHelper:n,elevationInfo:r},i){return t?Cn(n.vectorToDehydratedPoint(t,Gn),e,r,i):null}function Cn(t,e,n,r=z()){return r[0]=t.x,r[1]=t.y,r[2]=t.z??0,e==null||(e.type==="2d"?r[2]=0:r[2]=Bt(e,t,n,Fe)??0),r}function ts(t,e,n){return n?(dt(n,t[0],t[1],t[2],e),n):Se(t[0],t[1],t[2],e)}function ns(t,e,{z:n,m:r},i,s){const{spatialReference:a,elevationInfo:o}=i;let u;n==null&&r==null?u=void 0:e==null||e.type==="2d"?u=n??void 0:u=Yt(e,t,a,Fe,o)??0;const[l,p]=t;return s?dt(s,l,p,u,a):s=Se(l,p,u,a),r!=null&&(s.m=r,s.hasM=!0),s}function rs(t,e,n,r,i=z()){const[s,a]=t;return i[0]=s,i[1]=a,t.length>3&&(i[3]=t[3]??0),n?.type!=="3d"?(i[2]=e.value,i):(i[2]=Xt(n,s,a,e.value,r,e.elevationInfo,Fe)??0,i)}const Gn=Se(0,0,0,null);let R=class extends yt{constructor(){super(...arguments),this.enabled=!0}};c([f({type:Boolean})],R.prototype,"enabled",void 0),R=c([Le("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],R);let g=class extends yt{constructor(e){super(e),this.lineSnapper=new R,this.parallelLineSnapper=new R,this.rightAngleSnapper=new R,this.rightAngleTriangleSnapper=new R,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new be([255,127,0]),this.orangeTransparent=new be([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([f({type:R,constructOnly:!0,nonNullable:!0,json:{write:!0}})],g.prototype,"lineSnapper",void 0),c([f({type:R,constructOnly:!0,nonNullable:!0,json:{write:!0}})],g.prototype,"parallelLineSnapper",void 0),c([f({type:R,constructOnly:!0,nonNullable:!0,json:{write:!0}})],g.prototype,"rightAngleSnapper",void 0),c([f({type:R,constructOnly:!0,nonNullable:!0,json:{write:!0}})],g.prototype,"rightAngleTriangleSnapper",void 0),c([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],g.prototype,"shortLineThreshold",void 0),c([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],g.prototype,"distance",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],g.prototype,"pointThreshold",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],g.prototype,"intersectionParallelLineThreshold",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],g.prototype,"parallelLineThreshold",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"verticalLineThresholdMeters",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],g.prototype,"touchSensitivityMultiplier",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],g.prototype,"pointOnLineThreshold",void 0),c([f({type:be,nonNullable:!0})],g.prototype,"orange",void 0),c([f({type:be,nonNullable:!0})],g.prototype,"orangeTransparent",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],g.prototype,"lineHintWidthReference",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],g.prototype,"lineHintWidthTarget",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"lineHintFadedExtensions",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],g.prototype,"parallelLineHintWidth",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],g.prototype,"parallelLineHintLength",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],g.prototype,"parallelLineHintOffset",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],g.prototype,"rightAngleHintSize",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],g.prototype,"rightAngleHintOutlineSize",void 0),c([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],g.prototype,"satisfiesConstraintScreenThreshold",void 0),g=c([Le("esri.views.interactive.snapping.Settings.Defaults")],g);const ot=new g;let F=class extends gt{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new ee}};c([f({constructOnly:!0})],F.prototype,"layer",void 0),c([f()],F.prototype,"enabled",void 0),c([f()],F.prototype,"updating",void 0),c([f()],F.prototype,"availability",void 0),c([f()],F.prototype,"sublayerSources",void 0),F=c([Le("esri.views.interactive.snapping.FeatureSnappingLayerSource")],F);let S=class extends gt{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new ee,this.distance=ot.distance,this.touchSensitivityMultiplier=ot.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(ut)&&Qt.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const n=e.filter(Kn),r=this._get("_effectiveFeatureSources")?.filter(ut)??new ee;for(const u of n){const l=r.find(p=>p.layer===u.layer.parent);if(l)l.sublayerSources.includes(u)||l.sublayerSources.add(u);else if(u.layer.parent){const p=new F({layer:u.layer.parent});p.sublayerSources.add(u),r.add(p)}}for(const u of r){const l=u.sublayerSources.filter(p=>!n.includes(p));u.sublayerSources.removeMany(l)}r.removeMany(r.filter(u=>u.sublayerSources.length===0));const i=e.filter(Jn),s=this._get("_effectiveFeatureSources")??new ee,{added:a,removed:o}=en(s.toArray(),[...i,...r]);return s.removeMany(o),s.addMany(a),s}};function ut(t){return t.layer.type==="subtype-group"}function Jn(t){return t.layer.type!=="subtype-group"}function Kn(t){return t.layer.type==="subtype-sublayer"}c([f()],S.prototype,"enabled",void 0),c([f()],S.prototype,"enabledToggled",void 0),c([f()],S.prototype,"forceDisabled",void 0),c([f()],S.prototype,"selfEnabled",void 0),c([f()],S.prototype,"featureEnabled",void 0),c([f()],S.prototype,"gridEnabled",void 0),c([f()],S.prototype,"attributeRulesEnabled",void 0),c([f({type:ee.ofType(F)})],S.prototype,"featureSources",void 0),c([f()],S.prototype,"distance",void 0),c([f()],S.prototype,"touchSensitivityMultiplier",void 0),c([f({readOnly:!0})],S.prototype,"effectiveEnabled",null),c([f({readOnly:!0})],S.prototype,"effectiveGridEnabled",null),c([f({readOnly:!0})],S.prototype,"effectiveSelfEnabled",null),c([f({readOnly:!0})],S.prototype,"effectiveFeatureEnabled",null),c([f({readOnly:!0})],S.prototype,"_effectiveFeatureSources",null),S=c([Le("esri.views.interactive.snapping.SnappingOptions")],S);const os=Symbol("grid-placement-graphic");function Un(t,e){const n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function us(t,e){return Math.sqrt(Un(t,e))}function ls(t,e){e.sort((n,r)=>Oe(n.targetPoint,t)-Oe(r.targetPoint,t))}function cs({parameters:{point:t,distance:e,returnEdge:n,vertexMode:r,coordinateHelper:{spatialReference:i},filter:s},mode:a,returnZ:o,filter:u}){const l=u?.clone()??new an({where:"1=1"});return l.returnZ=o??a==="3d",s&&(l.geometry=s.geometry,l.distance=s.distance,l.spatialRelationship=s.spatialRelationship,l.where=on(l.where,s.where),l.timeExtent=un(l.timeExtent,s.timeExtent),l.objectIds=Bn(l.objectIds,s.objectIds)),{point:Se(t[0],t[1],t[2],i.toJSON()),mode:a,distance:e,returnEdge:n,vertexMode:r,query:l.toJSON()}}function Bn(t,e){return t||e?e?t?Array.from(ln(new Set(t),new Set(e))):e:t:null}function fs(t,e,n){return{left:at(t.leftVertex.pos,e,n),right:at(t.rightVertex.pos,e,n)}}const lt=Symbol("snapping-toggle");function ps(t,e=()=>{}){const n=tn(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:r,snappingOptions:i})=>{if(t.removeHandles(lt),!r||!i)return;const s=rn.TOOL,a=[r.on("key-down",o=>{o.key!==st.toggle||o.repeat||(i.enabledToggled=!0,e())},s),r.on("key-up",o=>{o.key===st.toggle&&(i.enabledToggled=!1,e())},s),r.on("pointer-move",o=>{const u=o.native.ctrlKey;i.enabledToggled!==u&&(i.enabledToggled=u,e())},s)];t.addHandles(a,lt)},nn);t.addHandles(n)}function hs(t){return sn(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function ds(t){return t?.type==="line"}function Je({start:t,end:e,type:n},r,i){const s=[],a=Y(se,e,t),o=Y(Te,t,r),u=ve(a),l=2*_e(a,o),p=l*l-4*u*(ve(o)-i*i);if(p===0){const d=-l/(2*u);(n===0||d>=0)&&s.push(ye(B(),t,a,d))}else if(p>0){const d=Math.sqrt(p),b=(-l+d)/(2*u);(n===0||b>=0)&&s.push(ye(B(),t,a,b));const $=(-l-d)/(2*u);(n===0||$>=0)&&s.push(ye(B(),t,a,$))}return s}function zt(t,e){const n=t.start,r=t.end,i=Y(se,r,n),s=G(Ne,-i[1],i[0],0),a=e.start,o=e.end,u=T(Ue,o,a),l=M(u,s),p=G(Pt,n[0],n[1],0),d=T(Ot,p,a),b=M(d,s),$=ne();if(Math.abs(l)<$)return[];const x=L(Ht,a,u,b/l);if(e.type===0){const _=T(Ie,x,a);if(M(_,u)<-$)return[]}if(t.type===1){const _=pn(Te,x,n);if(_e(_,i)<-$)return[]}return[J(x)]}function Yn(t,e){return Qn(xe(Be,e[2],t),e)}function Nt(t,e){return Rt(xe(Be,0,t),xe(rr,0,e)).map(([r,i])=>ge(r,i))}function Dt(t,e,n){return Et(t,xe(Be,t[2],e),n)}function kt(t,e,n,r=h()){const i=Y(se,t,e),s=fn(i);return ye(r,e,i,s===0?1:n/s),r[2]=t[2],r}function Et(t,{start:e,end:n,type:r},i=h()){const s=T(ze,t,e),a=T(Ne,n,e),o=M(s,a)/M(a,a);return L(i,e,a,r===0?Math.max(o,0):o)}const Xn=(()=>{const t=h(),e=h(),n=h();return({start:r,end:i},{center:s,radius:a,normal:o,slicePlane:u})=>{const l=Me(s,o,nr);if(y(Ze(l,r),0)&&y(Ze(l,i),0)){$t(o,t,e);const d=(x,_)=>(We(n,_,s),vt(x,M(n,t),M(n,e)),x),b=Fn({start:d(se,r),end:d(Te,i)},dn,a),$=[];for(const[x,_]of b){const N=bt(h(),s);L(N,N,t,x),L(N,N,e,_),u&&!C(u,N)||$.push(N)}return $}const p=h();return mt(l,r,i,p)?!y(te(p,s),a)||u&&!C(u,p)?[]:[p]:[]}})();function jt({start:t,end:e,type:n},r,i){const s=[],a=We(ze,e,t),o=Y(Te,t,r),u=ve(a),l=2*_e(a,o),p=l*l-4*u*(ve(o)-i*i);if(p===0){const d=-l/(2*u);(n===1||d>=0)&&s.push(L(h(),t,a,d))}else if(p>0){const d=Math.sqrt(p),b=(-l+d)/(2*u);(n===1||b>=0)&&s.push(L(h(),t,a,b));const $=(-l-d)/(2*u);(n===1||$>=0)&&s.push(L(h(),t,a,$))}return s}function Rt(t,e){const n=t.start,r=t.end,i=e.start,s=e.end,a=T(ze,r,n),o=T(Ne,s,i),u=T(Ue,i,n),l=me(Pt,a,o);if(!y(M(u,l),0))return[];const p=He(l);if(y(p,0))return[];const d=me(Ot,u,o),b=M(d,l)/p,$=L(Ht,n,a,b);if(t.type===0){const x=T(Ie,$,n);if(M(a,x)<-ne())return[]}if(e.type===0){const x=T(Ie,$,i);if(M(o,x)<-ne())return[]}return[J($)]}function Qn({start:t,end:e,type:n},r){const i=T(ze,r,t),s=T(Ne,e,t),a=me(Ue,s,i),o=He(a)/He(s),u=ne();if(o<u)switch(n){case 1:return[J(r)];case 0:return M(s,i)<-u?[]:[J(r)]}return[]}function Ke(t,e,n,r){const[i,s]=t,[a,o]=n,u=a-i,l=o-s,p=u*u+l*l,d=Math.sqrt(p);if(d>e+r)return[];if(d<Math.abs(e-r))return[];if(y(d,0)&&y(e,r))return[];const b=(e*e-r*r+p)/(2*d),$=Math.sqrt(e*e-b*b),x=$*l/d,_=$*u/d,[N,U]=hn(se,t,n,b/d);return y(x,_)?[ge(N,U)]:[ge(N+x,U-_),ge(N-x,U+_)]}function xe(t,e,{start:n,end:r,type:i}){return G(t.start,n[0],n[1],e),G(t.end,r[0],r[1],e),t.type=tr[i],t}function qt(t,e){return y(t[2],e[2])}function y(t,e){return cn(Math.abs(t-e),0,ne())}function er(t,e){return e.filter(n=>C(t,n))}function C(t,e){return yn(t,e)}const tr={0:1,1:0},se=B(),Te=B(),ze=h(),Ne=h(),Ue=h(),Pt=h(),Ot=h(),Ht=h(),Ie=h(),nr=k(),Be={start:h(),end:h(),type:1},rr={start:h(),end:h(),type:1};class E{intersect(e){return Z(this,e)}closestPoints(e){return[this.closestTo(e)]}}class ie extends E{constructor(e){super(),this.point=e}equals(e){return this===e||j(e)&&w(this.point,e.point)}closestTo(){return X(this.point)}}class Ye extends E{constructor(e,n,r){super(),this.start=e,this.end=n,this.lineLike={start:e,end:n,type:r}}equals(e){return this===e||P(e)&&this.lineLike.type===e.lineLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const n=z();return Et(e,this.lineLike,n),n}}class Zt extends Ye{constructor(e,n){super(e,n,1)}}class sr extends Ye{constructor(e,n){super(e,n,0)}}class At extends E{constructor(e){super(),this.constraints=e}equals(e){return this===e||Ve(e)&&xn(this.constraints,e.constraints,(n,r)=>n.equals(r))}closestTo(e){let n,r=1/0;for(const i of this.constraints){const s=i.closestTo(e),a=Oe(e,s);a<r&&(r=a,n=s)}return X(n??e)}closestPoints(e){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(e))}}class ir extends E{constructor(e,n){super(),this.center=e,this.radius=n}equals(e){return this===e||H(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const n=z();return kt(e,this.center,this.radius,n),n}}class Xe extends E{constructor(e,n){super(),this.center=e,this.radius=n}equals(e){return this===e||I(e)&&w(this.center,e.center)&&this.radius===e.radius}closestTo(e){const n=z();return kt(e,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new Qe(X(this.center),this.radius,K(0,0,1))}}class Qe extends E{constructor(e,n,r,i=void 0){super(),this.center=e,this.radius=n,this.normal=r,this.slicePlane=i}equals(e){return this===e||W(e)&&w(this.center,e.center)&&w(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:n,radius:r}=this;xt(this.getPlane(ar),e,Re);const i=T(Re,Re,n),s=Sn(i);if(y(s,0))return X(e);const a=r/Math.sqrt(s),o=z();L(o,n,i,a);const{slicePlane:u}=this;return u&&!C(u,o)?tt(u,this)?.closestTo(e)??X(e):o}getPlane(e=k()){return Me(this.center,this.normal,e)}}const Re=h(),ar=k();class or extends E{constructor(e){super(),this.z=e}equals(e){return this===e||A(e)&&this.z===e.z}closestTo(e){return K(e[0],e[1],this.z)}getPlane(e=k()){return G(ct,0,0,this.z),Me(ct,wn,e)}}const ct=h();class et extends E{constructor(e,n,r){super(),this.start=e,this.end=n,this.planeLike={start:e,end:n,type:r}}equals(e){return this===e||O(e)&&this.planeLike.type===e.planeLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const n=z();return Dt(e,this.planeLike,n),n}closestEndTo(e){const{start:n,end:r}=this.planeLike;return Math.sign(_e(Y(ur,r,n),Y(lr,e,n)))>0?this.end:this.start}getPlane(e=k()){const n=bt(ft,this.end);return n[2]+=1,gn(this.start,this.end,n,e)}getSlicePlane(e=k()){const{start:n,end:r,type:i}=this.planeLike;if(i===0)return;const s=G(ft,n[0],n[1],0),a=G(pt,r[0],r[1],0),o=We(pt,a,s);return Me(s,o,e),e}}const ur=B(),lr=B(),ft=h(),pt=h();class ys extends et{constructor(e,n){super(e,n,1)}}class gs extends et{constructor(e,n){super(e,n,0)}}class cr extends E{constructor(e,n){super(),this.sphere=Ln(e,n),this._center=J(e)}equals(e){return this===e||V(e)&&_n(this.sphere,e.sphere)}closestTo(e){const n=z();return Mn(this.sphere,e,n),n}get center(){return this._center}get radius(){return this.sphere[3]}}class fr extends E{constructor(e,n,r){super(),this.start=e,this.end=n,this.getZ=r,this.planeLike={start:e,end:n,type:0}}equals(e){return this===e||we(e)&&w(this.start,e.start)&&w(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return $r(this,e)}addIfOnTheGround(e,n){for(const r of n){const i=this.getZ(r[0],r[1])??0;y(r[2],i)&&(r[2]=i,e.push(r))}}}class pr extends E{constructor(e,n,r){super(),this._x=e,this._y=n,this._z=r}equals(e){return this===e||jr(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,n,r]){return Tt(this._x??e,this._y??n,this._z??r)}}class hr extends E{constructor(e,n,r,i,s){super(),this._origin=e,this._spatialReference=n,this._distanceMeters=r,this._z=i,this._directionDegrees=s}equals(e){return this===e||Er(e)&&it(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,n,r]){return vt(Q,e,n),it(Q,this._origin)||this._applyDirectionAndDistance(Q),Tt(Q[0],Q[1],this._z??r)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Ae(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)yr(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=Ce(dr,this._origin,e,this._spatialReference);Ae(e,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const Q=[0,0],dr=new Ge;function yr(t,e,n,r,i){let{azimuth:s,distance:a}=Ce(gr,e,r,i);s??=0;let o=a*Math.cos((s-n)*En);o=Math.max(0,o),Ae(t,e,n,o,i)}const gr=new Ge;function $r(t,e){const n=z();return Dt(e,t.planeLike,n),n[2]=t.getZ(n[0],n[1])??Vt,n}function Z(t,e){if(Ve(t)){const n=[];for(const r of t.constraints){const i=r.intersect(e);i&&n.push(i)}return nt(n)}if(Ve(e))return Z(e,t);if(we(t))return ht(t,e);if(we(e))return ht(e,t);if(j(t)){const{point:n}=t;if(j(e))return w(n,e.point)?t:void 0;const r=e.closestTo(n);return $n(r,n)?t:void 0}if(P(t)){if(j(e))return Z(e,t);if(P(e))return q(Rt(t.lineLike,e.lineLike));if(A(e))return br(t,e);if(O(e))return q(zt(e.planeLike,t.lineLike));if(H(e))return q(jt(t.lineLike,e.center,e.radius));if(W(e))return q(Xn(t.lineLike,e));if(I(e))return mr(t,e);if(V(e))return vr(t,e)}else if(A(t)){if(j(e)||P(e))return Z(e,t);if(A(e))return xr(t,e);if(O(e))return wr(t,e);if(H(e))return Sr(t,e);if(W(e))return _r(t,e);if(I(e))return Lr(t,e);if(V(e))return Mr(t,e)}else if(O(t)){if(j(e)||P(e)||A(e))return Z(e,t);if(O(e))return qe(Nt(t.planeLike,e.planeLike));if(H(e))return qe(Je(t.planeLike,e.center,e.radius));if(W(e))return zr(t,e);if(I(e))return Tr(t,e);if(V(e))return Nr(t,e)}else if(H(t)){if(j(e)||P(e)||A(e)||O(e))return Z(e,t);if(H(e))return qe(Ke(t.center,t.radius,e.center,e.radius));if(W(e))return void 0;if(I(e))return Dr(t,e);if(V(e))return void 0}else if(W(t)){if(j(e)||P(e)||A(e)||O(e)||H(e))return Z(e,t);if(W(e))return void 0;if(I(e))return e.asCircle(),void 0;if(V(e))return void 0}else if(I(t)){if(j(e)||P(e)||A(e)||O(e)||H(e)||W(e))return Z(e,t);if(I(e))return kr(e,t);if(V(e))return void 0}else if(V(t)){if(j(e)||P(e)||A(e)||O(e)||H(e)||I(e))return Z(e,t);if(V(e))return void 0}}const br=(()=>{const t=k();return(e,n)=>{const{start:r,end:i}=e;if(qt(r,i)&&y(r[2],n.z))return e;const s=z();return mt(n.getPlane(t),r,i,s)?new ie(s):void 0}})();function mr({lineLike:t},{center:e,radius:n}){const r=e[2];return q(jt(t,e,n).filter(i=>y(i[2],r)))}function vr({lineLike:t},{sphere:e}){return q(mn(e,t.start,t.end))}const tt=(()=>{const t=Dn(),e=h(),n=h();return(r,i,s)=>{const{normal:a,center:o,radius:u}=i;$t(a,e,n);const l=wt(r),p=u*M(l,e),d=u*M(l,n);Tn(t,o[0],o[1],o[2],1);const b=zn(r,t),$=Math.hypot(p,d),x=y($,0);if(y(Ze(r,o),0)){if(x)return i;if(y(u,0))return!s||C(s,o)?new ie(X(o)):void 0;me(e,l,a),Nn(e,e);const Ee=new Array,le=J(o);L(le,le,e,u),s&&!C(s,le)||Ee.push(le);const ce=J(o);return L(ce,ce,e,-u),s&&!C(s,ce)||Ee.push(ce),q(Ee)}if(x)return;const _=-b/$;if(Math.abs(_)>1||y(_,1))return;const N=Math.atan(p/d),U=kn(_)-N,rt=Math.PI-U,ae=new Array,oe=h();L(oe,o,e,u*Math.cos(U)),L(oe,oe,n,u*Math.sin(U)),ae.push(oe);const ue=h();return L(ue,o,e,u*Math.cos(rt)),L(ue,ue,n,u*Math.sin(rt)),ae.push(ue),q(s?er(s,ae):ae)}})();function xr(t,e){return y(t.z,e.z)?t:void 0}function wr({z:t},{planeLike:e}){const[n,r]=e.start,[i,s]=e.end,a=K(n,r,t),o=K(i,s,t);return e.type===0?new Zt(a,o):new sr(a,o)}function Sr(t,e){const[n,r]=e.center;return new Xe(K(n,r,t.z),e.radius)}function Lr(t,e){return y(e.center[2],t.z)?e:void 0}const _r=(()=>{const t=k();return(e,n)=>tt(e.getPlane(t),n,n.slicePlane)})();function Mr(t,{center:e,radius:n}){const r=Math.abs(e[2]-t.z);if(r>n&&!y(r,n))return;const i=K(e[0],e[1],t.z),s=Math.sqrt(n**2-r**2);return y(s,0)?void 0:new Xe(i,s)}const Tr=(()=>{const t=k();return(e,{center:n,radius:r})=>{const i=Je(e.planeLike,n,r),s=n[2];e.getSlicePlane(t);const a=new Array;for(const[o,u]of i){const l=[o,u,s];C(t,l)&&a.push(l)}return q(a)}})(),zr=(()=>{const t=k(),e=k();return(n,r)=>tt(n.getPlane(t),r,n.getSlicePlane(e))})(),Nr=(()=>{const t=k();return(e,{center:n,radius:r})=>{const i=e.getPlane(t),s=vn(i,n),a=Math.abs(s);if(a>r&&!y(a,r))return;const o=Math.sqrt(r**2-s**2);if(y(o,0)){const p=z();return xt(i,n,p),new ie(p)}const u=z(),l=J(wt(i));return L(u,n,l,s),new Qe(u,o,l,e.getSlicePlane())}})();function Dr(t,e){const n=St(t.center,e.center);return y(n,0)&&y(t.radius,e.radius)?e:It(Ke(t.center,t.radius,e.center,e.radius),e.center[2])}function kr(t,e){if(!qt(t.center,e.center))return;const n=St(t.center,e.center);return y(n,0)&&y(t.radius,e.radius)?t:It(Ke(t.center,t.radius,e.center,e.radius),t.center[2])}function ht(t,e){const{planeLike:n,getZ:r}=t,i=new Array;if(j(e))t.addIfOnTheGround(i,Yn(n,e.point));else if(P(e))t.addIfOnTheGround(i,zt(n,e.lineLike));else if(H(e))for(const[s,a]of Je(n,e.center,e.radius)){const o=r(s,a);o!=null&&i.push($e(s,a,o))}else if(O(e)||we(e))for(const[s,a]of Nt(n,e.planeLike)){const o=r(s,a)??Vt;i.push($e(s,a,o))}return q(i)}function qe(t){return nt(t.map(([e,n])=>{const r=K(e,n,0),i=K(e,n,1);return new Zt(r,i)}))}function q(t){return nt(t.map(e=>e?new ie(e):void 0))}function It(t,e){return q(t.map(([n,r])=>[n,r,e]))}function nt(t){if(t.length!==0)return t.length===1?t[0]??void 0:new At(t.filter(bn))}function Ve(t){return t instanceof At}function j(t){return t instanceof ie}function P(t){return t instanceof Ye}function A(t){return t instanceof or}function O(t){return t instanceof et}function H(t){return t instanceof ir}function I(t){return t instanceof Xe}function W(t){return t instanceof Qe}function V(t){return t instanceof cr}function we(t){return t instanceof fr}function Er(t){return t instanceof hr}function jr(t){return t instanceof pr}const Vt=0;let De=class{constructor(e,n){this.isDraped=e,this.domain=n}};class Ft extends De{constructor(e,n,r,i,s=3,a=!0,o=!0){super(i,s),this.type=e,this.lineStart=n,this.lineEnd=r,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof Ft&&this.type===e.type&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return te(this.lineStart,this.lineEnd)}}class Wt extends De{constructor(e,n,r=3){super(n,r),this.intersectionPoint=e}equals(e){return e instanceof Wt&&w(this.intersectionPoint,e.intersectionPoint)}}let bs=class Ct extends De{constructor(e,n,r,i=3){super(r,i),this.lineStart=e,this.lineEnd=n}equals(e){return e instanceof Ct&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)}},ms=class Gt extends De{constructor(e,n,r,i,s=3){super(i,s),this.previousVertex=e,this.centerVertex=n,this.nextVertex=r}equals(e){return e instanceof Gt&&w(this.previousVertex,e.previousVertex)&&w(this.centerVertex,e.centerVertex)&&w(this.nextVertex,e.nextVertex)}};function Rr(t){const{spatialReference:e}=t;return Lt(e,Zr,Ar,t)}function qr(t,e){if(!re(t.spatialReference,e.spatialReference))return null;const{spatialReference:n}=t;return fe[0]=t.x,fe[1]=t.y,fe[2]=t.hasZ?t.z:0,pe[0]=e.x,pe[1]=e.y,pe[2]=e.hasZ?e.z:0,Jt(fe,pe,n)}function Jt(t,e,n){return Lt(n,Or,Hr,t,e,n)}const Pr={geodesicLength:Rr,geodesicDistanceBetweenPoints:qr,geodesicDistance:Jt};async function vs(){return await Wn(),Pr}function Or(t,e,n){return D(Ce(Vr,t,e,n).distance,"meters")}function Hr(t,e,n){return D(Mt(Ir(t,e,n),{unit:"meters"}),"meters")}function Zr(t){return D(jn([t],"meters")[0],"meters")}function Ar(t){return D(Mt(t,{unit:"meters"}),"meters")}function Ir(t,e,n){return new Rn({spatialReference:n,paths:[[[...t],[...e]]]})}const Vr=new Ge,fe=h(),pe=h();function Kt(t){return Pn(t)?On(t)||Hn(t)||Zn(t)||An(t)?qn:t:In(t)}function xs(t){return Fr(t)}function Fr(t,e){const{hasZ:n,spatialReference:r}=t,i=Kt(r);let s=0;const a=_t(i);if(a==null)return null;const o=Ut;for(const u of t.paths){if(u.length<2)continue;const l=u.length-1;for(let p=0;p<l;++p){const d=u[p];m[0]=d[0],m[1]=d[1],m[2]=n?d[2]:0;const b=u[p+1];v[0]=b[0],v[1]=b[1],v[2]=n?b[2]:0;const $=o(m,v,r);if($==null)return null;s+=$.value}}return D(s,a)}function ws(t,e){const{spatialReference:n}=t;return re(n,e.spatialReference)?(m[0]=t.x,m[1]=t.y,m[2]=t.hasZ?t.z:0,v[0]=e.x,v[1]=e.y,v[2]=e.hasZ?e.z:0,Cr(m,v,n)):null}function Ss(t,e){const{spatialReference:n}=t;return re(n,e.spatialReference)?(m[0]=t.x,m[1]=t.y,m[2]=t.hasZ?t.z:0,v[0]=e.x,v[1]=e.y,v[2]=e.hasZ?e.z:0,Gr(m,v,n)):null}function Ls(t,e){const{spatialReference:n}=t;return re(n,e.spatialReference)?(m[0]=t.x,m[1]=t.y,m[2]=t.hasZ?t.z:0,v[0]=e.x,v[1]=e.y,v[2]=e.hasZ?e.z:0,Ut(m,v,n)):null}function _s(t,e){const{spatialReference:n}=t;return re(n,e.spatialReference)?(m[0]=t.x,m[1]=t.y,m[2]=t.hasZ?t.z:0,v[0]=e.x,v[1]=e.y,v[2]=e.hasZ?e.z:0,Jr(m,v,n)):null}function Ms(t){return t!=null?Wr(t.hasZ?t.z:0,t.spatialReference):null}function Wr(t,e){const n=Vn(e);return n!=null?D(t??0,n):null}function Cr(t,e,n){const r=ke(t,e,n);return r!=null?{direct:D(r.direct,r.unit),horizontal:D(r.horizontal,r.unit),vertical:D(r.vertical,r.unit)}:null}function Gr(t,e,n){const r=ke(t,e,n,0);return r!=null?D(r.direct,r.unit):null}function Ut(t,e,n){const r=ke(t,e,n,1);return r!=null?D(r.horizontal,r.unit):null}function Jr(t,e,n){const r=ke(t,e,n,2);return r!=null?D(r.verticalSigned,r.unit):null}function ke(t,e,n,r){const i=Kt(n),s=_t(i);if(s==null)return null;const a=e[2]-t[2];if(r===2)return{verticalSigned:a,unit:s};if(!je(t,n,Pe,i)||!je(e,n,he,i))return null;if(r===0)return{direct:te(he,Pe),unit:s};if(G(de,t[0],t[1],e[2]),!je(de,n,de,i))return null;const o=te(de,he);return r===1?{horizontal:o,unit:s}:{direct:te(he,Pe),horizontal:o,vertical:Math.abs(a),unit:s}}const m=h(),v=h(),Pe=h(),he=h(),de=h();export{es as A,Yr as B,Cn as C,ys as D,ns as E,pr as F,ir as G,nt as H,rs as I,j as J,Ms as K,Un as L,or as M,ds as N,fs as O,Et as P,fr as Q,Zt as R,gs as S,Wr as T,hr as U,Ss as V,Gr as W,_s as X,Jr as Y,Ut as Z,ws as _,Ft as a,ms as b,De as c,xs as d,F as e,os as f,vs as g,z as h,Wt as i,Qr as j,K as k,Tt as l,Ls as m,ie as n,cs as o,ot as p,Kt as q,bs as r,Xr as s,at as t,S as u,us as v,ps as w,hs as x,ls as y,ts as z};
