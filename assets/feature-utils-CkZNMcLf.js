import{a0 as u}from"./index-Brd6-W-v.js";function l(e){return e!=null&&typeof e=="object"&&"type"in e&&e.type==="feature"}function g(e){return l(e)&&e?.type==="feature"&&e.source?.type==="feature-layer"}function a(e){return l(e)&&g(e)}const c=/^\s*expression\//iu,y=/href=(""|'')/giu,h=/(\{([^{\r\n]+)\})/gu,N=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/giu,I=/'/gu,C="relationships/",w=/^(?:mailto:|tel:)/u;function k(e,n){const r=new Map;if(!e)return r;for(const t of e){if(!t.fieldName)continue;const o=s(t.fieldName,n);t.fieldName=o,r.set(o.toLowerCase(),t)}return r}function O(e){const n=[];if(!e)return n;const{fieldInfos:r,content:t}=e;return r&&n.push(...r),!t||!Array.isArray(t)||t.forEach(o=>{if(o.type==="fields"){const i=o?.fieldInfos;i&&n.push(...i)}}),n}function P(e,n){return e?.getEffectivePopupTemplate(n)??void 0}function R(e){if(e!=null)return"sourceLayer"in e&&e.sourceLayer?e.sourceLayer:e.layer??void 0}function L(e=""){return e?e.includes(C):!1}function U(e=""){if(e)return!w.test(e.trim().toLowerCase())}function s(e,n){const r=m(n,e);return r?r.name:e}function W(e,n){return e?.map(r=>s(r,n))}function d(e){return e?c.test(e):!1}function A(e,n){if(!n||!d(n)||!e)return;const r=n.replace(c,"").toLowerCase();return e.find(({name:t})=>t.toLowerCase()===r)}function q(e,n){if(!(!e?.length||!n))return e.find(r=>r.fieldName?.toLowerCase()===n.toLowerCase())}function F({fieldInfo:e,graphic:n}){return!!e?.fieldName&&!d(e.fieldName)&&!L(e.fieldName)&&!n?.isAggregate&&!n?.popupTemplate}function z({expressionInfos:e,fieldInfo:n,graphic:r,isContentFieldInfos:t,layer:o}){if(!n?.fieldName)return null;const i=A(e,n?.fieldName);if(i)return i.title||null;if(a(o)&&F({fieldInfo:n,graphic:r})){const f=o.getFieldAlias(n.fieldName);return t?n.label||f||n.fieldName:f||n.fieldName}return n.label||n.fieldName}function H({fieldInfo:e,isContentFieldInfos:n,layer:r}){if(!e?.fieldName)return null;if(a(r)){const t=r?.getFieldConfiguration?.(e.fieldName)?.fieldFormat;return n&&e.fieldFormat||t}return null}function p(e){return e.trim()}function v(e){return e.replaceAll(y,"")}function b(e,n){return`{${n.get(e.toLowerCase())?.fieldName||e}}`}function x({formattedValues:e,template:n,fieldInfoMap:r}){return p(v(u(u(n,t=>b(t,r)),e)))}function m(e,n){return!(e&&"getField"in e&&typeof e.getField=="function")||!n?null:e.getField(n)??null}function M(e,n){return e.replaceAll(h,(r,t,o)=>{const i=m(n,o);return i?`{${i.name}}`:t})}function $(e,n,r=!1){const t=n[e];if(typeof t=="string"){const o=(r?encodeURIComponent(t):t).replaceAll(I,"%27");n[e]=o}}function E(e,n=!1){const r={...e};return Object.keys(r).forEach(t=>$(t,r,n)),r}function V(e,n,r){n=p(n);const t=n&&!n.startsWith("{");return u(e,E(r,t||!1))}function j(e,n,r){const t=M(e,r);return t&&t.replaceAll(N,(o,i,f)=>V(o,i||f,n))}function _({values:e,globalValues:n,layer:r,text:t,fieldInfoMap:o}){return t?x({formattedValues:n,template:j(t,{...n,...e},r),fieldInfoMap:o}):""}async function B({type:e,value:n,event:r}){try{return typeof n=="function"?n(r):await n}catch(t){console.error(`[arcgis-feature] An error occurred when calling the "${e}" function`,{error:t,graphic:r.graphic,value:n});return}}export{q as $,L as A,P as H,R as M,U as O,W as P,x as T,z as U,H as W,B as _,F as b,a as c,d,k as j,M as k,s as l,_ as q,O as z};
