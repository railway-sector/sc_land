import{r as A,l as I,p as z}from"./number-D1l_YqpP.js";import{ad as Z,ag as R,a2 as G,bz as X,b5 as F,nB as j,aP as k,lB as O,Z as p,$ as g,a0 as q,z as T}from"./index-CVzGOCNQ.js";import{P as U,G as H,T as J,w as K,R as L,v as Q,M as V,p as tt}from"./coordinateFormatter-BlmOo1oI.js";function et(t,n){const e=N(n);return[t[0].toFixed(e),t[1].toFixed(e)]}function N(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function it(t,n){const e=t.includes(",")?",":" ",[a,u,h]=t.split(e).map(l=>{const b=l.trim();return b?Number(b):null});if(!D(a)||!D(u))return null;const c=new Z({x:a,y:u,spatialReference:n||R.WGS84});return h&&(c.z=h,c.hasZ=!0),c}function D(t){return typeof t=="number"&&isFinite(t)}function M(t){return!!t&&D(t.x)&&D(t.y)}function C(t,n){if(t.spatialReference.isGeographic&&n){const[e,a]=et([t.x,t.y],n);return`${e}, ${a}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}const nt=["dd","dms","ddm","mgrs","usng","utm"];function ut(t){return nt.includes(t)}let d=class extends G{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(t){this._currentPattern=t}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){return this.name==="basemap"?this._viewSpatialReference:this.conversionInfo?.spatialReference??R.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.viewModel?.view?.spatialReference??R.WGS84}get _additionalCharactersPattern(){const t=this.coordinateSegments;if(!t)return null;const n=t.map(a=>a.alias),e=this.currentPattern.replaceAll(new RegExp(`["nsew${n.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${e}]`,"g")}get test(){}async convert(t){if(!M(t))throw new X("format:invalid-point","Could not convert invalid point.",{point:t});const n=this.conversionInfo?.convert;if(n)return Promise.resolve().then(()=>n(t));const e=this._project(t,this.spatialReference);return{location:e,coordinate:this._getCoordinate(e)}}getConversionStrategy(){const t=this._viewSpatialReference;return this.conversionInfo?.convert||this.viewModel?.formatterAvailable||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let n=this.currentPattern;const e=this._getSegmentMatches(t,!1);for(let a=this.coordinateSegments.length-1;a>=0;a--){const u=this.coordinateSegments[a];n=n.replace(u.alias,e[a])}return n}_parseUserInput(t){const{defaultPattern:n,_additionalCharactersPattern:e,coordinateSegments:a}=this;if(!n||!e)return"";let u=n.replace(e,"");t=t.replace(e,"");const h=this._getSegmentMatches(t,!0);if(a)for(let c=a.length-1;c>=0;c--){const l=a[c];u=u.replace(l.alias,h[c])}return u}_getSegmentMatches(t,n){const e=new Array,{coordinateSegments:a}=this;if(!a)return e;for(let u=0;u<a.length;u++){const h=a[u],c=t.match(h.searchPattern);if(!c){e.push("");continue}let l=c[0];if(t=t.replace(l,"").trim(),h.substitution){const b=n?h.substitution.input(l):h.substitution.output(l);b&&(l=`${b}`)}e.push(l)}return e}async reverseConvert(t){const n=this._parseUserInput(t),e=this.conversionInfo?.reverseConvert;let a;if(e)a=e(n);else if(this.name==="xy"||this.name==="basemap")a=it(n,this.spatialReference);else if(this.viewModel?.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":a=K(n,this.spatialReference);break;case"mgrs":{a=J(n,this.spatialReference,"automatic");break}case"utm":{a=H(n,this.spatialReference,"latitude-band-indicators");break}case"usng":a=U(n,this.spatialReference);break;default:a=null}if(!a)throw new X("format:invalid-input","Could not parse input into point.",{coordinate:t});return this._project(a,this._viewSpatialReference)}_getCoordinate(t){const n=this.viewModel?.view?.scale??0;if(!M(t))throw new X("format:invalid-point","Could not transform invalid point into coordinate.",{point:t});if(this.viewModel?.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{const e=N(n);return tt(t,this.name,e)}case"mgrs":return V(t,"automatic",5,!1);case"usng":return Q(t,5,!1);case"utm":return L(t,"latitude-band-indicators",!0);default:return C(t,n)}return C(t,n)}_project(t,n){if(F(t.spatialReference,n)||!n)return t;if(this.viewModel?.formatterAvailable&&j())return k(t,n);if(!this.viewModel?.formatterAvailable){const e=O(t,n);if(e!=null)return e}return null}};p([g()],d.prototype,"conversionInfo",void 0),p([g()],d.prototype,"coordinateSegments",void 0),p([g()],d.prototype,"currentPattern",null),p([g()],d.prototype,"_currentPattern",void 0),p([g()],d.prototype,"label",null),p([g()],d.prototype,"defaultPattern",void 0),p([g({readOnly:!0})],d.prototype,"hasDisplayProperties",null),p([g()],d.prototype,"name",void 0),p([g({type:R})],d.prototype,"spatialReference",null),p([g()],d.prototype,"viewModel",void 0),p([g({readOnly:!0})],d.prototype,"_viewSpatialReference",null),p([g({readOnly:!0})],d.prototype,"_additionalCharactersPattern",null),d=p([q("esri.widgets.CoordinateConversion.support.Format")],d);const v=d,P=A().decimal,w={N:"north",S:"south",E:"east",W:"west"},o="°‎",S=new RegExp(`-?\\d+[\\.|\\${P}]?\\d*`),at=/^[\\0]+(?=\d)/;function dt(t,n){const e=T()==="ar",a=t.abbreviatedDirections.north,u=t.abbreviatedDirections.south,h=t.abbreviatedDirections.east,c=t.abbreviatedDirections.west,l=A().decimal,b={[a]:"N",[u]:"S",[h]:"E",[c]:"W"},Y=new RegExp(`-?\\d+[\\.|\\${l}]?\\d*`),y=new RegExp(`N|S|${a}|${u}`,"i"),E=new RegExp(`E|W|${h}|${c}`,"i"),_={ddm:`Y${o} A'${t.abbreviatedDirections.north}, X${o} B'${t.abbreviatedDirections.east}`,dms:`Y${o} A' B"${t.abbreviatedDirections.north}, X${o} C' D"${t.abbreviatedDirections.east}`,dd:`Y${o}${t.abbreviatedDirections.north}, X${o}${t.abbreviatedDirections.east}`,xy:`X${o}, Y${o}`,basemap:"X, Y"},W={ddm:`${t.abbreviatedDirections.north}${o}Y 'A ,${t.abbreviatedDirections.east}${o}X 'B`,dms:`${t.abbreviatedDirections.north}${o}Y 'A "B ,${t.abbreviatedDirections.east}${o}X 'C "D`,dd:`${t.abbreviatedDirections.north}${o}Y ,${t.abbreviatedDirections.east}${o}X`,xy:`X${o} ,Y${o}`,basemap:"X ,Y"},B=m=>m!=null&&Object.keys(_).includes(m),f=new RegExp(`\\d{1,2}[\\.|\\${l}]?\\d*`,"i"),x=new RegExp(`\\d{1,3}[\\.|\\${l}]?\\d*`,"i");n.forEach(m=>{const{name:$}=m;if($==="dd"?m.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:y,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}},{alias:"X",description:"degrees longitude",searchPattern:x,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:E,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}}]:$==="ddm"?m.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"A",description:"minutes latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:y,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}},{alias:"X",description:"degrees longitude",searchPattern:x,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"B",description:"minutes longitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:E,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}}]:$==="dms"?m.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"A",description:"minutes latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"B",description:"seconds latitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:y,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}},{alias:"X",description:"degrees longitude",searchPattern:x,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"C",description:"minutes longitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"D",description:"seconds longitude",searchPattern:f,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:E,substitution:{input:i=>b[i],output:i=>t.abbreviatedDirections[w[i]]}}]:(m.name==="xy"||m.name==="basemap")&&(m.coordinateSegments=[{alias:"X",description:"easting",searchPattern:Y,substitution:{input:i=>r(i),output:i=>s(i)}},{alias:"Y",description:"northing",searchPattern:Y,substitution:{input:i=>r(i),output:i=>s(i)}}]),B($)){const i=e?W[$]:_[$];m.defaultPattern=i,m.currentPattern=i}})}function ct(){const t=new RegExp("N|S","i"),n=new RegExp("E|W","i");return[new v({name:"basemap",coordinateSegments:[{alias:"X",description:"easting",searchPattern:S,substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"Y",description:"northing",searchPattern:S,substitution:{input:e=>r(e),output:e=>s(e)}}],defaultPattern:"X, Y",viewModel:null}),new v({name:"dd",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${P}]?\\d*(?=\\D*?[N|S])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp(`\\d{1,3}[\\.|\\${P}]?\\d*(?=\\D*?[E|W|])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"E",description:"east/west indicator",searchPattern:n}],defaultPattern:`Y${o}N, X${o}E`,viewModel:null}),new v({name:"ddm",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp(`\\d{1,2}[\\.\\${P}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=\\D*?\\s+.*?[E|W])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"B",description:"minutes longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\|${P}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"E",description:"east/west indicator",searchPattern:n}],defaultPattern:`Y${o} A'N, X${o} B'E`,viewModel:null}),new v({name:"dms",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[N|S])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"B",description:"seconds latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${P}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=.*?\\s+.*?[E|W])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"C",description:"minutes longitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[E|W])","i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"D",description:"seconds longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${P}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"E",description:"east/west indicator",searchPattern:n}],defaultPattern:`Y${o} A' B"N, X${o} C' D"E`,viewModel:null}),new v({name:"xy",coordinateSegments:[{alias:"X",description:"longitude",searchPattern:S,substitution:{input:e=>r(e),output:e=>s(e)}},{alias:"Y",description:"latitude",searchPattern:S,substitution:{input:e=>r(e),output:e=>s(e)}}],defaultPattern:`X${o}, Y${o}`,viewModel:null}),new v({name:"mgrs",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new v({name:"usng",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new v({name:"utm",coordinateSegments:[{alias:"Z",description:"zone number",searchPattern:/\d{1,2}|[abyz]/i},{alias:"B",description:"latitude band",searchPattern:/^\D/},{alias:"X",description:"easting",searchPattern:/\d{1,7}(?=\s*\d{7}$)/},{alias:"Y",description:"northing",searchPattern:/\d{1,7}/}],defaultPattern:"ZB X Y",viewModel:null})]}function s(t){const n=t.match(at),e=n?n[0]:"",a=t.includes(".")?t.split(".")[1].length:0;return e+I(Number(t),{pattern:"###0.###",places:a,round:-1})}function r(t){return z(t)}export{v as R,dt as c,ut as f,o,ct as p,M as u};
