import{a5 as s,c4 as l,d0 as d,d1 as g,d2 as m,am as p,a0 as f,d3 as c,a3 as v}from"./index-CgzAF5Ey.js";const a=()=>f.getLogger("esri.widgets.support.geolocationUtils"),w={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function h(){const e=!!l("esri-geolocation");return e||a().warn("geolocation-unsupported","Geolocation unsupported."),e}function y(){const e=window.isSecureContext;return e||a().warnOnce("insecure-context","Geolocation requires a secure origin."),e}function A(){return h()&&y()}function R(e){return e??=w,new Promise((o,i)=>{setTimeout(()=>i(new s("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(o,i,e??void 0)})}function U(e,t){const{position:o,view:i}=e,n=S(o),r=n?.coords;if(!r)throw new s("geometry-service:no-coords","Geolocation has no coordinates");return $(P(r),i,t)}function S(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e&&{coords:o,timestamp:e.timestamp,toJSON:()=>({})}}function P({longitude:e,latitude:t,altitude:o}){return new p({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}function $(e,t,o){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(d(e)):G(o).then(n=>{if(!n)throw new s("geometry-service:missing-url","Geometry service URL is missing");const r=new g({geometries:[e],outSpatialReference:i});return m(n,r,o).then(u=>u[0])})}function G(e){if(c.geometryServiceUrl)return Promise.resolve(c.geometryServiceUrl);const t=v.getDefault();return t.load(e).catch(()=>{}).then(()=>t.helperServices?.geometry?.url)}export{U as f,A as g,R as p};
