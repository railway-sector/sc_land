const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/arcgis-knowledge-client-core-simd-MWuc4M46.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/arcgis-knowledge-client-core-C35p-7p7.js"])))=>i.map(i=>d[i]);
import{c5 as Xe,a3 as Se,bR as $e,a7 as W,a5 as i,x as l,y as f,cn as K,al as ee,bI as u,ju as me,b4 as je,ai as Fe,aj as ve,b5 as xe,tX as U,a9 as oe,d6 as et,cf as z,ez as tt}from"./index-Brd6-W-v.js";import{s as rt}from"./submitJob-D8nyJcJi.js";import{b as nt,i as at,a as ot,e as st}from"./GraphQueryStreaming-x4Fpv_du.js";const De="esri/rest/knowledgeGraph/wasmInterface/";let ie;async function h(){const e=ie;if(e)return e;const t=!!Xe("wasm-simd");return ie=it(t),ie}async function it(e){if(e){const{default:r}=await Se(()=>import("./arcgis-knowledge-client-core-simd-MWuc4M46.js"),__vite__mapDeps([0,1])).then(n=>n.a);return r({locateFile:n=>$e(De+n)})}const{default:t}=await Se(()=>import("./arcgis-knowledge-client-core-C35p-7p7.js"),__vite__mapDeps([2,1])).then(r=>r.a);return t({locateFile:r=>$e(De+r)})}const Ce={Regular:0,Provenance:1,Document:2},Me={esriFieldTypeSmallInteger:0,esriFieldTypeInteger:1,esriFieldTypeSingle:2,esriFieldTypeDouble:3,esriFieldTypeString:4,esriFieldTypeDate:5,esriFieldTypeOID:6,esriFieldTypeGeometry:7,esriFieldTypeBlob:8,esriFieldTypeRaster:9,esriFieldTypeGUID:10,esriFieldTypeGlobalID:11,esriFieldTypeXML:12,esriFieldTypeBigInteger:13,esriFieldTypeDateOnly:14,esriFieldTypeTimeOnly:15,esriFieldTypeTimestampOffset:16},de={esriGeometryNull:0,esriGeometryPoint:1,esriGeometryMultipoint:2,esriGeometryPolyline:3,esriGeometryPolygon:4,esriGeometryEnvelope:5,esriGeometryAny:7,esriGeometryMultiPatch:9},dt={esriMethodHintUNSPECIFIED:0,esriUUIDESRI:1,esriUUIDRFC4122:2},lt={esriTypeUNSPECIFIED:0,esriTypeEntity:1,esriTypeRelationship:2,esriTypeBoth:4,esriTypeMetaEntityProvenance:8},Ne={esriGraphPropertyUNSPECIFIED:0,esriGraphPropertyRegular:1,esriGraphPropertyDocumentName:2,esriGraphPropertyDocumentTitle:3,esriGraphPropertyDocumentUrl:4,esriGraphPropertyDocumentText:5,esriGraphPropertyDocumentKeywords:6,esriGraphPropertyDocumentContentType:7,esriGraphPropertyDocumentMetadata:8,esriGraphPropertyDocumentFileExtension:9,esriGraphPropertyProvenanceInstanceId:10,esriGraphPropertyProvenanceSourceType:11,esriGraphPropertyProvenanceSourceName:12,esriGraphPropertyProvenanceSource:13,esriGraphPropertyProvenanceComment:14,esriGraphPropertyProvenanceTypeName:15,esriGraphPropertyProvenancePropertyName:16},pt={esriIdentifierInfoTypeUNSPECIFIED:0,esriIdentifierInfoTypeDatabaseNative:1,esriIdentifierInfoTypeUniformProperty:2};let F=class extends W{constructor(t){super(t),this.headerKeys=[],this.outSpatialReference=null,this.exceededTransferLimit=!1}};i([l()],F.prototype,"headerKeys",void 0),i([l()],F.prototype,"outSpatialReference",void 0),i([l()],F.prototype,"exceededTransferLimit",void 0),F=i([f("esri.rest.knowledgeGraph.GraphQueryResultHeader")],F);let V=class extends W{constructor(t){super(t),this.resultRows=[],this.resultHeader=new F}};i([l()],V.prototype,"resultRows",void 0),i([l()],V.prototype,"resultHeader",void 0),V=i([f("esri.rest.knowledgeGraph.GraphQueryResult")],V);let B=class extends W{constructor(t){super(t),this.resultRowsStream=new ReadableStream,this.resultHeader=new F}};i([l()],B.prototype,"resultRowsStream",void 0),i([l()],B.prototype,"resultHeader",void 0),B=i([f("esri.rest.knowledgeGraph.GraphQueryStreamingResult")],B);let j=class extends K{constructor(t){super(t),this.name=null,this.unique=null,this.ascending=!0,this.description="",this.fieldNames=[]}};i([l({type:String,json:{write:!0}})],j.prototype,"name",void 0),i([l({type:Boolean,json:{write:!0}})],j.prototype,"unique",void 0),i([l({type:Boolean,json:{write:!0}})],j.prototype,"ascending",void 0),i([l({type:String,json:{write:!0}})],j.prototype,"description",void 0),i([l({type:[String],json:{write:!0}})],j.prototype,"fieldNames",void 0),j=i([f("esri.rest.knowledgeGraph.FieldIndex")],j);let v=class extends K{constructor(t){super(t),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=!0,this.required=!1,this.defaultVisibility=!0,this.systemMaintained=null,this.role="esriGraphPropertyUNSPECIFIED",this.defaultValue=null}};i([l({type:String,json:{write:!0}})],v.prototype,"name",void 0),i([l({type:String,json:{write:!0}})],v.prototype,"alias",void 0),i([l({type:String,json:{write:!0}})],v.prototype,"fieldType",void 0),i([l({type:String,json:{write:!0}})],v.prototype,"geometryType",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"hasM",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"hasZ",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"nullable",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"editable",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"required",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"defaultVisibility",void 0),i([l({type:Boolean,json:{write:!0}})],v.prototype,"systemMaintained",void 0),i([l({type:String,json:{write:!0}})],v.prototype,"role",void 0),i([l({json:{write:!0}})],v.prototype,"defaultValue",void 0),v=i([f("esri.rest.knowledgeGraph.GraphProperty")],v);let I=class extends K{constructor(t){super(t),this.name=null,this.alias=null,this.role="Regular",this.strict=null,this.properties=[],this.fieldIndexes=[],this.type=null}};i([l({type:String,json:{write:!0}})],I.prototype,"name",void 0),i([l({type:String,json:{write:!0}})],I.prototype,"alias",void 0),i([l({type:String,json:{write:!0}})],I.prototype,"role",void 0),i([l({type:Boolean,json:{write:!0}})],I.prototype,"strict",void 0),i([l({type:[v],json:{write:!0}})],I.prototype,"properties",void 0),i([l({type:[j],json:{write:!0}})],I.prototype,"fieldIndexes",void 0),I=i([f("esri.rest.knowledgeGraph.GraphObjectType")],I);let X=class extends I{constructor(t){super(t),this.type="entity"}};X=i([f("esri.rest.knowledgeGraph.EntityType")],X);let J=class extends I{constructor(t){super(t),this.endPoints=[],this.type="relationship"}};i([l({json:{write:!0}})],J.prototype,"endPoints",void 0),J=i([f("esri.rest.knowledgeGraph.RelationshipType")],J);let H=class extends K{constructor(t){super(t),this.value=null,this.behavior=null}};i([l({type:String,json:{write:!0}})],H.prototype,"value",void 0),i([l({type:String,json:{write:!0}})],H.prototype,"behavior",void 0),H=i([f("esri.rest.knowledgeGraph.SourceTypeValueBehavior")],H);let b=class extends K{constructor(t){super(t),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=[],this.entityTypes=[],this.relationshipTypes=[],this.metaEntityTypes=[],this.provenanceSourceTypeValues=[]}};i([l({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],b.prototype,"timestamp",void 0),i([l({type:ee,json:{write:!0}})],b.prototype,"spatialReference",void 0),i([l({type:Boolean,json:{write:!0}})],b.prototype,"strict",void 0),i([l({type:String,json:{write:!0}})],b.prototype,"objectIdField",void 0),i([l({type:String,json:{write:!0}})],b.prototype,"globalIdField",void 0),i([l()],b.prototype,"arcgisManaged",void 0),i([l()],b.prototype,"identifierInfo",void 0),i([l()],b.prototype,"searchIndexes",void 0),i([l({type:[X],json:{write:!0}})],b.prototype,"entityTypes",void 0),i([l({type:[J],json:{write:!0}})],b.prototype,"relationshipTypes",void 0),i([l({type:[X],json:{write:!0}})],b.prototype,"metaEntityTypes",void 0),i([l({type:[H],json:{write:!0}})],b.prototype,"provenanceSourceTypeValues",void 0),b=i([f("esri.rest.knowledgeGraph.DataModel")],b);let w=class extends K{constructor(t){super(t),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1,this.supportsProvenance=!1}};i([l({type:[String],json:{write:!0}})],w.prototype,"capabilities",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"supportsSearch",void 0),i([l({type:[String],json:{write:!0}})],w.prototype,"supportedQueryFormats",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"allowGeometryUpdates",void 0),i([l({type:Number,json:{write:!0}})],w.prototype,"searchMaxRecordCount",void 0),i([l({type:Object,json:{write:!0}})],w.prototype,"serviceCapabilities",void 0),i([l({type:Number,json:{write:!0}})],w.prototype,"maxRecordCount",void 0),i([l({type:String,json:{write:!0}})],w.prototype,"description",void 0),i([l({type:String,json:{write:!0}})],w.prototype,"copyrightText",void 0),i([l({type:String,json:{write:!0}})],w.prototype,"units",void 0),i([l({type:ee,json:{write:!0}})],w.prototype,"spatialReference",void 0),i([l({type:Number,json:{write:!0}})],w.prototype,"currentVersion",void 0),i([l({type:Object,json:{write:!0}})],w.prototype,"dateFieldsTimeReference",void 0),i([l({type:String,json:{write:!0}})],w.prototype,"serviceItemId",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"supportsDocuments",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"dataEditingNotSupported",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"schemaEditingNotSupported",void 0),i([l({type:Boolean,json:{write:!0}})],w.prototype,"supportsProvenance",void 0),w=i([f("esri.rest.knowledgeGraph.ServiceDefinition")],w);let Q=class extends K{constructor(t){super(t),this.url=null,this.dataModel=null,this.serviceDefinition=null}};i([l({type:String,json:{write:!0}})],Q.prototype,"url",void 0),i([l({type:b,json:{write:!0}})],Q.prototype,"dataModel",void 0),i([l({type:w,json:{write:!0}})],Q.prototype,"serviceDefinition",void 0),Q=i([f("esri.rest.knowledgeGraph.KnowledgeGraph")],Q);function G(e,t,r){if(e.error_code!==0)throw new u(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function m(e){return e?.error_code?new u("knowledgeGraphService:server-or-decoding-error",e.error_message,{errorCode:e.error_code}):void 0}function ut(e,t,r,n=!1){const a=new r.ClientDataFetchRequestEncoder;a.deleteLater();for(const s of e){const d=ct(s,t,r,n);a.add_client_data_fetch_request_parameter(d)}a.encode();const o=a.get_encoding_result();return G(o.error,"knowledge-graph:fetchClientDataAtKeys-encoding-failed","Attempting to encode the fetchClientDataAtKeys failed"),structuredClone(o.get_byte_buffer())}function ct(e,t,r,n){const a=new r.ClientDataKey;a.deleteLater(),a.key_string=e;const o=new r.ClientDataFetchRequestParameter;o.deleteLater(),o.set_key(a);const s=t.get(e);return s&&!n&&(o.v_tag={v_tag:s.version}),o}const yt={exclude:0,include:1};function qe(e,t){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(Ge(n,t))}),r}function Oe(e,t){const r=new t.ObjectValue;r.deleteLater();for(const[n,a]of Object.entries(e))r.set_key_value(n,Ge(a,t));return r}function be(e,t){if(e instanceof je)return _t(e,t);if(e instanceof Fe)return mt(e,t);if(e instanceof ve||e instanceof xe)return wt(e,t);throw new u("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ht(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function gt(e,t,r){if(!e.extent)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function ft(e,t){t.provenance_behavior={value:yt[e]}}function Ge(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof me)return be(e,t);if(Array.isArray(e)){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(Ge(n,t))}),r}return Oe(e,t)}function wt(e,t){const r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];let o=[];e instanceof ve?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,o=e.paths):e instanceof xe&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,o=e.rings);let s=0,d=0;return o.forEach(p=>{let y=0;p.forEach(c=>{y++,c.forEach(_=>{n[d]=_,d++})}),a[s]=y,s++}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function _t(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];a[0]=e.points.length;let o=0;return e.points.forEach(s=>{s.forEach(d=>{n[o]=d,o++})}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function mt(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],a=[];a[0]=1,n[0]=e.x,n[1]=e.y;let o=2;return e.hasZ&&(n[o]=e.z,o++),e.hasM&&(n[o]=e.m,o++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(a),r}function re(e,t){if(!e.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(!("originId"in e)){const r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,a]of Object.entries(e.properties))r.set_key_value(n,se(a,t));return e.id&&r.set_id(e.id),r}if("originId"in e&&"destinationId"in e){const r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,a]of Object.entries(e.properties))r.set_key_value(n,se(a,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new u("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function vt(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function xt(e,t){const r=new t.EntityType;return r.deleteLater(),ze(e,t,r)}function bt(e,t){const r=new t.RelationshipType;r.deleteLater();for(const n of e.endPoints){const a=new t.EndPoint;a.deleteLater(),a.origin_entity_type=n.originEntityType,a.dest_entity_type=n.destinationEntityType,r.add_end_point(a)}return ze(e,t,r)}function Gt(e,t){const r=new t.EntityType;return r.deleteLater(),Ue(e,r)}function Tt(e,t){const r=new t.RelationshipType;return r.deleteLater(),Ue(e,r)}function Le(e,t){const r=new t.GraphProperty;return r.deleteLater(),r.name=e.name,r.alias=e.alias??"",r.field_type={value:Me[e.fieldType]},r.geometry_type={value:e.geometryType?de[e.geometryType]:de.esriGeometryNull},r.has_m=e.hasM??!1,r.has_z=e.hasZ??!1,r.nullable=e.nullable??!1,r.editable=e.editable,r.required=e.required,r.default_visibility=e.defaultVisibility,r.system_maintained=e.systemMaintained??!1,r.role={value:Ne[e.role]},r.default_value=se(e.defaultValue,t),r}function kt(e,t){const r=new t.GraphProperty;return r.deleteLater(),e.hasOwnProperty("alias")&&(r.alias=e.alias),e.hasOwnProperty("editable")&&(r.editable=e.editable),e.hasOwnProperty("required")&&(r.required=e.required),e.hasOwnProperty("defaultVisibility")&&(r.default_visibility=e.defaultVisibility),e.hasOwnProperty("defaultValue")&&(r.default_value=se(e.defaultValue,t)),r}function Ae(e,t){const r=new t.SearchIndexProperties;r.deleteLater();for(const n of e.propertyNames)r.add_search_property_name(n);return r}function Pt(e,t){const r=new t.FieldIndex;r.deleteLater(),r.name=e.name,r.unique=e.unique,r.ascending=e.ascending,r.description=e.description??"";for(const n of e.fieldNames)r.add_field(n);return r}function ze(e,t,r){r.name=e.name,r.alias=e.alias??"",r.role={value:Ce[e.role]},r.strict=e.strict;for(const n of e.properties){const a=Le(n,t);r.add_property(a)}return r}function Ue(e,t){return e.hasOwnProperty("alias")&&(t.alias=e.alias),t}function se(e,t){return e==null?null:typeof e!="object"||e instanceof Date?e:e instanceof me?be(e,t):null}function Rt(e,t,r,n=!1){const a=new Map;for(let o=0;o<e.get_results_count();o++){const s=e.get_result_at(o);if(s.get_fetch_result_case().value!==2||s.error().error_code!==0){const _=s.get_key().key_string;r.has(_)&&t.delete(_);continue}const d=s.get_value(),p=s.get_key().key_string,y=r.get(p);let c;if(d.get_data_case().value===2&&y)c=y.value;else{if(d.get_data_case().value!==1)continue;{c=d.get_data().client_data_string;const _=s.get_value().get_v_tag().v_tag;n||t.set(p,{key:p,version:_,value:c})}}a.set(p,c)}return a}function St(e){const t=e.get_keys(),r=new Array;for(let n=0;n<t.get_keys_count();n++){const a=t.get_key_at(n);a.get_client_data_key_type().value===1&&r.push(a.key_string)}return r}let q=class extends W{constructor(t){super(t),this.decoderError=null,this.resultsCount=0,this.results=[],this.updatedKnowledgeGraph=null}};i([l()],q.prototype,"decoderError",void 0),i([l()],q.prototype,"resultsCount",void 0),i([l()],q.prototype,"results",void 0),i([l()],q.prototype,"updatedKnowledgeGraph",void 0),q=i([f("esri.rest.knowledgeGraph.GraphDataModelOperationResult")],q);const C=q;let le=class extends C{constructor(t){super(t)}};le=i([f("esri.rest.knowledgeGraph.GraphAddFieldIndexResult")],le);const $t=le;let O=class extends C{constructor(t){super(t),this.entityAddResultsCount=0,this.relationshipAddResultsCount=0,this.entityAddResults=[],this.relationshipAddResults=[]}};i([l()],O.prototype,"entityAddResultsCount",void 0),i([l()],O.prototype,"relationshipAddResultsCount",void 0),i([l()],O.prototype,"entityAddResults",void 0),i([l()],O.prototype,"relationshipAddResults",void 0),O=i([f("esri.rest.knowledgeGraph.GraphAddNamedTypesResult")],O);const Dt=O;let pe=class extends C{constructor(t){super(t)}};pe=i([f("esri.rest.knowledgeGraph.GraphAddPropertyResult")],pe);const At=pe;let ue=class extends C{constructor(t){super(t)}};ue=i([f("esri.rest.knowledgeGraph.GraphDeleteFieldIndexResult")],ue);const It=ue;let ce=class extends C{constructor(t){super(t)}};ce=i([f("esri.rest.knowledgeGraph.GraphDeleteNamedTypeResult")],ce);const Et=ce;let ye=class extends C{constructor(t){super(t)}};ye=i([f("esri.rest.knowledgeGraph.GraphDeletePropertyResult")],ye);const jt=ye;let he=class extends C{constructor(t){super(t)}};he=i([f("esri.rest.knowledgeGraph.GraphUpdateNamedTypesResult")],he);const Ft=he;let ge=class extends C{constructor(e){super(e)}};ge=i([f("esri.rest.knowledgeGraph.GraphUpdatePropertyResult")],ge);const Ct=ge;let fe=class extends C{constructor(e){super(e)}};fe=i([f("esri.rest.knowledgeGraph.GraphUpdateSearchIndexResult")],fe);const Mt=fe;function M(e,t){const r=[];for(let n=0;n<t;n++){const a=e.get_result_at(n);r.push({name:a.get_name(),error:m(a.get_error())})}return r}function Nt(e){const t=e.get_results_count(),r=e.get_entity_type_add_results_count(),n=e.get_relationship_type_add_results_count(),a=new Dt({resultsCount:t,results:M(e,t),decoderError:m(e.error),entityAddResultsCount:r,relationshipAddResultsCount:n});for(let o=0;o<r;o++){const s=e.get_entity_type_add_results_at(o),d=s.get_name(),p=s.get_error();a.entityAddResults.push({name:d,error:m(p)})}for(let o=0;o<n;o++){const s=e.get_relationship_type_add_results_at(o),d=s.get_name(),p=s.get_error();a.relationshipAddResults.push({name:d,error:m(p)})}return a}function qt(e){const t=e.get_results_count();return new Ft({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Ot(e){const t=e.get_results_count();return new Et({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Lt(e){const t=e.get_results_count();return new At({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function zt(e){const t=e.get_results_count();return new jt({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Ut(e){const t=e.get_results_count();return new Ct({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Kt(e){const t=e.get_results_count();return new Mt({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Qt(e){const t=e.get_results_count();return new $t({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}function Vt(e){const t=e.get_results_count();return new It({resultsCount:t,results:M(e,t),decoderError:m(e.error)})}let L=class extends W{constructor(t){super(t),this.name=null,this.supportedCategory="esriTypeUNSPECIFIED",this.analyzers=[],this.searchProperties=new Map}};i([l()],L.prototype,"name",void 0),i([l()],L.prototype,"supportedCategory",void 0),i([l()],L.prototype,"analyzers",void 0),i([l()],L.prototype,"searchProperties",void 0),L=i([f("esri.rest.knowledgeGraph.SearchIndex")],L);let we=!1;function Bt(e){e.deleteLater(),we=!1;const t=new b({timestamp:e.timestamp,spatialReference:new ee(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:U(pt,e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value),databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:U(dt,e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value)}},searchIndexes:ar(e.search_indexes),entityTypes:Ie(e.entity_types),relationshipTypes:rr(e.relationship_types),metaEntityTypes:Ie(e.meta_entity_types),provenanceSourceTypeValues:nr(e.provenance_source_type_values.value_behavior_array)});return we&&oe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),t}function Ht(e){return e.deleteLater(),new X(Ke(e))}function Wt(e){return e.deleteLater(),new j({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Xt(e.fields)})}function Ke(e){return{name:e.name,alias:e.alias,role:U(Ce,e.role.value),strict:e.strict,properties:er(e.properties),fieldIndexes:tr(e.field_indexes)}}function Zt(e){return e.deleteLater(),new v({alias:e.alias,name:e.name,fieldType:U(Me,e.field_type.value)??void 0,geometryType:U(de,e.geometry_type.value)??null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:U(Ne,e.role.value),defaultValue:e.default_value})}function Jt(e){e.deleteLater();const t=Ke(e),r=[];for(let n=0;n<e.end_points.size();n++){const a=e.end_points.get(n);r.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return e.end_points.delete(),new J(Object.assign({endPoints:r},t))}function Yt(e){return new H({behavior:e.behavior,value:e.value})}function Ie(e){const t=[];for(let r=0;r<e.size();r++)t.push(Ht(e.get(r)));return e.delete(),t}function Xt(e){const t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return e.delete(),t}function er(e){const t=[];for(let r=0;r<e.size();r++){const n=Zt(e.get(r));n.fieldType==="esriFieldTypeBigInteger"&&(we=!0),t.push(n)}return e.delete(),t}function tr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Wt(e.get(r)));return e.delete(),t}function rr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Jt(e.get(r)));return e.delete(),t}function nr(e){const t=[];for(let r=0;r<e.size();r++){const n=e.get(r);n.deleteLater(),t.push(Yt(n))}return e.delete(),t}function ar(e){const t=[];for(let r=0;r<e.size();r++){const n=new L,a=e.get(r);n.name=a.name,n.supportedCategory=U(lt,a.supported_category.value);const o=a.analyzers.size();for(let s=0;s<o;s++)n.analyzers.push({name:a.analyzers.get(s).name});a.analyzers.delete();for(let s=0;s<a.search_properties.keys().size();s++){const d=a.search_properties.keys().get(s),p=a.search_properties.get(d),y=[];for(let c=0;c<p.property_names.size();c++)y.push(p.property_names.get(c));n.searchProperties.set(d,{propertyNames:y})}t.push(n)}return e.delete(),t}function or(e,t){const r={spatialReference:t},n=Te(e,r),a=e.lengths,o=e.coords,s=a[0];r.points=[];let d=0;for(let p=0;p<s;p++){const y=[];for(let c=0;c<n;c++)y[c]=o[d],d++;r.points.push(y)}return new je(r)}function sr(e,t){const r={spatialReference:t};let n=2;Te(e,r);const a=e.coords;return r.x=a[0],r.y=a[1],e.has_z&&(r.z=a[n],n++),e.has_m&&(r.m=a[n]),new Fe(r)}function ir(e,t){const{paths:r,hasM:n,hasZ:a}=Qe(e,3);return new ve({paths:r,hasM:n,hasZ:a,spatialReference:t})}function dr(e,t){const{paths:r,hasM:n,hasZ:a}=Qe(e,4);return new xe({rings:r,hasM:n,hasZ:a,spatialReference:t})}function Qe(e,t){const r={paths:[],hasM:!1,hasZ:!1},n=Te(e,r),{coords:a,geometry_type:o,lengths:s}=e;if(o.value!==t)throw new u("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");let d=0;return s.forEach(p=>{const y=[];for(let c=0;c<p;c++){const _=[];for(let x=0;x<n;x++)_[x]=a[d],d++;y.push(_)}r.paths.push(y)}),r}function Te(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}const ne=()=>oe.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),lr={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case 1:return sr(e,r);case 2:return or(e,r);case 3:return ir(e,r);case 4:return dr(e,r);case 5:case 7:return ne().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;default:return ne().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return ne().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case 0:return ur(e,t,r);case 1:return Ve(e,t,r);case 2:return Be(e,t,r);case 3:return cr(e,t,r);case 4:return pr(e,t,r);default:return ne().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function pr(e,t,r){const n=[],a=e.count();for(let o=0;o<a;o++){const s=e.get_value_at(o);n.push(ke(s,t,r))}return n}function ke(e,t,r){return lr.decodedWasmObjToQueryResponseObj(e,t,r)}function Ve(e,t,r){const n=e.type_name,a=Pe(e,t,r),o=e.get_id();return new ot(Object.assign({typeName:n,id:o},a))}function Pe(e,t,r){const n={},a=e.key_count();for(let o=0;o<a;o++)n[e.get_key_at(o)]=ke(e.get_value_at(o),t,r);return{properties:n}}function ur(e,t,r){return new st(Pe(e,t,r))}function cr(e,t,r){const n=e.entity_count(),a=e.relationship_count(),o=[];for(let s=0;s<n;s++)o.push(Ve(e.get_entity_at(s),t,r)),s<a&&o.push(Be(e.get_relationship_at(s),t,r));return new nt({path:o})}function Be(e,t,r){const n=e.type_name,a=Pe(e,t,r);return new at(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},a))}function yr(e){const t=[];for(let n=0;n<e.get_header_keys().size();n++)t.push(e.get_header_keys().get(n));const r=new ee(e.get_out_sr());return new F({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}let N=class extends W{constructor(e){super(e),this.hasError=!1,this.error=null,this.editResults=[],this.cascadeRelationshipDeleteResults=[],this.cascadeProvenanceDeleteResults=[]}};i([l()],N.prototype,"hasError",void 0),i([l()],N.prototype,"error",void 0),i([l()],N.prototype,"editResults",void 0),i([l()],N.prototype,"cascadeRelationshipDeleteResults",void 0),i([l()],N.prototype,"cascadeProvenanceDeleteResults",void 0),N=i([f("esri.rest.knowledgeGraph.GraphApplyEditsResult")],N);const hr=N;function gr(e){const t=e.has_error(),r=new hr({hasError:t,error:t?m(e.error):null}),n=e.get_edit_results_count();for(let o=0;o<n;o++){const s=e.get_edit_results_at(o);s.deleteLater();const d=e.get_edit_results_type_name_at(o),p=[],y=[],c=[],_=s.get_add_results_count(),x=s.get_update_results_count(),D=s.get_delete_results_count();for(let R=0;R<_;R++){const T=s.get_add_result_at(R);T.deleteLater(),p.push({id:T.id,error:m(T.error)})}for(let R=0;R<x;R++){const T=s.get_update_result_at(R);T.deleteLater(),y.push({id:T.id,error:m(T.error)})}for(let R=0;R<D;R++){const T=s.get_delete_result_at(R);T.deleteLater(),c.push({id:T.id,error:m(T.error)})}r.editResults.push({typeName:d,adds:p,updates:y,deletes:c})}const a=e.get_cascaded_rel_deletes_count();for(let o=0;o<a;o++){const s=e.get_cascaded_rel_deletes_at(o);s.deleteLater();const d=e.get_cascaded_rel_deletes_type_name_at(o),p=[];for(let y=0;y<s.get_count();y++){const c=s.get_result_at(y);c.deleteLater(),p.push({id:c.id,originId:c.origin_id,destinationId:c.dest_id,error:m(c.error)})}r.cascadeRelationshipDeleteResults.push({typeName:d,cascadeRelationshipDeletes:p})}if(e.has_cascading_provenance_deletes()){const o=e.get_cascading_provenance_deletes();o.deleteLater();const s=o.get_count();for(let d=0;d<s;d++){const p=o.get_result_at(d);p.deleteLater(),r.cascadeProvenanceDeleteResults.push({id:p.id,error:m(p.error)})}}return r}const Y=new Map,fr=()=>new Map(Y.entries()),g={fetchKnowledgeGraph:async e=>{const t=new Q({url:e}),r=[];return r.push(te(t)),r.push(He(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await Je(e)},refreshServiceDefinition:async e=>{const t=(await z(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new w(t),e.serviceDefinition},executeFindPathsAsynchronous:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /rest/services/");const n=r[0],a=(await ae(`${n}/rest/info`,{query:{f:"json"}})).data.currentVersion,o=`/rest/services/${a&&a<12?"System":"Utilities"}/KnowledgeGraphServerToolsAsync/GPServer/ServerFilteredFindPaths`;return await We(`${n}${o}`,{in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:e.config.toJSON(),result_type:"STRING"},{},t)},executeFindPaths:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /rest/services/");const n=r[0],a=(await ae(`${n}/rest/info`,{query:{f:"json"}})).data.currentVersion,o=`/rest/services/${a&&a<12?"System":"Utilities"}/KnowledgeGraphServerTools/GPServer/ServerFilteredFindPaths/execute`,s=await ae(`${n}${o}`,{method:"post",query:{f:"pjson",in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:JSON.stringify(e.config),result_type:"STRING"},...t});if(s.data.results.length<1)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results returned",s);let d;for(const p of s.data.results)if(p.paramName==="out_results_string"){d=p.value;break}if(!d)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results were returned on the expected paramater out_results_string",s);return d},fetchAsynchronousFindPathsResultData:async(e,t)=>(await e.fetchResultData("out_results_string",null,t)).value,executeQueryStreaming:async(e,t,r)=>{const n="include",a=`${e.url}/graph/query`;await $(e);const o=await S(a,r);if(!e.serviceDefinition?.supportsProvenance&&t.provenanceBehavior===n)throw new u("knowledge-graph:provenance-not-supported","The Knowledge Graph Service definition indicated that provenance is not supported");o.data.body=await Br(t,e);const s=await P(o.data.url,o.data);if(e.dataModel){const d=await Ee(s,e.dataModel);return new B({resultRowsStream:d.readableStream,resultHeader:d.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{if(e.serviceDefinition?.dataEditingNotSupported)throw new u("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await $(e);const a=await S(n,r);return a.data.body=await Nr(t,e),Wr(await P(a.data.url,a.data))},executeAddNamedTypes:async(e,t,r)=>{if(!t.newEntityTypes?.length&&!t.newRelationshipTypes?.length)throw new u("knowledge-graph:no-arguments","The operation to add types to the data model contained no values");const n=`${e.url}/dataModel/edit/namedTypes/add`;await $(e);const a=await S(n,r);a.data.body=await qr(t);const o=await P(a.data.url,a.data),s=await Zr(o);return s.updatedKnowledgeGraph=await A(e.url),s},executeDeleteNamedType:async(e,t,r)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to delete a named type from the data model contained no value");const n=`${e.url}/dataModel/edit/namedTypes/${t}/delete`;await $(e);const a=await S(n,r);a.data.body="";const o=await P(a.data.url,a.data),s=await Jr(o);return s.updatedKnowledgeGraph=await A(e.url),s},executeUpdateNamedType:async(e,t,r,n)=>{if(!t&&!Object.keys(r).length)throw new u("knowledge-graph:no-arguments","The operation to update types in the data model contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/update`;await $(e);const o=await S(a,n);o.data.body=await Or(r,t,e.dataModel);const s=await P(o.data.url,o.data),d=await Yr(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeAddGraphProperties:async(e,t,r,n)=>{if(!t&&!r.length)throw new u("knowledge-graph:no-arguments","The operation to add properties to the data model contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/fields/add`;await $(e);const o=await S(a,n);o.data.body=await Lr(r);const s=await P(o.data.url,o.data),d=await Xr(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeDeleteGraphProperty:async(e,t,r,n)=>{if(!t&&!r)throw new u("knowledge-graph:no-arguments","The operation to delete property contained missing or empty values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/fields/delete`;await $(e);const o=await S(a,n);o.data.body=await zr(r);const s=await P(o.data.url,o.data),d=await en(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeUpdateGraphProperty:async(e,t,r,n,a)=>{if(!t&&!r&&!Object.keys(n).length)throw new u("knowledge-graph:no-arguments","The operation to update properties in the data model contained missing or empty values");const o=`${e.url}/dataModel/edit/namedTypes/${t}/fields/update`;await $(e);const s=await S(o,a);s.data.body=await Ur(r,n);const d=await P(s.data.url,s.data),p=await tn(d);return p.updatedKnowledgeGraph=await A(e.url),p},executeAddGraphFieldIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!r?.length)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty field index values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/indexes/add`;await $(e);const o=await S(a,n);o.data.body=await Kr(r);const s=await P(o.data.url,o.data),d=await rn(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeDeleteGraphFieldIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!r?.length)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty field index values");const a=`${e.url}/dataModel/edit/namedTypes/${t}/indexes/delete`;await $(e);const o=await S(a,n);o.data.body=await Qr(r);const s=await P(o.data.url,o.data),d=await nn(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeUpdateSearchIndex:async(e,t,r,n)=>{if(!t)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing named type");if(!Object.keys(r.addSearchProperties??{}).length&&!Object.keys(r.removeSearchProperties??{}).length)throw new u("knowledge-graph:no-arguments","The operation to update search index in the data model contained missing or empty properties values");const a=`${e.url}/dataModel/searchIndex/update`;await $(e);const o=await S(a,n);o.data.body=await Vr(t,r);const s=await P(o.data.url,o.data),d=await an(s);return d.updatedKnowledgeGraph=await A(e.url),d},executeQuery:async(e,t,r)=>{const n=`${e.url}/graph/query`,a=await z(n,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...r?.query},signal:r?.signal,timeout:r?.timeout}),o=a.getHeader?.("content-type"),s=a.data;if(o?.includes("application/x-protobuf")){const d=new(await h()).GraphQueryDecoder;if(d.deleteLater(),e.dataModel){const p=_e({wasmQueryDecoder:d,newArrayBufferToParse:s,dataModel:e.dataModel});return new V({resultRows:p.resultRows,resultHeader:p.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:a.data})},executeSearch:async(e,t,r)=>{const n=t.typeCategoryFilter==="provenance"?"metaEntityProvenance":t.typeCategoryFilter,a=`${e.url}/graph/search`,o=await z(a,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:n,...r?.query},signal:r?.signal,timeout:r?.timeout}),s=o.getHeader?.("content-type"),d=o.data;if(s?.includes("application/x-protobuf")){const p=new(await h()).GraphQueryDecoder;if(p.deleteLater(),e.dataModel){const y=_e({wasmQueryDecoder:p,newArrayBufferToParse:d,dataModel:e.dataModel});return new V({resultRows:y.resultRows,resultHeader:y.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:o.data})},executeSearchStreaming:async(e,t,r)=>{const n=`${e.url}/graph/search`;await $(e);const a=await S(n,r);a.data.body=await Hr(t);const o=await P(a.data.url,a.data);if(e.dataModel){const s=await Ee(o,e.dataModel);return new B({resultRowsStream:s.readableStream,resultHeader:s.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},fetchClientDataAtKeys:async(e,t,r={ignoreCache:!1})=>{if(!t.length)return new Map;let n=Y.get(e.url||"");n||(n=new Map,Y.set(e.url||"",n));const a=new Map(n.entries()),o=`${e.url}/clientData/fetch`;t=Array.from(new Set(t));const s=await h(),d=ut(t,n,s,r.ignoreCache),p=await S(o,r.requestOptions);p.data.body=d;const y=await P(p.data.url,p.data),c=y.headers.get("content-type");if(c?.includes("application/x-protobuf")){const _=new s.ClientDataFetchResponseDecoder;_.deleteLater();const x=await y.arrayBuffer();return _.decode(new Uint8Array(x)),_.has_error()&&G(_.error,"knowledge-graph:fetchClientDataAtKeys-decoding-error","An error occurred while decoding the client data keys response"),Rt(_,n,a,r.ignoreCache)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response when fetching client data",{responseType:c,data:y})},fetchAllClientDataKeys:async(e,t)=>{const r=`${e.url}/clientData`,n=await z(r,{responseType:"array-buffer",query:{f:"pbf"},signal:t?.signal,timeout:t?.timeout}),a=n.getHeader?.("content-type"),o=n.data;if(a?.includes("application/x-protobuf")){const s=new(await h()).ClientDataKeysResponseDecoder;return s.deleteLater(),s.decode(new Uint8Array(o)),s.has_error()&&G(s.error,"knowledge-graph:fetchAllClientDataKeys-decoding-error","An error occurred while decoding the client data keys response"),St(s)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:n.data})},clearClientDataCache:()=>Y.clear(),_fetchWrapper:async(e,t)=>fetch(e,t),_submitJobWrapper:async(e,t,r,n)=>rt(e,t,r,n),_esriRequestWrapper:async(e,t)=>z(e,t)};async function wr(e,t,r){return g.executeApplyEdits(e,t,r)}async function _r(e,t,r){return g.executeAddNamedTypes(e,t,r)}async function mr(e,t,r){return g.executeDeleteNamedType(e,t,r)}async function vr(e,t,r,n){return g.executeUpdateNamedType(e,t,r,n)}async function xr(e,t,r,n){return g.executeAddGraphProperties(e,t,r,n)}async function br(e,t,r,n){return g.executeDeleteGraphProperty(e,t,r,n)}async function Gr(e,t,r,n,a){return g.executeUpdateGraphProperty(e,t,r,n,a)}async function Tr(e,t,r,n){return g.executeAddGraphFieldIndex(e,t,r,n)}async function kr(e,t,r,n){return g.executeDeleteGraphFieldIndex(e,t,r,n)}async function Pr(e,t,r,n){return g.executeUpdateSearchIndex(e,t,r,n)}async function Rr(e,t,r){return g.executeQuery(e,t,r)}async function Sr(e,t,r){return g.executeQueryStreaming(e,t,r)}async function $r(e,t,r){return g.executeSearch(e,t,r)}async function Dr(e,t,r){return g.executeSearchStreaming(e,t,r)}function Ar(e,t){return g.fetchAllClientDataKeys(e,t)}function Ir(e,t,r){return g.fetchClientDataAtKeys(e,t,r)}async function A(e){return g.fetchKnowledgeGraph(e)}async function te(e){return g.refreshDataModel(e)}async function He(e){return g.refreshServiceDefinition(e)}async function Er(e,t){return g.executeFindPathsAsynchronous(e,t)}async function jr(e,t){return g.executeFindPaths(e,t)}async function Fr(e,t){return g.fetchAsynchronousFindPathsResultData(e,t)}function Cr(){return g.clearClientDataCache()}async function P(e,t){return g._fetchWrapper(e,t)}async function We(e,t,r,n){return g._submitJobWrapper(e,t,r,n)}async function ae(e,t){return g._esriRequestWrapper(e,t)}async function $(e){et?.findCredential(e.url)||(e.dataModel?await Je(e):await te(e))}function Mr(e,t,r,n){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof me?r.set_param_key_value(e,be(t,n)):Array.isArray(t)?r.set_param_key_value(e,qe(t,n)):r.set_param_key_value(e,Oe(t,n))}async function Nr(e,t){if(t.dataModel||await te(t),!t.dataModel)throw new u("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const r=await h(),n=!!e.options?.cascadeDelete,a=!!e.options?.cascadeProvenanceDelete,o=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?vt(e.options?.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());o.deleteLater(),o.cascade_delete=n,o.cascade_delete_provenance=a;try{let d;e.entityAdds?.forEach(p=>{d=o.add_entity(re(p,r)),G(d,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(p=>{if(!p.originId||!p.destinationId)throw new u("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");d=o.add_relationship(re(p,r)),G(d,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(p=>{if(!p.id)throw new u("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");d=o.update_entity(re(p,r)),G(d,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(p=>{if(!p.id)throw new u("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");d=o.update_relationship(re(p,r)),G(d,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(p=>{if(!p.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const y=o.make_delete_helper(p.typeName,!0);y.deleteLater(),p.ids?.forEach(c=>{y.delete_by_id(c)})}),e.relationshipDeletes?.forEach(p=>{if(!p.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const y=o.make_delete_helper(p.typeName,!1);p.ids?.forEach(c=>{y.delete_by_id(c)})}),o.encode()}catch(d){throw new u("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:d})}const s=o.get_encoding_result();return G(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(s.get_byte_buffer())}async function qr(e){const t=await h(),r=new t.GraphNamedObjectTypeAddsRequestEncoder;r.deleteLater(),e.newEntityTypes?.forEach(a=>{r.add_entity_type(xt(a,t))}),e.newRelationshipTypes?.forEach(a=>{r.add_relationship_type(bt(a,t))});try{r.encode()}catch(a){throw new u("knowledge-graph:addNamedTypes-encoding-failed","Attempting to encode the addNamedTypes failed",{error:a})}const n=r.get_encoding_result();return G(n.error,"knowledge-graph:addNamedTypes-encoding-failed","Attempting to encode the addNamedTypes failed"),structuredClone(n.get_byte_buffer())}async function Or(e,t,r){const n=await h(),a=new n.GraphNamedObjectTypeUpdateRequestEncoder;if(a.deleteLater(),r.entityTypes.some(s=>s.name===t))a.update_entity_type(Gt(e,n));else{if(!r.relationshipTypes.some(s=>s.name===t))throw new u("knowledge-graph:updateNamedType-encoding-failed","The named type you are trying to update does not exist in the data model");a.update_relationship_type(Tt(e,n))}a.update_alias=e.hasOwnProperty("alias");try{a.encode()}catch(s){throw new u("knowledge-graph:updateNamedType-encoding-failed","Attempting to encode the updateNamedType failed",{error:s})}const o=a.get_encoding_result();return G(o.error,"knowledge-graph:updateNamedType-encoding-failed","Attempting to encode the updateNamedType failed"),structuredClone(o.get_byte_buffer())}async function Lr(e){const t=await h(),r=new t.GraphPropertyAddsRequestEncoder;r.deleteLater(),e.forEach(a=>{r.add_graph_property(Le(a,t))});try{r.encode()}catch(a){throw new u("knowledge-graph:addGraphProperties-encoding-failed","Attempting to encode the addGraphProperties failed",{error:a})}const n=r.get_encoding_result();return G(n.error,"knowledge-graph:addGraphProperties-encoding-failed","Attempting to encode the addGraphProperties failed"),structuredClone(n.get_byte_buffer())}async function zr(e){const t=new(await h()).GraphPropertyDeleteRequestEncoder;t.deleteLater(),t.field_name=e;try{t.encode()}catch(n){throw new u("knowledge-graph:deleteGraphProperty-encoding-failed","Attempting to encode the deleteGraphProperty failed",{error:n})}const r=t.get_encoding_result();return G(r.error,"knowledge-graph:deleteGraphProperty-encoding-failed","Attempting to encode the deleteGraphProperty failed"),structuredClone(r.get_byte_buffer())}async function Ur(e,t){const r=await h(),n=new r.GraphPropertyUpdateRequestEncoder;n.deleteLater(),n.update_graph_property(kt(t,r)),n.set_property_name(e),n.update_alias=t.hasOwnProperty("alias"),n.update_editable=t.hasOwnProperty("editable"),n.update_required=t.hasOwnProperty("required"),n.update_visible=t.hasOwnProperty("defaultVisibility"),n.update_default_value=t.hasOwnProperty("defaultValue");try{n.encode()}catch(o){throw new u("knowledge-graph:updateGraphProperty-encoding-failed","Attempting to encode the updateGraphProperty failed",{error:o})}const a=n.get_encoding_result();return G(a.error,"knowledge-graph:updateGraphProperty-encoding-failed","Attempting to encode the updateGraphProperty failed"),structuredClone(a.get_byte_buffer())}async function Kr(e){const t=await h(),r=new t.GraphIndexAddsRequestEncoder;r.deleteLater(),e.forEach(a=>{r.add_field_index(Pt(a,t))});try{r.encode()}catch(a){throw new u("knowledge-graph:addGraphFieldIndex-encoding-failed","Attempting to encode the addGraphFieldIndex failed",{error:a})}const n=r.get_encoding_result();return G(n.error,"knowledge-graph:addGraphFieldIndex-encoding-failed","Attempting to encode the addGraphFieldIndex failed"),structuredClone(n.get_byte_buffer())}async function Qr(e){const t=new(await h()).GraphIndexDeleteRequestEncoder;t.deleteLater(),e.forEach(n=>{t.add_index_name(n)});try{t.encode()}catch(n){throw new u("knowledge-graph:deleteGraphFieldIndex-encoding-failed","Attempting to encode the deleteGraphFieldIndex failed",{error:n})}const r=t.get_encoding_result();return G(r.error,"knowledge-graph:deleteGraphFieldIndex-encoding-failed","Attempting to encode the deleteGraphFieldIndex failed"),structuredClone(r.get_byte_buffer())}async function Vr(e,t){const r=await h(),n=new r.GraphUpdateSearchIndexRequestEncoder;n.deleteLater(),t.hasOwnProperty("addSearchProperties")&&n.insert_add_search_property(e,Ae(t.addSearchProperties,r)),t.hasOwnProperty("removeSearchProperties")&&n.insert_delete_search_property(e,Ae(t.removeSearchProperties,r));try{n.encode()}catch(o){throw new u("knowledge-graph:updateSearchIndex-encoding-failed","Attempting to encode the updateSearchIndex failed",{error:o})}const a=n.get_encoding_result();return G(a.error,"knowledge-graph:updateSearchIndex-encoding-failed","Attempting to encode the updateSearchIndex failed"),structuredClone(a.get_byte_buffer())}async function Br(e,t){const r=await h(),n=new r.GraphQueryRequestEncoder;if(n.deleteLater(),e.outputSpatialReference?n.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:n.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[o,s]of Object.entries(e.bindParameters))Mr(o,s,n,r);if(e.bindGeometryQuantizationParameters)ht(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await te(t),t.dataModel?.spatialReference?.wkid!==4326)throw new u("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&gt(e.outputQuantizationParameters,n,r),e.provenanceBehavior&&ft(e.provenanceBehavior,n);try{n.encode()}catch(o){throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:o})}const a=n.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())}async function Hr(e){const t=await h(),r=new t.GraphSearchRequestEncoder;r.deleteLater(),r.search_query=e.searchQuery;const n=e.typeCategoryFilter==="provenance"?"meta_entity_provenance":e.typeCategoryFilter;if(r.type_category_filter=t.esriNamedTypeCategory[n],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(qe(e.idsFilter,t))}catch(o){throw new u("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:o})}e.namedTypesFilter?.forEach(o=>{r.add_named_type_filter(o)});try{r.encode()}catch(o){throw new u("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:o})}const a=r.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())}async function S(e,t){return z(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}async function E(e,t,r){const n=e.headers.get("content-type");if(n?.includes("application/x-protobuf")){const a=await e.arrayBuffer(),o=new t;try{return o.decode(new Uint8Array(a)),r(o)}finally{o.deleteLater()}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:await e.text()})}async function Wr(e){return E(e,(await h()).GraphApplyEditsDecoder,gr)}async function Zr(e){return E(e,(await h()).GraphNamedObjectTypeAddsResponseDecoder,Nt)}async function Jr(e){return E(e,(await h()).GraphNamedObjectTypeDeleteResponseDecoder,Ot)}async function Yr(e){return E(e,(await h()).GraphNamedObjectTypeUpdateResponseDecoder,qt)}async function Xr(e){return E(e,(await h()).GraphPropertyAddsResponseDecoder,Lt)}async function en(e){return E(e,(await h()).GraphPropertyDeleteResponseDecoder,zt)}async function tn(e){return E(e,(await h()).GraphPropertyUpdateResponseDecoder,Ut)}async function rn(e){return E(e,(await h()).GraphIndexAddsResponseDecoder,Qt)}async function nn(e){return E(e,(await h()).GraphIndexDeleteResponseDecoder,Vt)}async function an(e){return E(e,(await h()).GraphUpdateSearchIndexResponseDecoder,Kt)}let Ze=50;function on(e){Ze=e}function _e({wasmQueryDecoder:e,newArrayBufferToParse:t,dataModel:r,decodedHeader:n,limitMaxProcessingTime:a=!1}){t&&e.push_buffer(new Uint8Array(t));const o=[];let s,d,p=0;const y=Date.now();let c=!0;for(;e.next_row();){s&&d||(s=n??yr(e),d=s.outSpatialReference??new ee({wkid:4326})),p||(p=e.get_header_keys().size());const _=new Array(p);for(let x=0;x<p;x++){const D=e.get_value(x);_[x]=ke(D,r,d)}if(o.push(_),a&&Date.now()-y>Ze){c=!1;break}}if(e.has_error())throw new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - inner row decoding",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return{resultHeader:s,resultRows:o,parsedAllResultsFromBuffer:c}}async function Ee(e,t){const r=e.headers.get("content-type");if(e.headers.get("content-length")&&oe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r?.includes("application/x-protobuf")){const n=e.body?.getReader(),a=new(await h()).GraphQueryDecoder;let o,s,d;a.deleteLater();const p=new Promise((x,D)=>{s=x,d=D});let y=!1,c=null;return{readableStream:new ReadableStream({pull:async function x(D){if(!n){const k=new u("knowledge-graph:stream-decoding-error","Error reading from stream - reader is undefined");throw d(k),k}const{done:R,value:T}=c?{done:!1,value:null}:await n.read().catch(k=>{throw d(k),n.releaseLock(),k});T&&(c=T);try{if(R){let Z;if(a.has_error()?Z=new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - query stream done",{errorCode:a.error.error_code,errorMessage:a.error.error_message}):y||s(new F),n.releaseLock(),Z)throw D.error(Z),d(Z),Z;return void D.close()}const{resultHeader:k,resultRows:Re,parsedAllResultsFromBuffer:Ye}=_e({wasmQueryDecoder:a,newArrayBufferToParse:T,dataModel:t,decodedHeader:o,limitMaxProcessingTime:!0});return Ye&&(c=null),!o&&k&&(o=k,s(k),y=!0),Re.length>0?void D.enqueue(Re):await x(D)}catch(k){throw oe.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").error(k),d(k),n.releaseLock(),tt(k)?k:new u("knowledge-graph:unexpected-server-response","Error inside streaming data return parsing",{error:k})}}}),resultHeader:await p}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function Je(e){const t=`${e.url}/dataModel/queryDataModel`,r=await z(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=r.getHeader?.("content-type"),a=r.data;if(n?.includes("application/x-protobuf")){const o=(await h()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!o)throw new u("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return Bt(o)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:r.data})}const An=Object.freeze(Object.defineProperty({__proto__:null,_checkAuthentication:$,_esriRequestWrapper:ae,_fetchWrapper:P,_getClientDataCacheCopy:fr,_setMaxQueryParsingDurationForTesting:on,_submitJobWrapper:We,clearClientDataCache:Cr,clientDataCache:Y,executeAddGraphFieldIndex:Tr,executeAddGraphProperties:xr,executeAddNamedTypes:_r,executeApplyEdits:wr,executeDeleteGraphFieldIndex:kr,executeDeleteGraphProperty:br,executeDeleteNamedType:mr,executeFindPaths:jr,executeFindPathsAsynchronous:Er,executeQuery:Rr,executeQueryStreaming:Sr,executeSearch:$r,executeSearchStreaming:Dr,executeUpdateGraphProperty:Gr,executeUpdateNamedType:vr,executeUpdateSearchIndex:Pr,fetchAllClientDataKeys:Ar,fetchAsynchronousFindPathsResultData:Fr,fetchClientDataAtKeys:Ir,fetchKnowledgeGraph:A,kgRestServices:g,refreshDataModel:te,refreshServiceDefinition:He},Symbol.toStringTag,{value:"Module"}));export{g as J,wr as V,de as a,Sr as i,An as k,Ir as l,h as n,Q as p,Me as r,A as u};
