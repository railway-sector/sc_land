import{pn as y,po as D,pp as F,pq as d,pr as f,ps as A,i3 as g,f1 as v,pt as z,pu as S,gM as m,pv as E,aq as w}from"./index-aRi8Xk-b.js";function $(t,e=!1){return t<=y?e?new Array(t).fill(0):new Array(t):D(t)}function K(t,e,r=null){const n=[],a=e.mapPositions,o=I(e,n),i=o.data,s=o.indices.length,u=F(s);return q(e,n,u),M(e,n,u),x(e,n,u),G(e,n,o.indices,u),R(e,n,o.indices,u),T(e,n),j(e,n,o.indices,u),C(e,n,i),new d(t,n,a,2,r)}function I(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,a=H(r)&&n,o=r.length/3-(a?1:0),i=new Array(2*(o-1)),s=a?r.slice(0,-3):r;let u=0;for(let l=0;l<o-1;l++)i[u++]=l,i[u++]=l+1;const c=new f(s,i,3,a);return e.push(["position",c]),c}function q(t,e,r){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push(["color",new f(n??A,r,4)])}function x(t,e,r){t.attributeData.normal&&e.push(["normal",new f(t.attributeData.normal,r,3)])}function G(t,e,r,n){const a=t.attributeData.colorFeature;a!=null&&(typeof a=="number"?e.push(["colorFeatureAttribute",new f([a],n,1,!0)]):e.push(["colorFeatureAttribute",new f(a,r,1,!0)]))}function M(t,e,r){t.attributeData.sizeFeature==null&&e.push(["size",new f([t.attributeData.size??1],r,1,!0)])}function R(t,e,r,n){const a=t.attributeData.sizeFeature;a!=null&&(typeof a=="number"?e.push(["sizeFeatureAttribute",new f([a],n,1,!0)]):e.push(["sizeFeatureAttribute",new f(a,r,1,!0)]))}function T(t,e){const{attributeData:{position:r,timeStamps:n}}=t;if(!n)return;const a=r.length/3,o=new Array(2*(a-1));let i=0;for(let s=0;s<a-1;s++)o[i++]=s,o[i++]=s+1;e.push(["timeStamps",new f(n,o,h,!0)])}function j(t,e,r,n){const a=t.attributeData.opacityFeature;a!=null&&(typeof a=="number"?e.push(["opacityFeatureAttribute",new f([a],n,1,!0)]):e.push(["opacityFeatureAttribute",new f(a,r,1,!0)]))}function C(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==1||!t.overlayInfo.spatialReference.isGeographic)return;const n=g(r.length),a=v(t.overlayInfo.spatialReference);for(let p=0;p<n.length;p+=3)z(r,p,n,p,a);const o=r.length/3,i=S(o+1);let s=P,u=U,c=0,l=0;m(s,n[l++],n[l++]),l++,i[0]=0;for(let p=1;p<o+1;++p)p===o&&(l=0),m(u,n[l++],n[l++]),l++,c+=E(s,u),i[p]=c,[s,u]=[u,s];e.push(["distanceToStart",new f(i,e[0][1].indices,1,!0)])}function H(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const P=w(),U=w(),h=4;function k(t,e,r,n,a){if(t==null||t.length===0)return[];const o=[];return t.forEach((i,s)=>{const u=i.length,c=g(3*u);i.forEach((p,b)=>{c[3*b]=p[0],c[3*b+1]=p[1],c[3*b+2]=p[2]});const l={attributeData:{position:c,normal:e,colorFeature:r?.[s],opacityFeature:n?.[s],sizeFeature:a?.[s]},removeDuplicateStartEnd:!1};o.push(l)}),o}function L(t,e,r,n,a,o){if(t==null||t.length===0)return[];const i=k(t,e,n,a,o);return t.forEach((s,u)=>{const c=r?.[u],l=c!=null?B(c.timeStamps,c.streamlineType):void 0;i[u].attributeData.timeStamps=l}),i}function B(t,e){const r=$(t.length*h),n=t[0],a=t[t.length-1];for(let o=0;o<t.length;o++)r[o*h]=t[o],r[o*h+1]=n,r[o*h+2]=a,r[o*h+3]=e+.5;return r}export{L as E,k as S,K as f,$ as n};
