import{fJ as b,qK as j,pr as S,gO as $,qL as k,qM as q,fs as y}from"./index-CgzAF5Ey.js";import{f as I}from"./dataUtils-Bl6288_r.js";import{h as A}from"./FeatureTileDescriptor-TRTidUVT.js";class O{constructor(e,t,o,l,i){this.extent=e,this.timeExtent=t,this.size=o,this.pixelRatio=l,this.time=i}get flowExtentInfo(){return{modelSize:this.size,valid:$(this.extent.spatialReference)?.valid,extent:S(this.extent)}}insideMapExtent(e,t){return v(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,o){return E(this.flowExtentInfo,e,t,o)}}function v(n,e,t){const{extent:o,valid:l}=n,[i,s,r,u]=o;return!(t<s||t>u)&&(l!=null&&i>r?e>=r||e<=i:e>=i&&e<=r)}function E(n,e,t,o){const{extent:l,modelSize:i,valid:s}=n,[r,u,c]=l,f=F(r,c,s);let a=e/i[0]*f+r;return s!=null&&o&&(a=new b(s[0],s[1]).normalize(a)),[a,(i[1]-t)/i[1]*j(l)+u]}function R(n,e,t){return t!=null&&Math.abs(n-t.valid[0])<t.dx&&Math.abs(e-t.valid[1])<t.dx}function F(n,e,t){if(t!=null&&n>e){const[o,l]=t;return l-n+(e-o)}return e-n}function T(n){return n?4:3}function B(n){return n[0].vertices instanceof Float32Array}class C{constructor(e,t,o,l,i,s){this.data=e,this.mask=t,this.width=o,this.height=l,this.lij=i,this.extent=s}}function D(n){return A(n.lij[0],n.lij[1],n.lij[2])}function H(n,e){let[t,o,l,i]=[null,null,null,null];for(const s of n){const r=s.extent;t=g(r[0],t),o=g(r[1],o),l=w(r[2],l),i=w(r[3],i)}if(t==null||o==null||l==null||i==null)return null;if(R(t,l,e)){const s=[...n].toSorted((a,h)=>a.extent[0]-h.extent[0]);let r=s[0].extent[2],u=0,c=0,f=0;for(let a=1;a<s.length;a++){const[h,x,d]=s[a].extent;if(r<h&&(f++,u=r,c=h,f>1))break;r=Math.max(r,d)}f===1&&(t=c,l=u)}return y([t,o,l,i])}function w(n,e){return e==null?n:Math.max(n,e)}function g(n,e){return e==null?n:Math.min(n,e)}function N(n,e,t){const[o,l]=t.modelSize;let i=null;const s=new Map;e.forEach(u=>{s.set(u.lij,I(n,u))});const r=(u,c,f)=>q(u.extent,c,f);return(u,c)=>{const f=Math.round(u),a=Math.round(c);if(!n.wrapAround&&(f<0||f>=o||a<0||a>=l))return[0,0];const[h,x]=E(t,u,c,!0);if(!v(t,h,x))return[0,0];if(i==null||!r(i,h,x)){i=null;for(const[G,M]of e)if(r(M,h,x)){i=M;break}}if(i?.data==null)return[0,0];const d=s.get(i.lij);if(d==null)return[0,0];const{width:z,height:p,extent:m}=i;return d((h-m[0])/k(m)*z,p-(x-m[1])/j(m)*p)}}export{B as a,F as b,C as c,T as f,D as h,H as m,O as o,R as s,N as x};
