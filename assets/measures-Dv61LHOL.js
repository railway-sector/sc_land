import{eV as B,dK as z,uB as ee,dM as D,dO as te,bI as F,bz as K,dQ as Q,dR as N,dN as G,dT as H,dV as ne,dW as re,uC as ae,h0 as S,uD as X,uE as se,eM as k,ai as v,b5 as ie,eU as Z}from"./index-aRi8Xk-b.js";import{h as oe}from"./splitCurveAtPoint-BkQeBQSd.js";function O(e,t,n){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]!==void 0&&t[2]!==void 0?(e[2]*n-t[2]*n)**2:0))}function ce(e,t,n){return(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]!==void 0&&t[2]!==void 0?(e[2]*n-t[2]*n)**2:0)}const P=[];for(const e of[[9002,56146130,6131,6132,8050,8051,8228],[9003,5702,6358,6359,6360,8052,8053],[9095,5754]]){const t=e[0];for(let n=1;n<e.length;n++)P[e[n]]=t}const W=[];function w(e){return e.vcsWkid&&P[e.vcsWkid]!==void 0?W[P[e.vcsWkid]]:e.latestVcsWkid&&P[e.latestVcsWkid]!==void 0?W[P[e.latestVcsWkid]]:1}function E(e,t,n){const r=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(r*r+a*a)}function le(e,t,n){const r=t[0]-e[0],a=t[1]-e[1];return r*r+a*a}function ue(e,t){return e.x*t.x+e.y*t.y}function fe(e,t){return e.x*t.y-t.x*e.y}function A(e,t,n=0){for(;e<n;)e+=t;const r=n+t;for(;e>=r;)e-=t;return e}function J(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function Ve(e,t){return A(J(e,t),2*Math.PI)*(180/Math.PI)}function be(e,t){return A(Math.PI/2-J(e,t),2*Math.PI)*(180/Math.PI)}function Y(e,t,n){const r={x:e.x-t.x,y:e.y-t.y},a={x:n.x-t.x,y:n.y-t.y};return Math.atan2(fe(r,a),ue(r,a))}function qe(e,t,n){return B(A(Y(e,t,n),2*Math.PI))}function Ae(e,t,n){return B(A(-1*Y(e,t,n),2*Math.PI))}function de(e,t,n){return Math.max(t,Math.min(n,e))}function he(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ye(e,t,n){const r=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],a=de(he(r,[e[0]-t[0],e[1]-t[1],e[2]-t[2]])/pe(r),0,1);return[t[0]+(n[0]-t[0])*a,t[1]+(n[1]-t[1])*a,t[2]+(n[2]-t[2])*a]}function me(e,t,n){let r=0;const a=n[0]-t[0],o=n[1]-t[1],l=a*a+o*o;return l===0?r=.5:(r=((e[0]-t[0])*a+(e[1]-t[1])*o)/l,r<0?r=0:r>1&&(r=1)),r<=.5?[t[0]+(n[0]-t[0])*r,t[1]+(n[1]-t[1])*r]:[n[0]-(n[0]-t[0])*(1-r),n[1]-(n[1]-t[1])*(1-r)]}W[9002]=.3048,W[9003]=.3048006096012192,W[9095]=.3048007491;function xe(e,t,n){if(z(t))return ee(e,t,n);if(D(t)){const a=te(e,t,n)[0];if(a==null)throw new F("closestPointOnCurve:unexpected-error","Failed to find close point on bezier curve");return a}if(K(t)){const a=Q(e,t);return N(a,n)}if(G(t)){const a=H(e,t);return N(a,n)}const r=ne(e,t);return re(r,n)}function Me(e,t,n=1){if(D(t))return ae(e,t,n);if(K(t)){const r=Q(e,t);return r.isInvalid?Math.sqrt(S(e,t.c[0])):X(r)}if(G(t)){const r=H(e,t);return r.isInvalid?Math.sqrt(S(e,t.a[0])):X(r)}return se(e,t,n)}function Re(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function ge(e){const t=Re(e);return[e[0]/t,e[1]/t,e[2]/t]}function U(e,t,n,r){const a=ge([t[0]-e[0],t[1]-e[1],t[2]*r-e[2]*r]);return[e[0]+a[0]*n,e[1]+a[1]*n,e[2]+a[2]*n]}function C(e,t,n,r){return e+(t-e)/n*r}function j(e,t,n){let r=t[0]-e[0],a=t[1]-e[1];const o=Math.sqrt(r*r+a*a);return r/=o,a/=o,r*=n,a*=n,[e[0]+r,e[1]+a]}function ve(e,t){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const n=e.type==="polygon"?e.rings:e.paths;let r=1;if((e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(r=w(e.spatialReference)/k(e.spatialReference)),n.length===0||n[0].length===0||e.hasM===!1)return null;let a=-1,o=0;const{hasM:l,hasZ:c}=e,u=c?3:2,f=2;for(const s of n){if(a++,s.length>0&&s[0][u]===t)return{partId:a,distanceAlong:o,coordinate:new v({hasZ:c,hasM:l,spatialReference:e.spatialReference,x:s[0][0],y:s[0][1],...c?{z:s[0][f]}:{},...l?{m:s[0][u]}:{}}),segmentId:0};let p=-1;for(let i=1;i<s.length;i++){const x=g(s[i-1],s[i],c,r);p++;const h=s[i][u]-s[i-1][u],d=s[i][u];if(d===t)return{partId:a,distanceAlong:x+o,coordinate:new v({hasZ:c,hasM:l,spatialReference:e.spatialReference,x:s[i][0],y:s[i][1],...c?{z:s[i][f]}:{},...l?{m:s[i][u]}:{}}),segmentId:p};if(d>t&&t>s[i-1][u]){const $=(t-s[i-1][u])/h*x;let y=c?U(s[i-1],s[i],$,r):j(s[i-1],s[i],$);y=[...y,t];const M=new v({hasZ:c,hasM:l,spatialReference:e.spatialReference,x:y[0],y:y[1],...c?{z:y[f]}:{},...l?{m:y[u]}:{}});return{partId:a,distanceAlong:o+g(s[i-1],[M.x,M.y,...c?[M.z]:[],...l?[M.m]:[]],c,r),coordinate:M,segmentId:p}}o+=x}}return null}function $e(e,t){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const n=e.type==="polygon"?e.rings:e.paths;if(t<0)return null;let r=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(r=w(e.spatialReference)/k(e.spatialReference));let a=0;const{hasZ:o,hasM:l}=e,c=o?3:2,u=2;let f=-1;if(t===0)return n.length===0||n[0].length===0?null:{partId:0,coordinate:new v({hasZ:o,hasM:l,spatialReference:e.spatialReference,x:n[0][0][0],y:n[0][0][1],...o?{z:n[0][0][u]}:{},...l?{m:n[0][0][c]}:{}}),segmentId:0};for(const s of n){f++;let p=-1;for(let i=1;i<s.length;i++){p++;const x=g(s[i-1],s[i],o,r),h=a+x;if(h===t)return{partId:f,coordinate:new v({hasZ:o,hasM:l,spatialReference:e.spatialReference,x:s[i][0],y:s[i][1],...o?{z:s[i][u]}:{},...l?{m:s[i][c]}:{}}),segmentId:p};if(h>t){let d=o?U(s[i-1],s[i],t-a,r):j(s[i-1],s[i],t-a);return d=[...d,C(s[i-1][c],s[i][c],x,t-a)],{partId:f,coordinate:new v({hasZ:o,hasM:l,spatialReference:e.spatialReference,x:d[0],y:d[1],...o?{z:d[u]}:{},...l?{m:d[c]}:{}}),segmentId:p}}a=h}}return null}function Ie(e,t){if(!e||!t)return null;let n=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(n=w(t.spatialReference)/k(t.spatialReference));let r=null,a=0;return r=e,a=e.hasZ&&t.hasZ?O([t.x,t.y,t.z],[e.x,e.y,e.z],n):E([t.x,t.y],[e.x,e.y]),{coordinate:r,distance:a}}function Ze(e,t){if(!e||!t)return null;let n=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(n=w(t.spatialReference)/k(t.spatialReference));let r=null,a=0,o=Number.MAX_VALUE,l=-1,c=-1;for(const u of e.points||[]){c++;const f=e.hasZ&&t.hasZ?ce([u[0],u[1],u[2]],[t.x,t.y,t.z],n):le([u[0],u[1]],[t.x,t.y]);f<o&&(o=f,l=c)}return l<0?null:(a=o,r=e.getPoint(l),{coordinate:r,distance:Math.sqrt(a)})}function Pe(e,t){if(!e||!t)return null;const n=e.type==="polygon"?e.curveRings??e.rings:e.curvePaths??e.paths;let r=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(r=w(t.spatialReference)/k(t.spatialReference));let a=Number.MAX_VALUE,o=-1,l=-1,c=-1;const u=e.hasZ&&t.hasZ;let f=null;const s=u?[t.x,t.y,t.z]:[t.x,t.y];for(const R of n){l++;for(let m=1;m<R.length;m++){const I=We(s,R[m-1],R[m],u,r);I.distance<a&&(a=I.distance,f=I.closestPoint,c=l,o=m-1)}}if(o<0||!f)return null;const p=e.hasM&&e.hasZ?3:2,i=2,x=n[c][o],h=Z(x),d=n[c][o+1],$=Z(d);let y=null,M=null,_=u?f[2]:null;const V=z(d)?f:oe(h,d,f,.001)[0];let b=g(h,V,u,r);const L=g(h,d,u,r);e.hasM&&(M=C(h[p],$[p],L,b)),!e.hasZ||t.hasZ!==!1&&z(V)||(_=C(h[i],$[i],L,b),Z(V)[i]=_,b=g(h,V,!0,r)),y=new v({hasZ:u,hasM:e.hasM,spatialReference:t.spatialReference,x:f[0],y:f[1],...e.hasZ?{z:_}:{},...e.hasM?{m:M}:{}});let T=0;for(let R=0;R<=c;R++){const m=n[R],I=R===c?o:m.length-1;for(let q=1;q<=I;q++)T+=g(Z(m[q-1]),m[q],e.hasZ,r)}return T+=b,{partId:c,segmentId:o,coordinate:y,distance:a,distanceAlong:T}}function We(e,t,n,r,a){const o=Z(t);if(z(n)){const c=r?ye(e,o,n):me(e,o,n);return{closestPoint:c,distance:r?O(c,e,a):E(c,e)}}const l=xe(o,n,e);if(!l)throw new F("arcade:closestPointOnSegment","The given point is not on the curve");return{closestPoint:l.curvePoint,distance:l.distance}}function g(e,t,n,r){return z(t)?n?O(e,t,r):E(e,t):Me(e,t,.001)}function ze(e,t){if(!e||!t)return null;if(e.type==="extent"){const n=e;e=new ie({spatialReference:e.spatialReference,rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}switch(e.type){case"point":return Ie(e,t)??null;case"multipoint":return Ze(e,t)??null;case"polygon":case"polyline":return Pe(e,t)??null;default:return null}}const _e=Object.freeze(Object.defineProperty({__proto__:null,distanceToCoordinate:$e,measureToCoordinate:ve,pointToCoordinate:ze},Symbol.toStringTag,{value:"Module"}));export{ve as M,qe as P,ze as W,Ae as Z,be as d,O as e,w as i,_e as m,$e as v,Ve as z};
