import{C as ge,S as oe,a as he,R as be,T as ce}from"./ColorSet-Bz9feQjA.js";import{T as de,a as O}from"./Theme-BVyKZ0d6.js";import{a as S,p as te,b as y,P as pe}from"./Percent-XZYBab5B.js";import{d as fe,C as ee,v as me,g as ne,m as _e,e as R,n as ye,s as k,c as A,G as J,h as $,t as v,L as xe}from"./DefaultTheme-B2D9mfOm.js";import{tm as Y}from"./index-Brd6-W-v.js";import{e as w,i as G}from"./Disposer-BEiFQPZr.js";import{r as D,m as j}from"./Animation-CScr9byu.js";import{S as ve}from"./Slice-BjbqfAhb.js";class we extends de{setupDefaultRules(){super.setupDefaultRules();const t=this._root.interfaceColors,e=this.rule.bind(this);e("PercentSeries").setAll({legendLabelText:"{category}",legendValueText:"{valuePercentTotal.formatNumber('0.00p')}",colors:ge.new(this._root,{}),width:S,height:S}),e("PieChart").setAll({radius:te(80),startAngle:-90,endAngle:270}),e("PieSeries").setAll({alignLabels:!0,startAngle:-90,endAngle:270}),e("PieSeries").states.create("hidden",{endAngle:-90,opacity:0}),e("Slice",["pie"]).setAll({position:"absolute",isMeasured:!1,x:0,y:0,toggleKey:"active",tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}",strokeWidth:1,strokeOpacity:1,role:"figure",lineJoin:"round"}),e("Slice",["pie"]).states.create("active",{shiftRadius:20,scale:1}),e("Slice",["pie"]).states.create("hoverActive",{scale:1.04}),e("Slice",["pie"]).states.create("hover",{scale:1.04}),e("RadialLabel",["pie"]).setAll({textType:"aligned",radius:10,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",paddingTop:5,paddingBottom:5,populateText:!0}),e("Tick",["pie"]).setAll({location:1}),e("SlicedChart").setAll({paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10}),e("FunnelSeries").setAll({startLocation:0,endLocation:1,orientation:"vertical",alignLabels:!0,sequencedInterpolation:!0}),e("FunnelSlice").setAll({interactive:!0,expandDistance:0}),e("FunnelSlice").states.create("hover",{expandDistance:.15}),e("Label",["funnel"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:y}),e("Label",["funnel","horizontal"]).setAll({centerX:0,centerY:y,rotation:-90}),e("Label",["funnel","vertical"]).setAll({centerY:y,centerX:0}),e("Tick",["funnel"]).setAll({location:1}),e("FunnelSlice",["funnel","link"]).setAll({fillOpacity:.5,strokeOpacity:0,expandDistance:-.1}),e("FunnelSlice",["funnel","link","vertical"]).setAll({height:10}),e("FunnelSlice",["funnel","link","horizontal"]).setAll({width:10}),e("PyramidSeries").setAll({valueIs:"area"}),e("FunnelSlice",["pyramid","link"]).setAll({fillOpacity:.5}),e("FunnelSlice",["pyramid","link","vertical"]).setAll({height:0}),e("FunnelSlice",["pyramid","link","horizontal"]).setAll({width:0}),e("FunnelSlice",["pyramid"]).setAll({interactive:!0,expandDistance:0}),e("FunnelSlice",["pyramid"]).states.create("hover",{expandDistance:.15}),e("Label",["pyramid"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:y}),e("Label",["pyramid","horizontal"]).setAll({centerX:0,centerY:y,rotation:-90}),e("Label",["pyramid","vertical"]).setAll({centerY:y,centerX:0}),e("Tick",["pyramid"]).setAll({location:1}),e("FunnelSlice",["pictorial"]).setAll({interactive:!0,tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}"}),e("Label",["pictorial"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:y}),e("Label",["pictorial","horizontal"]).setAll({centerX:0,centerY:y,rotation:-90}),e("Label",["pictorial","vertical"]).setAll({centerY:y,centerX:0}),e("FunnelSlice",["pictorial","link"]).setAll({fillOpacity:.5,width:0,height:0}),e("Tick",["pictorial"]).setAll({location:.5});{const i=e("Graphics",["pictorial","background"]);i.setAll({fillOpacity:.2}),fe(i,"fill",t,"alternativeBackground")}}}class M extends oe{_afterNew(){this._defaultThemes.push(we.new(this._root)),super._afterNew(),this.chartContainer.children.push(this.seriesContainer),this.seriesContainer.children.push(this.bulletsContainer)}_processSeries(t){super._processSeries(t),this.seriesContainer.children.moveValue(this.bulletsContainer,this.seriesContainer.children.length-1)}}Object.defineProperty(M,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentChart"});Object.defineProperty(M,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:oe.classNames.concat([M.className])});class W extends he{constructor(){super(...arguments),Object.defineProperty(this,"slicesContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(ee.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"labelsContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(ee.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"ticksContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(ee.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"_lLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_rLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_hLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"slices",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeSlices())}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeLabels())}),Object.defineProperty(this,"ticks",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeTicks())})}makeSlice(t){const e=this.slicesContainer.children.push(this.slices.make());return e.on("fill",()=>{this.updateLegendMarker(t)}),e.on("fillPattern",()=>{this.updateLegendMarker(t)}),e.on("stroke",()=>{this.updateLegendMarker(t)}),e._setDataItem(t),t.set("slice",e),this.slices.push(e),e}makeLabel(t){const e=this.labelsContainer.children.push(this.labels.make());return e._setDataItem(t),t.set("label",e),this.labels.push(e),e}_shouldMakeBullet(t){return t.get("value")!=null}makeTick(t){const e=this.ticksContainer.children.push(this.ticks.make());return e._setDataItem(t),t.set("tick",e),this.ticks.push(e),e}_afterNew(){this.fields.push("category","fill"),super._afterNew()}_onDataClear(){const t=this.get("colors");t&&t.reset();const e=this.get("patterns");e&&e.reset()}_prepareChildren(){if(super._prepareChildren(),this._lLabels=[],this._rLabels=[],this._hLabels=[],this._valuesDirty){let t=0,e=0,i=0,s=1/0,r=0;w(this._dataItems,l=>{let a=l.get("valueWorking",0);t+=a,e+=Math.abs(a)}),w(this._dataItems,l=>{let a=l.get("valueWorking",0);a>i&&(i=a),a<s&&(s=a),r++;let n=a/e;e==0&&(n=0),l.setRaw("valuePercentTotal",n*100)}),this.setPrivateRaw("valueLow",s),this.setPrivateRaw("valueHigh",i),this.setPrivateRaw("valueSum",t),this.setPrivateRaw("valueAverage",t/r),this.setPrivateRaw("valueAbsoluteSum",e)}}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return Y(this,void 0,void 0,function*(){let i=[];i.push(e.show.call(this,t)),i.push(this._sequencedShowHide(!0,t)),yield Promise.all(i)})}hide(t){const e=Object.create(null,{hide:{get:()=>super.hide}});return Y(this,void 0,void 0,function*(){let i=[];i.push(e.hide.call(this,t)),i.push(this._sequencedShowHide(!1,t)),yield Promise.all(i)})}_updateChildren(){super._updateChildren(),this._valuesDirty&&w(this._dataItems,t=>{t.get("label").text.markDirtyText()}),(this.isDirty("legendLabelText")||this.isDirty("legendValueText"))&&w(this._dataItems,t=>{this.updateLegendValue(t)}),this._arrange()}_arrange(){this._arrangeDown(this._lLabels),this._arrangeUp(this._lLabels),this._arrangeDown(this._rLabels),this._arrangeUp(this._rLabels),this._arrangeLeft(this._hLabels),this._arrangeRight(this._hLabels),w(this.dataItems,t=>{this._updateTick(t)})}_afterChanged(){super._afterChanged(),this._arrange()}processDataItem(t){if(super.processDataItem(t),t.get("fill")==null){let e=this.get("colors");e&&t.setRaw("fill",e.next())}if(t.get("fillPattern")==null){let e=this.get("patterns");e&&t.setRaw("fillPattern",e.next())}}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return Y(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,t,e)];G(e)||(e=this.get("stateAnimationDuration",0));const r=this.get("stateAnimationEasing");let l=t.get("value");const a=t.animate({key:"valueWorking",to:l,duration:e,easing:r});a&&s.push(a.waitForStop());const n=t.get("tick");n&&s.push(n.show(e));const c=t.get("label");c&&s.push(c.show(e));const o=t.get("slice");o&&s.push(o.show(e)),o.get("active")&&o.states.applyAnimate("active"),yield Promise.all(s)})}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return Y(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,t,e)],r=this.states.create("hidden",{});G(e)||(e=r.get("stateAnimationDuration",this.get("stateAnimationDuration",0)));const l=r.get("stateAnimationEasing",this.get("stateAnimationEasing")),a=t.animate({key:"valueWorking",to:0,duration:e,easing:l});a&&s.push(a.waitForStop());const n=t.get("tick");n&&s.push(n.hide(e));const c=t.get("label");c&&s.push(c.hide(e));const o=t.get("slice");o.hideTooltip(),o&&s.push(o.hide(e)),yield Promise.all(s)})}disposeDataItem(t){super.disposeDataItem(t);let e=t.get("label");e&&(this.labels.removeValue(e),e.dispose());let i=t.get("tick");i&&(this.ticks.removeValue(i),i.dispose());let s=t.get("slice");s&&(this.slices.removeValue(s),s.dispose())}hoverDataItem(t){const e=t.get("slice");e&&!e.isHidden()&&e.hover()}unhoverDataItem(t){const e=t.get("slice");e&&e.unhover()}updateLegendMarker(t){if(t){const e=t.get("slice");if(e){const i=t.get("legendDataItem");if(i){const s=i.get("markerRectangle");w(me,r=>{e.get(r)!=null&&s.set(r,e.get(r))})}}}}_arrangeDown(t){if(t){let e=this._getNextDown();t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),w(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.top;i.y+r<e&&(i.y=e-r),i.label.set("y",i.y),e=i.y+s.bottom})}}_getNextUp(){return this.labelsContainer.maxHeight()}_getNextDown(){return 0}_arrangeUp(t){if(t){let e=this._getNextUp();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),w(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.bottom;i.y+r>e&&(i.y=e-r),i.label.set("y",i.y),e=i.y+s.top})}}_arrangeRight(t){if(t){let e=0;t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),w(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.left;i.y+r<e&&(i.y=e-r),i.label.set("x",i.y),e=i.y+s.right})}}_arrangeLeft(t){if(t){let e=this.labelsContainer.maxWidth();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),w(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.right;i.y+r>e&&(i.y=e-r),i.label.set("x",i.y),e=i.y+s.left})}}_updateSize(){super._updateSize(),this.markDirty()}_updateTick(t){}_dispose(){super._dispose();const t=this.chart;t&&t.series.removeValue(this)}}Object.defineProperty(W,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentSeries"});Object.defineProperty(W,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:he.classNames.concat([W.className])});class ie extends M{constructor(){super(...arguments),Object.defineProperty(this,"_maxRadius",{enumerable:!0,configurable:!0,writable:!0,value:1})}_afterNew(){super._afterNew(),this.seriesContainer.setAll({x:y,y})}_prepareChildren(){super._prepareChildren();const t=this.chartContainer,e=t.innerWidth(),i=t.innerHeight(),s=this.get("startAngle",0),r=this.get("endAngle",0),l=this.get("innerRadius");let a=ne(0,0,s,r,1);const n=e/(a.right-a.left),c=i/(a.bottom-a.top);let o={left:0,right:0,top:0,bottom:0};if(l instanceof pe){let g=l.value,b=Math.min(n,c);g=Math.max(b*g,b-Math.min(i,e))/b,o=ne(0,0,s,r,g),this.setPrivateRaw("irModifyer",g/l.value)}a=_e([a,o]);const d=this._maxRadius;this._maxRadius=Math.min(n,c);const h=D(this.get("radius",0),this._maxRadius);this.seriesContainer.setAll({dy:-h*(a.bottom+a.top)/2,dx:-h*(a.right+a.left)/2}),(this.isDirty("startAngle")||this.isDirty("endAngle")||d!=this._maxRadius)&&this.series.each(g=>{g._markDirtyKey("startAngle")}),(this.isDirty("innerRadius")||this.isDirty("radius"))&&this.series.each(g=>{g._markDirtyKey("innerRadius")})}radius(t){let e=D(this.get("radius",0),this._maxRadius),i=D(this.get("innerRadius",0),e);if(t){let s=this.series.indexOf(t),r=this.series.length,l=t.get("radius");return l!=null?i+D(l,e-i):i+(e-i)/r*(s+1)}return e}innerRadius(t){const e=this.radius();let i=D(this.get("innerRadius",0),e);if(i<0&&(i=e+i),t){let s=this.series.indexOf(t),r=this.series.length,l=t.get("innerRadius");return l!=null?i+D(l,e-i):i+(e-i)/r*s}return i}_updateSize(){super._updateSize(),this.markDirtyKey("radius")}}Object.defineProperty(ie,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieChart"});Object.defineProperty(ie,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:M.classNames.concat([ie.className])});class se extends W{_makeSlices(){return new R(O.new({}),()=>ve._new(this._root,{themeTags:j(this.slices.template.get("themeTags",[]),["pie","series"])},[this.slices.template]))}_makeLabels(){return new R(O.new({}),()=>be._new(this._root,{themeTags:j(this.labels.template.get("themeTags",[]),["pie","series"])},[this.labels.template]))}_makeTicks(){return new R(O.new({}),()=>ce._new(this._root,{themeTags:j(this.ticks.template.get("themeTags",[]),["pie","series"])},[this.ticks.template]))}processDataItem(t){super.processDataItem(t);const e=this.makeSlice(t);e.on("scale",()=>{this._updateTick(t)}),e.on("shiftRadius",()=>{this._updateTick(t)}),e.events.on("positionchanged",()=>{this._updateTick(t)});const i=this.makeLabel(t);i.events.on("positionchanged",()=>{this._updateTick(t)}),this.makeTick(t),e.events.on("positionchanged",()=>{i.markDirty()})}_getNextUp(){const t=this.chart;return t?t._maxRadius:this.labelsContainer.maxHeight()/2}_getNextDown(){const t=this.chart;return t?-t._maxRadius:-this.labelsContainer.maxHeight()/2}_prepareChildren(){super._prepareChildren();const t=this.chart;if(t){if(this.isDirty("alignLabels")){let e=this.labels.template;if(this.get("alignLabels"))e.set("textType","aligned");else{let i=e.get("textType");(i==null||i=="aligned")&&e.set("textType","adjusted")}}if(this._valuesDirty||this.isDirty("radius")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("endAngle")||this.isDirty("alignLabels")){this.markDirtyBounds();const e=this.get("startAngle",t.get("startAngle",-90)),s=this.get("endAngle",t.get("endAngle",270))-e;let r=e;const l=t.radius(this);this.setPrivateRaw("radius",l);let a=t.innerRadius(this)*t.getPrivate("irModifyer",1);a<0&&(a=l+a),w(this._dataItems,n=>{this.updateLegendValue(n);let c=s*n.get("valuePercentTotal")/100;const o=n.get("slice");if(o){o.set("radius",l),o.set("innerRadius",a),o.set("startAngle",r),o.set("arc",c);const g=n.get("fill");o._setDefault("fill",g),o._setDefault("stroke",g);const b=n.get("fillPattern");o._setDefault("fillPattern",b)}let d=ye(r+c/2);const h=n.get("label");if(h&&(h.setPrivate("radius",l),h.setPrivate("innerRadius",a),h.set("labelAngle",d),h.get("textType")=="aligned")){let g=l+h.get("radius",0),b=l*k(d);d>90&&d<=270?(!h.isHidden()&&!h.isHiding()&&this._lLabels.push({label:h,y:b}),g*=-1,g-=this.labelsContainer.get("paddingLeft",0),h.set("centerX",S),h.setPrivateRaw("left",!0)):(!h.isHidden()&&!h.isHiding()&&this._rLabels.push({label:h,y:b}),g+=this.labelsContainer.get("paddingRight",0),h.set("centerX",0),h.setPrivateRaw("left",!1)),h.set("x",g),h.set("y",l*k(d))}r+=c,this._updateTick(n)})}}}_updateTick(t){const e=t.get("tick"),i=t.get("label"),s=t.get("slice"),r=e.get("location",1);if(e&&i&&s){const l=(s.get("shiftRadius",0)+s.get("radius",0))*s.get("scale",1)*r,a=i.get("labelAngle",0),n=A(a),c=k(a),o=this.labelsContainer,d=o.get("paddingLeft",0),h=o.get("paddingRight",0);let g=0,b=0;g=i.x(),b=i.y();let u=[];if(g!=0||b!=0){if(i.get("textType")=="circular"){const m=i.radius()-i.get("paddingBottom",0),_=i.get("labelAngle",0);g=m*A(_),b=m*k(_)}let p=-h;i.getPrivate("left")&&(p=d),u=[{x:s.x()+l*n,y:s.y()+l*c},{x:g+p,y:b},{x:g,y:b}]}e.set("points",u)}}_positionBullet(t){const e=t.get("sprite");if(e){const s=e.dataItem.get("slice");if(s){const r=s.get("innerRadius",0),l=s.get("radius",0),a=s.get("startAngle",0),n=s.get("arc",0),c=t.get("locationX",.5),o=t.get("locationY",.5),d=a+n*c,h=r+(l-r)*o;e.setAll({x:A(d)*h,y:k(d)*h})}}}}Object.defineProperty(se,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieSeries"});Object.defineProperty(se,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:W.classNames.concat([se.className])});class U extends J{constructor(){super(...arguments),Object.defineProperty(this,"_projectionDirty",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_tlx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_tly",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_trx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_try",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_blx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_bly",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_brx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_bry",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cprx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cplx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cpry",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cply",{enumerable:!0,configurable:!0,writable:!0,value:0})}_afterNew(){super._afterNew(),this.set("draw",t=>{const e=this.width(),i=this.height();let s=Math.min(e,i)/2,r=D(this.get("cornerRadiusTL",0),s),l=D(this.get("cornerRadiusTR",0),s),a=D(this.get("cornerRadiusBR",0),s),n=D(this.get("cornerRadiusBL",0),s),c=this._trx,o=this._try,d=this._tlx,h=this._tly,g=this._brx,b=this._bry,u=this._blx,p=this._bly;o==h&&(o=o-.01),b==p&&(b=b-.01);let m=$({x:d,y:h},{x:c,y:o}),_=$({x:c,y:o},{x:g,y:b}),x=$({x:g,y:b},{x:u,y:p}),f=$({x:u,y:p},{x:d,y:h});this.get("orientation")=="horizontal"?(r=Math.min(r,Math.abs(h-o)/2),l=Math.min(l,Math.abs(h-o)/2),a=Math.min(a,Math.abs(p-b)/2),n=Math.min(n,Math.abs(p-b)/2)):(r=Math.min(r,Math.abs(d-c)/2),l=Math.min(l,Math.abs(d-c)/2),a=Math.min(a,Math.abs(u-g)/2),n=Math.min(n,Math.abs(u-g)/2));const P=d-r*v((m-f)/2)*A(f),T=h-r*v((m-f)/2)*k(f),H=d-r*v((f-m)/2)*A(m),B=h-r*v((f-m)/2)*k(m),L=c-l*v((_-m)/2)*A(m),Q=o-l*v((_-m)/2)*k(m),N=c-l*v((m-_)/2)*A(_),X=o-l*v((m-_)/2)*k(_),V=g-a*v((x-_)/2)*A(_),z=b-a*v((x-_)/2)*k(_),F=g-a*v((_-x)/2)*A(x),q=b-a*v((_-x)/2)*k(x),ae=u-n*v((f-x)/2)*A(x),Z=p-n*v((f-x)/2)*k(x),I=u-n*v((x-f)/2)*A(f),ue=p-n*v((x-f)/2)*k(f);t.moveTo(H,B),t.lineTo(L,Q),t.arcTo(c,o,N,X,l),t.quadraticCurveTo(this._cprx,this._cpry,V,z),t.arcTo(g,b,F,q,a),t.lineTo(ae,Z),t.arcTo(u,p,I,ue,n),t.quadraticCurveTo(this._cplx,this._cply,P,T),t.arcTo(d,h,H,B,r)})}getPoint(t,e){let i=this.width(),s=this.height();const r=this.get("topWidth",0),l=this.get("bottomWidth",0);if(this.get("orientation")=="vertical"){let a=-r/2,n=r/2,c=l/2,o=-l/2,d=a+(o-a)*e,h=n+(c-n)*e;return{x:d+(h-d)*t,y:s*e}}else{let a=-r/2,n=r/2,c=l/2,o=-l/2,d=a+(o-a)*t,h=n+(c-n)*t;return{x:i*t,y:d+(h-d)*e}}}_changed(){if(this.isDirty("topWidth")||this.isDirty("bottomWidth")||this.isDirty("expandDistance")||this.isDirty("orientation")||this.isDirty("width")||this.isDirty("height")){const t=this.width(),e=this.height(),i=this.get("topWidth",0),s=this.get("bottomWidth",0);this._clear=!0;let r=this.get("expandDistance",0);this.get("orientation")=="vertical"?(this._tlx=-i/2,this._tly=0,this._trx=i/2,this._try=0,this._brx=s/2,this._bry=e,this._blx=-s/2,this._bly=e,this._cprx=this._trx+(this._brx-this._trx)/2+r*e,this._cpry=this._try+.5*e,this._cplx=this._tlx+(this._blx-this._tlx)/2-r*e,this._cply=this._tly+.5*e):(this._tly=i/2,this._tlx=0,this._try=-i/2,this._trx=0,this._bry=-s/2,this._brx=t,this._bly=s/2,this._blx=t,this._cpry=this._try+(this._bry-this._try)/2-r*t,this._cprx=this._trx+.5*t,this._cply=this._tly+(this._bly-this._tly)/2+r*t,this._cplx=this._tlx+.5*t)}super._changed()}}Object.defineProperty(U,"className",{enumerable:!0,configurable:!0,writable:!0,value:"FunnelSlice"});Object.defineProperty(U,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:J.classNames.concat([U.className])});class K extends W{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"funnel"}),Object.defineProperty(this,"links",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeLinks())}),Object.defineProperty(this,"_total",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_count",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_nextCoord",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_opposite",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_makeSlices(){return new R(O.new({}),()=>U._new(this._root,{themeTags:j(this.slices.template.get("themeTags",[]),[this._tag,"series","slice",this.get("orientation")])},[this.slices.template]))}_makeLabels(){return new R(O.new({}),()=>xe._new(this._root,{themeTags:j(this.labels.template.get("themeTags",[]),[this._tag,"series","label",this.get("orientation")])},[this.labels.template]))}_makeTicks(){return new R(O.new({}),()=>ce._new(this._root,{themeTags:j(this.ticks.template.get("themeTags",[]),[this._tag,"series","tick",this.get("orientation")])},[this.ticks.template]))}_makeLinks(){return new R(O.new({}),()=>U._new(this._root,{themeTags:j(this.links.template.get("themeTags",[]),[this._tag,"series","link",this.get("orientation")])},[this.links.template]))}makeLink(t){const e=this.slicesContainer.children.push(this.links.make());return e._setDataItem(t),t.set("link",e),this.links.push(e),e}_afterNew(){super._afterNew();const t=this.slicesContainer;t.setAll({isMeasured:!0,position:"relative",width:te(100),height:te(100)}),t.onPrivate("width",()=>{this.markDirtySize()}),t.onPrivate("height",()=>{this.markDirtySize()}),this.get("orientation")=="vertical"?this.set("layout",this._root.horizontalLayout):this.set("layout",this._root.verticalLayout)}processDataItem(t){super.processDataItem(t);const e=this.makeSlice(t);e._setDataItem(t),t.set("slice",e),this.makeLink(t);const i=this.makeLabel(t);i.on("x",()=>{this._updateTick(t)}),i.on("y",()=>{this._updateTick(t)}),this.makeTick(t),e.events.on("positionchanged",()=>{i.markDirty()}),e.events.on("boundschanged",()=>{const s=e.dataItem;s&&this._updateTick(s)})}_updateChildren(){this._opposite=!1,this.children.indexOf(this.labelsContainer)==0&&(this._opposite=!0);let t=0,e=0;if(w(this.dataItems,i=>{const s=i.get("value");G(s)&&(e++,s>0?t+=Math.abs(i.get("valueWorking",s)/s):this.get("ignoreZeroValues",!1)||i.isHidden()?e--:t+=1)}),this._total=1/e*t,this._count=e,this.isDirty("alignLabels")&&this._fixLayout(),this._total>0&&(this._valuesDirty||this._sizeDirty)){const i=this.slicesContainer;let s;this.get("orientation")=="vertical"?s=i.innerHeight():s=i.innerWidth(),this._nextCoord=this.get("startLocation",0)*s,this.markDirtyBounds();let r=0;w(this._dataItems,l=>{this.updateLegendValue(l),l.set("index",r),r++;const a=l.get("slice"),n=l.get("tick"),c=l.get("label"),o=l.get("link"),d=l.get("fill"),h=l.get("fillPattern");a._setDefault("fill",d),a._setDefault("stroke",d),a._setDefault("fillPattern",h),o._setDefault("fill",d),o._setDefault("stroke",d);const g=l.get("value");G(g)&&(g==0&&this.get("ignoreZeroValues")?(a.setPrivate("visible",!1),n.setPrivate("visible",!1),c.setPrivate("visible",!1)):(a.setPrivate("visible",!0),n.setPrivate("visible",!0),c.setPrivate("visible",!0),this.decorateSlice(l),this.isLast(l)?o.setPrivate("visible",!1):l.isHidden()||o.setPrivate("visible",!0)))})}super._updateChildren()}_fixLayout(){const t=this.get("orientation"),e=this.labelsContainer,i=this.labels.template;this.get("alignLabels")?(e.set("position","relative"),e.setAll({isMeasured:!0}),t=="vertical"?(this.set("layout",this._root.horizontalLayout),i.setAll({centerX:S,x:S})):(this.set("layout",this._root.verticalLayout),i.setAll({centerX:0,x:0}))):(e.setAll({isMeasured:!1,position:"absolute"}),t=="vertical"?(e.setAll({x:y}),i.setAll({centerX:y,x:0})):(e.setAll({y}),i.setAll({centerX:y,y:0}))),this.markDirtySize()}getNextValue(t){let e=t.get("index"),i=t.get("valueWorking",0);if(e<this.dataItems.length-1){let s=this.dataItems[e+1];if(i=s.get("valueWorking",0),s.isHidden()||s.get("value")==0&&this.get("ignoreZeroValues"))return this.getNextValue(s)}return i}isLast(t){let e=t.get("index");if(e==this.dataItems.length-1)return!0;for(let i=e+1;i<this.dataItems.length;i++)if(!this.dataItems[i].isHidden())return!1;return!0}decorateSlice(t){const e=this.get("orientation"),i=t.get("slice"),s=t.get("label"),r=t.get("link"),l=this.slicesContainer;let a=l.innerWidth(),n=l.innerHeight(),c=a;e=="horizontal"&&(c=n);const o=this.getNextValue(t),d=t.get("value",0),h=Math.abs(t.get("valueWorking",d)),g=this.get("bottomRatio",0),b=this.getPrivate("valueHigh",0);let u=1;d!=0?u=h/Math.abs(d):t.isHidden()&&(u=1e-6),this._nextCoord==1/0&&(this._nextCoord=0);let p=h/b*c,m=(h-(h-o)*g)/b*c;i.setAll({topWidth:p,bottomWidth:m,orientation:e}),r.setAll({topWidth:m,bottomWidth:(h-(h-o))/b*c,orientation:e});const _=this.get("startLocation",0),x=this.get("endLocation",1);if(e=="vertical"){let f=r.height()*u;n=n*(x-_)+f,i.set("y",this._nextCoord);let P=Math.min(1e5,Math.max(0,n/this._count*u/this._total-f));i.setAll({height:P,x:a/2});let T=this._nextCoord+P/2;s.set("y",T),this._nextCoord+=P+f,r.setAll({y:this._nextCoord-f,x:a/2})}else{let f=r.width()*u;a=a*(x-_)+f,i.set("x",this._nextCoord);let P=Math.min(1e5,Math.max(0,a/this._count*u/this._total-f));i.setAll({width:P,y:n/2});const T=this._nextCoord+P/2;s.set("x",T),this._nextCoord+=P+f,r.setAll({x:this._nextCoord-f,y:n/2})}}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return Y(this,void 0,void 0,function*(){return t.get("link").hide(e),i.hideDataItem.call(this,t,e)})}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return Y(this,void 0,void 0,function*(){return t.get("link").show(e),i.showDataItem.call(this,t,e)})}_updateTick(t){if(this.get("alignLabels")){const e=t.get("tick"),i=t.get("label"),s=t.get("slice");if(e&&s&&i){const r=this.labelsContainer,l=this.slicesContainer;let a=e.get("location",.5);const n=r.width(),c=r.height(),o=r.get("paddingLeft",0),d=r.get("paddingRight",0),h=r.get("paddingTop",0),g=r.get("paddingBottom",0);let b={x:0,y:0},u={x:0,y:0},p={x:0,y:0};this._opposite&&(a=1-a),this.get("orientation")=="vertical"?(b=s.getPoint(a,.5),b.x+=s.x()+l.x(),b.y+=s.y()+l.y(),this._opposite?(u.x=n,u.y=i.y(),p.x=n-o,p.y=u.y):(u.x=l.x()+l.width(),u.y=i.y(),p.x=u.x+n-i.width()-d,p.y=u.y)):(b=s.getPoint(.5,a),b.x+=s.x()+l.x(),b.y+=s.y()+l.y(),this._opposite?(u.y=c,u.x=i.x(),p.y=c-h,p.x=u.x):(u.y=l.y()+l.height(),u.x=i.x(),p.y=u.y+c-i.height()-g,p.x=u.x)),e.set("points",[b,u,p])}}}disposeDataItem(t){super.disposeDataItem(t);let e=t.get("link");e&&(this.links.removeValue(e),e.dispose())}_positionBullet(t){const e=t.get("sprite");if(e){const s=e.dataItem.get("slice");if(s){const r=s.width(),l=s.height(),a=t.get("locationX",.5),n=t.get("locationY",.5);let c=0,o=0;this.get("orientation")=="horizontal"?o=l/2:c=r/2,e.setAll({x:s.x()+r*a-c,y:s.y()-o+l*n})}}}}Object.defineProperty(K,"className",{enumerable:!0,configurable:!0,writable:!0,value:"FunnelSeries"});Object.defineProperty(K,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:W.classNames.concat([K.className])});class E extends K{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"pyramid"}),Object.defineProperty(this,"_nextSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_prepareChildren(){super._prepareChildren(),this._nextSize=void 0}decorateSlice(t){const e=this.get("orientation"),i=this.slicesContainer,s=t.get("slice"),r=t.get("label"),l=t.get("link"),a=this.get("valueIs","area"),n=this.getPrivate("valueAbsoluteSum",0);if(n==0)return;const c=this.get("startLocation",0),o=this.get("endLocation",1),d=this.get("topWidth",0),h=this.get("bottomWidth",S),g=Math.abs(t.get("valueWorking",0)),b=t.get("value",0);let u,p,m=i.innerHeight(),_=i.innerWidth(),x=l.width(),f=l.height();e=="horizontal"&&([_,m]=[m,_],[x,f]=[f,x]);const P=_/2;let T=1;b!=0?T=g/Math.abs(b):t.isHidden()&&(T=1e-6),f*=T,m=m*(o-c)-f*(this._count*this._total-1);let H=D(d,_);G(this._nextSize)||(this._nextSize=H);let B=D(h,_),L=this._nextSize,Q=Math.atan2(m,H-B),N=Math.tan(Math.PI/2-Q);if(N==0&&(N=1e-8),a=="area"){let Z=(H+B)/2*m*g/n,I=Math.abs(L*L-2*Z*N);u=(L-Math.sqrt(I))/N,u>0?p=(2*Z-u*L)/u:p=L}else u=m*g/n,p=L-u*N;let X=this._nextCoord+u/2,V=P,z=this._nextCoord,F=P,q=z+u;e=="vertical"?(r.set("y",X),r.get("opacity")>0&&this._rLabels.push({label:r,y:X}),s.set("height",u)):(r.set("x",X),r.get("opacity")>0&&this._hLabels.push({label:r,y:X}),[V,z]=[z,V],[F,q]=[q,F],s.set("width",u)),s.setAll({orientation:e,bottomWidth:p,topWidth:L,x:V,y:z}),l.setAll({orientation:e,x:F,y:q,topWidth:p,bottomWidth:p}),this._nextSize=p,this._nextCoord+=u+f}}Object.defineProperty(E,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PyramidSeries"});Object.defineProperty(E,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:K.classNames.concat([E.className])});class re extends E{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"pictorial"}),Object.defineProperty(this,"seriesMask",{enumerable:!0,configurable:!0,writable:!0,value:J.new(this._root,{position:"absolute",x:y,y,centerX:y,centerY:y})}),Object.defineProperty(this,"seriesGraphics",{enumerable:!0,configurable:!0,writable:!0,value:this.slicesContainer.children.push(J.new(this._root,{themeTags:["pictorial","background"],position:"absolute",x:y,y,centerX:y,centerY:y}))})}_afterNew(){super._afterNew(),this.set("topWidth",S),this.set("bottomWidth",S),this.set("valueIs","height"),this.slicesContainer.set("mask",this.seriesMask)}_updateScale(){let t=this.slicesContainer,e=t.innerWidth(),i=t.innerHeight(),s=this.seriesMask,r=this.seriesGraphics,l=s.get("scale",1);const a=s.localBounds();let n=a.right-a.left,c=a.bottom-a.top;this.get("orientation")=="horizontal"?l=e/n:l=i/c,l!=1/0&&l!=NaN&&(s.set("scale",l),s.set("x",e/2),s.set("y",i/2),r.set("scale",l),r.set("x",e/2),r.set("y",i/2))}_prepareChildren(){if(super._prepareChildren(),this.isDirty("svgPath")){const t=this.get("svgPath");this.seriesMask.set("svgPath",t),this.seriesGraphics.set("svgPath",t)}this._updateScale()}}Object.defineProperty(re,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PictorialStackedSeries"});Object.defineProperty(re,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:E.classNames.concat([re.className])});class le extends M{_afterNew(){super._afterNew(),this.seriesContainer.setAll({isMeasured:!0,layout:this._root.horizontalLayout})}}Object.defineProperty(le,"className",{enumerable:!0,configurable:!0,writable:!0,value:"SlicedChart"});Object.defineProperty(le,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:M.classNames.concat([le.className])});export{we as DefaultTheme,K as FunnelSeries,U as FunnelSlice,M as PercentChart,W as PercentSeries,re as PictorialStackedSeries,ie as PieChart,se as PieSeries,E as PyramidSeries,le as SlicedChart};
