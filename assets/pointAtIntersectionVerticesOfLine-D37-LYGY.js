import{u as k,y as M}from"./customElement-B5XwxIK1.js";import{g as q,h as z,y as C,m as v,u as A}from"./builderUtils-CtUzeS_a.js";import{g as F}from"./offsetUtils-BdFSC4dM.js";import{g as G,y as H,R as L}from"./shapeUtils-CqSaz5wj.js";import{i as Q,n as U}from"./createTemplateExecutor-COTtwtiQ.js";import{nL as P,a$ as j}from"./index-CVzGOCNQ.js";import{n as B}from"./intersectsOperator-JGCLrhKn.js";import{fromSpatialReference as D}from"./apiConverter-BzlOtf7d.js";import"./SketchOptions-jDwM9f-P.js";import"./SketchLabelOptions-CqH3Ufpn.js";import"./Attachments-CJ3fUOq4.js";import"./AttachmentsViewModel-CU6a6j5Q.js";import"./AttachmentInfo-QjQb7hJP.js";import"./featureUtils-CRixeKPJ.js";import"./attachmentUtils-B0TajW9L.js";import"./legacyIcon-BpbXCnGp.js";import"./featureFormUtils-DZCGk7i8.js";import"./dateUtils-CPMrUQV3.js";import"./arcade-CWm4oESS.js";import"./arcadeEnvironment-IAD0yQdg.js";import"./ImmutableArray-BPVd6ESQ.js";import"./FeatureForm-QvbMddgC.js";import"./FieldInput-BteTLhpi.js";import"./Heading-DCecCONm.js";import"./FeatureRelationshipViewModel-BockPlm6.js";import"./FeatureTemplates-BkkRmfJP.js";import"./FeatureService-C87EUQvv.js";import"./applyEditsUtils-stzT1Xy5.js";import"./MeshTransform-D2izkyal.js";import"./editingSupport-Brqgmc_m.js";import"./utils-Cje67gBa.js";import"./Spinner-Bmgoy0XR.js";import"./AnchorElementViewModel-DrYGvaIz.js";import"./GraphicsLayer-Bv5fg2Ea.js";import"./SnappingManager-BNZlGG0z.js";import"./euclideanLengthMeasurementUtils-DBiCfquW.js";import"./geometry2dUtils-LjZtnzdA.js";import"./geodeticLengthOperator-BIEHzJmk.js";import"./geodeticCurveType-CirnHLSB.js";import"./helpMessageUtils-2XpUG8Xk.js";import"./HighlightHelper-ZJj2OtmY.js";import"./layerUtils-D052B-tr.js";import"./GraphicState-BVJRwWh9.js";import"./DrawingMode-Cvvf0VVz.js";import"./SketchViewModel-Bt1xgiPE.js";import"./isSupportedObject-R_XZCIzy.js";import"./automaticAreaMeasurementUtils-DmTPCnFV.js";import"./geodesicAreaMeasurementUtils-D_rqVMY2.js";import"./earcut-D9gy186-.js";import"./automaticLengthMeasurementUtils-Blbew1js.js";import"./utils-qyn4azVp.js";import"./splitCurveAtPoint-BN0rTVUt.js";import"./coordinateHelper-B96_yUPb.js";import"./SelectionToolbar-Bd1CV6TX.js";import"./directionModeIcons-Br5woIHu.js";import"./uploadAssetErrors-CZRLhg8s.js";import"./createPresetServiceEdit--3aH-DZE.js";import"./affineTransformOperator-3JYdP7s9.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./Point2D-8Py_srEd.js";import"./Transformation-7C1WgwNJ.js";import"./Transformation2D-Ckyhe4wc.js";import"./Envelope2D-DQ3Tn1o-.js";import"./ProjectionTransformation-KGXLRiS7.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./jsonConverter-5JRjSyWN.js";import"./operatorOffset-D0-G8w1V.js";import"./OperatorIntersects-Bnu38Z1A.js";function sr(i){if(J(i)&&i.mode!=="digitizing")return E(i)}async function E({templatePart:i,parentTemplate:p,shape:a,edits:n,relationships:S,mode:T}){const{builderConfig:f}=i,s=q(f),g=z(f),V=C(f),l=v(f,g),t=V||s===0?a:F(a,s);if(t===null)return;const e=p.layer.createQuery();e.geometry=t,e.spatialRelationship="intersects",e.returnM=!0,e.returnZ=!0,e.outSpatialReference=t.spatialReference,e.cacheHint=!1,e.returnGeometry=!0,e.historicMoment=p.layer.historicMoment,e.gdbVersion=p.layer.gdbVersion;const w=2*(D(t.spatialReference)?.getTolerance()??.001);e.distance=w;const{features:y}=await p.layer.queryFeatures(e);if(y.length===0)return;const R=[];for(const r of y)R.push(I(r.geometry));const u=k(t.spatialReference);let d=0,$=0;for(let r=0;r<t.paths.length&&!(n.length>U);r++){const h=t.paths[r].length;for(let o=0;o<h;o++){let m=t.getPoint(r,o);if(m!=null){for(const x of R)if(B(m,x)){if(o>0&&l!==0&&(d+=t.hasZ?M(t.paths[r][o-1],t.paths[r][o],u):P(t.paths[r][o-1],t.paths[r][o])),l!==0){let Z=1;if(g){const c=l<0?o-1:o+1;if(c>=h||c<0)return;Z=t.hasZ?M(t.paths[r][o],t.paths[r][c],u):P(t.paths[r][o],t.paths[r][c])}const b=d+Z*l;m=t.hasZ?G(t,b,s,u):H(t,b,s)}else s!==0&&(m=L(m,o===h-1?[t.paths[r][o-1],t.paths[r][o]]:[t.paths[r][o],t.paths[r][o+1]],s));m&&A({templatePart:i,shape:m,edits:n,relationships:S,mode:T},`V${$.toString()}`);break}$++}}}}function I(i){const p=[];for(const a of i.paths)for(const n of a)p.push([...n]);return new j({spatialReference:i.spatialReference,points:p})}function J(i){return i.parentTemplate!=null&&Q(i.shape)}const ar=!0;export{sr as execute,ar as isAsync};
