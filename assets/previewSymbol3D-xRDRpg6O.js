import{bS as B,dg as M,a5 as H,a0 as A,fX as G,fY as J,fZ as K,f_ as Q}from"./index-CgzAF5Ey.js";import{f as V,b as X,w as W}from"./gfxUtils-B1R76T6S.js";import{u as S,t as j,s as Y,l as _,L as $,p as ee,o as te,n as ae,e as le,c as ne,m as se}from"./previewUtils-m-R88IBt.js";import{l as F,d as re}from"./symbolUtils-0l5vVMbV.js";import{h as oe,d as ie}from"./utils-BxeCvIiv.js";import{resolveWebStyleSymbol as ce}from"./webStyleSymbolUtils-onUVZ_RA.js";import"./cimSymbolUtils-D8zbHeXT.js";import"./svgUtils-smkwubCy.js";import"./mat2df32-Dpt2CT5P.js";import"./mat2d-DWPHXQcf.js";import"./devEnvironmentUtils-8WtPGj6h.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";const L=22,D=120,O=80,I=50,q=20;function z(e){const t=e.outline,l=e.material!=null?e.material.color:null,a=l!=null?l.toHex():null;if(t==null||"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&a==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=M(t.size)||0;return{color:"rgba("+(t.color!=null?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,O),style:"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"?W(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}async function ue(e,t){if(e.thumbnail?.url)return e.thumbnail.url;if(t.type==="icon"&&t?.resource?.href)return ie(t);const l=B("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const a=await ce(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(a&&"thumbnail"in a&&a.thumbnail?.url)return a.thumbnail.url}return l}function Z(e,t=1){const l=e.a,a=G(e),s=a.h,c=a.s/t,o=100-(100-a.v)/t,{r:m,g:y,b:i}=J({h:s,s:c,v:o});return[m,y,i,l]}function C(e){return e.type==="water"?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function r(e,t=0){const l=C(e);if(!l){if(e.type==="fill")return null;const s=X.r,c=S(s,t);return[c,c,c,100]}const a=l.toRgba();for(let s=0;s<3;s++)a[s]=S(a[s],t);return a}async function pe(e,t){const l=e.style;return l==="none"?null:{type:"pattern",x:0,y:0,src:await V(B(`esri/symbols/patterns/${l}.png`),t.toCss(!0)),width:5,height:5}}function N(e){return e.outline?z(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function R(e,t){const l=C(e);if(!l)return null;let a="rgba(";return a+=S(l.r,t)+",",a+=S(l.g,t)+",",a+=S(l.b,t)+",",a+l.a+");"}function T(e,t){const l=e.edges;return!l||!l.color||!l.size?null:{color:l.color.toCss(!0),width:Math.min(M(l.size),t,O),join:"round"}}function E(e,t){const l=R(e,t);if(!l||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const a={color:l,width:Math.min(e.size?M(e.size):.75,O)};return"pattern"in e&&e.pattern?.type==="style"&&(a.style=W(e.pattern.style)),"cap"in e&&e.cap&&(a.cap=e.cap),"join"in e&&e.join&&(a.join=e.join==="miter"?M(2):e.join),a}function P(e,t,l){const a=l!=null?.75*l:0;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function he(e){const t=e.depth,l=e.height,a=e.width;return a!==0&&t!==0&&l!==0&&a===t&&a!=null&&l!=null&&a<l}function me(e,t,l){const a=[];if(!e)return a;switch(e.type){case"icon":{const o=t,m=t;switch(e.resource?.primitive??Q){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:r(e,0),stroke:z(e)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,m]},{command:"M",values:[0,.5*m]},{command:"L",values:[o,.5*m]}]},stroke:N(e)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,m]},{command:"M",values:[o,0]},{command:"L",values:[0,m]}]},stroke:N(e)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*m]},{command:"L",values:[.5*o,m]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)})}break}case"object":switch(e.resource?.primitive??K){case"cone":{const s=P(r(e,0),r(e,-.6),l?q:t),c=ae(t,l);a.push({shape:c[0],fill:s},{shape:c[1],fill:s});break}case"inverted-cone":{const s=r(e,0),c=P(s,r(e,-.6),t),o=te(t);a.push({shape:o[0],fill:c},{shape:o[1],fill:s});break}case"cube":{const s=ee(t,l);a.push({shape:s[0],fill:r(e,0)},{shape:s[1],fill:r(e,-.3)},{shape:s[2],fill:r(e,-.5)});break}case"cylinder":{const s=P(r(e,0),r(e,-.6),l?q:t),c=$(t,l);a.push({shape:c[0],fill:s},{shape:c[1],fill:s},{shape:c[2],fill:r(e,0)});break}case"diamond":{const s=_(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.3)},{shape:s[3],fill:r(e,-.7)});break}case"sphere":{const s=P(r(e,0),r(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=Y(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.6)});break}}break}return a}function U(e){const t=typeof e?.size=="number"?e?.size:null;return t?M(t):null}function fe(e){return e.type==="icon"?"multiply":"tint"}async function ye(e,t){const l=U(t),a=t?.maxSize?M(t.maxSize):null,s=t?.disableUpsampling??!1,c=e.symbolLayers,o=[],m=[];let y=!1,i=0,d=0,w=0;c.forEach(n=>{if(n.type!=="icon"&&n.type!=="object")return;n&&n.type==="icon"&&(w=Math.max(n.size&&M(n.size),w));const p=n.type==="icon"?n.size&&M(n.size):0,h=l||p?Math.ceil(Math.min(l||p,a||D)):L;let f=n.type==="icon"?n.angle:null;if(t?.rotation!=null&&(f=(f??0)+t.rotation),m.push(f),n?.resource?.href){const b=ue(e,n).then(k=>{const v=n?.material?.color,x=fe(n);return re(k,h,v,x,s)}).then(k=>{const v=k.width,x=k.height;return i=Math.max(i,v),d=Math.max(d,x),f&&(y=!0),[{shape:{type:"image",x:0,y:0,width:v,height:x,src:k.url},fill:null,stroke:null}]});o.push(b)}else{let b=h;n.type==="icon"&&l&&(b=h*(p/w));const k=t?.symbolConfig==="tall"||t?.symbolConfig?.isTall||n.type==="object"&&he(n);i=Math.max(i,k?q:b),d=Math.max(d,b),f&&n.resource?.primitive&&["square","triangle","x"].includes(n.resource?.primitive)&&(y=!0),o.push(Promise.resolve(me(n,b,k)))}});const u=await Promise.allSettled(o),g=[];return u.forEach(n=>{n.status==="fulfilled"?g.push(n.value):n.reason&&A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",n.reason)}),F(g,[i,d],{node:t?.node,scale:!1,opacity:t?.opacity,ariaLabel:t?.ariaLabel,rotations:m,useRotationSize:y})}function de(e,t){const l=e.symbolLayers,a=[],s=oe(e),c=U(t),o=(t?.maxSize?M(t.maxSize):null)||O;let m,y=0,i=0;return l.forEach((d,w)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const u=[];switch(d.type){case"line":{const g=E(d,0);if(g==null)break;const n=g?.width||0;w===0&&(m=n);const p=Math.min(c||n,o),h=w===0?p:c?p*(n/m):p,f=h>I/2?2*h:I;i=Math.max(i,h),y=Math.max(y,f),g.width=h,u.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[y,.5*i]}]},stroke:g});break}case"path":{const g=Math.min(c||L,o),n=r(d,0),p=r(d,-.2),h=R(d,-.4),f=h?{color:h,width:1}:{};if(d.profile==="quad"){const b=d.width,k=d.height,v=le(b&&k?b/k:1,k===0,b===0),x={...f,join:"bevel"};u.push({shape:v[0],fill:p,stroke:x},{shape:v[1],fill:p,stroke:x},{shape:v[2],fill:n,stroke:x})}else u.push({shape:j.pathSymbol3DLayer[0],fill:p,stroke:f},{shape:j.pathSymbol3DLayer[1],fill:n,stroke:f});i=Math.max(i,g),y=i}}a.push(u)}),Promise.resolve(F(a,[y,i],{node:t?.node,scale:s,opacity:t?.opacity,ariaLabel:t?.ariaLabel}))}async function be(e,t){const l=e.type==="mesh-3d",a=e.symbolLayers,s=U(t),c=t?.maxSize?M(t.maxSize):null,o=s||L,m=[];let y=0,i=0,d=!1;for(let w=0;w<a.length;w++){const u=a.at(w),g=[];if(!l||u.type==="fill"){switch(u.type){case"fill":{const n=Math.min(o,c||D);if(y=Math.max(y,n),i=Math.max(i,n),d=!0,l){const p=j.meshSymbol3DFill,h=R(u,-.4),f=T(u,.05*n)??(h?{join:"round",color:h,width:1}:null);g.push({shape:p[0],fill:r(u,0),stroke:f},{shape:p[1],fill:r(u,-.2),stroke:f},{shape:p[2],fill:r(u,-.6),stroke:f})}else{let p=r(u,0);const h="pattern"in u?u.pattern:null,f=z(u),b=C(u);h!=null&&h.type==="style"&&h.style!=="solid"&&b&&(p=await pe(h,b)),g.push({shape:j.fill[0],fill:p,stroke:f})}break}case"line":{const n=E(u,0);if(n==null)break;const p={stroke:n,shape:j.fill[0]};y=Math.max(y,L),i=Math.max(i,L),g.push(p);break}case"extrude":{const n=r(u,0),p=r(u,-.2),h=Math.min(o,c||D),f=se(h),b=L,k=.7*L+.5*h,v=T(u,.1*Math.min(b,k))??{join:"round",...E(u,-.4),width:1};g.push({shape:f[0],fill:p,stroke:v},{shape:f[1],fill:p,stroke:v},{shape:f[2],fill:n,stroke:v}),y=Math.max(y,b),i=Math.max(i,k);break}case"water":{const n=C(u),p=Z(n),h=Z(n,2),f=Z(n,3),b=ne();d=!0,g.push({shape:b[0],fill:p},{shape:b[1],fill:h},{shape:b[2],fill:f});const k=Math.min(o,c||D);y=Math.max(y,k),i=Math.max(i,k);break}}m.push(g)}}return F(m,[y,i],{node:t?.node,scale:d,opacity:t?.opacity,ariaLabel:t?.ariaLabel})}function Ce(e,t){if(e.symbolLayers.length===0)return Promise.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return ye(e,t);case"line-3d":return de(e,t);case"polygon-3d":case"mesh-3d":return be(e,t)}return Promise.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}export{pe as getPatternDescriptor,U as getSizeFromOptions,r as getSymbolLayerFill,Ce as previewSymbol3D};
