import{gX as S}from"./index-CgzAF5Ey.js";function B(i,n){if(!(this instanceof B))return new B(i,n);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&(typeof n=="function"?this.toBBox=n:this._initFormat(n)),this.clear()}function E(i,n,t){if(!t)return n.indexOf(i);for(var h=0;h<n.length;h++)if(t(i,n[h]))return h;return-1}function c(i,n){x(i,0,i.children.length,n,i)}function x(i,n,t,h,e){e||(e=f(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a,r=n;r<t;r++)a=i.children[r],d(e,i.leaf?h(a):a);return e}function d(i,n){return i.minX=Math.min(i.minX,n.minX),i.minY=Math.min(i.minY,n.minY),i.maxX=Math.max(i.maxX,n.maxX),i.maxY=Math.max(i.maxY,n.maxY),i}function _(i,n){return i.minX-n.minX}function v(i,n){return i.minY-n.minY}function g(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function p(i){return i.maxX-i.minX+(i.maxY-i.minY)}function w(i,n){return(Math.max(n.maxX,i.maxX)-Math.min(n.minX,i.minX))*(Math.max(n.maxY,i.maxY)-Math.min(n.minY,i.minY))}function F(i,n){var t=Math.max(i.minX,n.minX),h=Math.max(i.minY,n.minY),e=Math.min(i.maxX,n.maxX),a=Math.min(i.maxY,n.maxY);return Math.max(0,e-t)*Math.max(0,a-h)}function Y(i,n){return i.minX<=n.minX&&i.minY<=n.minY&&n.maxX<=i.maxX&&n.maxY<=i.maxY}function M(i,n){return n.minX<=i.maxX&&n.minY<=i.maxY&&n.maxX>=i.minX&&n.maxY>=i.minY}function f(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(i,n,t,h,e){for(var a,r=[n,t];r.length;)(t=r.pop())-(n=r.pop())<=h||(a=n+Math.ceil((t-n)/h/2)*h,S(i,a,n,t,e),r.push(n,a,a,t))}B.prototype={all:function(){return this._all(this.data,[])},search:function(i){var n=this.data,t=[],h=this.toBBox;if(!M(i,n))return t;for(var e,a,r,o,s=[];n;){for(e=0,a=n.children.length;e<a;e++)r=n.children[e],M(i,o=n.leaf?h(r):r)&&(n.leaf?t.push(r):Y(i,o)?this._all(r,t):s.push(r));n=s.pop()}return t},collides:function(i){var n=this.data,t=this.toBBox;if(!M(i,n))return!1;for(var h,e,a,r,o=[];n;){for(h=0,e=n.children.length;h<e;h++)if(a=n.children[h],M(i,r=n.leaf?t(a):a)){if(n.leaf||Y(i,r))return!0;o.push(a)}n=o.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var n=0,t=i.length;n<t;n++)this.insert(i[n]);return this}var h=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var e=this.data;this.data=h,h=e}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},insert:function(i){return i!=null&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(i,n){if(i==null)return this;for(var t,h,e,a,r=this.data,o=this.toBBox(i),s=[],l=[];r||s.length;){if(r||(r=s.pop(),h=s[s.length-1],t=l.pop(),a=!0),r.leaf&&(e=E(i,r.children,n))!==-1)return r.children.splice(e,1),s.push(r),this._condense(s),this;a||r.leaf||!Y(r,o)?h?(t++,r=h.children[t],a=!1):r=null:(s.push(r),l.push(t),t=0,h=r,r=r.children[0])}return this},toBBox:function(i){return i},compareMinX:_,compareMinY:v,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,n){for(var t=[];i;)i.leaf?n.push.apply(n,i.children):t.push.apply(t,i.children),i=t.pop();return n},_build:function(i,n,t,h){var e,a=t-n+1,r=this._maxEntries;if(a<=r)return c(e=f(i.slice(n,t+1)),this.toBBox),e;h||(h=Math.ceil(Math.log(a)/Math.log(r)),r=Math.ceil(a/Math.pow(r,h-1))),(e=f([])).leaf=!1,e.height=h;var o,s,l,m,u=Math.ceil(a/r),X=u*Math.ceil(Math.sqrt(r));for(b(i,n,t,X,this.compareMinX),o=n;o<=t;o+=X)for(b(i,o,l=Math.min(o+X-1,t),u,this.compareMinY),s=o;s<=l;s+=u)m=Math.min(s+u-1,l),e.children.push(this._build(i,s,m,h-1));return c(e,this.toBBox),e},_chooseSubtree:function(i,n,t,h){for(var e,a,r,o,s,l,m,u;h.push(n),!n.leaf&&h.length-1!==t;){for(m=u=1/0,e=0,a=n.children.length;e<a;e++)s=g(r=n.children[e]),(l=w(i,r)-s)<u?(u=l,m=s<m?s:m,o=r):l===u&&s<m&&(m=s,o=r);n=o||n.children[0]}return n},_insert:function(i,n,t){var h=this.toBBox,e=t?i:h(i),a=[],r=this._chooseSubtree(e,this.data,n,a);for(r.children.push(i),d(r,e);n>=0&&a[n].children.length>this._maxEntries;)this._split(a,n),n--;this._adjustParentBBoxes(e,a,n)},_split:function(i,n){var t=i[n],h=t.children.length,e=this._minEntries;this._chooseSplitAxis(t,e,h);var a=this._chooseSplitIndex(t,e,h),r=f(t.children.splice(a,t.children.length-a));r.height=t.height,r.leaf=t.leaf,c(t,this.toBBox),c(r,this.toBBox),n?i[n-1].children.push(r):this._splitRoot(t,r)},_splitRoot:function(i,n){this.data=f([i,n]),this.data.height=i.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},_chooseSplitIndex:function(i,n,t){var h,e,a,r,o,s,l,m;for(s=l=1/0,h=n;h<=t-n;h++)r=F(e=x(i,0,h,this.toBBox),a=x(i,h,t,this.toBBox)),o=g(e)+g(a),r<s?(s=r,m=h,l=o<l?o:l):r===s&&o<l&&(l=o,m=h);return m},_chooseSplitAxis:function(i,n,t){var h=i.leaf?this.compareMinX:_,e=i.leaf?this.compareMinY:v;this._allDistMargin(i,n,t,h)<this._allDistMargin(i,n,t,e)&&i.children.sort(h)},_allDistMargin:function(i,n,t,h){i.children.sort(h);var e,a,r=this.toBBox,o=x(i,0,n,r),s=x(i,t-n,t,r),l=p(o)+p(s);for(e=n;e<t-n;e++)a=i.children[e],d(o,i.leaf?r(a):a),l+=p(o);for(e=t-n-1;e>=n;e--)a=i.children[e],d(s,i.leaf?r(a):a),l+=p(s);return l},_adjustParentBBoxes:function(i,n,t){for(var h=t;h>=0;h--)d(n[h],i)},_condense:function(i){for(var n,t=i.length-1;t>=0;t--)i[t].children.length===0?t>0?(n=i[t-1].children).splice(n.indexOf(i[t]),1):this.clear():c(i[t],this.toBBox)},_initFormat:function(i){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(i[0])),this.compareMinY=new Function("a","b",n.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};export{B as i};
