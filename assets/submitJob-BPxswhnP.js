const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BrQW8HOS.js","assets/index-lUE0m221.css","assets/MapImageLayer-CNW-XLqP.js","assets/SublayersOwner-CivANdBq.js","assets/QueryTask-DGAVH4-R.js","assets/executeForIds-Cnn1OWXP.js","assets/query-D5mFMRFz.js","assets/pbfQueryUtils-PegbNvJC.js","assets/pbf-bO1aG1II.js","assets/executeQueryJSON-CQzDonsh.js","assets/sublayerUtils-BEQnBRaB.js","assets/ExportImageParameters-BgkEQlXw.js","assets/floorFilterUtils-DKzVzLpH.js","assets/imageBitmapUtils-CV2jqiy6.js"])))=>i.map(i=>d[i]);
import{Y as te,ac as re,_ as t,e as i,aa as x,b3 as W,g as j,ch as J,cE as I,d6 as oe,cm as ae,d$ as se,dA as w,cv as _,dL as U,dC as ie,eW as ne,U as B,hJ as A,hL as R,cR as le}from"./index-BrQW8HOS.js";import{s as ue,t as ce}from"./networkEnums-CVHKZ3ki.js";import{a as pe}from"./GPMessage-Sj7XYBcS.js";var V;let b=V=class extends te{constructor(r){super(r),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(r){return re(V,r)}};t([i({type:x})],b.prototype,"outSpatialReference",void 0),t([i({type:W})],b.prototype,"processExtent",void 0),t([i({type:x})],b.prototype,"processSpatialReference",void 0),t([i({nonNullable:!0})],b.prototype,"returnColumnName",void 0),t([i({nonNullable:!0})],b.prototype,"returnFeatureCollection",void 0),t([i({nonNullable:!0})],b.prototype,"returnM",void 0),t([i({nonNullable:!0})],b.prototype,"returnZ",void 0),b=V=t([j("esri.rest.geoprocessor.GPOptions")],b);let m=class extends J{constructor(e){super(e),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};t([i({type:W})],m.prototype,"extent",void 0),t([i()],m.prototype,"height",void 0),t([i()],m.prototype,"href",void 0),t([i()],m.prototype,"opacity",void 0),t([i()],m.prototype,"rotation",void 0),t([i()],m.prototype,"scale",void 0),t([i()],m.prototype,"visible",void 0),t([i()],m.prototype,"width",void 0),m=t([j("esri.layers.support.MapImage")],m);let N=class extends J{constructor(r){super(r),this.area=0,this.units=null}};t([i({json:{write:!0}})],N.prototype,"area",void 0),t([I(ue)],N.prototype,"units",void 0),N=t([j("esri.rest.support.ArealUnit")],N);let S=class extends J{constructor(e){super(e),this.itemId=null,this.url=null}};t([i({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],S.prototype,"itemId",void 0),t([i({type:String,json:{write:!0}})],S.prototype,"url",void 0),S=t([j("esri.rest.support.DataFile")],S);let C=class extends J{constructor(r){super(r),this.distance=0,this.units=null}};t([i({json:{write:!0}})],C.prototype,"distance",void 0),t([I(ce)],C.prototype,"units",void 0),C=t([j("esri.rest.support.LinearUnit")],C);const u="multi-value-",F=new oe({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${u}areal-unit`,"GPMultiValue:GPBoolean":`${u}boolean`,"GPMultiValue:GPComposite":`${u}composite`,"GPMultiValue:GPDataFile":`${u}data-file`,"GPMultiValue:GPDate":`${u}date`,"GPMultiValue:GPDouble":`${u}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${u}feature-record-set-layer`,"GPMultiValue:Field":`${u}field`,"GPMultiValue:GPLinearUnit":`${u}linear-unit`,"GPMultiValue:GPLong":`${u}long`,"GPMultiValue:GPRasterData":`${u}raster-data`,"GPMultiValue:GPRasterDataLayer":`${u}raster-data-layer`,"GPMultiValue:GPRecordSet":`${u}record-set`,"GPMultiValue:GPString":`${u}string`});let G=class extends J{constructor(r){super(r),this.dataType=null,this.paramName=null,this.value=null}};t([I(F,{ignoreUnknown:!1})],G.prototype,"dataType",void 0),t([i()],G.prototype,"paramName",void 0),t([i()],G.prototype,"value",void 0),G=t([j("esri.rest.support.ParameterValue")],G);let y=class extends J{constructor(e){super(e),this.format=null,this.itemId=null,this.type=null,this.url=null}readType(e){return e==="ImageService"?"image-service":null}};t([i()],y.prototype,"format",void 0),t([i({json:{name:"itemID",write:!0}})],y.prototype,"itemId",void 0),t([i()],y.prototype,"type",void 0),t([ae("type")],y.prototype,"readType",null),t([i({json:{write:!0}})],y.prototype,"url",void 0),y=t([j("esri.rest.support.RasterData")],y);async function de(r,e,o,s,a){const n={},l={},c=[];return me(s,c,n),se(c).then(d=>{const{outSpatialReference:p,processExtent:$,processSpatialReference:v,returnColumnName:f,returnFeatureCollection:P,returnM:g,returnZ:z}=o,{path:H}=w(r);for(const E in n){const[X,ee]=n[E];l[E]=d.slice(X,ee)}const q=p?p.wkid||p:null,L=v?v.wkid||v:null,K=e==="execute"?{returnColumnName:f||void 0,returnFeatureCollection:P||void 0,returnM:g||void 0,returnZ:z||void 0}:null,Y=D({...$?{context:{extent:$,outSR:q,processSR:L}}:{"env:outSR":q,"env:processSR":L},...s,...K,f:"json"},null,l),Q={...a,query:Y};return _(`${H}/${e}`,Q)})}function me(r,e,o){for(const s in r){const a=r[s];if(a&&typeof a=="object"&&a instanceof U){const{features:n}=a;o[s]=[e.length,e.length+n.length],n.forEach(l=>{e.push(l.geometry)})}}}async function k(r,e){switch(r){case"areal-unit":return N.fromJSON(e);case"boolean":case"double":case"long":case"string":case"value-table":return e;case"date":return new Date(e);case"data-file":return S.fromJSON(e);case"linear-unit":return C.fromJSON(e);case"feature-record-set-layer":if("url"in e)return S.fromJSON(e);if("layerDefinition"in e){const o=new(await B(async()=>{const{default:n}=await import("./index-BrQW8HOS.js").then(l=>l.MJ);return{default:n}},__vite__mapDeps([0,1]))).default,{layerDefinition:s,featureSet:a}=e;return o.read({layerDefinition:s,featureSet:a},{origin:"portal-item"}),o.spatialReference=x.fromJSON(a.spatialReference??s.spatialReference??s.extent.spatialReference),o}return U.fromJSON(e);case"record-set":return"url"in e?S.fromJSON(e):U.fromJSON(e);case"raster-data":case"raster-data-layer":return"mapImage"in e?m.fromJSON(e.mapImage):y.fromJSON(e);case"field":return ne.fromJSON(e)}}function be(r){return r.startsWith(u)}function he(r){return r.replace(u,"")}async function fe(r,e){const o=he(r),s=o==="composite"?e.map(a=>k(F.fromJSON(a.dataType),a.value)):e.map(a=>k(o,a));return Promise.all(s)}async function Z(r){const e=F.fromJSON(r.dataType),{paramName:o}=r,s=be(e)?await fe(e,r.value):await k(e,r.value);return new G({dataType:e,paramName:o,value:s})}function D(r,e,o){for(const s in r){const a=r[s];Array.isArray(a)?r[s]=JSON.stringify(a.map(n=>D({item:n},!0).item)):a instanceof Date&&(r[s]=a.getTime())}return ie(r,e,o)}var O;const ye=le()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),M=1e3;var T;let h=(T=class extends J{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(e){const{jobId:o,sourceUrl:s}=this,{path:a}=w(s),n={...this.requestOptions,...e,query:{f:"json"}},l=`${a}/jobs/${o}/cancel`,{data:c}=await _(l,n),{messages:d,jobStatus:p,progress:$}=O.fromJSON(c);return this.set({messages:d,jobStatus:p,progress:$}),p==="job-cancelled"?this:new Promise((v,f)=>{A(n.signal,()=>{this.clearCancelJobTimer(),f(R())}),this.clearCancelJobTimer();const P=()=>{this._cancelJobTimer||f(R()),this.checkJobStatus(e).then(({jobStatus:g})=>{switch(g){case"job-cancelling":default:this._cancelJobTimer=setTimeout(P,M);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":f(this);break;case"job-cancelled":v(this)}}).catch(g=>{f(g)})};this._cancelJobTimer=setTimeout(P,M)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(e){const{path:o}=w(this.sourceUrl),s={...this.requestOptions,...e,query:{...e?.query,f:"json"}},a=`${o}/jobs/${this.jobId}`,{data:n}=await _(a,s),{messages:l,jobStatus:c,progress:d}=O.fromJSON(n);return this.set({messages:l,jobStatus:c,progress:d}),this}async fetchResultData(e,o,s){o=b.from(o||{});const{returnColumnName:a,returnFeatureCollection:n,returnM:l,returnZ:c,outSpatialReference:d}=o,{path:p}=w(this.sourceUrl),$={returnColumnName:a||null,returnFeatureCollection:n||null,returnM:l||null,returnZ:c||null,outSR:d,returnType:"data",f:"json",...s?.query},v=D($,null),f={...this.requestOptions,...s,query:v},P=`${p}/jobs/${this.jobId}/results/${e}`,{data:g}=await _(P,f);return Z(g)}async fetchResultImage(e,o,s){const{path:a}=w(this.sourceUrl),n={...o.toJSON(),f:"json"},l=D(n),c={...this.requestOptions,...s,query:l},d=`${a}/jobs/${this.jobId}/results/${e}`,{data:p}=await _(d,c);return Z(p)}async fetchResultMapImageLayer(){const{path:e}=w(this.sourceUrl),o=e.indexOf("/GPServer/"),s=`${e.slice(0,Math.max(0,o))}/MapServer/jobs/${this.jobId}`;return new(await B(async()=>{const{default:a}=await import("./MapImageLayer-CNW-XLqP.js");return{default:a}},__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13]))).default({url:s})}async waitForJobCompletion(e={}){const{interval:o=M,signal:s,statusCallback:a,apiKey:n}=e;return new Promise((l,c)=>{A(s,()=>{this.clearJobCompletionTimer(),c(R())}),this.clearJobCompletionTimer();const d=()=>{this._jobCompletionTimer||c(R()),this.checkJobStatus({query:{token:n}}).then(({jobStatus:p})=>{switch(p){case"job-succeeded":l(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":a&&a(this),this._jobCompletionTimer=setTimeout(d,o);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":c(this);break;default:this._jobCompletionTimer=setTimeout(d,o)}}).catch(p=>{c(p)})};this._jobCompletionTimer=setTimeout(d,o)})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}},O=T,T);t([i()],h.prototype,"jobId",void 0),t([I(ye,{ignoreUnknown:!1})],h.prototype,"jobStatus",void 0),t([i({type:[pe]})],h.prototype,"messages",void 0),t([i()],h.prototype,"progress",void 0),t([i()],h.prototype,"requestOptions",void 0),t([i({json:{write:!0}})],h.prototype,"sourceUrl",void 0),h=O=t([j("esri.rest.support.JobInfo")],h);async function Pe(r,e,o,s){return o=b.from(o||{}),de(r,"submitJob",o,e??{},s).then(({data:a})=>{const n=h.fromJSON(a);return n.sourceUrl=r,n})}export{Z as O,de as S,b as l,Pe as s};
