const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-aRi8Xk-b.js","assets/index-ni9qn0ie.css","assets/MapImageLayer-Bcj4CUlX.js","assets/SublayersOwner-03GAieqk.js","assets/QueryTask-BGZm88SC.js","assets/executeForIds-BOIvqEB-.js","assets/query-zZV_LNG5.js","assets/pbfQueryUtils-Cjywei14.js","assets/pbf-D2pQhulj.js","assets/executeQueryJSON-BsEB0j6G.js","assets/imageBitmapUtils-DWFhzbXj.js"])))=>i.map(i=>d[i]);
import{a7 as te,ak as re,a5 as t,x as i,al as M,b3 as B,y as j,cn as $,co as D,cQ as oe,c8 as ae,dA as se,dc as G,cf as _,dn as V,de as ie,eb as ne,a3 as W,gl as A,gn as O,cB as le}from"./index-aRi8Xk-b.js";import{s as ue,t as ce}from"./networkEnums-UDfrwzJn.js";import{a as pe}from"./GPMessage-DE2mHj4m.js";var U;let b=U=class extends te{constructor(r){super(r),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(r){return re(U,r)}};t([i({type:M})],b.prototype,"outSpatialReference",void 0),t([i({type:B})],b.prototype,"processExtent",void 0),t([i({type:M})],b.prototype,"processSpatialReference",void 0),t([i({nonNullable:!0})],b.prototype,"returnColumnName",void 0),t([i({nonNullable:!0})],b.prototype,"returnFeatureCollection",void 0),t([i({nonNullable:!0})],b.prototype,"returnM",void 0),t([i({nonNullable:!0})],b.prototype,"returnZ",void 0),b=U=t([j("esri.rest.geoprocessor.GPOptions")],b);let m=class extends ${constructor(e){super(e),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};t([i({type:B})],m.prototype,"extent",void 0),t([i()],m.prototype,"height",void 0),t([i()],m.prototype,"href",void 0),t([i()],m.prototype,"opacity",void 0),t([i()],m.prototype,"rotation",void 0),t([i()],m.prototype,"scale",void 0),t([i()],m.prototype,"visible",void 0),t([i()],m.prototype,"width",void 0),m=t([j("esri.layers.support.MapImage")],m);let N=class extends ${constructor(r){super(r),this.area=0,this.units=null}};t([i({json:{write:!0}})],N.prototype,"area",void 0),t([D(ue)],N.prototype,"units",void 0),N=t([j("esri.rest.support.ArealUnit")],N);let S=class extends ${constructor(e){super(e),this.itemId=null,this.url=null}};t([i({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],S.prototype,"itemId",void 0),t([i({type:String,json:{write:!0}})],S.prototype,"url",void 0),S=t([j("esri.rest.support.DataFile")],S);let C=class extends ${constructor(r){super(r),this.distance=0,this.units=null}};t([i({json:{write:!0}})],C.prototype,"distance",void 0),t([D(ce)],C.prototype,"units",void 0),C=t([j("esri.rest.support.LinearUnit")],C);const u="multi-value-",F=new oe({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${u}areal-unit`,"GPMultiValue:GPBoolean":`${u}boolean`,"GPMultiValue:GPComposite":`${u}composite`,"GPMultiValue:GPDataFile":`${u}data-file`,"GPMultiValue:GPDate":`${u}date`,"GPMultiValue:GPDouble":`${u}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${u}feature-record-set-layer`,"GPMultiValue:Field":`${u}field`,"GPMultiValue:GPLinearUnit":`${u}linear-unit`,"GPMultiValue:GPLong":`${u}long`,"GPMultiValue:GPRasterData":`${u}raster-data`,"GPMultiValue:GPRasterDataLayer":`${u}raster-data-layer`,"GPMultiValue:GPRecordSet":`${u}record-set`,"GPMultiValue:GPString":`${u}string`});let w=class extends ${constructor(r){super(r),this.dataType=null,this.paramName=null,this.value=null}};t([D(F,{ignoreUnknown:!1})],w.prototype,"dataType",void 0),t([i()],w.prototype,"paramName",void 0),t([i()],w.prototype,"value",void 0),w=t([j("esri.rest.support.ParameterValue")],w);let y=class extends ${constructor(e){super(e),this.format=null,this.itemId=null,this.type=null,this.url=null}readType(e){return e==="ImageService"?"image-service":null}};t([i()],y.prototype,"format",void 0),t([i({json:{name:"itemID",write:!0}})],y.prototype,"itemId",void 0),t([i()],y.prototype,"type",void 0),t([ae("type")],y.prototype,"readType",null),t([i({json:{write:!0}})],y.prototype,"url",void 0),y=t([j("esri.rest.support.RasterData")],y);async function de(r,e,o,s,a){const n={},l={},c=[];return me(s,c,n),se(c).then(d=>{const{outSpatialReference:p,processExtent:J,processSpatialReference:g,returnColumnName:f,returnFeatureCollection:P,returnM:v,returnZ:z}=o,{path:H}=G(r);for(const E in n){const[Y,ee]=n[E];l[E]=d.slice(Y,ee)}const q=p?p.wkid||p:null,L=g?g.wkid||g:null,K=e==="execute"?{returnColumnName:f||void 0,returnFeatureCollection:P||void 0,returnM:v||void 0,returnZ:z||void 0}:null,Q=x({...J?{context:{extent:J,outSR:q,processSR:L}}:{"env:outSR":q,"env:processSR":L},...s,...K,f:"json"},null,l),X={...a,query:Q};return _(`${H}/${e}`,X)})}function me(r,e,o){for(const s in r){const a=r[s];if(a&&typeof a=="object"&&a instanceof V){const{features:n}=a;o[s]=[e.length,e.length+n.length],n.forEach(l=>{e.push(l.geometry)})}}}async function k(r,e){switch(r){case"areal-unit":return N.fromJSON(e);case"boolean":case"double":case"long":case"string":case"value-table":return e;case"date":return new Date(e);case"data-file":return S.fromJSON(e);case"linear-unit":return C.fromJSON(e);case"feature-record-set-layer":if("url"in e)return S.fromJSON(e);if("layerDefinition"in e){const o=new(await W(async()=>{const{default:n}=await import("./index-aRi8Xk-b.js").then(l=>l.OG);return{default:n}},__vite__mapDeps([0,1]))).default,{layerDefinition:s,featureSet:a}=e;return o.read({layerDefinition:s,featureSet:a},{origin:"portal-item"}),o.spatialReference=M.fromJSON(a.spatialReference??s.spatialReference??s.extent.spatialReference),o}return V.fromJSON(e);case"record-set":return"url"in e?S.fromJSON(e):V.fromJSON(e);case"raster-data":case"raster-data-layer":return"mapImage"in e?m.fromJSON(e.mapImage):y.fromJSON(e);case"field":return ne.fromJSON(e)}}function be(r){return r.startsWith(u)}function he(r){return r.replace(u,"")}async function fe(r,e){const o=he(r),s=o==="composite"?e.map(a=>k(F.fromJSON(a.dataType),a.value)):e.map(a=>k(o,a));return Promise.all(s)}async function Z(r){const e=F.fromJSON(r.dataType),{paramName:o}=r,s=be(e)?await fe(e,r.value):await k(e,r.value);return new w({dataType:e,paramName:o,value:s})}function x(r,e,o){for(const s in r){const a=r[s];Array.isArray(a)?r[s]=JSON.stringify(a.map(n=>x({item:n},!0).item)):a instanceof Date&&(r[s]=a.getTime())}return ie(r,e,o)}var R;const ye=le()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),I=1e3;var T;let h=(T=class extends ${constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(e){const{jobId:o,sourceUrl:s}=this,{path:a}=G(s),n={...this.requestOptions,...e,query:{f:"json"}},l=`${a}/jobs/${o}/cancel`,{data:c}=await _(l,n),{messages:d,jobStatus:p,progress:J}=R.fromJSON(c);return this.set({messages:d,jobStatus:p,progress:J}),p==="job-cancelled"?this:new Promise((g,f)=>{A(n.signal,()=>{this.clearCancelJobTimer(),f(O())}),this.clearCancelJobTimer();const P=()=>{this._cancelJobTimer||f(O()),this.checkJobStatus(e).then(({jobStatus:v})=>{switch(v){case"job-cancelling":default:this._cancelJobTimer=setTimeout(P,I);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":f(this);break;case"job-cancelled":g(this)}}).catch(v=>{f(v)})};this._cancelJobTimer=setTimeout(P,I)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(e){const{path:o}=G(this.sourceUrl),s={...this.requestOptions,...e,query:{...e?.query,f:"json"}},a=`${o}/jobs/${this.jobId}`,{data:n}=await _(a,s),{messages:l,jobStatus:c,progress:d}=R.fromJSON(n);return this.set({messages:l,jobStatus:c,progress:d}),this}async fetchResultData(e,o,s){o=b.from(o||{});const{returnColumnName:a,returnFeatureCollection:n,returnM:l,returnZ:c,outSpatialReference:d}=o,{path:p}=G(this.sourceUrl),J={returnColumnName:a||null,returnFeatureCollection:n||null,returnM:l||null,returnZ:c||null,outSR:d,returnType:"data",f:"json",...s?.query},g=x(J,null),f={...this.requestOptions,...s,query:g},P=`${p}/jobs/${this.jobId}/results/${e}`,{data:v}=await _(P,f);return Z(v)}async fetchResultImage(e,o,s){const{path:a}=G(this.sourceUrl),n={...o.toJSON(),f:"json"},l=x(n),c={...this.requestOptions,...s,query:l},d=`${a}/jobs/${this.jobId}/results/${e}`,{data:p}=await _(d,c);return Z(p)}async fetchResultMapImageLayer(){const{path:e}=G(this.sourceUrl),o=e.indexOf("/GPServer/"),s=`${e.slice(0,Math.max(0,o))}/MapServer/jobs/${this.jobId}`;return new(await W(async()=>{const{default:a}=await import("./MapImageLayer-Bcj4CUlX.js");return{default:a}},__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10]))).default({url:s})}async waitForJobCompletion(e={}){const{interval:o=I,signal:s,statusCallback:a,apiKey:n}=e;return new Promise((l,c)=>{A(s,()=>{this.clearJobCompletionTimer(),c(O())}),this.clearJobCompletionTimer();const d=()=>{this._jobCompletionTimer||c(O()),this.checkJobStatus({query:{token:n}}).then(({jobStatus:p})=>{switch(p){case"job-succeeded":l(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":a&&a(this),this._jobCompletionTimer=setTimeout(d,o);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":c(this);break;default:this._jobCompletionTimer=setTimeout(d,o)}}).catch(p=>{c(p)})};this._jobCompletionTimer=setTimeout(d,o)})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}},R=T,T);t([i()],h.prototype,"jobId",void 0),t([D(ye,{ignoreUnknown:!1})],h.prototype,"jobStatus",void 0),t([i({type:[pe]})],h.prototype,"messages",void 0),t([i()],h.prototype,"progress",void 0),t([i()],h.prototype,"requestOptions",void 0),t([i({json:{write:!0}})],h.prototype,"sourceUrl",void 0),h=R=t([j("esri.rest.support.JobInfo")],h);async function Pe(r,e,o,s){return o=b.from(o||{}),de(r,"submitJob",o,e??{},s).then(({data:a})=>{const n=h.fromJSON(a);return n.sourceUrl=r,n})}export{Z as O,de as S,b as l,Pe as s};
