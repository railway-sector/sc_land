import{ad as n,b8 as l,b9 as d,ba as p,am as a,bb as h,bc as u,bd as w,be as R,bf as g,bg as W,bh as v,bi as F,bj as c,aK as S}from"./index-Bp3GeDhQ.js";function i(s,e,t=null){return t!=null?[s,e,t]:[s,e]}function f(s,e,t=null){return t!=null?{x:s,y:e,z:t}:{x:s,y:e}}class m{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(S)}get doUnnormalization(){return!1}}class T extends m{constructor(e,t,r=null){super(t),this._defaultZ=r,this.transform=l(),this.transformInv=l(),this.transform=d(e),p(this.transformInv,this.transform)}makeMapPoint(e,t){return i(e,t,this._defaultZ)}mapToLocal(e){return f(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return i(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class b extends m{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=a(),this.tangentFrameUpWS=a(),this.tangentFrameRightWS=a(),this.tangentFrameForwardWS=a(),this.localFrameRightWS=a(),this.localFrameUpWS=a(),this.worldToLocalTransform=h(),this.localToWorldTransform=h(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const r=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const o=a();u(o,this.tangentFrameForwardWS,w(r,this.tangentFrameForwardWS)),R(this.localFrameRightWS,r,o),g(this.localFrameRightWS,this.localFrameRightWS),W(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),v(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),F(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return i(e,t,this.defaultZ)}mapToLocal(e){const t=a();this.view.renderCoordsHelper.toRenderCoords(new n({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),c(t,t,this.worldToLocalTransform);const r=this.view.renderCoordsHelper.fromRenderCoords(t,new n({spatialReference:this.view.spatialReference}));return r!=null?f(r.x/this.scale,r.y/this.scale):null}localToMap(e){const t=a();this.view.renderCoordsHelper.toRenderCoords(new n({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),c(t,t,this.localToWorldTransform);const r=this.view.renderCoordsHelper.fromRenderCoords(t,new n({spatialReference:this.view.spatialReference}));return r!=null?i(r.x,r.y,this.defaultZ):null}}function y(s,e){if(s.type==="2d")return new T(s.state.transform,s.spatialReference,e.length>2?e[2]:null);if(s.type==="3d"){const t=e.length>2?new n({x:e[0],y:e[1],z:e[2],spatialReference:s.spatialReference}):new n({x:e[0],y:e[1],spatialReference:s.spatialReference});return new b(s,t)}return null}export{T as R,y as W,f as w};
