import{K as v,M as f,N as u,Q as w,R as y,f as d,S as b}from"./index-CgzAF5Ey.js";import{c as x}from"./useView-CMtXgKA0.js";const P=(p,e)=>t=>E(t,p);class M extends f{#o=new Map;#e;#t;constructor(e,t){super(e,t),new x(e);const s=this,o=s.instance;let i=o.viewModel,c=o.visibleElements;const r=new Proxy(this.exports,{get(n,l,h){return l==="viewModel"?i:l==="visibleElements"?c:Reflect.get(n,l,h)}});if(s.#t=o,s.instance=r,s.exports=r,i){const n={component:e,get exports(){return s.instance.viewModel}};u(s).set("viewModel","viewModel"),e.addController(n),i=w(e,new WeakRef(n),y(e)-1,i,s.#o)}s.instance.visibleElements&&(c=s.#s(o))}hostConnected(){this.instance=this.#t,super.hostConnected()}hostLoad(){this.#e=d(()=>this.component.el.view,e=>{const t=this.instance;!("view"in t)&&typeof t.viewModel=="object"?t.viewModel.view=e:t.view=e,!("map"in t)&&typeof t.viewModel=="object"?t.viewModel.map=e?.map:t.map=e?.map},{sync:!0,initial:!0})}hostUpdate(e){e.has("closed")&&(this.instance.visible=!this.component.closed)}hostLoaded(){const{el:e}=this.component;e.childElem??=document.createElement("div"),this.instance.container=e.childElem,(this.component.el.shadowRoot??this.component.el).appendChild(this.instance.container),this.component.closed!==void 0&&this.onLifecycle(()=>d(()=>this.instance.visible,t=>this.component.closed=!t,{initial:!0}))}#s(e){return new Proxy(e.visibleElements,{get:(t,s)=>{if(typeof s=="symbol"||s in Promise.prototype)return t[s];const o=[s],i=this.#n(o);return b(this.component,c=>{const r=c;this.component[r]=!1;let n=e.visibleElements??{},l;for(const a of o.slice(0,-1))if(typeof n[a]=="object"&&n[a]!==null)n=n[a];else{l=!!n[a];break}l===void 0&&(l=!!(n[o.slice(-1)[0]]??!0));const h=r.startsWith("hide")||r.startsWith("show")?r.startsWith("hide"):l;this.onUpdate(a=>{if(a.has(r)){const m=this.component[r];this.#i(o,m,h)}})},i)}})}#n(e){const t=new Proxy({},{get:(s,o)=>{const i=Reflect.get(s,o);return typeof o=="symbol"||o in Promise.prototype?i:(e.push(o),t)}});return t}#i(e,t,s){let o=this.instance.visibleElements??{};for(const c of e.slice(0,-1))(typeof o[c]!="object"||o[c]===null)&&(o[c]={}),o=o[c];const i=!!(s?!t:t);o[e.at(-1)]=i}hostDestroy(){this.#e?.remove(),super.hostDestroy()}}const E=v(M);export{P as I};
