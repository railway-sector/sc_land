const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CgzAF5Ey.js","assets/index-ni9qn0ie.css"])))=>i.map(i=>d[i]);
import{bY as I,bW as V,bX as $,aw as N,V as h,vW as F,vX as R,bU as U,ky as M,aR as O,df as A,vY as S,vZ as T,f8 as B,c2 as _}from"./index-CgzAF5Ey.js";import{b as p}from"./utils-BxeCvIiv.js";import{x as k}from"./utils-CAdwX-R_.js";const L=/^-?(\d+)(\.(\d+))?$/i;function q(e,n){return e-n}function Q(e,n){let t,o;return t=Number(e.toFixed(n)),t<e?o=t+1/10**n:(o=t,t-=1/10**n),t=Number(t.toFixed(n)),o=Number(o.toFixed(n)),[t,o]}function D(e,n,t,o,a){const l=W(e,n,t,o),i=l.previous==null||l.previous<=a,r=l.next==null||l.next<=a;return i&&r||l.previous+l.next<=2*a}function C(e){const n=String(e),t=n.match(L);if(t?.[1])return{integer:t[1].split("").length,fractional:t[3]?t[3].split("").length:0};if(n.toLowerCase().includes("e")){const o=n.split("e"),a=o[0],l=o[1];if(a&&l){const i=Number(a);let r=Number(l);const c=r>0;c||(r=Math.abs(r));const s=C(i);return c?(s.integer+=r,r>s.fractional?s.fractional=0:s.fractional-=r):(s.fractional+=r,r>s.integer?s.integer=1:s.integer-=r),s}}return{integer:0,fractional:0}}function W(e,n,t,o){const a={previous:null,next:null};if(t!=null){const l=e-t,i=n-t-l;a.previous=Math.floor(Math.abs(100*i/l))}if(o!=null){const l=o-e,i=o-n-l;a.next=Math.floor(Math.abs(100*i/l))}return a}function fe(e,n={}){const t=e.slice(),{tolerance:o=2,strictBounds:a=!1,indexes:l=t.map((i,r)=>r)}=n;l.sort(q);for(let i=0;i<l.length;i++){const r=l[i],c=t[r],s=r===0?null:t[r-1],f=r===t.length-1?null:t[r+1],m=C(c).fractional;if(m){let d,g=0,w=!1;for(;g<=m&&!w;){const y=Q(c,g);d=a&&i===0?y[1]:y[0],w=D(c,d,s,f,o),g++}w&&(t[r]=d)}}return t}const Z={maximumFractionDigits:20};function j(e){return I(e,Z)}const K="<",G=">";function P(e,n,t,o){let a="";n===0?a=`${K} `:n===t&&(a=`${G} `);const l=X(e,o);return l==null?"":a+l}function H(e){const{format:n,fieldFormat:t}=e||{};return t?.type==="number"||!!n&&n.dateFormat==null&&(n.places!=null||n.digitSeparator!=null)}function X(e,n){if(e==null)return e;const{fieldType:t,format:o,fieldFormat:a,timeZoneOptions:l}=n||{};if(b(t))return k(e,{fieldType:t,format:o?.dateFormat,fieldFormat:a?.type==="date-time"?a:void 0,timeZoneOptions:l});if(typeof e=="string"&&H(n)){const r=Number(e);isNaN(r)||(e=r)}if(typeof e=="string")return e;const i=a?.type==="number"?V(a):o?$(o):void 0;return i?I(e,i):j(e)}const Ae=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function Y(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const n=e.visualVariables.find(i=>i.type==="color");if(!n)return null;let t=null,o=null;if(n.stops){if(n.stops.length===1)return n.stops[0].color;t=n.stops[0].value,o=n.stops[n.stops.length-1].value}const a=t!=null&&o!=null?t+(o-t)/2:0,{getColor:l}=await h(async()=>{const{getColor:i}=await import("./index-CgzAF5Ey.js").then(r=>r.ML);return{getColor:i}},__vite__mapDeps([0,1]));return l(n,a)??null}async function pe(e,n){const t=e.trailCap,o=e.trailWidth||1,a=n||await Y(e)||e.color;return new N({cap:t,color:a,width:o})}function z(e,n){if(!n)return null;if("featureReduction"in e)switch(e.featureReduction?.type){case"cluster":case"binning":{const t=e.featureReduction.fields.find(({name:o})=>o.toLowerCase()===n.toLowerCase());return t&&"getField"in e?e.getField(t.onStatisticField):null}}return"getField"in e?e.getField?.(n):null}function J(e,n){const t="popupTemplate"in e?e.popupTemplate?.fieldInfos:null;if(t?.length&&n)return t.find(o=>o.fieldName?.toLowerCase()===n.toLowerCase())}function v(e){let n=0,t=0;return e.stops?(n=e.stops?.at(0)?.value??n,t=e.stops?.at(-1)?.value??t):"minDataValue"in e&&"maxDataValue"in e&&(n=e.minDataValue??n,t=e.maxDataValue??t),t-n>2*M.days?"short-date":"short-date-short-time"}function b(e){return["date","date-only","time-only","timestamp-offset"].includes(e||"")}function x(e){return U(e)&&!("featureReduction"in e&&e.featureReduction)}function me(e,n,t){const o=ee(e,n.field,t);return o?(b(o.fieldType)&&(x(e)?o.fieldFormat??=new F({dateStyle:"short",timeStyle:v(n)==="short-date-short-time"?"short":null}):o.format??=new R({dateFormat:v(n)})),o):null}function ee(e,n,t){const o=z(e,n),a=o?.name;if(!a)return null;const l=o?.type,i=x(e);return{fieldType:l,format:i?null:J(e,a)?.format,fieldFormat:i?e.getFieldConfiguration(a)?.fieldFormat:null,timeZoneOptions:b(l)?{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:t,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}:null}}function de(e,n){if("authoringInfo"in e)return e.authoringInfo?.visualVariables?.find(({theme:t})=>t===n)}function ge(e,n){let t=e??"";return n!=null&&n&&(t=t?"("+t+") AND ("+n+")":n),t}const te=new A([64,64,64]);function E(e,n){const t=[],o=e.length-1;return e.length===5?t.push(0,2,4):t.push(0,o),e.map((a,l)=>t.includes(l)?P(a,l,o,n):null)}async function ne(e,n,t){let o=!1,a=[],l=[];if(e.stops){const s=e.stops;a=s.map(f=>f.value),o=s.some(f=>!!f.label),o&&(l=s.map(f=>f.label))}const i=a[0],r=a[a.length-1];if(i==null&&r==null)return null;const c=o?null:E(a,t);return(await Promise.all(a.map(async(s,f)=>{const m=e.type==="opacity"?await oe(s,e,n):(await h(async()=>{const{getColor:g}=await import("./index-CgzAF5Ey.js").then(w=>w.ML);return{getColor:g}},__vite__mapDeps([0,1]))).getColor(e,s),d=o?l[f]:c?.[f]??"";return m==null?null:{value:s,color:m,label:d}}))).filter(O).reverse()}async function oe(e,n,t){const o=new A(t??te),a=(await h(async()=>{const{getOpacity:l}=await import("./index-CgzAF5Ey.js").then(i=>i.ML);return{getOpacity:l}},__vite__mapDeps([0,1]))).getOpacity(n,e);return a!=null&&(o.a=a),o}function we(e){let n=!1,t=[],o=[];t=e.map(r=>r.value),n=e.some(r=>!!r.label),n&&(o=e.map(r=>r.label??""));const a=t[0],l=t[t.length-1];if(a==null&&l==null)return null;const i=n?null:E(t);return t.map((r,c)=>({value:r,color:ae(r,e),label:n?o[c]:i?.[c]??""})).reverse()}function ae(e,n){const{startIndex:t,endIndex:o,weight:a}=le(e,n);if(t===o)return n[t].color;const l=A.blendColors(n[t].color,n[o].color,a);return new A(l)}function le(e,n){let t=0,o=n.length-1;return n.some((a,l)=>e<a.value?(o=l,!0):(t=l,!1)),{startIndex:t,endIndex:o,weight:(e-n[t].value)/(n[o].value-n[t].value)}}function he(e,n){let t=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((o,a)=>{a===0?t.push({value:n.max,color:new A(o.toColor),label:"high"}):t.push({value:null,color:new A(o.toColor),label:""}),a===e.colorRamps.length-1?t.push({value:n.min,color:new A(o.fromColor),label:"low"}):t.push({value:null,color:new A(o.fromColor),label:""})});else{let o,a;e&&e.type==="algorithmic"?(o=e.fromColor,a=e.toColor):(o=[0,0,0,1],a=[255,255,255,1]),t=[{value:n.max,color:new A(a),label:"high"},{value:n.min,color:new A(o),label:"low"}]}return t}function re(e){if(!e.colorStops)return[];const n=[...e.colorStops].filter(o=>o.color?.a>0);let t=n.length-1;if(n&&n[0]){const o=n[t];o&&o.ratio!==1&&(n.push(new S({ratio:1,color:o.color})),t++)}return n.map((o,a)=>{let l="";return a===0?l=e.legendOptions?.minLabel||"low":a===t&&(l=e.legendOptions?.maxLabel||"high"),{color:o.color,label:l,ratio:o.ratio}}).reverse()}const be=_("short-date");async function u(e,n,t){B(e,n,()=>[]).push(...t)}async function ye(e){const n=new Map;if(!e)return n;if("visualVariables"in e&&e.visualVariables){for(const t of e.visualVariables)if(ie(t)){const o=(await ne(t)??[]).map(a=>a.color);await u(n,t.field||t.valueExpression,o)}}if(e.type==="heatmap"){const t=re(e).map(o=>o.color);await u(n,e.field||e.valueExpression,t)}else if(e.type==="pie-chart"){for(const t of e.attributes)await u(n,t.field||t.valueExpression,[t.color]);await u(n,"default",[e?.othersCategory?.color,p(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const t of e.attributes)await u(n,t.field||t.valueExpression,[t.color]);await u(n,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(e.authoringInfo?.type==="predominance")for(const t of e.uniqueValueInfos??[])await u(n,t.value.toString(),[p(t.symbol,null)]);else{const t=(e.uniqueValueInfos??[]).map(r=>p(r.symbol,null)),{field:o,field2:a,field3:l,valueExpression:i}=e;(o||i)&&await u(n,o||i,t),a&&await u(n,a,t),l&&await u(n,l,t)}else if(e.type==="class-breaks"){const t=e.classBreakInfos.map(l=>p(l.symbol,null)),{field:o,valueExpression:a}=e;await u(n,o??a,t)}else e.type==="simple"&&await u(n,"default",[p(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await u(n,"default",[p(e.defaultSymbol,null)]),n.forEach((t,o)=>{const a=T(t.filter(Boolean),(l,i)=>JSON.stringify(l)===JSON.stringify(i));n.set(o,a)}),n}function ie(e){return e.type==="color"}export{de as C,me as V,K as a,we as b,ge as c,X as d,he as e,G as f,Y as g,Ae as h,C as i,ee as j,W as l,P as m,re as r,ae as s,ne as t,fe as u,be as v,pe as w,ye as x};
