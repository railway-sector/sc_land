import{fo as q,fn as rt,an as z,gK as N,ao as ot,bp as st,bo as O,gL as C,br as A,gM as y,aL as it,gN as M,bn as ct,gO as ut,ar as l,gP as ft,ck as k,am as I,b4 as T,gQ as V,gR as W,ba as P,dU as Q,gS as B,gT as D,gU as lt,gV as yt,O as mt,gW as gt,aW as E,ab as pt,aO as xt}from"./index-CgzAF5Ey.js";import{M as ht,c as J,f as bt,s as K,i as $,h as wt,u as dt}from"./mat2d-DWPHXQcf.js";import{e as S}from"./mat2df64-DJ_RMjZ3.js";const U=96,_=39.37,Gt=180/Math.PI;function H(t){return t.wkid?t:t.spatialReference||pt.WGS84}function j(t,e){return e.type?y(t,e.x,e.y):xt(t,e)}function X(t){return rt(t)}function Y(t,e,n=0){let a=t.width,r=t.height;if(n!==0){const i=lt(n),u=Math.abs(Math.cos(i)),c=Math.abs(Math.sin(i));a=t.width*u+t.height*c,r=t.width*c+t.height*u}const o=Math.max(1,e[0]),s=Math.max(1,e[1]);return Math.max(a/o,r/s)*Mt(t.spatialReference)}async function G(t,e,n,a){let r,o;if(!t||Array.isArray(t)&&!t.length)return null;if(mt.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const i=t.every(g=>"attributes"in g),u=t.some(g=>!g.geometry);let c=t;if(i&&u&&e&&e.allLayerViews){const g=new Map;for(const f of t){const m=f.layer,d=g.get(m)||[],h=f.attributes[m.objectIdField];h!=null&&d.push(h),g.set(m,d)}const x=[];g.forEach((f,m)=>{const d=e.allLayerViews?.find(h=>h.layer.id===m.id);if(d&&"queryFeatures"in d){const h=m.createQuery();h.objectIds=f,h.returnGeometry=!0,x.push(d.queryFeatures(h))}});const w=await Promise.all(x),p=[];for(const f of w)if(f&&f.features&&f.features.length)for(const m of f.features)m.geometry!=null&&p.push(m.geometry);c=p}for(const g of c)a=await G(g,e,n,a);return a}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")r=new I(t);else if(t instanceof V)r=t;else if("geometry"in t){if(t.geometry)r=t.geometry;else if(t.layer){const i=t.layer,u=e.allLayerViews?.find(c=>c.layer.id===i.id);if(u&&"queryFeatures"in u){const c=i.createQuery();c.objectIds=[t.attributes[i.objectIdField]],c.returnGeometry=!0,r=(await u.queryFeatures(c))?.features?.[0]?.geometry}}}if(r==null)return null;switch(r.type){case"point":o=new T({xmin:r.x,ymin:r.y,xmax:r.x,ymax:r.y,spatialReference:r.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=gt(r);break;default:o=r.extent}if(!o)return null;W()||Q(o.spatialReference,n)||await B();const s=E(o,n);if(!s)return null;if(a){const i=s.center,u=i.clone();u.x=D(i.x,a.center.x,n),u.x!==i.x&&s.centerAt(u),a=a.union(s)}else a=s;return a}function Rt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,n=0;for(const a of t){const r=a.layer;r?.minScale&&r.maxScale&&(e=r.minScale<e?r.minScale:e,n=r.maxScale>n?r.maxScale:n)}return e&&n?{min:e,max:n}:null}}}function F(t,e){const n=H(t);return P(n,e)||n.imageCoordinateSystem||e.imageCoordinateSystem?t:E(t,e)}async function Ct(t,e){if(!t||!e)return new k({targetGeometry:new I,scale:0,rotation:0});let n=e.spatialReference;const{constraints:a,padding:r,viewpoint:o,size:s}=e,i=[r?s[0]-r.left-r.right:s[0],r?s[1]-r.top-r.bottom:s[1]];let u=null;t instanceof k?u=t:t.viewpoint?u=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(u=t.target);let c=null;u?.targetGeometry?c=u.targetGeometry:t instanceof T?c=t:t instanceof V?c=await G(t,e,n):t&&(c=await G(t.center,e,n)||await G(t.target,e,n)||await G(t,e,n)),!c&&o?.targetGeometry?c=o.targetGeometry:!c&&e.extent&&(c=e.extent),n||(n=H(e.spatialReference||e.extent||c)),W()||P(c.spatialReference,n)||Q(c.spatialReference,n)||await B();const g=F(c,n),x="center"in g?g.center:g;e.pickClosestTarget!==!1&&x.type==="point"&&o.targetGeometry?.type==="point"&&(x.x=D(x.x,o.targetGeometry.x,x.spatialReference));let w=0;u?w=u.rotation:t.hasOwnProperty("rotation")?w=t.rotation:o&&(w=o.rotation);let p=0;p=u?.targetGeometry!=null&&u.targetGeometry.type==="point"?u.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&a&&a.effectiveLODs?a.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?o.scale:Y(F(c.extent,n),i,w);const f=Rt(t.target??t);f&&(f.min&&f.min<p?p=f.min:f.max&&f.max>p&&(p=f.max));let m=new k({targetGeometry:x,scale:p,rotation:w});return a&&(m=a.fit(m),a.constrainByGeometry(m),a.rotationEnabled||(m.rotation=o.rotation)),m}function b(t,e){const n=t.targetGeometry,a=e.targetGeometry;return n.x=a.x,n.y=a.y,n.spatialReference=a.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function At(t,e,n){return n?y(t,.5*(e[0]-n.right+n.left),.5*(e[1]-n.bottom+n.top)):A(t,e,.5)}const It=(function(){const t=l();return function(e,n,a){const r=n.targetGeometry;j(t,r);const o=.5*R(n);return e.xmin=t[0]-o*a[0],e.ymin=t[1]-o*a[1],e.xmax=t[0]+o*a[0],e.ymax=t[1]+o*a[1],e.spatialReference=r.spatialReference,e}})();function Tt(t,e,n,a,r){return Lt(t,e,n.center),t.scale=Y(n,a),r?.constraints?.constrain(t),t}function St(t,e,n,a){return et(t,e,n,a),dt(t,t)}const Z=(function(){const t=l();return function(e,n,a){return C(e,jt(e,n),At(t,n,a))}})(),kt=(function(){const t=S(),e=l();return function(n,a,r,o){const s=R(a),i=v(a);return y(e,s,s),wt(t,e),K(t,t,i),$(t,t,Z(e,r,o)),$(t,t,[0,o.top-o.bottom]),y(n,t[4],t[5])}})();function R(t){return t.scale*$t(t.targetGeometry?.spatialReference)}function $t(t){return q(t)?1/(X(t)*_*U):1}function v(t){return ft(t.rotation)||0}function Mt(t){return q(t)?X(t)*_*U:1}function jt(t,e){return A(t,e,.5)}const tt=(function(){const t=l(),e=l(),n=l();return function(a,r,o,s,i,u){return yt(t,r),A(e,o,.5*u),y(n,1/s*u,-1/s*u),bt(a,e),i&&K(a,a,i),J(a,a,n),$(a,a,t),a}})(),et=(function(){const t=l();return function(e,n,a,r){const o=R(n),s=v(n);return j(t,n.targetGeometry),tt(e,t,a,o,s,r)}})(),Vt=(function(){const t=l();return function(e,n,a,r){const o=R(n);return j(t,n.targetGeometry),tt(e,t,a,o,0,r)}})();function vt(t){const e=ut(t);return e?e.valid[1]-e.valid[0]:0}function Wt(t,e){return Math.round(vt(t)/e)}const Pt=(function(){const t=l(),e=l(),n=[0,0,0];return function(a,r,o){z(t,a,r),N(t,t),z(e,a,o),N(e,e),ot(n,t,e);let s=Math.acos(st(t,e)/(O(t)*O(e)))*Gt;return n[2]<0&&(s=-s),isNaN(s)&&(s=0),s}})(),Qt=(function(){const t=l();return function(e,n,a,r){const o=e.targetGeometry;return b(e,n),kt(t,n,a,r),o.x+=t[0],o.y+=t[1],e}})(),Lt=function(t,e,n){b(t,e);const a=t.targetGeometry;return a.x=n.x,a.y=n.y,a.spatialReference=n.spatialReference,t},Bt=(function(){const t=l();return function(e,n,a,r,o){o||(o="center"),C(t,a,r),A(t,t,.5);const s=t[0],i=t[1];switch(o){case"center":y(t,0,0);break;case"left":y(t,-s,0);break;case"top":y(t,0,i);break;case"right":y(t,s,0);break;case"bottom":y(t,0,-i);break;case"top-left":y(t,-s,i);break;case"bottom-left":y(t,-s,-i);break;case"top-right":y(t,s,i);break;case"bottom-right":y(t,s,-i)}return L(e,n,t),e}})();function Dt(t,e,n){return b(t,e),t.rotation+=n,t}function Et(t,e,n){return b(t,e),t.rotation=n,t}const zt=(function(){const t=l();return function(e,n,a,r,o){return b(e,n),isNaN(a)||a===0||(nt(t,r,n,o),e.scale=n.scale*a,at(t,t,e,o),L(e,e,y(t,t[0]-r[0],r[1]-t[1]))),e}})();function Jt(t,e,n){return b(t,e),t.scale=n,t}const Nt=(function(){const t=l();return function(e,n,a,r,o,s){return b(e,n),isNaN(a)||a===0||(nt(t,o,n,s),e.scale=n.scale*a,e.rotation+=r,at(t,t,e,s),L(e,e,y(t,t[0]-o[0],o[1]-t[1]))),e}})(),Kt=(function(){const t=l(),e=l();return function(n,a,r,o,s,i,u){return Z(e,i,u),ct(t,s,e),o?Nt(n,a,r,o,t,i):zt(n,a,r,t,i)}})(),nt=(function(){const t=S();return function(e,n,a,r){return M(e,n,St(t,a,r,1))}})(),at=(function(){const t=S();return function(e,n,a,r){return M(e,n,et(t,a,r,1))}})(),L=(function(){const t=l(),e=S();return function(n,a,r){b(n,a);const o=R(a),s=n.targetGeometry;return ht(e,v(a)),J(e,e,it(o,o)),M(t,r,e),s.x+=t[0],s.y+=t[1],n}})();export{At as $,Nt as G,Y as H,Kt as R,Ct as Y,b as Z,It as _,$t as a,Dt as b,Mt as c,Vt as f,Qt as g,Bt as h,Jt as j,L as k,et as l,vt as m,R as o,Pt as p,Z as r,Tt as t,tt as u,Et as w,Lt as x,Wt as y};
